<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>4&nbsp; Stock-Recruitment Analysis – YCT Productivity - Redd Counts</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./ClimateProjectionData.html" rel="next">
<link href="./JoinFishDataWithCovariates.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2486e1f0a3ee9ee1fc393803a1361cdb.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-6561bbde787c299e21493071c8edc6ff.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-a80106726509dab1d2ad658cd225c2ab.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="application/json" class="js-hypothesis-config">
{
  "theme": "clean"
}
</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">

<script src="site_libs/datatables-binding-0.33/datatables.js"></script>

<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">

<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">

<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>

<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>



</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ReddCountsRicker.html">Modeling</a></li><li class="breadcrumb-item"><a href="./ReddCountsRicker.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Stock-Recruitment Analysis</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">YCT Productivity - Redd Counts</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FlowTemp_Covariates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Environmental Covariates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./JoinFishDataWithCovariates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Join Fish and Env. Data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Modeling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ReddCountsRicker.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Stock-Recruitment Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Projections</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ClimateProjectionData.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">GCM Data Summary</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FutureProjections.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Population Projections</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data" id="toc-data" class="nav-link active" data-scroll-target="#data"><span class="header-section-number">4.1</span> Data</a></li>
  <li><a href="#format-fish-data" id="toc-format-fish-data" class="nav-link" data-scroll-target="#format-fish-data"><span class="header-section-number">4.2</span> Format Fish Data</a></li>
  <li><a href="#format-covariate-data" id="toc-format-covariate-data" class="nav-link" data-scroll-target="#format-covariate-data"><span class="header-section-number">4.3</span> Format Covariate Data</a></li>
  <li><a href="#model-in-jags" id="toc-model-in-jags" class="nav-link" data-scroll-target="#model-in-jags"><span class="header-section-number">4.4</span> Model in JAGS</a>
  <ul class="collapse">
  <li><a href="#specify-jags-model" id="toc-specify-jags-model" class="nav-link" data-scroll-target="#specify-jags-model"><span class="header-section-number">4.4.1</span> Specify JAGS model</a></li>
  <li><a href="#age-01-proportional" id="toc-age-01-proportional" class="nav-link" data-scroll-target="#age-01-proportional"><span class="header-section-number">4.4.2</span> Age-0/1 Proportional</a></li>
  <li><a href="#age-0-only" id="toc-age-0-only" class="nav-link" data-scroll-target="#age-0-only"><span class="header-section-number">4.4.3</span> Age-0 only</a></li>
  <li><a href="#loo-cv" id="toc-loo-cv" class="nav-link" data-scroll-target="#loo-cv"><span class="header-section-number">4.4.4</span> LOO-CV</a></li>
  <li><a href="#set-top-model" id="toc-set-top-model" class="nav-link" data-scroll-target="#set-top-model"><span class="header-section-number">4.4.5</span> Set top model</a></li>
  </ul></li>
  <li><a href="#model-diagnostics" id="toc-model-diagnostics" class="nav-link" data-scroll-target="#model-diagnostics"><span class="header-section-number">4.5</span> Model Diagnostics</a>
  <ul class="collapse">
  <li><a href="#residuals" id="toc-residuals" class="nav-link" data-scroll-target="#residuals"><span class="header-section-number">4.5.1</span> Residuals</a></li>
  <li><a href="#bayesian-p-value" id="toc-bayesian-p-value" class="nav-link" data-scroll-target="#bayesian-p-value"><span class="header-section-number">4.5.2</span> Bayesian p-value</a></li>
  <li><a href="#pp-check" id="toc-pp-check" class="nav-link" data-scroll-target="#pp-check"><span class="header-section-number">4.5.3</span> PP Check</a></li>
  </ul></li>
  <li><a href="#plot-model-output" id="toc-plot-model-output" class="nav-link" data-scroll-target="#plot-model-output"><span class="header-section-number">4.6</span> Plot Model Output</a>
  <ul class="collapse">
  <li><a href="#time-series-fits" id="toc-time-series-fits" class="nav-link" data-scroll-target="#time-series-fits"><span class="header-section-number">4.6.1</span> Time series fits</a></li>
  <li><a href="#parameter-dot-plots" id="toc-parameter-dot-plots" class="nav-link" data-scroll-target="#parameter-dot-plots"><span class="header-section-number">4.6.2</span> Parameter dot plots</a></li>
  <li><a href="#marginal-effects" id="toc-marginal-effects" class="nav-link" data-scroll-target="#marginal-effects"><span class="header-section-number">4.6.3</span> Marginal effects</a></li>
  <li><a href="#interactions" id="toc-interactions" class="nav-link" data-scroll-target="#interactions"><span class="header-section-number">4.6.4</span> Interactions</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ReddCountsRicker.html">Modeling</a></li><li class="breadcrumb-item"><a href="./ReddCountsRicker.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Stock-Recruitment Analysis</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Stock-Recruitment Analysis</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Purpose: Fit hierarchical Ricker stock-recruitment model to understand environmental effects on population productivity</p>
<p><strong>Notes:</strong></p>
<ul>
<li>Model is fit with managed winter flow variation as the only winter flow variable.
<ul>
<li>Managed winter flow variables (<em>jld_winmean</em>, <em>jld_winmin</em>, and <em>jld_winvar</em>) are all strongly correlated and alternative models fit with each produce similar results (<em>no effect of managed winter flow</em>)</li>
<li>However, traceplots for global covariate effects for the model with <em>jld_winvar</em> indicate better convergence than for alternative models</li>
</ul></li>
<li>An alternative option for dealing with correlated managed flow variables would be to fit a model with a “management regime” binary variable indicating pre- and post-1989 change in JLD autumn ramp-down and winter flow management.</li>
<li>For all models, ~bi-modal posterior distributions for select global covariate effects (<em>jld_peakmag</em> in particular) suggest that the effects of certain covariates may differ between ages.
<ul>
<li>More exploratory modeling may be warranted. For example, we could treat the base model as an “exploratory” analysis, then after seeing posterior distributions, estimate age-specific effects for problematic variables. Although this complicates the interaction term between managed and natural peak flow magnitude.</li>
</ul></li>
<li>It may be worth considering other natural flow variables, such as annual/winter minimum flow per Clark comment (+), but this may be correlated with managed minimum flows, and combined mean winter flow is correlated with jld_peaktime (?). Additionally, Diana suggests end of summer natural base flow (+), but this is likely correlated with natural peak flow magnitude</li>
</ul>
<section id="data" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="data"><span class="header-section-number">4.1</span> Data</h2>
<p>First, use this to pull fish data</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Derived/ReddCounts_WGFD_1971-2021_cleaned_withFlowTempCovariates_SeparateFlowComponents_age0.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Pull covariate data for age-0, combine experienced and natural flow datasets</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>dat0 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Derived/ReddCounts_WGFD_1971-2021_cleaned_withFlowTempCovariates_SeparateFlowComponents_age0.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>dat0b <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Derived/ReddCounts_WGFD_1971-2021_cleaned_withFlowTempCovariates_ExperiencedFlow_age0.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, stream, natq_winmean, natq_winvar, natq_peakmag, natq_peaktime, z_natq_winmean, z_natq_winvar, z_natq_peakmag, z_natq_peaktime) <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">expq_winmean =</span> natq_winmean,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">expq_winvar =</span> natq_winvar,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">expq_peakmag =</span> natq_peakmag,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">expq_peaktime =</span> natq_peaktime,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">z_expq_winmean =</span> z_natq_winmean,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">z_expq_winvar =</span> z_natq_winvar,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">z_expq_peakmag =</span> z_natq_peakmag,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">z_expq_peaktime =</span> z_natq_peaktime)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>dat0 <span class="ot">&lt;-</span> dat0 <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(dat0b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Pull covariate data for age-1, combine experienced and natural flow datasets</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>dat1 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Derived/ReddCounts_WGFD_1971-2021_cleaned_withFlowTempCovariates_SeparateFlowComponents_age1.csv"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>dat1b <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Derived/ReddCounts_WGFD_1971-2021_cleaned_withFlowTempCovariates_ExperiencedFlow_age1.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, stream, natq_winmean, natq_winvar, natq_peakmag, natq_peaktime, z_natq_winmean, z_natq_winvar, z_natq_peakmag, z_natq_peaktime) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">expq_winmean =</span> natq_winmean,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">expq_winvar =</span> natq_winvar,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">expq_peakmag =</span> natq_peakmag,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">expq_peaktime =</span> natq_peaktime,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">z_expq_winmean =</span> z_natq_winmean,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">z_expq_winvar =</span> z_natq_winvar,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">z_expq_peakmag =</span> z_natq_peakmag,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">z_expq_peaktime =</span> z_natq_peaktime)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>dat1 <span class="ot">&lt;-</span> dat1 <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(dat1b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Drop Cody (very little data), Salt River tribs, and “ghost years”</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>stream <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cody"</span>, <span class="st">"Christiansen"</span>, <span class="st">"Dave"</span>, <span class="st">"Laker"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(stream <span class="sc">==</span> <span class="st">"Cowboy Cabin"</span> <span class="sc">&amp;</span> year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1980</span><span class="sc">:</span><span class="dv">1981</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(stream <span class="sc">==</span> <span class="st">"Flat"</span> <span class="sc">&amp;</span> year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1976</span><span class="sc">:</span><span class="dv">1979</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(stream <span class="sc">==</span> <span class="st">"Spring"</span> <span class="sc">&amp;</span> year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1988</span><span class="sc">:</span><span class="dv">1992</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Create summary table</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>summary.dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(reddsperkm)) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(stream) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="st">'lat'</span> <span class="ot">=</span> <span class="fu">unique</span>(lat), <span class="st">'long'</span> <span class="ot">=</span> <span class="fu">unique</span>(long), <span class="st">'startyr'</span> <span class="ot">=</span> <span class="fu">min</span>(year), <span class="st">'endyr'</span> <span class="ot">=</span> <span class="fu">max</span>(year), <span class="st">'n.year'</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(year)), <span class="st">"med.redds"</span> <span class="ot">=</span> <span class="fu">median</span>(reddsperkm)) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(stream) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(summary.dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-fb7d854d6433324e76df" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-fb7d854d6433324e76df">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13"],["3 Channel","Blacktail","Blue Crane","Cowboy Cabin","Fish","Flat","Little Bar BC","Lower Bar BC","Nowlin","Price","Snake River Side Channel","Spring","Upper Bar BC"],[43.55623017,43.66881478,43.42787225,43.72893903,43.5467974,43.54300482,43.54701598,43.54628223,43.52638051,43.56333321,43.683012,43.4270652,43.67985923],[-110.7882611,-110.6986929,-110.8246243,-110.6741424,-110.8469954,-110.7255992,-110.7867088,-110.7843594,-110.7321466,-110.792471,-110.70152,-110.8209696,-110.7077563],[1973,1973,1985,1982,1984,1980,1978,1971,1976,1975,1986,1993,1974],[2014,2016,2015,2016,2016,2015,2016,2021,2015,2006,2002,2007,2016],[31,33,26,30,24,28,34,39,29,24,17,13,39],[77.13592592894153,254.7628220264208,14.9613312615476,29.51520499086582,42.00738605059631,17.6600672521524,30.44726409584053,152.2363204792026,35.37044808621977,28.82736701124104,34.23890589703017,45.08456322308749,116.1967017535139]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>stream<\/th>\n      <th>lat<\/th>\n      <th>long<\/th>\n      <th>startyr<\/th>\n      <th>endyr<\/th>\n      <th>n.year<\/th>\n      <th>med.redds<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"stream","targets":1},{"name":"lat","targets":2},{"name":"long","targets":3},{"name":"startyr","targets":4},{"name":"endyr","targets":5},{"name":"n.year","targets":6},{"name":"med.redds","targets":7}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(summary.dat, <span class="st">"ReddCounts_DataSummary.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Plot stock-recruit data</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> reddsperkm_lag4, <span class="at">y =</span> reddsperkm, <span class="at">color =</span> broodyr)) <span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> stream, <span class="at">scales =</span> <span class="st">'free'</span>, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">'Spawning redd density (redds/km)'</span>) <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">'Recruitment redd density (redds/km)'</span>) <span class="sc">+</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(g)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Plot productivity by stock/spawners</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> reddsperkm_lag4, <span class="at">y =</span> <span class="fu">log</span>(reddsperkm<span class="sc">/</span>reddsperkm_lag4), <span class="at">color =</span> broodyr)) <span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span><span class="st">'lm'</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> stream, <span class="at">scales =</span> <span class="st">'free'</span>, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">'Spawning redd density (redds/km)'</span>) <span class="sc">+</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">'ln(Recruits/Spawner)'</span>) <span class="sc">+</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(g)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Add misc. variables (currently not used in the model)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># JLD mgmt regime</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">regime =</span> <span class="fu">ifelse</span>(year <span class="sc">&lt;</span> <span class="dv">1989</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Distance from JLD</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>djld <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Flowline Distance/ReddCount_Sites_JLDDistance.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>stream <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Dave"</span>, <span class="st">"Snake River Side Channel"</span>, <span class="st">"Spring"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>How much of the variation in productivity is explained by density-dependence alone? (<em>sensu</em> Jones <em>et al.</em> 2020)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dat2 <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">lnRS =</span> <span class="fu">log</span>(reddsperkm <span class="sc">/</span> reddsperkm_lag4), </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">stream =</span> <span class="fu">as_factor</span>(stream))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(lnRS <span class="sc">~</span> reddsperkm_lag4 <span class="sc">+</span> stream<span class="sc">:</span>reddsperkm_lag4, dat2)) <span class="co"># ~37%</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = lnRS ~ reddsperkm_lag4 + stream:reddsperkm_lag4, 
    data = dat2)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.65491 -0.32585  0.04252  0.32878  2.16889 

Coefficients:
                                                Estimate Std. Error t value
(Intercept)                                     1.059469   0.087723  12.078
reddsperkm_lag4                                -0.012519   0.002065  -6.063
reddsperkm_lag4:streamBlacktail                 0.009026   0.001984   4.550
reddsperkm_lag4:streamBlue Crane               -0.050926   0.008190  -6.218
reddsperkm_lag4:streamCowboy Cabin             -0.013250   0.004807  -2.757
reddsperkm_lag4:streamFish                     -0.010025   0.003744  -2.678
reddsperkm_lag4:streamFlat                     -0.044523   0.008485  -5.247
reddsperkm_lag4:streamLittle Bar BC            -0.017217   0.003412  -5.046
reddsperkm_lag4:streamNowlin                   -0.014566   0.003740  -3.895
reddsperkm_lag4:streamPrice                    -0.016379   0.004442  -3.687
reddsperkm_lag4:streamSnake River Side Channel -0.015236   0.004466  -3.411
reddsperkm_lag4:streamSpring                   -0.010905   0.004186  -2.605
reddsperkm_lag4:streamUpper Bar BC              0.004217   0.002015   2.093
reddsperkm_lag4:streamLower Bar BC              0.005705   0.001978   2.884
                                               Pr(&gt;|t|)    
(Intercept)                                     &lt; 2e-16 ***
reddsperkm_lag4                                4.79e-09 ***
reddsperkm_lag4:streamBlacktail                8.32e-06 ***
reddsperkm_lag4:streamBlue Crane               2.05e-09 ***
reddsperkm_lag4:streamCowboy Cabin             0.006262 ** 
reddsperkm_lag4:streamFish                     0.007895 ** 
reddsperkm_lag4:streamFlat                     3.25e-07 ***
reddsperkm_lag4:streamLittle Bar BC            8.58e-07 ***
reddsperkm_lag4:streamNowlin                   0.000126 ***
reddsperkm_lag4:streamPrice                    0.000277 ***
reddsperkm_lag4:streamSnake River Side Channel 0.000751 ***
reddsperkm_lag4:streamSpring                   0.009720 ** 
reddsperkm_lag4:streamUpper Bar BC             0.037376 *  
reddsperkm_lag4:streamLower Bar BC             0.004260 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.6103 on 255 degrees of freedom
  (189 observations deleted due to missingness)
Multiple R-squared:  0.3973,    Adjusted R-squared:  0.3666 
F-statistic: 12.93 on 13 and 255 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="format-fish-data" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="format-fish-data"><span class="header-section-number">4.2</span> Format Fish Data</h2>
<p>Log annual redd count data and calculate number of years per population</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># log </span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">rcraw_log =</span> <span class="fu">log</span>(reddsperkm))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># how many years of data does each pop have?</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(dat <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>(rcraw_log) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(stream) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">nyr =</span> <span class="fu">n_distinct</span>(rcraw_log)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-31f8a1b51bf8f02ca37a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-31f8a1b51bf8f02ca37a">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13"],["3 Channel","Blacktail","Blue Crane","Cowboy Cabin","Fish","Flat","Little Bar BC","Lower Bar BC","Nowlin","Price","Snake River Side Channel","Spring","Upper Bar BC"],[31,33,24,29,24,26,29,39,28,24,15,13,37]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>stream<\/th>\n      <th>nyr<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"stream","targets":1},{"name":"nyr","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Format fish data into matrices for JAGS model</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># specify populations</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>pops <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>stream))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>n.pops <span class="ot">&lt;-</span> <span class="fu">length</span>(pops)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># specify years</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>n.years <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">length =</span> n.pops)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> n.pops, <span class="at">ncol =</span> <span class="dv">51</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(p <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.pops) {</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  n.years[p] <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>year[dat<span class="sc">$</span>stream <span class="sc">==</span> pops[p]]))</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  years[p,<span class="dv">1</span><span class="sc">:</span>n.years[p]] <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>year[dat<span class="sc">$</span>stream <span class="sc">==</span> pops[p]]))</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Spawners and Recruits</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>rec_raw <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> n.pops, <span class="at">ncol =</span> <span class="fu">max</span>(n.years)) </span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co"># rec_cor &lt;- matrix(nrow = n.pops, ncol = max(n.years))</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co"># rec_cor_sd &lt;- matrix(nrow = n.pops, ncol = max(n.years))</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(p <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.pops) {</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(y <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.years[p]) {</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    year <span class="ot">&lt;-</span> years[p,y]</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    rec_raw[p,y] <span class="ot">&lt;-</span> dat<span class="sc">$</span>rcraw_log[dat<span class="sc">$</span>stream <span class="sc">==</span> pops[p] <span class="sc">&amp;</span> dat<span class="sc">$</span>year <span class="sc">==</span> year] <span class="co"># Raw, uncorrected ecruits (log scale)</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># rec_cor[p,y] &lt;- dat$rccor_log_mean[dat$stream == pops[p] &amp; dat$year == year] # Corrected recruits (log scale)</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># rec_cor_sd[p,y] &lt;- dat$rccor_log_sd[dat$stream == pops[p] &amp; dat$year == year] # recruitment uncertainty</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  }<span class="co">#next y</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>}<span class="co">#next p</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Get maximum spawners for initialization</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>maxY <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">exp</span>(rec_raw), <span class="dv">1</span>, max, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>meanY <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">exp</span>(rec_raw), <span class="dv">1</span>, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Check dimensions</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(years)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13 51</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(rec_raw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13 51</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(rec_cor)</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(rec_cor_sd)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="format-covariate-data" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="format-covariate-data"><span class="header-section-number">4.3</span> Format Covariate Data</h2>
<p>For age apportionment model (split covariate effects among ages 0 and 1), set up two arrays of covariates: one for covariates lagged to reflect conditions during age-0 (4 years) and another for covariates lagged to reflect conditions during age-1 (3 years)</p>
<p>Get covariate names</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># names.covars1 &lt;- grep("z", names(dat0), value = TRUE)[c(1:3,5:8,11,14:19)] # age-0</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># names.covars0 &lt;- grep("z", names(dat0), value = TRUE)[c(1:3,5:8,14:15,20,16:19)] # age-0</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># names.covars0 &lt;- grep("z", names(dat0), value = TRUE)[c(1:3,5:8,20,14:19)] # age-0</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>names.covars0 <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"z"</span>, <span class="fu">names</span>(dat0), <span class="at">value =</span> <span class="cn">TRUE</span>)[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>,<span class="dv">15</span><span class="sc">:</span><span class="dv">20</span>)]<span class="co">#[c(2:3,5,7:9,15:20)] # age-0</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># names.covars2 &lt;- grep("z", names(dat1), value = TRUE)[c(1:3,5:8,11,14:19)] # age-1</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># names.covars1 &lt;- grep("z", names(dat0), value = TRUE)[c(1:3,5:8,14:15,20,16:19)] # age-1</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># names.covars1 &lt;- grep("z", names(dat0), value = TRUE)[c(1:3,5:8,20,14:19)] # age-1</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>names.covars1 <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"z"</span>, <span class="fu">names</span>(dat1), <span class="at">value =</span> <span class="cn">TRUE</span>)[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>,<span class="dv">15</span><span class="sc">:</span><span class="dv">20</span>)]<span class="co">#[c(2:3,5,7:9,15:20)] # age-1</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(names.covars1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "z_jld_rampdur"        "z_jld_rampratemindoy" "z_jld_winvar"        
 [4] "z_jld_summean"        "z_jld_peakmag"        "z_jld_peaktime"      
 [7] "z_natq_peakmag"       "z_natq_peaktime"      "z_temp_falmean"      
[10] "z_temp_winmean"       "z_temp_sprmean"       "z_temp_summean"      </code></pre>
</div>
</div>
<p>Format covariate data into matrices for JAGS model</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>n.covars <span class="ot">&lt;-</span> <span class="fu">length</span>(names.covars0)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>covars0 <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">dim =</span> <span class="fu">c</span>(n.pops, <span class="fu">max</span>(n.years), n.covars))</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>covars1 <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">dim =</span> <span class="fu">c</span>(n.pops, <span class="fu">max</span>(n.years), n.covars))</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(p <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.pops) {</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(y <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.years[p]) {</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    yr <span class="ot">&lt;-</span> years[p,y]</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(c <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.covars) {</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>      covars0[p,y,c] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dat0 <span class="sc">%&gt;%</span> <span class="fu">select</span>(stream, year, names.covars0[c]) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(stream <span class="sc">==</span> pops[p] <span class="sc">&amp;</span> year <span class="sc">==</span> yr) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">3</span>))</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>      covars1[p,y,c] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dat1 <span class="sc">%&gt;%</span> <span class="fu">select</span>(stream, year, names.covars1[c]) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(stream <span class="sc">==</span> pops[p] <span class="sc">&amp;</span> year <span class="sc">==</span> yr) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">3</span>))</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    } <span class="co"># next c</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  } <span class="co"># next y</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#print(p)</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>} <span class="co"># next p</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(covars0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13 51 12</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(covars1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13 51 12</code></pre>
</div>
</div>
<p>Add interaction and/or squared terms, if applicable</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># names.covars0 &lt;- c(names.covars0, "z_int_peaktime", "z_int_peakmag") # add names for additional terms</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># names.covars1 &lt;- c(names.covars1, "z_int_peaktime", "z_int_peakmag") # add names for additional terms</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># covars0 &lt;- abind::abind(covars0, covars0[,,6]*covars0[,,9], covars0[,,5]*covars0[,,8], along = 3)</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># covars1 &lt;- abind::abind(covars1, covars1[,,6]*covars1[,,9], covars1[,,5]*covars1[,,8], along = 3)</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co"># n.covars &lt;- length(names.covars0)</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>names.covars0 <span class="ot">&lt;-</span> <span class="fu">c</span>(names.covars0, <span class="st">"z_int_peakmag"</span>, <span class="st">"z_int_peaktime"</span>) <span class="co"># add names for additional terms</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>names.covars1 <span class="ot">&lt;-</span> <span class="fu">c</span>(names.covars1, <span class="st">"z_int_peakmag"</span>, <span class="st">"z_int_peaktime"</span>) <span class="co"># add names for additional terms</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>covars0 <span class="ot">&lt;-</span> abind<span class="sc">::</span><span class="fu">abind</span>(covars0, covars0[,,<span class="dv">5</span>]<span class="sc">*</span>covars0[,,<span class="dv">7</span>], covars0[,,<span class="dv">6</span>]<span class="sc">*</span>covars0[,,<span class="dv">8</span>], <span class="at">along =</span> <span class="dv">3</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>covars1 <span class="ot">&lt;-</span> abind<span class="sc">::</span><span class="fu">abind</span>(covars1, covars1[,,<span class="dv">5</span>]<span class="sc">*</span>covars1[,,<span class="dv">7</span>], covars0[,,<span class="dv">6</span>]<span class="sc">*</span>covars0[,,<span class="dv">8</span>], <span class="at">along =</span> <span class="dv">3</span>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>n.covars <span class="ot">&lt;-</span> <span class="fu">length</span>(names.covars0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OLD - NOT USED</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # set up covariate array</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># names.covars &lt;- grep("z", names(dat), value = TRUE)[c(1:8,11,14:19)] # for separated flow components</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># names.covars &lt;- grep("z", names(dat), value = TRUE)[c(1:5,7:12)] # for experienced flow</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># names.covars &lt;- grep("z", names(dat), value = TRUE)[c(1:3,5:8,11,14:19)]</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># names.covars &lt;- grep("z", names(dat), value = TRUE)[c(1:3,14:19)]</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># n.covars &lt;- length(names.covars)</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co"># covars &lt;- array(data = NA, dim = c(n.pops, max(n.years), n.covars))</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co"># for(p in 1:n.pops) {</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   for(y in 1:n.years[p]) {</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     yr &lt;- years[p,y]</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     for(c in 1:n.covars) {</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co">#       covars[p,y,c] &lt;- as.numeric(dat %&gt;% select(stream, year, names.covars[c]) %&gt;% filter(stream == pops[p] &amp; year == yr) %&gt;% select(3))</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     } # next c</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   } # next y</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   print(p)</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="co"># } # next p</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(covars)</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a><span class="co"># # (for separate flow components) Full interaction model: add array slices for squared terms, interaction terms</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="co"># names.covars &lt;- c(names.covars, "z_int_peakmag", "z_int_peaktime", "z_int_winmeanflow", "z_int_jldwinmeanvar") # add names for additional terms</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="co"># covars &lt;- abind::abind(covars, covars[,,7]*covars[,,10], covars[,,8]*covars[,,11], covars[,,4]*covars[,,9], covars[,,4]*covars[,,5], along = 3)</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="co"># n.covars &lt;- length(names.covars)</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a><span class="co"># # (for experienced flow) Full interaction model: add array slices for squared terms, interaction terms</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a><span class="co"># names.covars &lt;- c(names.covars, "z_int_winflowmeanvar", "z_int_peakmagtime") # add names for additional terms</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a><span class="co"># covars &lt;- abind::abind(covars, covars[,,4]*covars[,,5], covars[,,6]*covars[,,7], along = 3)</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a><span class="co"># n.covars &lt;- length(names.covars)</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a><span class="co"># names.covars &lt;- c(names.covars, "z_int_peakmag", "z_int_peaktime", "z_int_winmeanvar") # add names for additional terms</span></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a><span class="co"># covars &lt;- abind::abind(covars, covars[,,5]*covars[,,7], covars[,,6]*covars[,,8], covars[,,13]*covars[,,14], along = 3)</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a><span class="co"># n.covars &lt;- length(names.covars)</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a><span class="co"># # check dimensions</span></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(covars)</span></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a><span class="co"># # create matrix for pre/post 1989</span></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a><span class="co"># regime &lt;- matrix(data = NA, nrow = nrow(years), ncol = ncol(years))</span></span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a><span class="co"># for (i in 1:nrow(regime)) { for (j in 1:ncol(regime)) { regime[i,j] &lt;- ifelse(years[i,j] &lt; 1989, 0, 1) }}</span></span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a><span class="co"># # names.covars &lt;- c(names.covars, "regime")</span></span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a><span class="co"># # covars &lt;- abind::abind(covars, regime, along = 3)</span></span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a><span class="co"># # n.covars &lt;- length(names.covars)</span></span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(covars1[,,1] ~ covars2[,,1])</span></span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(covars1[,,2] ~ covars2[,,2])</span></span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(covars1[,,3] ~ covars2[,,3])</span></span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(covars1[,,4] ~ covars2[,,4])</span></span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(covars1[,,5] ~ covars2[,,5])</span></span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(covars1[,,6] ~ covars2[,,6])</span></span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(covars1[,,7] ~ covars2[,,7])</span></span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(covars1[,,8] ~ covars2[,,8])</span></span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(covars1[,,9] ~ covars2[,,9])</span></span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(covars1[,,10] ~ covars2[,,10])</span></span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(covars1[,,11] ~ covars2[,,11])</span></span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(covars1[,,12] ~ covars2[,,12])</span></span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(covars1[,,13] ~ covars2[,,13])</span></span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(covars1[,,14] ~ covars2[,,14])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Add empty columns for model initialization</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># recruitment</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>rec_raw <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(rec_raw), <span class="at">ncol =</span> <span class="dv">4</span>), rec_raw)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># rec_cor &lt;- cbind(matrix(NA, nrow = nrow(rec_cor), ncol = 4), rec_cor)</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rec_cor_sd &lt;- cbind(matrix(NA, nrow = nrow(rec_cor_sd), ncol = 4), rec_cor_sd)</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># covariates</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># rl &lt;- list()</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co"># for (i in 1:dim(covars)[3]) { rl[[i]] &lt;- cbind(matrix(NA, nrow = nrow(covars), ncol = 4), covars[,,i]) }</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co"># covars &lt;- abind::abind(rl, along = 3)</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>rl <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(covars0)[<span class="dv">3</span>]) { rl[[i]] <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(covars0), <span class="at">ncol =</span> <span class="dv">4</span>), covars0[,,i]) }</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>covars0 <span class="ot">&lt;-</span> abind<span class="sc">::</span><span class="fu">abind</span>(rl, <span class="at">along =</span> <span class="dv">3</span>)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>rl <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(covars1)[<span class="dv">3</span>]) { rl[[i]] <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(covars1), <span class="at">ncol =</span> <span class="dv">4</span>), covars1[,,i]) }</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>covars1 <span class="ot">&lt;-</span> abind<span class="sc">::</span><span class="fu">abind</span>(rl, <span class="at">along =</span> <span class="dv">3</span>)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="co"># years</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>n.years <span class="ot">&lt;-</span> n.years <span class="sc">+</span> <span class="dv">4</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co"># regime</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="co"># regime &lt;- cbind(matrix(NA, nrow = nrow(regime), ncol = 4), regime)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Check dimensions</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check dimensions</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(rec_raw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13 55</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(rec_cor)</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(rec_cor_sd)</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(covars)</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(covars0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13 55 14</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(covars1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13 55 14</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(n.years)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 55</code></pre>
</div>
</div>
</section>
<section id="model-in-jags" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="model-in-jags"><span class="header-section-number">4.4</span> Model in JAGS</h2>
<section id="specify-jags-model" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="specify-jags-model"><span class="header-section-number">4.4.1</span> Specify JAGS model</h3>
<p>State-space hierarchical Ricker stock-recruitment model with auto-correlated residuals, where observation error is an estimated parameter. Covariates can affect productivity at either age-0 or age-1, with a parameter that estimates the relative importance of effects at each age class. Observations are distributed log-normally around (latent, phases 1-2) redd densities. Log-log scale ensures positive values and allows sigma.oe to be estimated on a log-scale and directly compared to net error model estimates of redd count error from Baldock <em>et al.</em> (2023 CJFAS): 0.38 (mean and 95% CI = 0.34, 0.44)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"model {</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="st">##--- LIKELIHOOD ---------------------------------------------------##</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="st"># OBSERVATION PROCESS</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="st">for (j in 1:numPops) {</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:numYears[j]) {</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="st">        logY0[j,i] ~ dnorm(logY[j,i], pow(sigma.oe, -2)) </span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="st">        N[j,i] &lt;- exp(logY[j,i])</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="st"># STATE PROCESS</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="st">for (j in 1:numPops) {</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="st">    # STARTING VALUES / INITIALIZATION</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="st">    Y1[j] ~ dunif(1, maxY[j])</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="st">    Y2[j] ~ dunif(1, maxY[j])</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="st">    Y3[j] ~ dunif(1, maxY[j])</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="st">    Y4[j] ~ dunif(1, maxY[j])</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="st">    logY[j,1] &lt;- log(Y1[j])</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="st">    logY[j,2] &lt;- log(Y2[j])</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="st">    logY[j,3] &lt;- log(Y3[j])</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a><span class="st">    logY[j,4] &lt;- log(Y4[j])</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="st">    logresid[j,4] &lt;- 0</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a><span class="st">    # ALL OTHER YEARS</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 5:numYears[j]) {</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="st">        # Derive population and year specific covariate effects </span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a><span class="st">        for (c in 1:numCovars) { </span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a><span class="st">            covars0[j,i,c] ~ dnorm(0, pow(1, -2))</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a><span class="st">            covars1[j,i,c] ~ dnorm(0, pow(1, -2))</span></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a><span class="st">            cov.eff[j,i,c] &lt;- coef[j,c] * (((1-p[c]) * covars0[j,i,c]) + (p[c] * covars1[j,i,c])) }</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a><span class="st">        # Likelihood and predictions</span></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a><span class="st">        logY[j,i] ~ dnorm(logpred2[j,i], pow(sigma.pe[j], -2))</span></span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a><span class="st">        logpred[j,i] &lt;- logY[j,i-4] + A[j] - B[j] * exp(logY[j,i-4]) + sum(cov.eff[j,i,1:numCovars])</span></span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a><span class="st">        # save observations and latent states in loop to exclude starting values from model object</span></span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a><span class="st">        loglatent[j,i] &lt;- logY[j,i]</span></span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a><span class="st">        logobserv[j,i] &lt;- logY0[j,i]</span></span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a><span class="st">        # Auto-correlated residuals</span></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a><span class="st">        logresid[j,i] &lt;- logY[j,i] - logpred[j,i]</span></span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a><span class="st">        logpred2[j,i] &lt;- logpred[j,i] + logresid[j,i-1] * phi[j]</span></span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a><span class="st">        logresid2[j,i] &lt;- logY[j,i] - logpred2[j,i]</span></span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a><span class="st">        # Log-likelihood</span></span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a><span class="st">        loglik[j,i] &lt;- logdensity.norm(logY0[j,i], logY[j,i], pow(sigma.oe, -2))</span></span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a><span class="st">##--- PRIORS --------------------------------------------------------##</span></span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a><span class="st"># Observation error is shared among populations, constrained prior...consider centering this on Baldock et al (2023) CJFAS estimate</span></span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a><span class="st">sigma.oe ~ dunif(0.001, 100) #dnorm(0, pow(0.5, -2)) T(0,)</span></span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a><span class="st"># Population-specific parameters</span></span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a><span class="st">for (j in 1:numPops) {</span></span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a><span class="st">    # Ricker A</span></span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a><span class="st">    #expA[j] ~ dunif(0, 20)</span></span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true" tabindex="-1"></a><span class="st">    #A[j] &lt;- log(expA[j])</span></span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true" tabindex="-1"></a><span class="st">    A[j] ~ dnorm(mu.A, pow(sigma.A, -2)) </span></span>
<span id="cb37-68"><a href="#cb37-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-69"><a href="#cb37-69" aria-hidden="true" tabindex="-1"></a><span class="st">    # Ricker B</span></span>
<span id="cb37-70"><a href="#cb37-70" aria-hidden="true" tabindex="-1"></a><span class="st">    B[j] ~ dnorm(0, pow(1, -2)) T(0,)</span></span>
<span id="cb37-71"><a href="#cb37-71" aria-hidden="true" tabindex="-1"></a><span class="st">    #B[j] ~ dnorm(mu.B, pow(sigma.B, -2))</span></span>
<span id="cb37-72"><a href="#cb37-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-73"><a href="#cb37-73" aria-hidden="true" tabindex="-1"></a><span class="st">    # Covariate effects</span></span>
<span id="cb37-74"><a href="#cb37-74" aria-hidden="true" tabindex="-1"></a><span class="st">    for (c in 1:numCovars) { coef[j,c] ~ dnorm(mu.coef[c], pow(sigma.coef[c], -2)) }</span></span>
<span id="cb37-75"><a href="#cb37-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-76"><a href="#cb37-76" aria-hidden="true" tabindex="-1"></a><span class="st">    # Process error</span></span>
<span id="cb37-77"><a href="#cb37-77" aria-hidden="true" tabindex="-1"></a><span class="st">    sigma.pe[j] ~ dunif(0.001, 100) #dnorm(0, pow(5, -2)) T(0,)</span></span>
<span id="cb37-78"><a href="#cb37-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-79"><a href="#cb37-79" aria-hidden="true" tabindex="-1"></a><span class="st">    # auto-correlated residuals</span></span>
<span id="cb37-80"><a href="#cb37-80" aria-hidden="true" tabindex="-1"></a><span class="st">    phi[j] ~ dunif(-0.99, 0.99)</span></span>
<span id="cb37-81"><a href="#cb37-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-82"><a href="#cb37-82" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb37-83"><a href="#cb37-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-84"><a href="#cb37-84" aria-hidden="true" tabindex="-1"></a><span class="st"># Global Ricker A and B</span></span>
<span id="cb37-85"><a href="#cb37-85" aria-hidden="true" tabindex="-1"></a><span class="st">mu.A &lt;- log(exp.mu.A) #dunif(0, 20)</span></span>
<span id="cb37-86"><a href="#cb37-86" aria-hidden="true" tabindex="-1"></a><span class="st">exp.mu.A ~ dunif(0, 20)</span></span>
<span id="cb37-87"><a href="#cb37-87" aria-hidden="true" tabindex="-1"></a><span class="st">sigma.A ~ dunif(0.001, 100)</span></span>
<span id="cb37-88"><a href="#cb37-88" aria-hidden="true" tabindex="-1"></a><span class="st">#mu.B ~ dnorm(0, pow(1, -2)) T(0,)</span></span>
<span id="cb37-89"><a href="#cb37-89" aria-hidden="true" tabindex="-1"></a><span class="st">#sigma.B ~ dunif(0.001, 100)</span></span>
<span id="cb37-90"><a href="#cb37-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-91"><a href="#cb37-91" aria-hidden="true" tabindex="-1"></a><span class="st"># Global covariate effects</span></span>
<span id="cb37-92"><a href="#cb37-92" aria-hidden="true" tabindex="-1"></a><span class="st">for (c in 1:numCovars) { </span></span>
<span id="cb37-93"><a href="#cb37-93" aria-hidden="true" tabindex="-1"></a><span class="st">    mu.coef[c] ~ dnorm(0, pow(25, -2)) </span></span>
<span id="cb37-94"><a href="#cb37-94" aria-hidden="true" tabindex="-1"></a><span class="st">    sigma.coef[c] ~ dunif(0.001, 100) #dnorm(0, pow(5, -2)) T(0.001,100)</span></span>
<span id="cb37-95"><a href="#cb37-95" aria-hidden="true" tabindex="-1"></a><span class="st">    p[c] ~ dunif(0, 1)</span></span>
<span id="cb37-96"><a href="#cb37-96" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb37-97"><a href="#cb37-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-98"><a href="#cb37-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-99"><a href="#cb37-99" aria-hidden="true" tabindex="-1"></a><span class="st">##--- DERIVED QUANTITIES ---------------------------------------------##</span></span>
<span id="cb37-100"><a href="#cb37-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-101"><a href="#cb37-101" aria-hidden="true" tabindex="-1"></a><span class="st"># Population specific carrying capacity</span></span>
<span id="cb37-102"><a href="#cb37-102" aria-hidden="true" tabindex="-1"></a><span class="st">for (j in 1:numPops) { K[j] &lt;- A[j] / B[j] }</span></span>
<span id="cb37-103"><a href="#cb37-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-104"><a href="#cb37-104" aria-hidden="true" tabindex="-1"></a><span class="st">}"</span>, <span class="at">file =</span> <span class="st">"JAGS Models/Ricker_Hierarchical_StateSpace_OEestimated_Covars_Proportional.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Same as above, but covariates only affect productivity at age-0</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"model {</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="st">##--- LIKELIHOOD ---------------------------------------------------##</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="st"># OBSERVATION PROCESS</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="st">for (j in 1:numPops) {</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:numYears[j]) {</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="st">        logY0[j,i] ~ dnorm(logY[j,i], pow(sigma.oe, -2)) </span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="st">        N[j,i] &lt;- exp(logY[j,i])</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="st"># STATE PROCESS</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="st">for (j in 1:numPops) {</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="st">    # STARTING VALUES / INITIALIZATION</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="st">    Y1[j] ~ dunif(1, maxY[j])</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="st">    Y2[j] ~ dunif(1, maxY[j])</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="st">    Y3[j] ~ dunif(1, maxY[j])</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="st">    Y4[j] ~ dunif(1, maxY[j])</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="st">    logY[j,1] &lt;- log(Y1[j])</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="st">    logY[j,2] &lt;- log(Y2[j])</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="st">    logY[j,3] &lt;- log(Y3[j])</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="st">    logY[j,4] &lt;- log(Y4[j])</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="st">    logresid[j,4] &lt;- 0</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a><span class="st">    # ALL OTHER YEARS</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 5:numYears[j]) {</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a><span class="st">        # Derive population and year specific covariate effects </span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a><span class="st">        for (c in 1:numCovars) { </span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a><span class="st">            covars[j,i,c] ~ dnorm(0, pow(1, -2))</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a><span class="st">            cov.eff[j,i,c] &lt;- coef[j,c] * covars[j,i,c] }</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a><span class="st">        # Likelihood and predictions</span></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a><span class="st">        logY[j,i] ~ dnorm(logpred2[j,i], pow(sigma.pe[j], -2))</span></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a><span class="st">        logpred[j,i] &lt;- logY[j,i-4] + A[j] - B[j] * exp(logY[j,i-4]) + sum(cov.eff[j,i,1:numCovars])</span></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a><span class="st">                </span></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a><span class="st">        # save observations and latent states in loop to exclude starting values from model object</span></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a><span class="st">        loglatent[j,i] &lt;- logY[j,i]</span></span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a><span class="st">        logobserv[j,i] &lt;- logY0[j,i]</span></span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a><span class="st">        # Auto-correlated residuals</span></span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a><span class="st">        logresid[j,i] &lt;- logY[j,i] - logpred[j,i]</span></span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a><span class="st">        logpred2[j,i] &lt;- logpred[j,i] + logresid[j,i-1] * phi[j]</span></span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a><span class="st">        logresid2[j,i] &lt;- logY[j,i] - logpred2[j,i]</span></span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a><span class="st">        # Log-likelihood</span></span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a><span class="st">        loglik[j,i] &lt;- logdensity.norm(logY0[j,i], logY[j,i], pow(sigma.oe, -2))</span></span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a><span class="st">##--- PRIORS --------------------------------------------------------##</span></span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a><span class="st"># Observation error is shared among populations, constrained prior...consider centering this on Baldock et al (2023) CJFAS estimate</span></span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a><span class="st">sigma.oe ~ dunif(0.001, 100) #dnorm(0, pow(0.5, -2)) T(0,)</span></span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a><span class="st"># Population-specific parameters</span></span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a><span class="st">for (j in 1:numPops) {</span></span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a><span class="st">    # Ricker A</span></span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a><span class="st">    #expA[j] ~ dunif(0, 20)</span></span>
<span id="cb38-65"><a href="#cb38-65" aria-hidden="true" tabindex="-1"></a><span class="st">    #A[j] &lt;- log(expA[j])</span></span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a><span class="st">    A[j] ~ dnorm(mu.A, pow(sigma.A, -2)) </span></span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a><span class="st">    # Ricker B</span></span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a><span class="st">    B[j] ~ dnorm(0, pow(1, -2)) T(0,)</span></span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a><span class="st">    #B[j] ~ dnorm(mu.B, pow(sigma.B, -2))</span></span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a><span class="st">    # Covariate effects</span></span>
<span id="cb38-73"><a href="#cb38-73" aria-hidden="true" tabindex="-1"></a><span class="st">    for (c in 1:numCovars) { coef[j,c] ~ dnorm(mu.coef[c], pow(sigma.coef[c], -2)) }</span></span>
<span id="cb38-74"><a href="#cb38-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-75"><a href="#cb38-75" aria-hidden="true" tabindex="-1"></a><span class="st">    # Process error</span></span>
<span id="cb38-76"><a href="#cb38-76" aria-hidden="true" tabindex="-1"></a><span class="st">    sigma.pe[j] ~ dunif(0.001, 100) #dnorm(0, pow(5, -2)) T(0,)</span></span>
<span id="cb38-77"><a href="#cb38-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-78"><a href="#cb38-78" aria-hidden="true" tabindex="-1"></a><span class="st">    # auto-correlated residuals</span></span>
<span id="cb38-79"><a href="#cb38-79" aria-hidden="true" tabindex="-1"></a><span class="st">    phi[j] ~ dunif(-0.99, 0.99)</span></span>
<span id="cb38-80"><a href="#cb38-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-81"><a href="#cb38-81" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb38-82"><a href="#cb38-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-83"><a href="#cb38-83" aria-hidden="true" tabindex="-1"></a><span class="st"># Global Ricker A and B</span></span>
<span id="cb38-84"><a href="#cb38-84" aria-hidden="true" tabindex="-1"></a><span class="st">mu.A &lt;- log(exp.mu.A) #dunif(0, 20)</span></span>
<span id="cb38-85"><a href="#cb38-85" aria-hidden="true" tabindex="-1"></a><span class="st">exp.mu.A ~ dunif(0, 20)</span></span>
<span id="cb38-86"><a href="#cb38-86" aria-hidden="true" tabindex="-1"></a><span class="st">sigma.A ~ dunif(0.001, 100)</span></span>
<span id="cb38-87"><a href="#cb38-87" aria-hidden="true" tabindex="-1"></a><span class="st">#mu.B ~ dnorm(0, pow(1, -2)) T(0,)</span></span>
<span id="cb38-88"><a href="#cb38-88" aria-hidden="true" tabindex="-1"></a><span class="st">#sigma.B ~ dunif(0.001, 100)</span></span>
<span id="cb38-89"><a href="#cb38-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-90"><a href="#cb38-90" aria-hidden="true" tabindex="-1"></a><span class="st"># Global covariate effects</span></span>
<span id="cb38-91"><a href="#cb38-91" aria-hidden="true" tabindex="-1"></a><span class="st">for (c in 1:numCovars) { </span></span>
<span id="cb38-92"><a href="#cb38-92" aria-hidden="true" tabindex="-1"></a><span class="st">    mu.coef[c] ~ dnorm(0, pow(25, -2)) </span></span>
<span id="cb38-93"><a href="#cb38-93" aria-hidden="true" tabindex="-1"></a><span class="st">    sigma.coef[c] ~ dunif(0.001, 100) #dnorm(0, pow(5, -2)) T(0.001,100)</span></span>
<span id="cb38-94"><a href="#cb38-94" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb38-95"><a href="#cb38-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-96"><a href="#cb38-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-97"><a href="#cb38-97" aria-hidden="true" tabindex="-1"></a><span class="st">##--- DERIVED QUANTITIES ---------------------------------------------##</span></span>
<span id="cb38-98"><a href="#cb38-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-99"><a href="#cb38-99" aria-hidden="true" tabindex="-1"></a><span class="st"># Population specific carrying capacity</span></span>
<span id="cb38-100"><a href="#cb38-100" aria-hidden="true" tabindex="-1"></a><span class="st">for (j in 1:numPops) { K[j] &lt;- A[j] / B[j] }</span></span>
<span id="cb38-101"><a href="#cb38-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-102"><a href="#cb38-102" aria-hidden="true" tabindex="-1"></a><span class="st">}"</span>, <span class="at">file =</span> <span class="st">"JAGS Models/Ricker_Hierarchical_StateSpace_OEestimated_Covars.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="age-01-proportional" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="age-01-proportional"><span class="header-section-number">4.4.2</span> Age-0/1 Proportional</h3>
<p>Parameters to monitor</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>jags.params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"K"</span>, <span class="st">"mu.A"</span>, <span class="st">"sigma.A"</span>, <span class="st">"sigma.oe"</span>, <span class="st">"sigma.pe"</span>,   <span class="co"># Ricker parameters</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"coef"</span>, <span class="st">"mu.coef"</span>, <span class="st">"sigma.coef"</span>, <span class="st">"cov.eff"</span>, <span class="st">"p"</span>,            <span class="co"># covariate effects</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"logpred"</span>, <span class="st">"logpred2"</span>,                                      <span class="co"># predictions</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"loglatent"</span>, <span class="st">"logobserv"</span>,                                   <span class="co"># latent states and observations</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"phi"</span>, <span class="st">"logresid"</span>, <span class="st">"logresid2"</span>, <span class="st">"loglik"</span>)                   <span class="co"># AR1 term, residuals, log-likelihood</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Run model in JAGS</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>st <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>jags.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"logY0"</span> <span class="ot">=</span> rec_raw, <span class="st">"numYears"</span> <span class="ot">=</span> n.years, <span class="st">"numPops"</span> <span class="ot">=</span> n.pops, <span class="st">"maxY"</span> <span class="ot">=</span> maxY, <span class="st">"covars0"</span> <span class="ot">=</span> covars0, <span class="st">"covars1"</span> <span class="ot">=</span> covars1, <span class="st">"numCovars"</span> <span class="ot">=</span> n.covars)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>mod_01pb <span class="ot">&lt;-</span> <span class="fu">jags.parallel</span>(<span class="at">data =</span> jags.data, <span class="at">inits =</span> <span class="cn">NULL</span>, <span class="at">parameters.to.save =</span> jags.params, </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">model.file =</span> <span class="st">"JAGS Models/Ricker_Hierarchical_StateSpace_OEestimated_Covars_Proportional.txt"</span>, </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">n.chains =</span> <span class="dv">20</span>, <span class="at">n.thin =</span> <span class="dv">200</span>, <span class="at">n.burnin =</span> <span class="dv">10000</span>, <span class="at">n.iter =</span> <span class="dv">60000</span>, <span class="at">DIC =</span> <span class="cn">TRUE</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="fu">MCMCtrace</span>(mod_01pb, <span class="at">ind =</span> <span class="cn">TRUE</span>, <span class="at">params =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"mu.A"</span>, <span class="st">"sigma.A"</span>, <span class="st">"sigma.oe"</span>, <span class="st">"sigma.pe"</span>, <span class="st">"mu.coef"</span>, <span class="st">"sigma.coef"</span>, <span class="st">"p"</span>, <span class="st">"phi"</span>),</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">filename =</span> <span class="st">"Model output/MCMCtrace_ReddCountsRicker_Test_Age01p_winvar.pdf"</span>) <span class="co"># write out traceplots</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.time</span>() <span class="sc">-</span> st</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="fu">beep</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Save model output as RDS file</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(mod_01pb, <span class="st">"Model output/ReddCountsRicker_Phase1_Age01p_winvar.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Read in model RDS file</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>mod_01pb <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"Model output/ReddCountsRicker_Phase1_Age01p_winvar.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Check R-hat values</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>mod_01pb<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>][mod_01pb<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>] <span class="sc">&gt;</span> <span class="fl">1.05</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  K[11] 
1.28153 </code></pre>
</div>
</div>
</section>
<section id="age-0-only" class="level3" data-number="4.4.3">
<h3 data-number="4.4.3" class="anchored" data-anchor-id="age-0-only"><span class="header-section-number">4.4.3</span> Age-0 only</h3>
<p><em>NOT CURRENTLY USED</em></p>
<p>Parameters to monitor</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>jags.params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"K"</span>, <span class="st">"mu.A"</span>, <span class="st">"sigma.A"</span>, <span class="st">"sigma.oe"</span>, <span class="st">"sigma.pe"</span>,   <span class="co"># Ricker parameters</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"coef"</span>, <span class="st">"mu.coef"</span>, <span class="st">"sigma.coef"</span>, <span class="st">"cov.eff"</span>,            <span class="co"># covariate effects</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"logpred"</span>, <span class="st">"logpred2"</span>,                                      <span class="co"># predictions</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"loglatent"</span>, <span class="st">"logobserv"</span>,                                   <span class="co"># latent states and observations</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"phi"</span>, <span class="st">"logresid"</span>, <span class="st">"logresid2"</span>, <span class="st">"loglik"</span>)                   <span class="co"># AR1 term, residuals, log-likelihood</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Run model in JAGS</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>st <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>jags.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"logY0"</span> <span class="ot">=</span> rec_raw, <span class="st">"numYears"</span> <span class="ot">=</span> n.years, <span class="st">"numPops"</span> <span class="ot">=</span> n.pops, <span class="st">"maxY"</span> <span class="ot">=</span> maxY, <span class="st">"covars"</span> <span class="ot">=</span> covars0, <span class="st">"numCovars"</span> <span class="ot">=</span> n.covars)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>mod_0 <span class="ot">&lt;-</span> <span class="fu">jags.parallel</span>(<span class="at">data =</span> jags.data, <span class="at">inits =</span> <span class="cn">NULL</span>, <span class="at">parameters.to.save =</span> jags.params, </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">model.file =</span> <span class="st">"JAGS Models/Ricker_Hierarchical_StateSpace_OEestimated_Covars.txt"</span>, </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">n.chains =</span> <span class="dv">20</span>, <span class="at">n.thin =</span> <span class="dv">200</span>, <span class="at">n.burnin =</span> <span class="dv">10000</span>, <span class="at">n.iter =</span> <span class="dv">40000</span>, <span class="at">DIC =</span> <span class="cn">TRUE</span>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="fu">MCMCtrace</span>(mod_0, <span class="at">ind =</span> <span class="cn">TRUE</span>, <span class="at">params =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"mu.A"</span>, <span class="st">"sigma.A"</span>, <span class="st">"sigma.oe"</span>, <span class="st">"sigma.pe"</span>, <span class="st">"mu.coef"</span>, <span class="st">"sigma.coef"</span>, <span class="st">"p"</span>, <span class="st">"phi"</span>),</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">filename =</span> <span class="st">"Model output/MCMCtrace_ReddCountsRicker_Test_Age0.pdf"</span>) <span class="co"># write out traceplots</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.time</span>() <span class="sc">-</span> st</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="fu">beep</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Check R-hat values</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>mod_0<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>][mod_0<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>] <span class="sc">&gt;</span> <span class="fl">1.05</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Save model output as RDS file</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(mod_0, <span class="st">"Model output/ReddCountsRicker_Phase1_Age0.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Read in model RDS file</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>mod_0 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"Redd Counts Ricker/Model output/ReddCountsRicker_Phase1_Age0.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="loo-cv" class="level3" data-number="4.4.4">
<h3 data-number="4.4.4" class="anchored" data-anchor-id="loo-cv"><span class="header-section-number">4.4.4</span> LOO-CV</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>ll.arr <span class="ot">&lt;-</span> mod_01pb<span class="sc">$</span>BUGSoutput<span class="sc">$</span>sims.list<span class="sc">$</span>loglik <span class="co"># extract the log-likelihood estimates for each MCMC sample</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>ll.mat <span class="ot">&lt;-</span> ll.arr[,,<span class="dv">1</span>]</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">dim</span>(ll.arr)[<span class="dv">3</span>]) {</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  ll.mat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(ll.mat, ll.arr[,,j])</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>rf <span class="ot">&lt;-</span> <span class="fu">relative_eff</span>(<span class="fu">exp</span>(ll.mat), <span class="at">chain_id =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="at">each =</span> <span class="dv">250</span>))</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>my_loo <span class="ot">&lt;-</span> <span class="fu">loo</span>(ll.mat, <span class="at">r_eff =</span> rf)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(my_loo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="set-top-model" class="level3" data-number="4.4.5">
<h3 data-number="4.4.5" class="anchored" data-anchor-id="set-top-model"><span class="header-section-number">4.4.5</span> Set top model</h3>
<p>Set top model and save MCMC samples and parameter summary</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>topmod <span class="ot">&lt;-</span> mod_01pb</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># generate MCMC samples and store as an array</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>modelout <span class="ot">&lt;-</span> topmod<span class="sc">$</span>BUGSoutput</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>param.summary <span class="ot">&lt;-</span> modelout<span class="sc">$</span>summary</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>McmcList <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">dim</span>(modelout<span class="sc">$</span>sims.array)[<span class="dv">2</span>])</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(McmcList)) {</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  McmcList[[i]] <span class="ot">=</span> <span class="fu">as.mcmc</span>(modelout<span class="sc">$</span>sims.array[,i,])</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="co"># rbind MCMC samples from 3 chains </span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>Mcmcdat <span class="ot">&lt;-</span> <span class="fu">rbind</span>(McmcList[[<span class="dv">1</span>]], McmcList[[<span class="dv">2</span>]], McmcList[[<span class="dv">3</span>]], McmcList[[<span class="dv">4</span>]], McmcList[[<span class="dv">5</span>]], </span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>                 McmcList[[<span class="dv">6</span>]], McmcList[[<span class="dv">7</span>]], McmcList[[<span class="dv">8</span>]], McmcList[[<span class="dv">9</span>]], McmcList[[<span class="dv">10</span>]], </span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>                 McmcList[[<span class="dv">11</span>]], McmcList[[<span class="dv">12</span>]], McmcList[[<span class="dv">13</span>]], McmcList[[<span class="dv">14</span>]], McmcList[[<span class="dv">15</span>]], </span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>                 McmcList[[<span class="dv">16</span>]], McmcList[[<span class="dv">17</span>]], McmcList[[<span class="dv">18</span>]], McmcList[[<span class="dv">19</span>]], McmcList[[<span class="dv">20</span>]])</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>param.summary <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(modelout<span class="sc">$</span>summary)</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a><span class="co"># save model output</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(<span class="fu">as.data.frame</span>(Mcmcdat), <span class="st">"Model output/ReddCountsRicker_Phase1_Age01p_mcmcsamps.csv"</span>)</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">as.data.frame</span>(modelout<span class="sc">$</span>summary), <span class="st">"Model output/ReddCountsRicker_Phase1_Age01p_ParameterSummary.csv"</span>, <span class="at">row.names =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="model-diagnostics" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="model-diagnostics"><span class="header-section-number">4.5</span> Model Diagnostics</h2>
<p>Get expected and observed MCMC samples</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>ppdat_exp <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Mcmcdat[,<span class="fu">startsWith</span>(<span class="fu">colnames</span>(Mcmcdat), <span class="st">"logpred2"</span>)])</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>ppdat_obs <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Mcmcdat[,<span class="fu">startsWith</span>(<span class="fu">colnames</span>(Mcmcdat), <span class="st">"loglatent"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="residuals" class="level3" data-number="4.5.1">
<h3 data-number="4.5.1" class="anchored" data-anchor-id="residuals"><span class="header-section-number">4.5.1</span> Residuals</h3>
<p>Histogram of residuals</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">2.5</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>((ppdat_obs <span class="sc">-</span> ppdat_exp), <span class="at">main =</span> <span class="st">""</span>, <span class="at">xlab =</span> <span class="st">"Observed - Expected"</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">legend =</span> <span class="fu">paste</span>(<span class="st">"Median Resid. = "</span>, <span class="fu">round</span>(<span class="fu">median</span>((ppdat_obs <span class="sc">-</span> ppdat_exp)), <span class="at">digits =</span> <span class="dv">4</span>), <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">median</span>(<span class="fu">unlist</span>(ppdat_obs <span class="sc">-</span> ppdat_exp)), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">bty =</span> <span class="st">"o"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="before-autocorrelation" class="level4" data-number="4.5.1.1">
<h4 data-number="4.5.1.1" class="anchored" data-anchor-id="before-autocorrelation"><span class="header-section-number">4.5.1.1</span> Before autocorrelation</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>logresid <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(rec_raw), <span class="at">ncol =</span> <span class="fu">ncol</span>(rec_raw)<span class="sc">+</span><span class="dv">4</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(rec_raw)) {</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(rec_raw)<span class="sc">+</span><span class="dv">4</span>) {</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">try</span>(logresid[j,i] <span class="ot">&lt;-</span> param.summary[<span class="fu">paste</span>(<span class="st">"logresid["</span>,j,<span class="st">","</span>,i,<span class="st">"]"</span>, <span class="at">sep =</span> <span class="st">""</span>),<span class="dv">1</span>])</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Time series of residuals (AR1)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="fl">0.8</span>,<span class="dv">0</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="dv">3</span>, <span class="fl">1.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.pops) {</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(logresid[i,<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">55</span>)] <span class="sc">~</span> years[i,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">51</span>)], <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">"log residuals"</span>, <span class="at">main =</span> pops[i], <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1970</span>, <span class="dv">2021</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(logresid, <span class="at">na.rm =</span> T), <span class="fu">max</span>(logresid, <span class="at">na.rm =</span> T)))</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(logresid[i,<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">55</span>)] <span class="sc">~</span> years[i,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">51</span>)])</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>time series of residuals (AR1), unique y scale</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="fl">0.8</span>,<span class="dv">0</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="dv">3</span>, <span class="fl">1.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.pops) {</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(logresid[i,<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">55</span>)] <span class="sc">~</span> years[i,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">51</span>)], <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">"log residuals"</span>, <span class="at">main =</span> pops[i], <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1970</span>, <span class="dv">2021</span>))</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(logresid[i,<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">55</span>)] <span class="sc">~</span> years[i,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">51</span>)])</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="after-autocorrelation" class="level4" data-number="4.5.1.2">
<h4 data-number="4.5.1.2" class="anchored" data-anchor-id="after-autocorrelation"><span class="header-section-number">4.5.1.2</span> After autocorrelation</h4>
<p>Residuals AFTER accounting for autocorrelation sensu Murdoch et al 2024 CJFAS</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>logresid <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(rec_raw), <span class="at">ncol =</span> <span class="fu">ncol</span>(rec_raw)<span class="sc">+</span><span class="dv">4</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(rec_raw)) {</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(rec_raw)<span class="sc">+</span><span class="dv">4</span>) {</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">try</span>(logresid[j,i] <span class="ot">&lt;-</span> param.summary[<span class="fu">paste</span>(<span class="st">"logresid2["</span>,j,<span class="st">","</span>,i,<span class="st">"]"</span>, <span class="at">sep =</span> <span class="st">""</span>),<span class="dv">1</span>])</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>time series of residuals (AR1)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="fl">0.8</span>,<span class="dv">0</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="dv">3</span>, <span class="fl">1.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.pops) {</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(logresid[i,<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">55</span>)] <span class="sc">~</span> years[i,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">51</span>)], <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">"log residuals"</span>, <span class="at">main =</span> pops[i], <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1970</span>, <span class="dv">2021</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(logresid, <span class="at">na.rm =</span> T), <span class="fu">max</span>(logresid, <span class="at">na.rm =</span> T)))</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(logresid[i,<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">55</span>)] <span class="sc">~</span> years[i,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">51</span>)])</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>time series of residuals (AR1), unique y scale</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="fl">0.8</span>,<span class="dv">0</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="dv">3</span>, <span class="fl">1.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.pops) {</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(logresid[i,<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">55</span>)] <span class="sc">~</span> years[i,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">51</span>)], <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">"log residuals"</span>, <span class="at">main =</span> pops[i], <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1970</span>, <span class="dv">2021</span>))</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(logresid[i,<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">55</span>)] <span class="sc">~</span> years[i,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">51</span>)])</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Show residual autocorrelation plots by population</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="fl">0.8</span>,<span class="dv">0</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.pops) {</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pacf</span>(logresid[i,][<span class="fu">complete.cases</span>(logresid[i,])], <span class="at">main =</span> pops[i])</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="bayesian-p-value" class="level3" data-number="4.5.2">
<h3 data-number="4.5.2" class="anchored" data-anchor-id="bayesian-p-value"><span class="header-section-number">4.5.2</span> Bayesian p-value</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bayesian p-value</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(ppdat_exp <span class="sc">&gt;</span> ppdat_obs) <span class="sc">/</span> (<span class="fu">dim</span>(ppdat_obs)[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">dim</span>(ppdat_obs)[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4857758</code></pre>
</div>
</div>
</section>
<section id="pp-check" class="level3" data-number="4.5.3">
<h3 data-number="4.5.3" class="anchored" data-anchor-id="pp-check"><span class="header-section-number">4.5.3</span> PP Check</h3>
<p>Note that this isn’t a posterior predictive check in the true sense, but rather a comparison between the model-estimated latent states (log redd density) and the model predicted means.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">2.5</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">1.5</span>, <span class="at">to =</span> <span class="fl">6.5</span>, <span class="at">length.out =</span> <span class="dv">100</span>), <span class="at">y =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">1.5</span>, <span class="at">to =</span> <span class="fl">6.5</span>, <span class="at">length.out =</span> <span class="dv">100</span>), <span class="at">pch =</span> <span class="cn">NA</span>, <span class="at">xlab =</span> <span class="st">"Latent ln(recruitment)"</span>, <span class="at">ylab =</span> <span class="st">"Median posterior expected ln(recruitment)"</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">apply</span>(ppdat_exp, <span class="dv">2</span>, median, <span class="at">na.rm =</span> T) <span class="sc">~</span> <span class="fu">apply</span>(ppdat_obs, <span class="dv">2</span>, median, <span class="at">na.rm =</span> T))</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">legend =</span> <span class="fu">paste</span>(<span class="st">"Bayesian p-value = "</span>, <span class="fu">round</span>(<span class="fu">sum</span>(ppdat_exp <span class="sc">&gt;</span> ppdat_obs) <span class="sc">/</span> (<span class="fu">dim</span>(ppdat_obs)[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">dim</span>(ppdat_obs)[<span class="dv">2</span>]), <span class="at">digits =</span> <span class="dv">3</span>), <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="plot-model-output" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="plot-model-output"><span class="header-section-number">4.6</span> Plot Model Output</h2>
<section id="time-series-fits" class="level3" data-number="4.6.1">
<h3 data-number="4.6.1" class="anchored" data-anchor-id="time-series-fits"><span class="header-section-number">4.6.1</span> Time series fits</h3>
<p>Pull latent and predicted abundance from model output</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up matrices: latent states</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>N_med <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(rec_raw), <span class="at">ncol =</span> <span class="fu">ncol</span>(rec_raw)<span class="sc">+</span><span class="dv">4</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>N_low <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(rec_raw), <span class="at">ncol =</span> <span class="fu">ncol</span>(rec_raw)<span class="sc">+</span><span class="dv">4</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>N_upp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(rec_raw), <span class="at">ncol =</span> <span class="fu">ncol</span>(rec_raw)<span class="sc">+</span><span class="dv">4</span>)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="co"># set up matrices: predictions</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>P_med <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(rec_raw), <span class="at">ncol =</span> <span class="fu">ncol</span>(rec_raw)<span class="sc">+</span><span class="dv">4</span>)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>P_low <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(rec_raw), <span class="at">ncol =</span> <span class="fu">ncol</span>(rec_raw)<span class="sc">+</span><span class="dv">4</span>)</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>P_upp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(rec_raw), <span class="at">ncol =</span> <span class="fu">ncol</span>(rec_raw)<span class="sc">+</span><span class="dv">4</span>)</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="co"># pull latent and predicted abundance from parameter summary</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(rec_raw)) {</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(rec_raw)<span class="sc">+</span><span class="dv">4</span>) {</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># try(N_med[j,i] &lt;- exp(param.summary[paste("loglatent[",j,",",i,"]", sep = ""),5]))</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># try(N_low[j,i] &lt;- exp(param.summary[paste("loglatent[",j,",",i,"]", sep = ""),3]))</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># try(N_upp[j,i] &lt;- exp(param.summary[paste("loglatent[",j,",",i,"]", sep = ""),7]))</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># try(P_med[j,i] &lt;- exp(param.summary[paste("logpred2[",j,",",i,"]", sep = ""),5]))</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># try(P_low[j,i] &lt;- exp(param.summary[paste("logpred2[",j,",",i,"]", sep = ""),3]))</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># try(P_upp[j,i] &lt;- exp(param.summary[paste("logpred2[",j,",",i,"]", sep = ""),7]))</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>    loglatent <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>    logpred2 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">try</span>(loglatent <span class="ot">&lt;-</span> Mcmcdat[,<span class="fu">paste</span>(<span class="st">"loglatent["</span>,j,<span class="st">","</span>,i,<span class="st">"]"</span>, <span class="at">sep =</span> <span class="st">""</span>)])</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">try</span>(logpred2 <span class="ot">&lt;-</span> Mcmcdat[,<span class="fu">paste</span>(<span class="st">"logpred2["</span>,j,<span class="st">","</span>,i,<span class="st">"]"</span>, <span class="at">sep =</span> <span class="st">""</span>)])</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">try</span>(N_med[j,i] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">exp</span>(loglatent), <span class="at">prob =</span> <span class="fl">0.50</span>))</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">try</span>(N_low[j,i] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">exp</span>(loglatent), <span class="at">prob =</span> <span class="fl">0.05</span>))</span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">try</span>(N_upp[j,i] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">exp</span>(loglatent), <span class="at">prob =</span> <span class="fl">0.95</span>))</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">try</span>(P_med[j,i] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">exp</span>(logpred2), <span class="at">prob =</span> <span class="fl">0.50</span>))</span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">try</span>(P_low[j,i] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">exp</span>(logpred2), <span class="at">prob =</span> <span class="fl">0.05</span>))</span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">try</span>(P_upp[j,i] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">exp</span>(logpred2), <span class="at">prob =</span> <span class="fl">0.95</span>))</span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Set up and check color palette for color blindess accessibility</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">&lt;-</span> rec_raw</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>popshort <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"THCH"</span>, <span class="st">"BLKT"</span>, <span class="st">"BLCR"</span>, <span class="st">"COCA"</span>, <span class="st">"FISH"</span>, <span class="st">"FLAT"</span>, <span class="st">"LTBC"</span>, <span class="st">"LOBC"</span>, <span class="st">"NOWL"</span>, <span class="st">"PRCE"</span>, <span class="st">"SRSC"</span>, <span class="st">"SPRG"</span>, <span class="st">"UPBC"</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>mycols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"orchid1"</span>, <span class="st">"forestgreen"</span>)<span class="co"># c("darkorange", "dodgerblue") # hcl.colors(2, "Red-Green")</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="fu">palette_check</span>(<span class="fu">col2hcl</span>(mycols), <span class="at">plot =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>          name n tolerance ncp ndcp min_dist mean_dist max_dist
1       normal 2  85.67993   1    1 85.67993  85.67993 85.67993
2 deuteranopia 2  85.67993   1    0 50.06492  50.06492 50.06492
3   protanopia 2  85.67993   1    0 55.64110  55.64110 55.64110
4   tritanopia 2  85.67993   1    0 56.34705  56.34705 56.34705</code></pre>
</div>
</div>
<p>Plot time series data with observations, latent states, and model fits.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="fl">0.6</span>,<span class="dv">0</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">1.2</span>, <span class="fl">1.2</span>, <span class="dv">2</span>, <span class="fl">1.2</span>), <span class="at">oma =</span> <span class="fu">c</span>(<span class="fl">2.5</span>,<span class="fl">2.5</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.pops) {</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="fu">exp</span>(rec_raw[i,<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">55</span>)]) <span class="sc">~</span> years[i,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">51</span>)], <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1970</span>, <span class="dv">2021</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">exp</span>(<span class="fu">max</span>(rec_raw[i,], <span class="at">na.rm =</span> T))))</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">title</span>(popshort[i], <span class="at">line =</span> <span class="fl">0.25</span>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pop-specific years</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  yrpreds <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">na.omit</span>(years[i,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">51</span>)]))<span class="co">#[1:(length(as.numeric(na.omit(years[i,c(1:51)])))-4)]</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pop-specific latent states</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  nmedpreds <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">na.omit</span>(N_med[i,<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">55</span>)]))</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>  nlowpreds <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">na.omit</span>(N_low[i,<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">55</span>)]))</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>  nupppreds <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">na.omit</span>(N_upp[i,<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">55</span>)]))</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pop-specific predictions</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  pmedpreds <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">na.omit</span>(P_med[i,<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">55</span>)]))</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>  plowpreds <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">na.omit</span>(P_low[i,<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">55</span>)]))</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>  pupppreds <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">na.omit</span>(P_upp[i,<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">55</span>)]))</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># carrying capacity</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h =</span> param.summary[<span class="fu">paste</span>(<span class="st">"K["</span>,i,<span class="st">"]"</span>, <span class="at">sep =</span> <span class="st">""</span>),<span class="dv">5</span>], <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot latent states</span></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(nmedpreds <span class="sc">~</span> yrpreds, <span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">col =</span> mycols[<span class="dv">1</span>])</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">polygon</span>(<span class="at">x =</span> <span class="fu">c</span>(yrpreds, <span class="fu">rev</span>(yrpreds)), <span class="at">y =</span> <span class="fu">c</span>(<span class="fu">c</span>(nlowpreds), <span class="fu">rev</span>(nupppreds)), <span class="at">col =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(mycols[<span class="dv">1</span>], <span class="fl">0.3</span>), <span class="at">border =</span> <span class="cn">NA</span>)</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot predictions</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(pmedpreds <span class="sc">~</span> yrpreds, <span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">col =</span> mycols[<span class="dv">2</span>])</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">polygon</span>(<span class="at">x =</span> <span class="fu">c</span>(yrpreds, <span class="fu">rev</span>(yrpreds)), <span class="at">y =</span> <span class="fu">c</span>(<span class="fu">c</span>(plowpreds), <span class="fu">rev</span>(pupppreds)), <span class="at">col =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(mycols[<span class="dv">2</span>], <span class="fl">0.3</span>), <span class="at">border =</span> <span class="cn">NA</span>)</span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot observations</span></span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(<span class="fu">exp</span>(rec_raw[i,<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">55</span>)]) <span class="sc">~</span> years[i,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">51</span>)], <span class="at">pch =</span> <span class="dv">1</span>)</span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># legend</span></span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">#legend("topright", legend = pops[i], bty = "n", border = NA, col = NA, fill = NA, cex = 1.25)</span></span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">"Year"</span>, <span class="at">side =</span> <span class="dv">1</span>, <span class="at">line =</span> <span class="dv">1</span>, <span class="at">outer =</span> T)</span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="fu">expression</span>(<span class="st">"Redds km"</span><span class="sc">^-</span><span class="dv">1</span>), <span class="at">side =</span> <span class="dv">2</span>, <span class="at">line =</span> <span class="dv">1</span>, <span class="at">outer =</span> T)</span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.new</span>()</span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"center"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Observations"</span>, <span class="st">"Latent states"</span>, <span class="st">"Predictions"</span>), <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="cn">NA</span>,<span class="cn">NA</span>), <span class="at">lwd =</span> <span class="fu">c</span>(<span class="cn">NA</span>,<span class="dv">2</span>,<span class="dv">2</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, mycols[<span class="dv">1</span>], mycols[<span class="dv">2</span>]), <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">cex =</span> <span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="816"></p>
</figure>
</div>
</div>
</div>
<p>Population summaries of latent states and carrying capacity, arranged from least to most variable (based on CV).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="fu">apply</span>(N_med, <span class="dv">1</span>, mean, <span class="at">na.rm =</span> T)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>sds <span class="ot">&lt;-</span> <span class="fu">apply</span>(N_med, <span class="dv">1</span>, sd, <span class="at">na.rm =</span> T)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>cvs <span class="ot">&lt;-</span> sds<span class="sc">/</span>means</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>mins <span class="ot">&lt;-</span> <span class="fu">apply</span>(N_med, <span class="dv">1</span>, min, <span class="at">na.rm =</span> T)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>maxs <span class="ot">&lt;-</span> <span class="fu">apply</span>(N_med, <span class="dv">1</span>, max, <span class="at">na.rm =</span> T)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>relc <span class="ot">&lt;-</span> maxs<span class="sc">/</span>mins</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>ks <span class="ot">&lt;-</span> param.summary[<span class="fu">grep</span>(<span class="st">"K"</span>, <span class="fu">row.names</span>(param.summary), <span class="at">value =</span> <span class="cn">TRUE</span>),<span class="dv">5</span>]</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>poptib <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">pop =</span> pops, <span class="at">mean =</span> <span class="fu">round</span>(means, <span class="at">digits =</span> <span class="dv">3</span>), <span class="at">sd =</span> <span class="fu">round</span>(sds, <span class="at">digits =</span> <span class="dv">3</span>), <span class="at">cv =</span> <span class="fu">round</span>(cvs, <span class="at">digits =</span> <span class="dv">3</span>), <span class="at">min =</span> <span class="fu">round</span>(mins, <span class="at">digits =</span> <span class="dv">3</span>), <span class="at">max =</span> <span class="fu">round</span>(maxs, <span class="at">digits =</span> <span class="dv">3</span>), <span class="at">K =</span> <span class="fu">round</span>(ks, <span class="at">digits =</span> <span class="dv">3</span>))</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(poptib <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(cv))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-5ad6c714e85ae4663778" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5ad6c714e85ae4663778">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13"],["Spring","3 Channel","Fish","Blacktail","Nowlin","Blue Crane","Upper Bar BC","Price","Snake River Side Channel","Flat","Cowboy Cabin","Lower Bar BC","Little Bar BC"],[47.185,73.681,40.915,261.14,35.836,16.673,120.401,28.694,37.142,19.275,37.713,133.099,35.776],[9.423,18.96,10.931,82.495,12.455,6.539,50.271,12.692,16.703,9.462,19.413,71.56100000000001,20.307],[0.2,0.257,0.267,0.316,0.348,0.392,0.418,0.442,0.45,0.491,0.515,0.538,0.5679999999999999],[32.683,24.89,24.05,43.642,17.073,5.376,64.72799999999999,9.050000000000001,7.823,6.745,10.769,10.599,3.225],[68.896,132.103,61.228,419.867,61.683,36.904,313.555,62.537,66.907,45.892,96.09,357.815,80.935],[53.242,84.276,42.855,268.941,38.976,17.167,128.144,32.306,40.776,19.599,38.339,152.716,41.909]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>pop<\/th>\n      <th>mean<\/th>\n      <th>sd<\/th>\n      <th>cv<\/th>\n      <th>min<\/th>\n      <th>max<\/th>\n      <th>K<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"pop","targets":1},{"name":"mean","targets":2},{"name":"sd","targets":3},{"name":"cv","targets":4},{"name":"min","targets":5},{"name":"max","targets":6},{"name":"K","targets":7}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="parameter-dot-plots" class="level3" data-number="4.6.2">
<h3 data-number="4.6.2" class="anchored" data-anchor-id="parameter-dot-plots"><span class="header-section-number">4.6.2</span> Parameter dot plots</h3>
<p>Coerce to ggs object</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>mod.gg <span class="ot">&lt;-</span> <span class="fu">ggs</span>(<span class="fu">as.mcmc</span>(topmod), <span class="at">keep_original_order =</span> <span class="cn">TRUE</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>popshort <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"THCH"</span>, <span class="st">"BLKT"</span>, <span class="st">"BLCR"</span>, <span class="st">"COCA"</span>, <span class="st">"FISH"</span>, <span class="st">"FLAT"</span>, <span class="st">"LTBC"</span>, <span class="st">"LOBC"</span>, <span class="st">"NOWL"</span>, <span class="st">"PRCE"</span>, <span class="st">"SRSC"</span>, <span class="st">"SPRG"</span>, <span class="st">"UPBC"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Remind covariate names…</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>names.covars0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "z_jld_rampdur"        "z_jld_rampratemindoy" "z_jld_winvar"        
 [4] "z_jld_summean"        "z_jld_peakmag"        "z_jld_peaktime"      
 [7] "z_natq_peakmag"       "z_natq_peaktime"      "z_temp_falmean"      
[10] "z_temp_winmean"       "z_temp_sprmean"       "z_temp_summean"      
[13] "z_int_peakmag"        "z_int_peaktime"      </code></pre>
</div>
</div>
<p>Covariate types and pretty covariate names</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>CovType <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Managed flow"</span>, <span class="at">times =</span> <span class="dv">6</span>), </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">rep</span>(<span class="st">"Natural flow"</span>, <span class="at">times =</span> <span class="dv">2</span>), </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">rep</span>(<span class="st">"Temperature"</span>, <span class="at">times =</span> <span class="dv">4</span>), </span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">rep</span>(<span class="st">"Interaction"</span>, <span class="at">times =</span> <span class="dv">2</span>)),</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Managed flow"</span>, <span class="st">"Natural flow"</span>, <span class="st">"Temperature"</span>, <span class="st">"Interaction"</span>))</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co"># rename covariates</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>names.covars.new <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Duration of ramp down"</span>, <span class="st">"Timing of ramp down"</span>, </span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Mgd. winter flow var."</span>, <span class="st">"Mgd. summer mean flow"</span>, <span class="st">"Mgd. peak flow mag."</span>, <span class="st">"Mgd. peak flow timing"</span>, </span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Nat. peak flow mag."</span>, <span class="st">"Nat. peak flow timing"</span>,</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Autumn temperature"</span>, <span class="st">"Winter temperature"</span>, <span class="st">"Spring temperature"</span>, <span class="st">"Summer temperature"</span>,</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Mgd. x Nat. peak flow mag."</span>, <span class="st">"Mgd. x Nat. peak flow timing"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Set color palette</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bls &lt;- hcl.colors(5, "Blues3")</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="co"># mycols &lt;- c("darkorange", bls[c(3,1)], "seagreen", "grey50")</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>mycols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#009E73"</span>, <span class="st">"#999999"</span>)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="co">#palette_check(col2hcl(mycols), plot = TRUE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="global-covariate-effects" class="level4" data-number="4.6.2.1">
<h4 data-number="4.6.2.1" class="anchored" data-anchor-id="global-covariate-effects"><span class="header-section-number">4.6.2.1</span> Global covariate effects</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(<span class="at">D =</span> mod.gg, <span class="at">family =</span> <span class="st">"mu.coef"</span>, <span class="at">thick_ci =</span> <span class="fu">c</span>(<span class="fl">0.125</span>, <span class="fl">0.875</span>), <span class="at">thin_ci =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Environmental driver"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Global change in productivity, ln(R/S)"</span>) <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">color =</span> CovType) <span class="sc">+</span> <span class="fu">scale_color_manual</span>(<span class="at">values =</span> mycols) <span class="sc">+</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(names.covars.new), <span class="at">limits =</span> rev) <span class="sc">+</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>, <span class="at">legend.title =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.spacing.y =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"cm"</span>), <span class="at">legend.key.spacing.x =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>), <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> </span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="population-covariate-effects" class="level4" data-number="4.6.2.2">
<h4 data-number="4.6.2.2" class="anchored" data-anchor-id="population-covariate-effects"><span class="header-section-number">4.6.2.2</span> Population covariate effects</h4>
<p>Define colors</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>mycols2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(mycols[<span class="dv">1</span>], <span class="at">times =</span> <span class="dv">6</span>), <span class="fu">rep</span>(mycols[<span class="dv">2</span>], <span class="at">times =</span> <span class="dv">2</span>), </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">rep</span>(mycols[<span class="dv">3</span>], <span class="at">times =</span> <span class="dv">4</span>), <span class="fu">rep</span>(mycols[<span class="dv">4</span>], <span class="at">times =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Generate plots in a for loop</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># generate plots in a for loop</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(names.covars0)) {</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">jpeg</span>(<span class="fu">paste</span>(<span class="st">"Figures/Dot Plots/Pop Level Covariate Effects/ReddCounts_Ricker_CovarModel_DotPlot_Covs"</span>, i, <span class="st">"_"</span>, names.covars0[i], <span class="st">".jpg"</span>, <span class="at">sep =</span> <span class="st">""</span>), <span class="at">units =</span> <span class="st">"in"</span>, <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">res =</span> <span class="dv">1500</span>)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">ggs_caterpillar</span>(<span class="at">D =</span> mod.gg <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">paste</span>(<span class="st">"coef["</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>, <span class="st">","</span>, i, <span class="st">"]"</span>, <span class="at">sep =</span> <span class="st">""</span>)), <span class="at">family =</span> <span class="st">"coef"</span>, <span class="at">thick_ci =</span> <span class="fu">c</span>(<span class="fl">0.125</span>, <span class="fl">0.875</span>), <span class="at">thin_ci =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Effect"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(names.covars.new[i]) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(pops), <span class="at">limits =</span> rev) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">color =</span> CovType[i]) <span class="sc">+</span> <span class="fu">scale_color_manual</span>(<span class="at">values =</span> mycols2[i]) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>), <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)))</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dev.off</span>()</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Combined plot</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>covplots <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>popshort <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"THCH"</span>, <span class="st">"BLKT"</span>, <span class="st">"BLCR"</span>, <span class="st">"COCA"</span>, <span class="st">"FISH"</span>, <span class="st">"FLAT"</span>, <span class="st">"LTBC"</span>, <span class="st">"LOBC"</span>, <span class="st">"NOWL"</span>, <span class="st">"PRCE"</span>, <span class="st">"SRSC"</span>, <span class="st">"SPRG"</span>, <span class="st">"UPBC"</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(names.covars0)) {</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">substitute</span>(<span class="fu">ggs_caterpillar</span>(<span class="at">D =</span> mod.gg <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">paste</span>(<span class="st">"coef["</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>, <span class="st">","</span>, i, <span class="st">"]"</span>, <span class="at">sep =</span> <span class="st">""</span>)), <span class="at">family =</span> <span class="st">"coef"</span>, <span class="at">thick_ci =</span> <span class="fu">c</span>(<span class="fl">0.125</span>, <span class="fl">0.875</span>), <span class="at">thin_ci =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="sc">-</span><span class="fl">0.55</span>, <span class="fl">0.49</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(names.covars.new[i]) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(popshort), <span class="at">limits =</span> rev) <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">color =</span> CovType[i]) <span class="sc">+</span> <span class="fu">scale_color_manual</span>(<span class="at">values =</span> mycols2[i]) <span class="sc">+</span> </span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="sc">-</span><span class="fl">0.7</span>,<span class="sc">-</span><span class="fl">0.5</span>), <span class="st">'lines'</span>), <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>), <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)), <span class="fu">list</span>(<span class="at">i =</span> i)))</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  covplots[[i]] <span class="ot">&lt;-</span> p1</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>myfig <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(<span class="at">plotlist =</span> covplots, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">nrow =</span> <span class="dv">4</span>)</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>myfig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid figure-img" width="1056"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="population-variation-in-covariate-effects" class="level4" data-number="4.6.2.3">
<h4 data-number="4.6.2.3" class="anchored" data-anchor-id="population-variation-in-covariate-effects"><span class="header-section-number">4.6.2.3</span> Population variation in covariate effects</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(<span class="at">D =</span> mod.gg, <span class="at">family =</span> <span class="st">"sigma.coef"</span>, <span class="at">thick_ci =</span> <span class="fu">c</span>(<span class="fl">0.125</span>, <span class="fl">0.875</span>), <span class="at">thin_ci =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Environmental driver"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Population-level variation in covariate effect"</span>) <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">color =</span> CovType) <span class="sc">+</span> <span class="fu">scale_color_manual</span>(<span class="at">values =</span> mycols) <span class="sc">+</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(names.covars.new), <span class="at">limits =</span> rev) <span class="sc">+</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>), </span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.spacing.y =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"cm"</span>), <span class="at">legend.key.spacing.x =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>), <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))  <span class="sc">+</span> </span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="age-proportional-effects" class="level4" data-number="4.6.2.4">
<h4 data-number="4.6.2.4" class="anchored" data-anchor-id="age-proportional-effects"><span class="header-section-number">4.6.2.4</span> Age proportional effects</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_tibble</span>(Mcmcdat[, <span class="fu">c</span>(<span class="st">"p[1]"</span>, <span class="st">"p[2]"</span>, <span class="st">"p[3]"</span>, <span class="st">"p[4]"</span>, <span class="st">"p[5]"</span>, <span class="st">"p[6]"</span>, <span class="st">"p[7]"</span>, <span class="st">"p[8]"</span>, <span class="st">"p[9]"</span>, </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"p[10]"</span>, <span class="st">"p[11]"</span>, <span class="st">"p[12]"</span>, <span class="st">"p[13]"</span>, <span class="st">"p[14]"</span>)]) <span class="sc">%&gt;%</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">"param"</span>, <span class="at">value =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">param =</span> <span class="fu">fct_rev</span>(<span class="fu">as_factor</span>(param))) <span class="sc">%&gt;%</span> </span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> param, <span class="at">height =</span> <span class="fu">stat</span>(density), <span class="at">fill =</span> param)) <span class="sc">+</span> </span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density_ridges</span>(<span class="at">scale =</span> <span class="fl">1.3</span>, <span class="at">stat =</span> <span class="st">"density"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(mycols2)) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(names.covars.new), <span class="at">expand =</span> <span class="fu">expand_scale</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, .<span class="dv">07</span>))) <span class="sc">+</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Environmental driver"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Proportional effect at age-0 vs. age-1 ("</span>, rho, <span class="st">")"</span>))) <span class="sc">+</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>), </span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.spacing.y =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"cm"</span>), <span class="at">legend.key.spacing.x =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>), <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())  <span class="sc">+</span> </span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># same but plot as density/ridgelines</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>mycols2 <span class="ot">&lt;-</span> <span class="fu">c</span>(mycols[<span class="dv">1</span>], mycols[<span class="dv">1</span>], mycols[<span class="dv">1</span>], mycols[<span class="dv">1</span>], mycols[<span class="dv">1</span>], mycols[<span class="dv">1</span>], mycols[<span class="dv">2</span>], mycols[<span class="dv">2</span>], mycols[<span class="dv">3</span>], mycols[<span class="dv">3</span>], mycols[<span class="dv">3</span>], mycols[<span class="dv">3</span>], mycols[<span class="dv">4</span>], mycols[<span class="dv">4</span>])</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="co"># mycols2 &lt;- c("darkorange", "darkorange", bls[3], bls[3], bls[3], bls[3], bls[1], bls[1], "seagreen", "seagreen", "seagreen", "seagreen", "grey50", "grey50")</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="fu">jpeg</span>(<span class="st">"Figures/Dot Plots/ReddCounts_Ricker_CovarModel_DensityPlot_ProportionalCov.jpg"</span>, <span class="at">units =</span> <span class="st">"in"</span>, <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="dv">7</span>, <span class="at">res =</span> <span class="dv">1500</span>)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="fu">as_tibble</span>(Mcmcdat[, <span class="fu">c</span>(<span class="st">"p[1]"</span>, <span class="st">"p[2]"</span>, <span class="st">"p[3]"</span>, <span class="st">"p[4]"</span>, <span class="st">"p[5]"</span>, <span class="st">"p[6]"</span>, <span class="st">"p[7]"</span>, <span class="st">"p[8]"</span>, <span class="st">"p[9]"</span>, </span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"p[10]"</span>, <span class="st">"p[11]"</span>, <span class="st">"p[12]"</span>, <span class="st">"p[13]"</span>, <span class="st">"p[14]"</span>)]) <span class="sc">%&gt;%</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">"param"</span>, <span class="at">value =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">param =</span> <span class="fu">fct_rev</span>(<span class="fu">as_factor</span>(param))) <span class="sc">%&gt;%</span> </span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> param, <span class="at">height =</span> <span class="fu">stat</span>(density), <span class="at">fill =</span> param)) <span class="sc">+</span> </span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density_ridges</span>(<span class="at">scale =</span> <span class="fl">1.3</span>, <span class="at">stat =</span> <span class="st">"density"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(mycols2)) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(names.covars.new), <span class="at">expand =</span> <span class="fu">expand_scale</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, .<span class="dv">07</span>))) <span class="sc">+</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Environmental driver"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Proportional effect at age-0 vs. age-1 ("</span>, rho, <span class="st">")"</span>))) <span class="sc">+</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>), </span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.spacing.y =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"cm"</span>), <span class="at">legend.key.spacing.x =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>), <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())  <span class="sc">+</span> </span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>))</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>png 
  2 </code></pre>
</div>
</div>
</section>
<section id="ricker-a" class="level4" data-number="4.6.2.5">
<h4 data-number="4.6.2.5" class="anchored" data-anchor-id="ricker-a"><span class="header-section-number">4.6.2.5</span> Ricker a</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(<span class="at">D =</span> mod.gg <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">paste</span>(<span class="st">"A["</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">13</span>, <span class="st">"]"</span>, <span class="at">sep =</span> <span class="st">""</span>)), <span class="at">family =</span> <span class="st">"A"</span>, <span class="at">thick_ci =</span> <span class="fu">c</span>(<span class="fl">0.125</span>, <span class="fl">0.875</span>), <span class="at">thin_ci =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Population"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Ricker a"</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(popshort), <span class="at">limits =</span> rev)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="river-b" class="level4" data-number="4.6.2.6">
<h4 data-number="4.6.2.6" class="anchored" data-anchor-id="river-b"><span class="header-section-number">4.6.2.6</span> River b</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(<span class="at">D =</span> mod.gg <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">paste</span>(<span class="st">"B["</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">13</span>, <span class="st">"]"</span>, <span class="at">sep =</span> <span class="st">""</span>)), <span class="at">family =</span> <span class="st">"B"</span>, <span class="at">thick_ci =</span> <span class="fu">c</span>(<span class="fl">0.125</span>, <span class="fl">0.875</span>), <span class="at">thin_ci =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Population"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Ricker b"</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(popshort), <span class="at">limits =</span> rev)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="observation-error" class="level4" data-number="4.6.2.7">
<h4 data-number="4.6.2.7" class="anchored" data-anchor-id="observation-error"><span class="header-section-number">4.6.2.7</span> Observation error</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(<span class="at">D =</span> mod.gg, <span class="at">family =</span> <span class="st">"sigma.oe"</span>, <span class="at">thick_ci =</span> <span class="fu">c</span>(<span class="fl">0.125</span>, <span class="fl">0.875</span>), <span class="at">thin_ci =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Observation error"</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="st">"Global"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-76-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="process-error" class="level4" data-number="4.6.2.8">
<h4 data-number="4.6.2.8" class="anchored" data-anchor-id="process-error"><span class="header-section-number">4.6.2.8</span> Process error</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(<span class="at">D =</span> mod.gg, <span class="at">family =</span> <span class="st">"sigma.pe"</span>, <span class="at">thick_ci =</span> <span class="fu">c</span>(<span class="fl">0.125</span>, <span class="fl">0.875</span>), <span class="at">thin_ci =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Population"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Process error"</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(popshort), <span class="at">limits =</span> rev)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="carrying-capacity" class="level4" data-number="4.6.2.9">
<h4 data-number="4.6.2.9" class="anchored" data-anchor-id="carrying-capacity"><span class="header-section-number">4.6.2.9</span> Carrying capacity</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(<span class="at">D =</span> mod.gg, <span class="at">family =</span> <span class="st">"K"</span>, <span class="at">thick_ci =</span> <span class="fu">c</span>(<span class="fl">0.125</span>, <span class="fl">0.875</span>), <span class="at">thin_ci =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Population"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Carrying capacity (redds / km)"</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(popshort), <span class="at">limits =</span> rev)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="phi---autocorrelated-residuls" class="level4" data-number="4.6.2.10">
<h4 data-number="4.6.2.10" class="anchored" data-anchor-id="phi---autocorrelated-residuls"><span class="header-section-number">4.6.2.10</span> Phi - autocorrelated residuls</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(<span class="at">D =</span> mod.gg, <span class="at">family =</span> <span class="st">"phi"</span>, <span class="at">thick_ci =</span> <span class="fu">c</span>(<span class="fl">0.125</span>, <span class="fl">0.875</span>), <span class="at">thin_ci =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Population"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"AR1"</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(popshort), <span class="at">limits =</span> rev) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sigma-a" class="level4" data-number="4.6.2.11">
<h4 data-number="4.6.2.11" class="anchored" data-anchor-id="sigma-a"><span class="header-section-number">4.6.2.11</span> Sigma a</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(<span class="at">D =</span> mod.gg, <span class="at">family =</span> <span class="st">"sigma.A"</span>, <span class="at">thick_ci =</span> <span class="fu">c</span>(<span class="fl">0.125</span>, <span class="fl">0.875</span>), <span class="at">thin_ci =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-84-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="marginal-effects" class="level3" data-number="4.6.3">
<h3 data-number="4.6.3" class="anchored" data-anchor-id="marginal-effects"><span class="header-section-number">4.6.3</span> Marginal effects</h3>
<p>Load in covariate mean/SD summaries, to transform axes to real scale</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>covsrc_jldq_summary <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Derived/ManagedFlow_SummaryMeanSD_1967-2022.csv"</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>covsrc_natq_summary <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Derived/NaturalFlow_SummaryMeanSD_1975-2022.csv"</span>)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>covsrc_expq_summary <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Derived/ExperiencedFlow_SummaryMeanSD_1975-2022.csv"</span>)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>covsrc_temp_summary <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Derived/Temperature_SummaryMeanSD_1967-2022.csv"</span>)</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>covsummary <span class="ot">&lt;-</span> <span class="fu">rbind</span>(covsrc_jldq_summary[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">6</span><span class="sc">:</span><span class="dv">9</span>),], covsrc_natq_summary[<span class="fu">c</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>),], covsrc_temp_summary)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>covsummary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   cov                        mean        sd
   &lt;chr&gt;                     &lt;dbl&gt;     &lt;dbl&gt;
 1 z_jld_rampdur           10.0       5.71  
 2 z_jld_rampratemindoy   270.        7.92  
 3 z_jld_winvar             0.0431    0.0649
 4 z_jld_summean         2700.      838.    
 5 z_jld_peakmag         5885.     1921.    
 6 z_jld_peaktime         286.       15.9   
 7 z_natq_peakmag       10948.     3603.    
 8 z_natq_peaktime        278.       11.9   
 9 z_temp_falmean           4.05      1.04  
10 z_temp_winmean          -9.29      1.80  
11 z_temp_sprmean           2.38      1.30  
12 z_temp_summean          14.8       1.14  </code></pre>
</div>
</div>
<p>Values for prediction and color palettes</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>nvalues <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>colPal <span class="ot">&lt;-</span> <span class="fu">hcl.colors</span>(<span class="fu">length</span>(pops), <span class="st">"Spectral"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">JLD ramp duration</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">JLD ramp timing</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">JLD winter variation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">JLD summer flow</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false">JLD peak flow mag.</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-6" role="tab" aria-controls="tabset-1-6" aria-selected="false">JLD peak flow timing</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-7" role="tab" aria-controls="tabset-1-7" aria-selected="false">Nat peak flow mag.</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-8-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-8" role="tab" aria-controls="tabset-1-8" aria-selected="false">Nat peak flow timing</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-9-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-9" role="tab" aria-controls="tabset-1-9" aria-selected="false">Autumn temperature</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-10-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-10" role="tab" aria-controls="tabset-1-10" aria-selected="false">Winter temperature</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-11-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-11" role="tab" aria-controls="tabset-1-11" aria-selected="false">Spring temperature</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-12-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-12" role="tab" aria-controls="tabset-1-12" aria-selected="false">Summer temperature</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">2.5</span>,<span class="fl">0.5</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">2.25</span>,<span class="fl">0.8</span>,<span class="dv">0</span>))</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="co"># set up plot</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_jld_rampdur), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_jld_rampdur), <span class="at">length.out =</span> nvalues)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.3</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> nvalues) <span class="sc">~</span> x1, <span class="at">pch =</span> <span class="cn">NA</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xlab =</span> <span class="st">"Duration of ramp down (days)"</span>, <span class="at">ylab =</span> <span class="st">"Productivity, ln(R/S)"</span>, <span class="at">axes =</span> F)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="co"># axes and box</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="co"># range(dat$jld_rampdur)</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>x.axis <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">5</span>, <span class="at">to =</span> <span class="dv">30</span>, <span class="at">by =</span> <span class="dv">5</span>)</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>x.axis.scaled <span class="ot">&lt;-</span> (x.axis <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">1</span>]) <span class="sc">/</span> covsummary<span class="sc">$</span>sd[<span class="dv">1</span>]</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> x.axis.scaled, <span class="at">labels =</span> x.axis)</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>)</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(Mcmcdat), <span class="at">ncol =</span> nvalues)</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pred)) { pred[j,] <span class="ot">&lt;-</span> Mcmcdat[j,<span class="st">"mu.A"</span>] <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[1]"</span>]<span class="sc">*</span>x1 }</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>pred_median <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.50</span>) </span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>pred_025 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.025</span>)</span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>pred_125 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.125</span>)</span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>pred_875 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.875</span>)</span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>pred_975 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.975</span>)</span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(x1, <span class="fu">rev</span>(x1)), <span class="fu">c</span>(pred_975, <span class="fu">rev</span>(pred_025)), <span class="at">col =</span> <span class="st">"grey85"</span>, <span class="at">lty=</span><span class="dv">0</span>)</span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(x1, <span class="fu">rev</span>(x1)), <span class="fu">c</span>(pred_875, <span class="fu">rev</span>(pred_125)), <span class="at">col =</span> <span class="st">"grey70"</span>, <span class="at">lty=</span><span class="dv">0</span>)</span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a><span class="co"># add population-specific fits</span></span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a><span class="co"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",1]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a><span class="co"># add global fit</span></span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_median <span class="sc">~</span> x1, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a><span class="co"># median productivity</span></span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> param.summary[<span class="st">"mu.A"</span>,<span class="dv">5</span>], <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fl">0.3</span>, <span class="at">labels =</span> <span class="st">"10"</span>, <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a><span class="co"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a><span class="co"># legend</span></span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">xpd =</span> <span class="cn">TRUE</span>, <span class="at">usr =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a><span class="co"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">bty =</span> <span class="st">"o"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> mycols2[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-88-1.png" class="img-fluid figure-img" width="408"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">2.5</span>,<span class="fl">0.5</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">2.25</span>,<span class="fl">0.8</span>,<span class="dv">0</span>))</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="co"># set up plot</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_jld_rampratemindoy), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_jld_rampratemindoy), <span class="at">length.out =</span> nvalues)</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.3</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> nvalues) <span class="sc">~</span> x1, <span class="at">pch =</span> <span class="cn">NA</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xlab =</span> <span class="st">"Timing of ramp down"</span>, <span class="at">ylab =</span> <span class="st">"Productivity, ln(R/S)"</span>, <span class="at">axes =</span> F)</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="co"># axes and box</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="co"># range(dat$jld_rampratemindoy)</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>x.axis <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">254</span>,<span class="dv">264</span>,<span class="dv">274</span>)</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>x.axis.scaled <span class="ot">&lt;-</span> (x.axis <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">2</span>]) <span class="sc">/</span> covsummary<span class="sc">$</span>sd[<span class="dv">2</span>]</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> x.axis.scaled, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"10 Sept"</span>, <span class="st">"20 Sept"</span>, <span class="st">"30 Sept"</span>))</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>)</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(Mcmcdat), <span class="at">ncol =</span> nvalues)</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pred)) { pred[j,] <span class="ot">&lt;-</span> Mcmcdat[j,<span class="st">"mu.A"</span>] <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[2]"</span>]<span class="sc">*</span>x1 }</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>pred_median <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.50</span>) </span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>pred_025 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.025</span>)</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>pred_125 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.125</span>)</span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>pred_875 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.875</span>)</span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>pred_975 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.975</span>)</span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(x1, <span class="fu">rev</span>(x1)), <span class="fu">c</span>(pred_975, <span class="fu">rev</span>(pred_025)), <span class="at">col =</span> <span class="st">"grey85"</span>, <span class="at">lty=</span><span class="dv">0</span>)</span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(x1, <span class="fu">rev</span>(x1)), <span class="fu">c</span>(pred_875, <span class="fu">rev</span>(pred_125)), <span class="at">col =</span> <span class="st">"grey70"</span>, <span class="at">lty=</span><span class="dv">0</span>)</span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a><span class="co"># add population-specific fits</span></span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a><span class="co"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",2]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a><span class="co"># add global fit</span></span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_median <span class="sc">~</span> x1, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a><span class="co"># median productivity</span></span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> param.summary[<span class="st">"mu.A"</span>,<span class="dv">5</span>], <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fl">0.3</span>, <span class="at">labels =</span> <span class="st">"26 Sept"</span>, <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a><span class="co"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a><span class="co"># legend</span></span>
<span id="cb93-31"><a href="#cb93-31" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">xpd =</span> <span class="cn">TRUE</span>, <span class="at">usr =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb93-32"><a href="#cb93-32" aria-hidden="true" tabindex="-1"></a><span class="co"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb93-33"><a href="#cb93-33" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">bty =</span> <span class="st">"o"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> mycols2[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-89-1.png" class="img-fluid figure-img" width="408"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">2.5</span>,<span class="fl">0.5</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">2.25</span>,<span class="fl">0.8</span>,<span class="dv">0</span>))</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="co"># set up plot</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_jld_winvar, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_jld_winvar, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">length.out =</span> nvalues)</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.3</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> nvalues) <span class="sc">~</span> x1, <span class="at">pch =</span> <span class="cn">NA</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xlab =</span> <span class="st">"Mgd. winter flow variation"</span>, <span class="at">ylab =</span> <span class="st">"Productivity, ln(R/S)"</span>, <span class="at">axes =</span> F)</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="co"># axes and box</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="co"># range(dat$jld_winvar, na.rm = T)</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>x.axis <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="fl">0.3</span>, <span class="at">by =</span> <span class="fl">0.05</span>)</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>x.axis.scaled <span class="ot">&lt;-</span> (x.axis <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">3</span>]) <span class="sc">/</span> covsummary<span class="sc">$</span>sd[<span class="dv">3</span>]</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> x.axis.scaled, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0.00"</span>, <span class="st">"0.05"</span>, <span class="st">"0.10"</span>, <span class="st">"0.15"</span>, <span class="st">"0.20"</span>, <span class="st">"0.25"</span>, <span class="st">"0.30"</span>))</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>)</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(Mcmcdat), <span class="at">ncol =</span> nvalues)</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pred)) { pred[j,] <span class="ot">&lt;-</span> Mcmcdat[j,<span class="st">"mu.A"</span>] <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[3]"</span>]<span class="sc">*</span>x1 }</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>pred_median <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.50</span>) </span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>pred_025 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.025</span>)</span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>pred_125 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.225</span>)</span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>pred_875 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.875</span>)</span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>pred_975 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.975</span>)</span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(x1, <span class="fu">rev</span>(x1)), <span class="fu">c</span>(pred_975, <span class="fu">rev</span>(pred_025)), <span class="at">col =</span> <span class="st">"grey85"</span>, <span class="at">lty=</span><span class="dv">0</span>)</span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(x1, <span class="fu">rev</span>(x1)), <span class="fu">c</span>(pred_875, <span class="fu">rev</span>(pred_125)), <span class="at">col =</span> <span class="st">"grey70"</span>, <span class="at">lty=</span><span class="dv">0</span>)</span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a><span class="co"># add population-specific fits</span></span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a><span class="co"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",3]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a><span class="co"># add global fit</span></span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_median <span class="sc">~</span> x1, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a><span class="co"># median productivity</span></span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> param.summary[<span class="st">"mu.A"</span>,<span class="dv">5</span>], <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fl">0.3</span>, <span class="at">labels =</span> <span class="st">"0.043"</span>, <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a><span class="co"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a><span class="co"># legend</span></span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">xpd =</span> <span class="cn">TRUE</span>, <span class="at">usr =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb94-32"><a href="#cb94-32" aria-hidden="true" tabindex="-1"></a><span class="co"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb94-33"><a href="#cb94-33" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">bty =</span> <span class="st">"o"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> mycols2[<span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-90-1.png" class="img-fluid figure-img" width="408"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">2.5</span>,<span class="fl">0.5</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">2.25</span>,<span class="fl">0.8</span>,<span class="dv">0</span>))</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="co"># set up plot</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_jld_summean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_jld_summean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">length.out =</span> nvalues)</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.3</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> nvalues) <span class="sc">~</span> x1, <span class="at">pch =</span> <span class="cn">NA</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xlab =</span> <span class="st">"Mgd. summer mean flow (cfs)"</span>, <span class="at">ylab =</span> <span class="st">"Productivity, ln(R/S)"</span>, <span class="at">axes =</span> F)</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="co"># axes and box</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a><span class="co"># range(dat$jld_summean, na.rm = T)</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>x.axis <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1500</span>, <span class="at">to =</span> <span class="dv">4500</span>, <span class="at">by =</span> <span class="dv">1000</span>)</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>x.axis.scaled <span class="ot">&lt;-</span> (x.axis <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">4</span>]) <span class="sc">/</span> covsummary<span class="sc">$</span>sd[<span class="dv">4</span>]</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> x.axis.scaled, <span class="at">labels =</span> x.axis)</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>)</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(Mcmcdat), <span class="at">ncol =</span> nvalues)</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pred)) { pred[j,] <span class="ot">&lt;-</span> Mcmcdat[j,<span class="st">"mu.A"</span>] <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[4]"</span>]<span class="sc">*</span>x1 }</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>pred_median <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.50</span>) </span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>pred_025 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.025</span>)</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>pred_125 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.125</span>)</span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>pred_875 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.875</span>)</span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>pred_975 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.975</span>)</span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(x1, <span class="fu">rev</span>(x1)), <span class="fu">c</span>(pred_975, <span class="fu">rev</span>(pred_025)), <span class="at">col =</span> <span class="st">"grey85"</span>, <span class="at">lty=</span><span class="dv">0</span>)</span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(x1, <span class="fu">rev</span>(x1)), <span class="fu">c</span>(pred_875, <span class="fu">rev</span>(pred_125)), <span class="at">col =</span> <span class="st">"grey70"</span>, <span class="at">lty=</span><span class="dv">0</span>)</span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a><span class="co"># add population-specific fits</span></span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a><span class="co"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",4]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a><span class="co"># add global fit</span></span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_median <span class="sc">~</span> x1, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a><span class="co"># median productivity</span></span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> param.summary[<span class="st">"mu.A"</span>,<span class="dv">5</span>], <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb95-28"><a href="#cb95-28" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fl">0.3</span>, <span class="at">labels =</span> <span class="st">"2700"</span>, <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb95-29"><a href="#cb95-29" aria-hidden="true" tabindex="-1"></a><span class="co"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb95-30"><a href="#cb95-30" aria-hidden="true" tabindex="-1"></a><span class="co"># legend</span></span>
<span id="cb95-31"><a href="#cb95-31" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">xpd =</span> <span class="cn">TRUE</span>, <span class="at">usr =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb95-32"><a href="#cb95-32" aria-hidden="true" tabindex="-1"></a><span class="co"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb95-33"><a href="#cb95-33" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">bty =</span> <span class="st">"o"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> mycols2[<span class="dv">4</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-91-1.png" class="img-fluid figure-img" width="408"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># JLD Peak flow magnitude</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">2.5</span>,<span class="fl">0.5</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">2.25</span>,<span class="fl">0.8</span>,<span class="dv">0</span>))</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="co"># set up plot</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_jld_peakmag, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_jld_peakmag, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">length.out =</span> nvalues)</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.3</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> nvalues) <span class="sc">~</span> x1, <span class="at">pch =</span> <span class="cn">NA</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xlab =</span> <span class="st">"Mgd. peak flow magnitude (cfs)"</span>, <span class="at">ylab =</span> <span class="st">"Productivity, ln(R/S)"</span>, <span class="at">axes =</span> F)</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="co"># axes and box</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a><span class="co"># range(dat$jld_peakmag, na.rm = T)</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>x.axis <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">4000</span>, <span class="at">to =</span> <span class="dv">12000</span>, <span class="at">by =</span> <span class="dv">2000</span>)</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>x.axis.scaled <span class="ot">&lt;-</span> (x.axis <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">5</span>]) <span class="sc">/</span> covsummary<span class="sc">$</span>sd[<span class="dv">5</span>]</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> x.axis.scaled, <span class="at">labels =</span> <span class="fu">round</span>((x.axis), <span class="at">digits =</span> <span class="dv">0</span>))</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>)</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(Mcmcdat), <span class="at">ncol =</span> nvalues)</span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pred)) { pred[j,] <span class="ot">&lt;-</span> Mcmcdat[j,<span class="st">"mu.A"</span>] <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[5]"</span>]<span class="sc">*</span>x1 }</span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>pred_median <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.50</span>) </span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>pred_025 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.025</span>)</span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>pred_125 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.125</span>)</span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>pred_875 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.875</span>)</span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>pred_975 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.975</span>)</span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(x1, <span class="fu">rev</span>(x1)), <span class="fu">c</span>(pred_975, <span class="fu">rev</span>(pred_025)), <span class="at">col =</span> <span class="st">"grey85"</span>, <span class="at">lty=</span><span class="dv">0</span>)</span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(x1, <span class="fu">rev</span>(x1)), <span class="fu">c</span>(pred_875, <span class="fu">rev</span>(pred_125)), <span class="at">col =</span> <span class="st">"grey70"</span>, <span class="at">lty=</span><span class="dv">0</span>)</span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a><span class="co"># add population-specific fits</span></span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a><span class="co"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",5]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a><span class="co"># add global fit</span></span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_median <span class="sc">~</span> x1, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-27"><a href="#cb96-27" aria-hidden="true" tabindex="-1"></a><span class="co"># interaction with natural peak magnitude</span></span>
<span id="cb96-28"><a href="#cb96-28" aria-hidden="true" tabindex="-1"></a><span class="do">## minimum</span></span>
<span id="cb96-29"><a href="#cb96-29" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(Mcmcdat), <span class="at">ncol =</span> nvalues)</span>
<span id="cb96-30"><a href="#cb96-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pred)) { pred[j,] <span class="ot">&lt;-</span> Mcmcdat[j,<span class="st">"mu.A"</span>] <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[5]"</span>]<span class="sc">*</span>x1 <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[7]"</span>]<span class="sc">*</span><span class="fu">min</span>(dat<span class="sc">$</span>z_natq_peakmag, <span class="at">na.rm =</span> T) <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[13]"</span>]<span class="sc">*</span>x1<span class="sc">*</span><span class="fu">min</span>(dat<span class="sc">$</span>z_natq_peakmag, <span class="at">na.rm =</span> T) }</span>
<span id="cb96-31"><a href="#cb96-31" aria-hidden="true" tabindex="-1"></a>pred_median <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.50</span>) </span>
<span id="cb96-32"><a href="#cb96-32" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_median <span class="sc">~</span> x1, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb96-33"><a href="#cb96-33" aria-hidden="true" tabindex="-1"></a><span class="do">## maximum</span></span>
<span id="cb96-34"><a href="#cb96-34" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(Mcmcdat), <span class="at">ncol =</span> nvalues)</span>
<span id="cb96-35"><a href="#cb96-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pred)) { pred[j,] <span class="ot">&lt;-</span> Mcmcdat[j,<span class="st">"mu.A"</span>] <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[5]"</span>]<span class="sc">*</span>x1 <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[7]"</span>]<span class="sc">*</span><span class="fu">max</span>(dat<span class="sc">$</span>z_natq_peakmag, <span class="at">na.rm =</span> T) <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[13]"</span>]<span class="sc">*</span>x1<span class="sc">*</span><span class="fu">max</span>(dat<span class="sc">$</span>z_natq_peakmag, <span class="at">na.rm =</span> T) }</span>
<span id="cb96-36"><a href="#cb96-36" aria-hidden="true" tabindex="-1"></a>pred_median <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.50</span>) </span>
<span id="cb96-37"><a href="#cb96-37" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_median <span class="sc">~</span> x1, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb96-38"><a href="#cb96-38" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Min. nat. peak flow"</span>, <span class="st">"Max. nat. peak flow"</span>), <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>), <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">cex =</span> <span class="fl">0.75</span>)</span>
<span id="cb96-39"><a href="#cb96-39" aria-hidden="true" tabindex="-1"></a><span class="co"># median productivity</span></span>
<span id="cb96-40"><a href="#cb96-40" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> param.summary[<span class="st">"mu.A"</span>,<span class="dv">5</span>], <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb96-41"><a href="#cb96-41" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb96-42"><a href="#cb96-42" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fl">0.3</span>, <span class="at">labels =</span> <span class="st">"5884"</span>, <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb96-43"><a href="#cb96-43" aria-hidden="true" tabindex="-1"></a><span class="co"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb96-44"><a href="#cb96-44" aria-hidden="true" tabindex="-1"></a><span class="co"># legend</span></span>
<span id="cb96-45"><a href="#cb96-45" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">xpd =</span> <span class="cn">TRUE</span>, <span class="at">usr =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb96-46"><a href="#cb96-46" aria-hidden="true" tabindex="-1"></a><span class="co"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb96-47"><a href="#cb96-47" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">bty =</span> <span class="st">"o"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> mycols2[<span class="dv">5</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-92-1.png" class="img-fluid figure-img" width="408"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-6-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">2.5</span>,<span class="fl">0.5</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">2.25</span>,<span class="fl">0.8</span>,<span class="dv">0</span>))</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="co"># set up plot</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_jld_peaktime, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_jld_peaktime, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">length.out =</span> nvalues)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.3</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> nvalues) <span class="sc">~</span> x1, <span class="at">pch =</span> <span class="cn">NA</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xlab =</span> <span class="st">"Mgd. peak flow timing"</span>, <span class="at">ylab =</span> <span class="st">"Productivity, ln(R/S)"</span>, <span class="at">axes =</span> F)</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="co"># axes and box</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="co"># range(dat$jld_peaktime, na.rm = T)</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>x.axis <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">242</span>, <span class="dv">273</span>, <span class="dv">303</span>)</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>x.axis.scaled <span class="ot">&lt;-</span> (x.axis <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">6</span>]) <span class="sc">/</span> covsummary<span class="sc">$</span>sd[<span class="dv">6</span>]</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> x.axis.scaled, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1 May"</span>, <span class="st">"1 June"</span>, <span class="st">"1 July"</span>))</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>)</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(Mcmcdat), <span class="at">ncol =</span> nvalues)</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pred)) { pred[j,] <span class="ot">&lt;-</span> Mcmcdat[j,<span class="st">"mu.A"</span>] <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[6]"</span>]<span class="sc">*</span>x1 }</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>pred_median <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.50</span>) </span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>pred_025 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.025</span>)</span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>pred_125 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.125</span>)</span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>pred_875 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.875</span>)</span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>pred_975 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.975</span>)</span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(x1, <span class="fu">rev</span>(x1)), <span class="fu">c</span>(pred_975, <span class="fu">rev</span>(pred_025)), <span class="at">col =</span> <span class="st">"grey85"</span>, <span class="at">lty=</span><span class="dv">0</span>)</span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(x1, <span class="fu">rev</span>(x1)), <span class="fu">c</span>(pred_875, <span class="fu">rev</span>(pred_125)), <span class="at">col =</span> <span class="st">"grey70"</span>, <span class="at">lty=</span><span class="dv">0</span>)</span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a><span class="co"># add population-specific fits</span></span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a><span class="co"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",6]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a><span class="co"># add global fit</span></span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_median <span class="sc">~</span> x1, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb97-25"><a href="#cb97-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-26"><a href="#cb97-26" aria-hidden="true" tabindex="-1"></a><span class="co"># interaction with natural peak magnitude</span></span>
<span id="cb97-27"><a href="#cb97-27" aria-hidden="true" tabindex="-1"></a><span class="do">## minimum</span></span>
<span id="cb97-28"><a href="#cb97-28" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(Mcmcdat), <span class="at">ncol =</span> nvalues)</span>
<span id="cb97-29"><a href="#cb97-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pred)) { pred[j,] <span class="ot">&lt;-</span> Mcmcdat[j,<span class="st">"mu.A"</span>] <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[6]"</span>]<span class="sc">*</span>x1 <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[8]"</span>]<span class="sc">*</span><span class="fu">min</span>(dat<span class="sc">$</span>z_natq_peaktime, <span class="at">na.rm =</span> T) <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[14]"</span>]<span class="sc">*</span>x1<span class="sc">*</span><span class="fu">min</span>(dat<span class="sc">$</span>z_natq_peaktime, <span class="at">na.rm =</span> T) }</span>
<span id="cb97-30"><a href="#cb97-30" aria-hidden="true" tabindex="-1"></a>pred_median <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.50</span>) </span>
<span id="cb97-31"><a href="#cb97-31" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_median <span class="sc">~</span> x1, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb97-32"><a href="#cb97-32" aria-hidden="true" tabindex="-1"></a><span class="do">## maximum</span></span>
<span id="cb97-33"><a href="#cb97-33" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(Mcmcdat), <span class="at">ncol =</span> nvalues)</span>
<span id="cb97-34"><a href="#cb97-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pred)) { pred[j,] <span class="ot">&lt;-</span> Mcmcdat[j,<span class="st">"mu.A"</span>] <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[6]"</span>]<span class="sc">*</span>x1 <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[8]"</span>]<span class="sc">*</span><span class="fu">max</span>(dat<span class="sc">$</span>z_natq_peaktime, <span class="at">na.rm =</span> T) <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[14]"</span>]<span class="sc">*</span>x1<span class="sc">*</span><span class="fu">max</span>(dat<span class="sc">$</span>z_natq_peaktime, <span class="at">na.rm =</span> T) }</span>
<span id="cb97-35"><a href="#cb97-35" aria-hidden="true" tabindex="-1"></a>pred_median <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.50</span>) </span>
<span id="cb97-36"><a href="#cb97-36" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_median <span class="sc">~</span> x1, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb97-37"><a href="#cb97-37" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Min. nat. peak time"</span>, <span class="st">"Max. nat. peak time"</span>), <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>), <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">cex =</span> <span class="fl">0.75</span>)</span>
<span id="cb97-38"><a href="#cb97-38" aria-hidden="true" tabindex="-1"></a><span class="co"># median productivity</span></span>
<span id="cb97-39"><a href="#cb97-39" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> param.summary[<span class="st">"mu.A"</span>,<span class="dv">5</span>], <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb97-40"><a href="#cb97-40" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb97-41"><a href="#cb97-41" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fl">0.3</span>, <span class="at">labels =</span> <span class="st">"14 June"</span>, <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb97-42"><a href="#cb97-42" aria-hidden="true" tabindex="-1"></a><span class="co"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb97-43"><a href="#cb97-43" aria-hidden="true" tabindex="-1"></a><span class="co"># legend</span></span>
<span id="cb97-44"><a href="#cb97-44" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">xpd =</span> <span class="cn">TRUE</span>, <span class="at">usr =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb97-45"><a href="#cb97-45" aria-hidden="true" tabindex="-1"></a><span class="co"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb97-46"><a href="#cb97-46" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">bty =</span> <span class="st">"o"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> mycols2[<span class="dv">6</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-93-1.png" class="img-fluid figure-img" width="408"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-7-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">2.5</span>,<span class="fl">0.5</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">2.25</span>,<span class="fl">0.8</span>,<span class="dv">0</span>))</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="co"># set up plot</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_natq_peakmag, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_natq_peakmag, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">length.out =</span> nvalues)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.3</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> nvalues) <span class="sc">~</span> x1, <span class="at">pch =</span> <span class="cn">NA</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xlab =</span> <span class="st">"Natural peak flow magnitude (cfs)"</span>, <span class="at">ylab =</span> <span class="st">"Productivity, ln(R/S)"</span>, <span class="at">axes =</span> F)</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="co"># axes and box</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="co"># range(dat$natq_peakmag, na.rm = T)</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>x.axis <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">5000</span>, <span class="at">to =</span> <span class="dv">20000</span>, <span class="at">by =</span> <span class="dv">5000</span>)</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>x.axis.scaled <span class="ot">&lt;-</span> (x.axis <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">7</span>]) <span class="sc">/</span> covsummary<span class="sc">$</span>sd[<span class="dv">7</span>]</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> x.axis.scaled, <span class="at">labels =</span> <span class="fu">round</span>((x.axis), <span class="at">digits =</span> <span class="dv">0</span>))</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>)</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(Mcmcdat), <span class="at">ncol =</span> nvalues)</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pred)) { pred[j,] <span class="ot">&lt;-</span> Mcmcdat[j,<span class="st">"mu.A"</span>] <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[7]"</span>]<span class="sc">*</span>x1 }</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>pred_median <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.50</span>) </span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>pred_025 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.025</span>)</span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>pred_125 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.125</span>)</span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>pred_875 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.875</span>)</span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>pred_975 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.975</span>)</span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(x1, <span class="fu">rev</span>(x1)), <span class="fu">c</span>(pred_975, <span class="fu">rev</span>(pred_025)), <span class="at">col =</span> <span class="st">"grey85"</span>, <span class="at">lty=</span><span class="dv">0</span>)</span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(x1, <span class="fu">rev</span>(x1)), <span class="fu">c</span>(pred_875, <span class="fu">rev</span>(pred_125)), <span class="at">col =</span> <span class="st">"grey70"</span>, <span class="at">lty=</span><span class="dv">0</span>)</span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a><span class="co"># add population-specific fits</span></span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a><span class="co"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",7]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a><span class="co"># add global fit</span></span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_median <span class="sc">~</span> x1, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a><span class="co"># interaction with natural peak magnitude</span></span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a><span class="do">## minimum</span></span>
<span id="cb98-28"><a href="#cb98-28" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(Mcmcdat), <span class="at">ncol =</span> nvalues)</span>
<span id="cb98-29"><a href="#cb98-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pred)) { pred[j,] <span class="ot">&lt;-</span> Mcmcdat[j,<span class="st">"mu.A"</span>] <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[7]"</span>]<span class="sc">*</span>x1 <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[5]"</span>]<span class="sc">*</span><span class="fu">min</span>(dat<span class="sc">$</span>z_jld_peakmag, <span class="at">na.rm =</span> T) <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[13]"</span>]<span class="sc">*</span>x1<span class="sc">*</span><span class="fu">min</span>(dat<span class="sc">$</span>z_jld_peakmag, <span class="at">na.rm =</span> T) }</span>
<span id="cb98-30"><a href="#cb98-30" aria-hidden="true" tabindex="-1"></a>pred_median <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.50</span>) </span>
<span id="cb98-31"><a href="#cb98-31" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_median <span class="sc">~</span> x1, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb98-32"><a href="#cb98-32" aria-hidden="true" tabindex="-1"></a><span class="do">## maximum</span></span>
<span id="cb98-33"><a href="#cb98-33" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(Mcmcdat), <span class="at">ncol =</span> nvalues)</span>
<span id="cb98-34"><a href="#cb98-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pred)) { pred[j,] <span class="ot">&lt;-</span> Mcmcdat[j,<span class="st">"mu.A"</span>] <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[7]"</span>]<span class="sc">*</span>x1 <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[5]"</span>]<span class="sc">*</span><span class="fu">max</span>(dat<span class="sc">$</span>z_jld_peakmag, <span class="at">na.rm =</span> T) <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[13]"</span>]<span class="sc">*</span>x1<span class="sc">*</span><span class="fu">max</span>(dat<span class="sc">$</span>z_jld_peakmag, <span class="at">na.rm =</span> T) }</span>
<span id="cb98-35"><a href="#cb98-35" aria-hidden="true" tabindex="-1"></a>pred_median <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.50</span>) </span>
<span id="cb98-36"><a href="#cb98-36" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_median <span class="sc">~</span> x1, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb98-37"><a href="#cb98-37" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Min. JLD peak flow"</span>, <span class="st">"Max. JLD peak flow"</span>), <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>), <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">cex =</span> <span class="fl">0.75</span>)</span>
<span id="cb98-38"><a href="#cb98-38" aria-hidden="true" tabindex="-1"></a><span class="co"># median productivity</span></span>
<span id="cb98-39"><a href="#cb98-39" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> param.summary[<span class="st">"mu.A"</span>,<span class="dv">5</span>], <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb98-40"><a href="#cb98-40" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb98-41"><a href="#cb98-41" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fl">0.3</span>, <span class="at">labels =</span> <span class="st">"10948"</span>, <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb98-42"><a href="#cb98-42" aria-hidden="true" tabindex="-1"></a><span class="co"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb98-43"><a href="#cb98-43" aria-hidden="true" tabindex="-1"></a><span class="co"># legend</span></span>
<span id="cb98-44"><a href="#cb98-44" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">xpd =</span> <span class="cn">TRUE</span>, <span class="at">usr =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb98-45"><a href="#cb98-45" aria-hidden="true" tabindex="-1"></a><span class="co"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb98-46"><a href="#cb98-46" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">bty =</span> <span class="st">"o"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> mycols2[<span class="dv">7</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-94-1.png" class="img-fluid figure-img" width="408"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-8" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-8-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">2.5</span>,<span class="fl">0.5</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">2.25</span>,<span class="fl">0.8</span>,<span class="dv">0</span>))</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="co"># set up plot</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_natq_peaktime, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_natq_peaktime, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">length.out =</span> nvalues)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.3</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> nvalues) <span class="sc">~</span> x1, <span class="at">pch =</span> <span class="cn">NA</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xlab =</span> <span class="st">"Natural peak flow timing"</span>, <span class="at">ylab =</span> <span class="st">"Productivity, ln(R/S)"</span>, <span class="at">axes =</span> F)</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="co"># axes and box</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a><span class="co"># range(dat$natq_peaktime, na.rm = T)</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>x.axis <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">256</span>, <span class="dv">273</span>, <span class="dv">287</span>, <span class="dv">303</span>)</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>x.axis.scaled <span class="ot">&lt;-</span> (x.axis <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">8</span>]) <span class="sc">/</span> covsummary<span class="sc">$</span>sd[<span class="dv">8</span>]</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> x.axis.scaled, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"15 May"</span>, <span class="st">"1 June"</span>, <span class="st">"15 June"</span>, <span class="st">"1 July"</span>))</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>)</span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(Mcmcdat), <span class="at">ncol =</span> nvalues)</span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pred)) { pred[j,] <span class="ot">&lt;-</span> Mcmcdat[j,<span class="st">"mu.A"</span>] <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[8]"</span>]<span class="sc">*</span>x1 }</span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>pred_median <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.50</span>) </span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>pred_025 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.025</span>)</span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>pred_125 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.125</span>)</span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a>pred_875 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.875</span>)</span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a>pred_975 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.975</span>)</span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(x1, <span class="fu">rev</span>(x1)), <span class="fu">c</span>(pred_975, <span class="fu">rev</span>(pred_025)), <span class="at">col =</span> <span class="st">"grey85"</span>, <span class="at">lty=</span><span class="dv">0</span>)</span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(x1, <span class="fu">rev</span>(x1)), <span class="fu">c</span>(pred_875, <span class="fu">rev</span>(pred_125)), <span class="at">col =</span> <span class="st">"grey70"</span>, <span class="at">lty=</span><span class="dv">0</span>)</span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a><span class="co"># add population-specific fits</span></span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a><span class="co"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",8]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a><span class="co"># add global fit</span></span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_median <span class="sc">~</span> x1, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb99-25"><a href="#cb99-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-26"><a href="#cb99-26" aria-hidden="true" tabindex="-1"></a><span class="co"># interaction with natural peak timing</span></span>
<span id="cb99-27"><a href="#cb99-27" aria-hidden="true" tabindex="-1"></a><span class="do">## minimum</span></span>
<span id="cb99-28"><a href="#cb99-28" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(Mcmcdat), <span class="at">ncol =</span> nvalues)</span>
<span id="cb99-29"><a href="#cb99-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pred)) { pred[j,] <span class="ot">&lt;-</span> Mcmcdat[j,<span class="st">"mu.A"</span>] <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[8]"</span>]<span class="sc">*</span>x1 <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[6]"</span>]<span class="sc">*</span><span class="fu">min</span>(dat<span class="sc">$</span>z_jld_peaktime, <span class="at">na.rm =</span> T) <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[14]"</span>]<span class="sc">*</span>x1<span class="sc">*</span><span class="fu">min</span>(dat<span class="sc">$</span>z_jld_peaktime, <span class="at">na.rm =</span> T) }</span>
<span id="cb99-30"><a href="#cb99-30" aria-hidden="true" tabindex="-1"></a>pred_median <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.50</span>) </span>
<span id="cb99-31"><a href="#cb99-31" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_median <span class="sc">~</span> x1, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb99-32"><a href="#cb99-32" aria-hidden="true" tabindex="-1"></a><span class="do">## maximum</span></span>
<span id="cb99-33"><a href="#cb99-33" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(Mcmcdat), <span class="at">ncol =</span> nvalues)</span>
<span id="cb99-34"><a href="#cb99-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pred)) { pred[j,] <span class="ot">&lt;-</span> Mcmcdat[j,<span class="st">"mu.A"</span>] <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[8]"</span>]<span class="sc">*</span>x1 <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[6]"</span>]<span class="sc">*</span><span class="fu">max</span>(dat<span class="sc">$</span>z_jld_peaktime, <span class="at">na.rm =</span> T) <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[14]"</span>]<span class="sc">*</span>x1<span class="sc">*</span><span class="fu">max</span>(dat<span class="sc">$</span>z_jld_peaktime, <span class="at">na.rm =</span> T) }</span>
<span id="cb99-35"><a href="#cb99-35" aria-hidden="true" tabindex="-1"></a>pred_median <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.50</span>) </span>
<span id="cb99-36"><a href="#cb99-36" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_median <span class="sc">~</span> x1, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb99-37"><a href="#cb99-37" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Min. JLD peak time"</span>, <span class="st">"Max. JLD peak time"</span>), <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>), <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">cex =</span> <span class="fl">0.75</span>)</span>
<span id="cb99-38"><a href="#cb99-38" aria-hidden="true" tabindex="-1"></a><span class="co"># median productivity</span></span>
<span id="cb99-39"><a href="#cb99-39" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> param.summary[<span class="st">"mu.A"</span>,<span class="dv">5</span>], <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb99-40"><a href="#cb99-40" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb99-41"><a href="#cb99-41" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fl">0.3</span>, <span class="at">labels =</span> <span class="st">"5 June"</span>, <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb99-42"><a href="#cb99-42" aria-hidden="true" tabindex="-1"></a><span class="co"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb99-43"><a href="#cb99-43" aria-hidden="true" tabindex="-1"></a><span class="co"># legend</span></span>
<span id="cb99-44"><a href="#cb99-44" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">xpd =</span> <span class="cn">TRUE</span>, <span class="at">usr =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb99-45"><a href="#cb99-45" aria-hidden="true" tabindex="-1"></a><span class="co"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb99-46"><a href="#cb99-46" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">bty =</span> <span class="st">"o"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> mycols2[<span class="dv">8</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-95-1.png" class="img-fluid figure-img" width="408"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-9" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-9-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">2.5</span>,<span class="fl">0.5</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">2.25</span>,<span class="fl">0.8</span>,<span class="dv">0</span>))</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="co"># set up plot</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_temp_falmean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_temp_falmean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">length.out =</span> nvalues)</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.3</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> nvalues) <span class="sc">~</span> x1, <span class="at">pch =</span> <span class="cn">NA</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Autumn temperature ("</span><span class="sc">^</span><span class="st">"o"</span>, <span class="st">"C)"</span>, <span class="at">sep =</span> <span class="st">""</span>)), <span class="at">ylab =</span> <span class="st">"Productivity, ln(R/S)"</span>, <span class="at">axes =</span> F)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="co"># axes and box</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="co"># range(dat$temp_falmean, na.rm = T)</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>x.axis <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">2</span>, <span class="at">to =</span> <span class="dv">6</span>, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>x.axis.scaled <span class="ot">&lt;-</span> (x.axis <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">9</span>]) <span class="sc">/</span> covsummary<span class="sc">$</span>sd[<span class="dv">9</span>]</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> x.axis.scaled, <span class="at">labels =</span> x.axis)</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>)</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(Mcmcdat), <span class="at">ncol =</span> nvalues)</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pred)) { pred[j,] <span class="ot">&lt;-</span> Mcmcdat[j,<span class="st">"mu.A"</span>] <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[9]"</span>]<span class="sc">*</span>x1 }</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>pred_median <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.50</span>) </span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>pred_025 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.05</span>)</span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>pred_125 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.125</span>)</span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>pred_875 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.875</span>)</span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>pred_975 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.975</span>)</span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(x1, <span class="fu">rev</span>(x1)), <span class="fu">c</span>(pred_975, <span class="fu">rev</span>(pred_025)), <span class="at">col =</span> <span class="st">"grey85"</span>, <span class="at">lty=</span><span class="dv">0</span>)</span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(x1, <span class="fu">rev</span>(x1)), <span class="fu">c</span>(pred_875, <span class="fu">rev</span>(pred_125)), <span class="at">col =</span> <span class="st">"grey70"</span>, <span class="at">lty=</span><span class="dv">0</span>)</span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a><span class="co"># add population-specific fits</span></span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a><span class="co"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",9]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a><span class="co"># add global fit</span></span>
<span id="cb100-24"><a href="#cb100-24" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_median <span class="sc">~</span> x1, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb100-25"><a href="#cb100-25" aria-hidden="true" tabindex="-1"></a><span class="co"># median productivity</span></span>
<span id="cb100-26"><a href="#cb100-26" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> param.summary[<span class="st">"mu.A"</span>,<span class="dv">5</span>], <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb100-27"><a href="#cb100-27" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb100-28"><a href="#cb100-28" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fl">0.3</span>, <span class="at">labels =</span> <span class="st">"4.05"</span>, <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb100-29"><a href="#cb100-29" aria-hidden="true" tabindex="-1"></a><span class="co"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb100-30"><a href="#cb100-30" aria-hidden="true" tabindex="-1"></a><span class="co"># legend</span></span>
<span id="cb100-31"><a href="#cb100-31" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">xpd =</span> <span class="cn">TRUE</span>, <span class="at">usr =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb100-32"><a href="#cb100-32" aria-hidden="true" tabindex="-1"></a><span class="co"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb100-33"><a href="#cb100-33" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">bty =</span> <span class="st">"o"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> mycols2[<span class="dv">9</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-96-1.png" class="img-fluid figure-img" width="408"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-10" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-10-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">2.5</span>,<span class="fl">0.5</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">2.25</span>,<span class="fl">0.8</span>,<span class="dv">0</span>))</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="co"># set up plot</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_temp_winmean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_temp_winmean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">length.out =</span> nvalues)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.3</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> nvalues) <span class="sc">~</span> x1, <span class="at">pch =</span> <span class="cn">NA</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Winter temperature ("</span><span class="sc">^</span><span class="st">"o"</span>, <span class="st">"C)"</span>, <span class="at">sep =</span> <span class="st">""</span>)), <span class="at">ylab =</span> <span class="st">"Productivity, ln(R/S)"</span>, <span class="at">axes =</span> F)</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="co"># axes and box</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="co"># range(dat$temp_winmean, na.rm = T)</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>x.axis <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">13</span>, <span class="at">to =</span> <span class="dv">5</span>, <span class="at">by =</span> <span class="dv">2</span>)</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>x.axis.scaled <span class="ot">&lt;-</span> (x.axis <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">10</span>]) <span class="sc">/</span> covsummary<span class="sc">$</span>sd[<span class="dv">10</span>]</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> x.axis.scaled, <span class="at">labels =</span> x.axis)</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>)</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(Mcmcdat), <span class="at">ncol =</span> nvalues)</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pred)) { pred[j,] <span class="ot">&lt;-</span> Mcmcdat[j,<span class="st">"mu.A"</span>] <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[10]"</span>]<span class="sc">*</span>x1 }</span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>pred_median <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.50</span>) </span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>pred_025 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.025</span>)</span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>pred_125 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.125</span>)</span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>pred_875 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.875</span>)</span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>pred_975 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.925</span>)</span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(x1, <span class="fu">rev</span>(x1)), <span class="fu">c</span>(pred_975, <span class="fu">rev</span>(pred_025)), <span class="at">col =</span> <span class="st">"grey85"</span>, <span class="at">lty=</span><span class="dv">0</span>)</span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(x1, <span class="fu">rev</span>(x1)), <span class="fu">c</span>(pred_875, <span class="fu">rev</span>(pred_125)), <span class="at">col =</span> <span class="st">"grey70"</span>, <span class="at">lty=</span><span class="dv">0</span>)</span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a><span class="co"># add population-specific fits</span></span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a><span class="co"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",10]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a><span class="co"># add global fit</span></span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_median <span class="sc">~</span> x1, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a><span class="co"># median productivity</span></span>
<span id="cb101-26"><a href="#cb101-26" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> param.summary[<span class="st">"mu.A"</span>,<span class="dv">5</span>], <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb101-27"><a href="#cb101-27" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb101-28"><a href="#cb101-28" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fl">0.3</span>, <span class="at">labels =</span> <span class="st">"-9.29"</span>, <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb101-29"><a href="#cb101-29" aria-hidden="true" tabindex="-1"></a><span class="co"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb101-30"><a href="#cb101-30" aria-hidden="true" tabindex="-1"></a><span class="co"># legend</span></span>
<span id="cb101-31"><a href="#cb101-31" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">xpd =</span> <span class="cn">TRUE</span>, <span class="at">usr =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb101-32"><a href="#cb101-32" aria-hidden="true" tabindex="-1"></a><span class="co"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb101-33"><a href="#cb101-33" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">bty =</span> <span class="st">"o"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> mycols2[<span class="dv">10</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-97-1.png" class="img-fluid figure-img" width="408"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-11" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-11-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">2.5</span>,<span class="fl">0.5</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">2.25</span>,<span class="fl">0.8</span>,<span class="dv">0</span>))</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="co"># set up plot</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_temp_sprmean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_temp_sprmean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">length.out =</span> nvalues)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.3</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> nvalues) <span class="sc">~</span> x1, <span class="at">pch =</span> <span class="cn">NA</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Spring temperature ("</span><span class="sc">^</span><span class="st">"o"</span>, <span class="st">"C)"</span>, <span class="at">sep =</span> <span class="st">""</span>)), <span class="at">ylab =</span> <span class="st">"Productivity, ln(R/S)"</span>, <span class="at">axes =</span> F)</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="co"># axes and box</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="co"># range(dat$temp_sprmean, na.rm = T)</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>x.axis <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">5</span>, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>x.axis.scaled <span class="ot">&lt;-</span> (x.axis <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">11</span>]) <span class="sc">/</span> covsummary<span class="sc">$</span>sd[<span class="dv">11</span>]</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> x.axis.scaled, <span class="at">labels =</span> x.axis)</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>)</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(Mcmcdat), <span class="at">ncol =</span> nvalues)</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pred)) { pred[j,] <span class="ot">&lt;-</span> Mcmcdat[j,<span class="st">"mu.A"</span>] <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[11]"</span>]<span class="sc">*</span>x1 }</span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>pred_median <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.50</span>) </span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>pred_025 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.025</span>)</span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>pred_125 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.125</span>)</span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>pred_875 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.875</span>)</span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>pred_975 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.975</span>)</span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(x1, <span class="fu">rev</span>(x1)), <span class="fu">c</span>(pred_975, <span class="fu">rev</span>(pred_025)), <span class="at">col =</span> <span class="st">"grey85"</span>, <span class="at">lty=</span><span class="dv">0</span>)</span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(x1, <span class="fu">rev</span>(x1)), <span class="fu">c</span>(pred_875, <span class="fu">rev</span>(pred_125)), <span class="at">col =</span> <span class="st">"grey70"</span>, <span class="at">lty=</span><span class="dv">0</span>)</span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a><span class="co"># add population-specific fits</span></span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a><span class="co"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",11]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a><span class="co"># add global fit</span></span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_median <span class="sc">~</span> x1, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a><span class="co"># median productivity</span></span>
<span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> param.summary[<span class="st">"mu.A"</span>,<span class="dv">5</span>], <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb102-27"><a href="#cb102-27" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb102-28"><a href="#cb102-28" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fl">0.3</span>, <span class="at">labels =</span> <span class="st">"2.38"</span>, <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb102-29"><a href="#cb102-29" aria-hidden="true" tabindex="-1"></a><span class="co"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb102-30"><a href="#cb102-30" aria-hidden="true" tabindex="-1"></a><span class="co"># legend</span></span>
<span id="cb102-31"><a href="#cb102-31" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">xpd =</span> <span class="cn">TRUE</span>, <span class="at">usr =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb102-32"><a href="#cb102-32" aria-hidden="true" tabindex="-1"></a><span class="co"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb102-33"><a href="#cb102-33" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">bty =</span> <span class="st">"o"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> mycols2[<span class="dv">11</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-98-1.png" class="img-fluid figure-img" width="408"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-12" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-12-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">2.5</span>,<span class="fl">0.5</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">2.25</span>,<span class="fl">0.8</span>,<span class="dv">0</span>))</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="co"># set up plot</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_temp_summean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_temp_summean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">length.out =</span> nvalues)</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.3</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> nvalues) <span class="sc">~</span> x1, <span class="at">pch =</span> <span class="cn">NA</span>, <span class="at">bty =</span> <span class="st">"l"</span>, <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Summer temperature ("</span><span class="sc">^</span><span class="st">"o"</span>, <span class="st">"C)"</span>, <span class="at">sep =</span> <span class="st">""</span>)), <span class="at">ylab =</span> <span class="st">"Productivity, ln(R/S)"</span>, <span class="at">axes =</span> F)</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="co"># axes and box</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="co"># range(dat$temp_summean, na.rm = T)</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>x.axis <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">12</span>, <span class="at">to =</span> <span class="dv">17</span>, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>x.axis.scaled <span class="ot">&lt;-</span> (x.axis <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">12</span>]) <span class="sc">/</span> covsummary<span class="sc">$</span>sd[<span class="dv">12</span>]</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> x.axis.scaled, <span class="at">labels =</span> x.axis)</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>)</span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(Mcmcdat), <span class="at">ncol =</span> nvalues)</span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pred)) { pred[j,] <span class="ot">&lt;-</span> Mcmcdat[j,<span class="st">"mu.A"</span>] <span class="sc">+</span> Mcmcdat[j,<span class="st">"mu.coef[12]"</span>]<span class="sc">*</span>x1 }</span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>pred_median <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.50</span>) </span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a>pred_025 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.025</span>)</span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>pred_125 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.125</span>)</span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>pred_875 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.875</span>)</span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>pred_975 <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred, <span class="at">MARGIN =</span> <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fl">0.975</span>)</span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(x1, <span class="fu">rev</span>(x1)), <span class="fu">c</span>(pred_975, <span class="fu">rev</span>(pred_025)), <span class="at">col =</span> <span class="st">"grey85"</span>, <span class="at">lty=</span><span class="dv">0</span>)</span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(x1, <span class="fu">rev</span>(x1)), <span class="fu">c</span>(pred_875, <span class="fu">rev</span>(pred_125)), <span class="at">col =</span> <span class="st">"grey70"</span>, <span class="at">lty=</span><span class="dv">0</span>)</span>
<span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a><span class="co"># add population-specific fits</span></span>
<span id="cb103-22"><a href="#cb103-22" aria-hidden="true" tabindex="-1"></a><span class="co"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",12]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb103-23"><a href="#cb103-23" aria-hidden="true" tabindex="-1"></a><span class="co"># add global fit</span></span>
<span id="cb103-24"><a href="#cb103-24" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_median <span class="sc">~</span> x1, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb103-25"><a href="#cb103-25" aria-hidden="true" tabindex="-1"></a><span class="co"># median productivity</span></span>
<span id="cb103-26"><a href="#cb103-26" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> param.summary[<span class="st">"mu.A"</span>,<span class="dv">5</span>], <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb103-27"><a href="#cb103-27" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb103-28"><a href="#cb103-28" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fl">0.3</span>, <span class="at">labels =</span> <span class="st">"14.81"</span>, <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"grey40"</span>)</span>
<span id="cb103-29"><a href="#cb103-29" aria-hidden="true" tabindex="-1"></a><span class="co"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb103-30"><a href="#cb103-30" aria-hidden="true" tabindex="-1"></a><span class="co"># legend</span></span>
<span id="cb103-31"><a href="#cb103-31" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">xpd =</span> <span class="cn">TRUE</span>, <span class="at">usr =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb103-32"><a href="#cb103-32" aria-hidden="true" tabindex="-1"></a><span class="co"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb103-33"><a href="#cb103-33" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">bty =</span> <span class="st">"o"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> mycols2[<span class="dv">12</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-99-1.png" class="img-fluid figure-img" width="408"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Write plots to file…</p>
</section>
<section id="interactions" class="level3" data-number="4.6.4">
<h3 data-number="4.6.4" class="anchored" data-anchor-id="interactions"><span class="header-section-number">4.6.4</span> Interactions</h3>
<p>Get raw covariate data for plotting</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>mgdcovs <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Derived/JLD_ManagedFlow_Covariates_BroodYear_1960-2022.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(broodyr, jld_peakmag, jld_peaktime) <span class="sc">%&gt;%</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">z_jld_peakmag =</span> (jld_peakmag <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">5</span>])<span class="sc">/</span>covsummary<span class="sc">$</span>sd[<span class="dv">5</span>],</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">z_jld_peaktime =</span> (jld_peaktime <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">6</span>])<span class="sc">/</span>covsummary<span class="sc">$</span>sd[<span class="dv">6</span>])</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>natcovs <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Derived/SnakeTribs_NaturalFlow_Covariates_BroodYear_1960-2022.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(site <span class="sc">==</span> <span class="st">"SnakeNat"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(broodyr, natq_peakmag, natq_peaktime) <span class="sc">%&gt;%</span></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">z_natq_peakmag =</span> (natq_peakmag <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">7</span>])<span class="sc">/</span>covsummary<span class="sc">$</span>sd[<span class="dv">7</span>],</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">z_natq_peaktime =</span> (natq_peaktime <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">8</span>])<span class="sc">/</span>covsummary<span class="sc">$</span>sd[<span class="dv">8</span>])</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>mycovdat <span class="ot">&lt;-</span> mgdcovs <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(natcovs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Number of values for calculation</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>nvalues <span class="ot">&lt;-</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="peak-flow-magnitude" class="level4" data-number="4.6.4.1">
<h4 data-number="4.6.4.1" class="anchored" data-anchor-id="peak-flow-magnitude"><span class="header-section-number">4.6.4.1</span> Peak flow magnitude</h4>
<p>Generate sequences of predictor data and transform to original scale</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>xjld <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_jld_peakmag, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_jld_peakmag, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">length.out =</span> nvalues)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>xnat <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_natq_peakmag, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_natq_peakmag, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">length.out =</span> nvalues)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>xjld.real <span class="ot">&lt;-</span> (xjld <span class="sc">*</span> covsummary<span class="sc">$</span>sd[<span class="dv">5</span>]) <span class="sc">+</span> covsummary<span class="sc">$</span>mean[<span class="dv">5</span>]</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>xnat.real <span class="ot">&lt;-</span> (xnat <span class="sc">*</span> covsummary<span class="sc">$</span>sd[<span class="dv">7</span>]) <span class="sc">+</span> covsummary<span class="sc">$</span>mean[<span class="dv">7</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Set up axes</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>xjld.axis <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">4000</span>, <span class="at">to =</span> <span class="dv">12000</span>, <span class="at">by =</span> <span class="dv">2000</span>)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>xjld.axis.scaled <span class="ot">&lt;-</span> (xjld.axis <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">5</span>]) <span class="sc">/</span> covsummary<span class="sc">$</span>sd[<span class="dv">5</span>]</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>xnat.axis <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">5000</span>, <span class="at">to =</span> <span class="dv">20000</span>, <span class="at">by =</span> <span class="dv">5000</span>)</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>xnat.axis.scaled <span class="ot">&lt;-</span> (xnat.axis <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">7</span>]) <span class="sc">/</span> covsummary<span class="sc">$</span>sd[<span class="dv">7</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Predict productivity from model</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> nvalues, <span class="at">ncol =</span> nvalues) <span class="co"># matrix of predictions</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>com <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> nvalues, <span class="at">ncol =</span> nvalues) <span class="co"># matrix of combined flow</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nvalues) {</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nvalues) {</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>    z[i,j] <span class="ot">&lt;-</span> param.summary[<span class="st">"mu.coef[5]"</span>,<span class="dv">5</span>]<span class="sc">*</span>xjld[i] <span class="sc">+</span> param.summary[<span class="st">"mu.coef[7]"</span>,<span class="dv">5</span>]<span class="sc">*</span>xnat[j] <span class="sc">+</span> param.summary[<span class="st">"mu.coef[13]"</span>,<span class="dv">5</span>]<span class="sc">*</span>xjld[i]<span class="sc">*</span>xnat[j]</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>    com[i,j] <span class="ot">&lt;-</span> (xjld.real[i]) <span class="sc">+</span> (xnat.real[j])</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>z.cont <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(z <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, z) <span class="co"># trick for plotting single contour</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(z)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.2687132  0.1940241</code></pre>
</div>
</div>
<p>Plot set up</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>mylevels <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>) <span class="co"># specify location and number of breaks for plotting</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>mycols <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">hcl.colors</span>(<span class="fu">length</span>(mylevels)<span class="sc">-</span><span class="dv">1</span>, <span class="st">"Blue-Red 3"</span>))</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>myddd <span class="ot">&lt;-</span> mycovdat <span class="sc">%&gt;%</span> <span class="fu">select</span>(z_natq_peakmag, z_jld_peakmag) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(z_natq_peakmag))</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>myhull <span class="ot">&lt;-</span> <span class="fu">chull</span>(myddd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">3.5</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filled.contour</span>(<span class="at">x =</span> xnat, <span class="at">y =</span> xjld, <span class="at">z =</span> <span class="fu">t</span>(z),</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">plot.title =</span> {</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">title</span>(<span class="at">xlab =</span> <span class="st">"Natural peak flow magnitude (cfs)"</span>)</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">title</span>(<span class="at">ylab =</span> <span class="st">"Managed peak flow magnitude (cfs)"</span>)</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>               },</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">levels =</span> mylevels,</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">col =</span> mycols,</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">plot.axes =</span> {</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">contour</span>(<span class="at">x =</span> xnat, <span class="at">y =</span> xjld, <span class="at">z =</span> <span class="fu">t</span>(z), <span class="at">levels =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"grey40"</span>,</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">drawlabels =</span> F, <span class="at">axes =</span> F, <span class="at">frame.plot =</span> F, <span class="at">add =</span> T);</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">segments</span>(myddd<span class="sc">$</span>z_natq_peakmag[myhull], myddd<span class="sc">$</span>z_jld_peakmag[myhull],</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>                          myddd<span class="sc">$</span>z_natq_peakmag[<span class="fu">c</span>(myhull[<span class="fu">length</span>(myhull)], myhull[<span class="sc">-</span><span class="fu">length</span>(myhull)])],</span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>                          myddd<span class="sc">$</span>z_jld_peakmag[<span class="fu">c</span>(myhull[<span class="fu">length</span>(myhull)], myhull[<span class="sc">-</span><span class="fu">length</span>(myhull)])],</span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>                          <span class="at">col =</span> <span class="st">"grey40"</span>, <span class="at">lwd =</span> <span class="dv">2</span>) <span class="co"># Draw convex hull lines</span></span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> xnat.axis.scaled, <span class="at">labels =</span> xnat.axis); </span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">axis</span>(<span class="dv">2</span>, <span class="at">at =</span> xjld.axis.scaled, <span class="at">labels =</span> xjld.axis)</span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a>               })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-107-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="peak-flow-timing" class="level4" data-number="4.6.4.2">
<h4 data-number="4.6.4.2" class="anchored" data-anchor-id="peak-flow-timing"><span class="header-section-number">4.6.4.2</span> Peak flow timing</h4>
<p>Generate sequences of predictor data and transform to original scale</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>xjld <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_jld_peaktime, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_jld_peaktime, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">length.out =</span> nvalues)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>xnat <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_natq_peaktime, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_natq_peaktime, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">length.out =</span> nvalues)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>xjld.real <span class="ot">&lt;-</span> (xjld <span class="sc">*</span> covsummary<span class="sc">$</span>sd[<span class="dv">6</span>]) <span class="sc">+</span> covsummary<span class="sc">$</span>mean[<span class="dv">6</span>]</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>xnat.real <span class="ot">&lt;-</span> (xnat <span class="sc">*</span> covsummary<span class="sc">$</span>sd[<span class="dv">8</span>]) <span class="sc">+</span> covsummary<span class="sc">$</span>mean[<span class="dv">8</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Set up axes</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>xjld.axis <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">242</span>, <span class="dv">273</span>, <span class="dv">303</span>)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>xjld.axis.scaled <span class="ot">&lt;-</span> (xjld.axis <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">6</span>]) <span class="sc">/</span> covsummary<span class="sc">$</span>sd[<span class="dv">6</span>]</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>xjld.axis.labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1 May"</span>, <span class="st">"1 June"</span>, <span class="st">"1 July"</span>)</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>xnat.axis <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">256</span>, <span class="dv">273</span>, <span class="dv">287</span>, <span class="dv">303</span>)</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>xnat.axis.scaled <span class="ot">&lt;-</span> (xnat.axis <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">8</span>]) <span class="sc">/</span> covsummary<span class="sc">$</span>sd[<span class="dv">8</span>]</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>xnat.axis.labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"15 May"</span>, <span class="st">"1 June"</span>, <span class="st">"15 June"</span>, <span class="st">"1 July"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Predict productivity from model</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> nvalues, <span class="at">ncol =</span> nvalues) <span class="co"># matrix of predictions</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>com <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> nvalues, <span class="at">ncol =</span> nvalues) <span class="co"># matrix of combined flow</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nvalues) {</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nvalues) {</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>    z[i,j] <span class="ot">&lt;-</span> param.summary[<span class="st">"mu.coef[6]"</span>,<span class="dv">5</span>]<span class="sc">*</span>xjld[i] <span class="sc">+</span> param.summary[<span class="st">"mu.coef[8]"</span>,<span class="dv">5</span>]<span class="sc">*</span>xnat[j] <span class="sc">+</span> param.summary[<span class="st">"mu.coef[14]"</span>,<span class="dv">5</span>]<span class="sc">*</span>xjld[i]<span class="sc">*</span>xnat[j]</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>z.cont <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(z <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, z) <span class="co"># trick for plotting single contour</span></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(z)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.7522073  0.8330047</code></pre>
</div>
</div>
<p>Plot set up</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>mylevels <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>) <span class="co"># specify location and number of breaks for plotting</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>mycols <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">hcl.colors</span>(<span class="fu">length</span>(mylevels)<span class="sc">-</span><span class="dv">1</span>, <span class="st">"Blue-Red 3"</span>))</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>myddd <span class="ot">&lt;-</span> mycovdat <span class="sc">%&gt;%</span> <span class="fu">select</span>(z_natq_peaktime, z_jld_peaktime) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(z_natq_peaktime), <span class="sc">!</span><span class="fu">is.na</span>(z_jld_peaktime))</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>myhull <span class="ot">&lt;-</span> <span class="fu">chull</span>(myddd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">3.5</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filled.contour</span>(<span class="at">x =</span> xnat, <span class="at">y =</span> xjld, <span class="at">z =</span> <span class="fu">t</span>(z),</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">plot.title =</span> {</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">title</span>(<span class="at">xlab =</span> <span class="st">"Natural peak flow timing"</span>)</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">title</span>(<span class="at">ylab =</span> <span class="st">"Managed peak flow timing"</span>)</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>               },</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">levels =</span> mylevels,</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">col =</span> mycols,</span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">plot.axes =</span> {</span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">contour</span>(<span class="at">x =</span> xnat, <span class="at">y =</span> xjld, <span class="at">z =</span> <span class="fu">t</span>(z), <span class="at">levels =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"grey40"</span>,</span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">drawlabels =</span> F, <span class="at">axes =</span> F, <span class="at">frame.plot =</span> F, <span class="at">add =</span> T);</span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">segments</span>(myddd<span class="sc">$</span>z_natq_peaktime[myhull], myddd<span class="sc">$</span>z_jld_peaktime[myhull],</span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a>                          myddd<span class="sc">$</span>z_natq_peaktime[<span class="fu">c</span>(myhull[<span class="fu">length</span>(myhull)], myhull[<span class="sc">-</span><span class="fu">length</span>(myhull)])],</span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a>                          myddd<span class="sc">$</span>z_jld_peaktime[<span class="fu">c</span>(myhull[<span class="fu">length</span>(myhull)], myhull[<span class="sc">-</span><span class="fu">length</span>(myhull)])],</span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a>                          <span class="at">col =</span> <span class="st">"grey40"</span>, <span class="at">lwd =</span> <span class="dv">2</span>) <span class="co"># Draw convex hull lines</span></span>
<span id="cb117-16"><a href="#cb117-16" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> xnat.axis.scaled, <span class="at">labels =</span> xnat.axis.labels);</span>
<span id="cb117-17"><a href="#cb117-17" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">axis</span>(<span class="dv">2</span>, <span class="at">at =</span> xjld.axis.scaled, <span class="at">labels =</span> xjld.axis.labels)</span>
<span id="cb117-18"><a href="#cb117-18" aria-hidden="true" tabindex="-1"></a>               })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ReddCountsRicker_files/figure-html/unnamed-chunk-113-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>


<!-- -->

</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./JoinFishDataWithCovariates.html" class="pagination-link" aria-label="Join Fish and Env. Data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Join Fish and Env. Data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./ClimateProjectionData.html" class="pagination-link" aria-label="GCM Data Summary">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">GCM Data Summary</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb118" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Stock-Recruitment Analysis"</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> html</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>Purpose: Fit hierarchical Ricker stock-recruitment model to understand environmental effects on population productivity</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>**Notes:**</span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Model is fit with managed winter flow variation as the only winter flow variable. </span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>Managed winter flow variables (*jld_winmean*, *jld_winmin*, and *jld_winvar*) are all strongly correlated and alternative models fit with each produce similar results (*no effect of managed winter flow*)</span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>However, traceplots for global covariate effects for the model with *jld_winvar* indicate better convergence than for alternative models</span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>An alternative option for dealing with correlated managed flow variables would be to fit a model with a "management regime" binary variable indicating pre- and post-1989 change in JLD autumn ramp-down and winter flow management. </span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>For all models, ~bi-modal posterior distributions for select global covariate effects (*jld_peakmag* in particular) suggest that the effects of certain covariates may differ between ages. </span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>More exploratory modeling may be warranted. For example, we could treat the base model as an "exploratory" analysis, then after seeing posterior distributions, estimate age-specific effects for problematic variables. Although this complicates the interaction term between managed and natural peak flow magnitude. </span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>It may be worth considering other natural flow variables, such as annual/winter minimum flow per Clark comment (+), but this may be correlated with managed minimum flows, and combined mean winter flow is correlated with jld_peaktime (?). Additionally, Diana suggests end of summer natural base flow (+), but this is likely correlated with natural peak flow magnitude </span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-19"><a href="#cb118-19" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE}</span></span>
<span id="cb118-20"><a href="#cb118-20" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb118-21"><a href="#cb118-21" aria-hidden="true" tabindex="-1"></a><span class="in">library(GGally)</span></span>
<span id="cb118-22"><a href="#cb118-22" aria-hidden="true" tabindex="-1"></a><span class="in">library(lubridate)</span></span>
<span id="cb118-23"><a href="#cb118-23" aria-hidden="true" tabindex="-1"></a><span class="in">library(RColorBrewer)</span></span>
<span id="cb118-24"><a href="#cb118-24" aria-hidden="true" tabindex="-1"></a><span class="in">library(R2jags)</span></span>
<span id="cb118-25"><a href="#cb118-25" aria-hidden="true" tabindex="-1"></a><span class="in">library(MCMCvis)</span></span>
<span id="cb118-26"><a href="#cb118-26" aria-hidden="true" tabindex="-1"></a><span class="in">library(loo)</span></span>
<span id="cb118-27"><a href="#cb118-27" aria-hidden="true" tabindex="-1"></a><span class="in">library(HDInterval)</span></span>
<span id="cb118-28"><a href="#cb118-28" aria-hidden="true" tabindex="-1"></a><span class="in">library(scales)</span></span>
<span id="cb118-29"><a href="#cb118-29" aria-hidden="true" tabindex="-1"></a><span class="in">library(data.table)</span></span>
<span id="cb118-30"><a href="#cb118-30" aria-hidden="true" tabindex="-1"></a><span class="in">library(corrplot)</span></span>
<span id="cb118-31"><a href="#cb118-31" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggmcmc)</span></span>
<span id="cb118-32"><a href="#cb118-32" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggeffects)</span></span>
<span id="cb118-33"><a href="#cb118-33" aria-hidden="true" tabindex="-1"></a><span class="in">library(viridis)</span></span>
<span id="cb118-34"><a href="#cb118-34" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggpubr)</span></span>
<span id="cb118-35"><a href="#cb118-35" aria-hidden="true" tabindex="-1"></a><span class="in">library(mcmcplots)</span></span>
<span id="cb118-36"><a href="#cb118-36" aria-hidden="true" tabindex="-1"></a><span class="in">library(beepr)</span></span>
<span id="cb118-37"><a href="#cb118-37" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggridges)</span></span>
<span id="cb118-38"><a href="#cb118-38" aria-hidden="true" tabindex="-1"></a><span class="in">library(colorblindcheck)</span></span>
<span id="cb118-39"><a href="#cb118-39" aria-hidden="true" tabindex="-1"></a><span class="in">library(DT)</span></span>
<span id="cb118-40"><a href="#cb118-40" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-41"><a href="#cb118-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-42"><a href="#cb118-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-43"><a href="#cb118-43" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data</span></span>
<span id="cb118-44"><a href="#cb118-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-45"><a href="#cb118-45" aria-hidden="true" tabindex="-1"></a>First, use this to pull fish data</span>
<span id="cb118-48"><a href="#cb118-48" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-49"><a href="#cb118-49" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Derived/ReddCounts_WGFD_1971-2021_cleaned_withFlowTempCovariates_SeparateFlowComponents_age0.csv"</span>)</span>
<span id="cb118-50"><a href="#cb118-50" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-51"><a href="#cb118-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-52"><a href="#cb118-52" aria-hidden="true" tabindex="-1"></a>Pull covariate data for age-0, combine experienced and natural flow datasets</span>
<span id="cb118-55"><a href="#cb118-55" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-56"><a href="#cb118-56" aria-hidden="true" tabindex="-1"></a>dat0 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Derived/ReddCounts_WGFD_1971-2021_cleaned_withFlowTempCovariates_SeparateFlowComponents_age0.csv"</span>)</span>
<span id="cb118-57"><a href="#cb118-57" aria-hidden="true" tabindex="-1"></a>dat0b <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Derived/ReddCounts_WGFD_1971-2021_cleaned_withFlowTempCovariates_ExperiencedFlow_age0.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb118-58"><a href="#cb118-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, stream, natq_winmean, natq_winvar, natq_peakmag, natq_peaktime, z_natq_winmean, z_natq_winvar, z_natq_peakmag, z_natq_peaktime) <span class="sc">%&gt;%</span></span>
<span id="cb118-59"><a href="#cb118-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">expq_winmean =</span> natq_winmean,</span>
<span id="cb118-60"><a href="#cb118-60" aria-hidden="true" tabindex="-1"></a>         <span class="at">expq_winvar =</span> natq_winvar,</span>
<span id="cb118-61"><a href="#cb118-61" aria-hidden="true" tabindex="-1"></a>         <span class="at">expq_peakmag =</span> natq_peakmag,</span>
<span id="cb118-62"><a href="#cb118-62" aria-hidden="true" tabindex="-1"></a>         <span class="at">expq_peaktime =</span> natq_peaktime,</span>
<span id="cb118-63"><a href="#cb118-63" aria-hidden="true" tabindex="-1"></a>         <span class="at">z_expq_winmean =</span> z_natq_winmean,</span>
<span id="cb118-64"><a href="#cb118-64" aria-hidden="true" tabindex="-1"></a>         <span class="at">z_expq_winvar =</span> z_natq_winvar,</span>
<span id="cb118-65"><a href="#cb118-65" aria-hidden="true" tabindex="-1"></a>         <span class="at">z_expq_peakmag =</span> z_natq_peakmag,</span>
<span id="cb118-66"><a href="#cb118-66" aria-hidden="true" tabindex="-1"></a>         <span class="at">z_expq_peaktime =</span> z_natq_peaktime)</span>
<span id="cb118-67"><a href="#cb118-67" aria-hidden="true" tabindex="-1"></a>dat0 <span class="ot">&lt;-</span> dat0 <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(dat0b)</span>
<span id="cb118-68"><a href="#cb118-68" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-69"><a href="#cb118-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-70"><a href="#cb118-70" aria-hidden="true" tabindex="-1"></a>Pull covariate data for age-1, combine experienced and natural flow datasets</span>
<span id="cb118-73"><a href="#cb118-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-74"><a href="#cb118-74" aria-hidden="true" tabindex="-1"></a>dat1 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Derived/ReddCounts_WGFD_1971-2021_cleaned_withFlowTempCovariates_SeparateFlowComponents_age1.csv"</span>)</span>
<span id="cb118-75"><a href="#cb118-75" aria-hidden="true" tabindex="-1"></a>dat1b <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Derived/ReddCounts_WGFD_1971-2021_cleaned_withFlowTempCovariates_ExperiencedFlow_age1.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb118-76"><a href="#cb118-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, stream, natq_winmean, natq_winvar, natq_peakmag, natq_peaktime, z_natq_winmean, z_natq_winvar, z_natq_peakmag, z_natq_peaktime) <span class="sc">%&gt;%</span></span>
<span id="cb118-77"><a href="#cb118-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">expq_winmean =</span> natq_winmean,</span>
<span id="cb118-78"><a href="#cb118-78" aria-hidden="true" tabindex="-1"></a>         <span class="at">expq_winvar =</span> natq_winvar,</span>
<span id="cb118-79"><a href="#cb118-79" aria-hidden="true" tabindex="-1"></a>         <span class="at">expq_peakmag =</span> natq_peakmag,</span>
<span id="cb118-80"><a href="#cb118-80" aria-hidden="true" tabindex="-1"></a>         <span class="at">expq_peaktime =</span> natq_peaktime,</span>
<span id="cb118-81"><a href="#cb118-81" aria-hidden="true" tabindex="-1"></a>         <span class="at">z_expq_winmean =</span> z_natq_winmean,</span>
<span id="cb118-82"><a href="#cb118-82" aria-hidden="true" tabindex="-1"></a>         <span class="at">z_expq_winvar =</span> z_natq_winvar,</span>
<span id="cb118-83"><a href="#cb118-83" aria-hidden="true" tabindex="-1"></a>         <span class="at">z_expq_peakmag =</span> z_natq_peakmag,</span>
<span id="cb118-84"><a href="#cb118-84" aria-hidden="true" tabindex="-1"></a>         <span class="at">z_expq_peaktime =</span> z_natq_peaktime)</span>
<span id="cb118-85"><a href="#cb118-85" aria-hidden="true" tabindex="-1"></a>dat1 <span class="ot">&lt;-</span> dat1 <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(dat1b)</span>
<span id="cb118-86"><a href="#cb118-86" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-87"><a href="#cb118-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-88"><a href="#cb118-88" aria-hidden="true" tabindex="-1"></a>Drop Cody (very little data), Salt River tribs, and "ghost years"</span>
<span id="cb118-91"><a href="#cb118-91" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-92"><a href="#cb118-92" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb118-93"><a href="#cb118-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>stream <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cody"</span>, <span class="st">"Christiansen"</span>, <span class="st">"Dave"</span>, <span class="st">"Laker"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb118-94"><a href="#cb118-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(stream <span class="sc">==</span> <span class="st">"Cowboy Cabin"</span> <span class="sc">&amp;</span> year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1980</span><span class="sc">:</span><span class="dv">1981</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb118-95"><a href="#cb118-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(stream <span class="sc">==</span> <span class="st">"Flat"</span> <span class="sc">&amp;</span> year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1976</span><span class="sc">:</span><span class="dv">1979</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb118-96"><a href="#cb118-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(stream <span class="sc">==</span> <span class="st">"Spring"</span> <span class="sc">&amp;</span> year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1988</span><span class="sc">:</span><span class="dv">1992</span>)))</span>
<span id="cb118-97"><a href="#cb118-97" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-98"><a href="#cb118-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-99"><a href="#cb118-99" aria-hidden="true" tabindex="-1"></a>Create summary table</span>
<span id="cb118-102"><a href="#cb118-102" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-103"><a href="#cb118-103" aria-hidden="true" tabindex="-1"></a>summary.dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(reddsperkm)) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(stream) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="st">'lat'</span> <span class="ot">=</span> <span class="fu">unique</span>(lat), <span class="st">'long'</span> <span class="ot">=</span> <span class="fu">unique</span>(long), <span class="st">'startyr'</span> <span class="ot">=</span> <span class="fu">min</span>(year), <span class="st">'endyr'</span> <span class="ot">=</span> <span class="fu">max</span>(year), <span class="st">'n.year'</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(year)), <span class="st">"med.redds"</span> <span class="ot">=</span> <span class="fu">median</span>(reddsperkm)) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(stream) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb118-104"><a href="#cb118-104" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(summary.dat)</span>
<span id="cb118-105"><a href="#cb118-105" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(summary.dat, <span class="st">"ReddCounts_DataSummary.csv"</span>)</span>
<span id="cb118-106"><a href="#cb118-106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-107"><a href="#cb118-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-108"><a href="#cb118-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-109"><a href="#cb118-109" aria-hidden="true" tabindex="-1"></a>Plot stock-recruit data</span>
<span id="cb118-110"><a href="#cb118-110" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=8, fig.height=7}</span></span>
<span id="cb118-111"><a href="#cb118-111" aria-hidden="true" tabindex="-1"></a><span class="in">g &lt;- ggplot(dat, aes(x = reddsperkm_lag4, y = reddsperkm, color = broodyr)) +</span></span>
<span id="cb118-112"><a href="#cb118-112" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() +</span></span>
<span id="cb118-113"><a href="#cb118-113" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(color = "black") +</span></span>
<span id="cb118-114"><a href="#cb118-114" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(alpha = 0.75) +</span></span>
<span id="cb118-115"><a href="#cb118-115" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~ stream, scales = 'free', ncol = 4) +</span></span>
<span id="cb118-116"><a href="#cb118-116" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab('Spawning redd density (redds/km)') +</span></span>
<span id="cb118-117"><a href="#cb118-117" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab('Recruitment redd density (redds/km)') +</span></span>
<span id="cb118-118"><a href="#cb118-118" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(panel.grid = element_blank())</span></span>
<span id="cb118-119"><a href="#cb118-119" aria-hidden="true" tabindex="-1"></a><span class="in">plot(g)</span></span>
<span id="cb118-120"><a href="#cb118-120" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-121"><a href="#cb118-121" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb118-122"><a href="#cb118-122" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/ReddCounts/RecruitsBySpawners.jpeg", height = 7, width = 8, units = "in", res = 1000)</span></span>
<span id="cb118-123"><a href="#cb118-123" aria-hidden="true" tabindex="-1"></a><span class="in">plot(g)</span></span>
<span id="cb118-124"><a href="#cb118-124" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-125"><a href="#cb118-125" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-126"><a href="#cb118-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-127"><a href="#cb118-127" aria-hidden="true" tabindex="-1"></a>Plot productivity by stock/spawners</span>
<span id="cb118-128"><a href="#cb118-128" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=8, fig.height=7}</span></span>
<span id="cb118-129"><a href="#cb118-129" aria-hidden="true" tabindex="-1"></a><span class="in">g &lt;- ggplot(dat, aes(x = reddsperkm_lag4, y = log(reddsperkm/reddsperkm_lag4), color = broodyr)) +</span></span>
<span id="cb118-130"><a href="#cb118-130" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() +</span></span>
<span id="cb118-131"><a href="#cb118-131" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method ='lm', color = "black") +</span></span>
<span id="cb118-132"><a href="#cb118-132" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(alpha = 0.75) +</span></span>
<span id="cb118-133"><a href="#cb118-133" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~ stream, scales = 'free', ncol = 4) +</span></span>
<span id="cb118-134"><a href="#cb118-134" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab('Spawning redd density (redds/km)') +</span></span>
<span id="cb118-135"><a href="#cb118-135" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab('ln(Recruits/Spawner)') +</span></span>
<span id="cb118-136"><a href="#cb118-136" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(panel.grid = element_blank())</span></span>
<span id="cb118-137"><a href="#cb118-137" aria-hidden="true" tabindex="-1"></a><span class="in">plot(g)</span></span>
<span id="cb118-138"><a href="#cb118-138" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-139"><a href="#cb118-139" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb118-140"><a href="#cb118-140" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/ReddCounts/ProductivityBySpawners.jpeg", height = 7, width = 8, units = "in", res = 1000)</span></span>
<span id="cb118-141"><a href="#cb118-141" aria-hidden="true" tabindex="-1"></a><span class="in">g</span></span>
<span id="cb118-142"><a href="#cb118-142" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-143"><a href="#cb118-143" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-144"><a href="#cb118-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-145"><a href="#cb118-145" aria-hidden="true" tabindex="-1"></a>Add misc. variables (currently not used in the model)</span>
<span id="cb118-146"><a href="#cb118-146" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb118-147"><a href="#cb118-147" aria-hidden="true" tabindex="-1"></a><span class="in"># JLD mgmt regime</span></span>
<span id="cb118-148"><a href="#cb118-148" aria-hidden="true" tabindex="-1"></a><span class="in">dat &lt;- dat %&gt;% mutate(regime = ifelse(year &lt; 1989, 0, 1))</span></span>
<span id="cb118-149"><a href="#cb118-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-150"><a href="#cb118-150" aria-hidden="true" tabindex="-1"></a><span class="in"># Distance from JLD</span></span>
<span id="cb118-151"><a href="#cb118-151" aria-hidden="true" tabindex="-1"></a><span class="in">djld &lt;- read_csv("Flowline Distance/ReddCount_Sites_JLDDistance.csv") %&gt;%</span></span>
<span id="cb118-152"><a href="#cb118-152" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!stream %in% c("Dave", "Snake River Side Channel", "Spring"))</span></span>
<span id="cb118-153"><a href="#cb118-153" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-154"><a href="#cb118-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-155"><a href="#cb118-155" aria-hidden="true" tabindex="-1"></a>How much of the variation in productivity is explained by density-dependence alone? (*sensu* Jones *et al.* 2020)</span>
<span id="cb118-158"><a href="#cb118-158" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-159"><a href="#cb118-159" aria-hidden="true" tabindex="-1"></a>dat2 <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">lnRS =</span> <span class="fu">log</span>(reddsperkm <span class="sc">/</span> reddsperkm_lag4), </span>
<span id="cb118-160"><a href="#cb118-160" aria-hidden="true" tabindex="-1"></a>                       <span class="at">stream =</span> <span class="fu">as_factor</span>(stream))</span>
<span id="cb118-161"><a href="#cb118-161" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(lnRS <span class="sc">~</span> reddsperkm_lag4 <span class="sc">+</span> stream<span class="sc">:</span>reddsperkm_lag4, dat2)) <span class="co"># ~37%</span></span>
<span id="cb118-162"><a href="#cb118-162" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-163"><a href="#cb118-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-164"><a href="#cb118-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-165"><a href="#cb118-165" aria-hidden="true" tabindex="-1"></a><span class="fu">## Format Fish Data</span></span>
<span id="cb118-166"><a href="#cb118-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-167"><a href="#cb118-167" aria-hidden="true" tabindex="-1"></a>Log annual redd count data and calculate number of years per population</span>
<span id="cb118-170"><a href="#cb118-170" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-171"><a href="#cb118-171" aria-hidden="true" tabindex="-1"></a><span class="co"># log </span></span>
<span id="cb118-172"><a href="#cb118-172" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">rcraw_log =</span> <span class="fu">log</span>(reddsperkm))</span>
<span id="cb118-173"><a href="#cb118-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-174"><a href="#cb118-174" aria-hidden="true" tabindex="-1"></a><span class="co"># how many years of data does each pop have?</span></span>
<span id="cb118-175"><a href="#cb118-175" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(dat <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>(rcraw_log) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(stream) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">nyr =</span> <span class="fu">n_distinct</span>(rcraw_log)))</span>
<span id="cb118-176"><a href="#cb118-176" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-177"><a href="#cb118-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-178"><a href="#cb118-178" aria-hidden="true" tabindex="-1"></a>Format fish data into matrices for JAGS model</span>
<span id="cb118-181"><a href="#cb118-181" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-182"><a href="#cb118-182" aria-hidden="true" tabindex="-1"></a><span class="co"># specify populations</span></span>
<span id="cb118-183"><a href="#cb118-183" aria-hidden="true" tabindex="-1"></a>pops <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>stream))</span>
<span id="cb118-184"><a href="#cb118-184" aria-hidden="true" tabindex="-1"></a>n.pops <span class="ot">&lt;-</span> <span class="fu">length</span>(pops)</span>
<span id="cb118-185"><a href="#cb118-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-186"><a href="#cb118-186" aria-hidden="true" tabindex="-1"></a><span class="co"># specify years</span></span>
<span id="cb118-187"><a href="#cb118-187" aria-hidden="true" tabindex="-1"></a>n.years <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">length =</span> n.pops)</span>
<span id="cb118-188"><a href="#cb118-188" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> n.pops, <span class="at">ncol =</span> <span class="dv">51</span>)</span>
<span id="cb118-189"><a href="#cb118-189" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(p <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.pops) {</span>
<span id="cb118-190"><a href="#cb118-190" aria-hidden="true" tabindex="-1"></a>  n.years[p] <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>year[dat<span class="sc">$</span>stream <span class="sc">==</span> pops[p]]))</span>
<span id="cb118-191"><a href="#cb118-191" aria-hidden="true" tabindex="-1"></a>  years[p,<span class="dv">1</span><span class="sc">:</span>n.years[p]] <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>year[dat<span class="sc">$</span>stream <span class="sc">==</span> pops[p]]))</span>
<span id="cb118-192"><a href="#cb118-192" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb118-193"><a href="#cb118-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-194"><a href="#cb118-194" aria-hidden="true" tabindex="-1"></a><span class="co"># Spawners and Recruits</span></span>
<span id="cb118-195"><a href="#cb118-195" aria-hidden="true" tabindex="-1"></a>rec_raw <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> n.pops, <span class="at">ncol =</span> <span class="fu">max</span>(n.years)) </span>
<span id="cb118-196"><a href="#cb118-196" aria-hidden="true" tabindex="-1"></a><span class="co"># rec_cor &lt;- matrix(nrow = n.pops, ncol = max(n.years))</span></span>
<span id="cb118-197"><a href="#cb118-197" aria-hidden="true" tabindex="-1"></a><span class="co"># rec_cor_sd &lt;- matrix(nrow = n.pops, ncol = max(n.years))</span></span>
<span id="cb118-198"><a href="#cb118-198" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(p <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.pops) {</span>
<span id="cb118-199"><a href="#cb118-199" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(y <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.years[p]) {</span>
<span id="cb118-200"><a href="#cb118-200" aria-hidden="true" tabindex="-1"></a>    year <span class="ot">&lt;-</span> years[p,y]</span>
<span id="cb118-201"><a href="#cb118-201" aria-hidden="true" tabindex="-1"></a>    rec_raw[p,y] <span class="ot">&lt;-</span> dat<span class="sc">$</span>rcraw_log[dat<span class="sc">$</span>stream <span class="sc">==</span> pops[p] <span class="sc">&amp;</span> dat<span class="sc">$</span>year <span class="sc">==</span> year] <span class="co"># Raw, uncorrected ecruits (log scale)</span></span>
<span id="cb118-202"><a href="#cb118-202" aria-hidden="true" tabindex="-1"></a>    <span class="co"># rec_cor[p,y] &lt;- dat$rccor_log_mean[dat$stream == pops[p] &amp; dat$year == year] # Corrected recruits (log scale)</span></span>
<span id="cb118-203"><a href="#cb118-203" aria-hidden="true" tabindex="-1"></a>    <span class="co"># rec_cor_sd[p,y] &lt;- dat$rccor_log_sd[dat$stream == pops[p] &amp; dat$year == year] # recruitment uncertainty</span></span>
<span id="cb118-204"><a href="#cb118-204" aria-hidden="true" tabindex="-1"></a>  }<span class="co">#next y</span></span>
<span id="cb118-205"><a href="#cb118-205" aria-hidden="true" tabindex="-1"></a>}<span class="co">#next p</span></span>
<span id="cb118-206"><a href="#cb118-206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-207"><a href="#cb118-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-208"><a href="#cb118-208" aria-hidden="true" tabindex="-1"></a>Get maximum spawners for initialization</span>
<span id="cb118-211"><a href="#cb118-211" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-212"><a href="#cb118-212" aria-hidden="true" tabindex="-1"></a>maxY <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">exp</span>(rec_raw), <span class="dv">1</span>, max, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb118-213"><a href="#cb118-213" aria-hidden="true" tabindex="-1"></a>meanY <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">exp</span>(rec_raw), <span class="dv">1</span>, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb118-214"><a href="#cb118-214" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-215"><a href="#cb118-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-216"><a href="#cb118-216" aria-hidden="true" tabindex="-1"></a>Check dimensions</span>
<span id="cb118-219"><a href="#cb118-219" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-220"><a href="#cb118-220" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(years)</span>
<span id="cb118-221"><a href="#cb118-221" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(rec_raw)</span>
<span id="cb118-222"><a href="#cb118-222" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(rec_cor)</span></span>
<span id="cb118-223"><a href="#cb118-223" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(rec_cor_sd)</span></span>
<span id="cb118-224"><a href="#cb118-224" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-225"><a href="#cb118-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-226"><a href="#cb118-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-227"><a href="#cb118-227" aria-hidden="true" tabindex="-1"></a><span class="fu">## Format Covariate Data</span></span>
<span id="cb118-228"><a href="#cb118-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-229"><a href="#cb118-229" aria-hidden="true" tabindex="-1"></a>For age apportionment model (split covariate effects among ages 0 and 1), set up two arrays of covariates: one for covariates lagged to reflect conditions during age-0 (4 years) and another for covariates lagged to reflect conditions during age-1 (3 years)</span>
<span id="cb118-230"><a href="#cb118-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-231"><a href="#cb118-231" aria-hidden="true" tabindex="-1"></a>Get covariate names</span>
<span id="cb118-234"><a href="#cb118-234" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-235"><a href="#cb118-235" aria-hidden="true" tabindex="-1"></a><span class="co"># names.covars1 &lt;- grep("z", names(dat0), value = TRUE)[c(1:3,5:8,11,14:19)] # age-0</span></span>
<span id="cb118-236"><a href="#cb118-236" aria-hidden="true" tabindex="-1"></a><span class="co"># names.covars0 &lt;- grep("z", names(dat0), value = TRUE)[c(1:3,5:8,14:15,20,16:19)] # age-0</span></span>
<span id="cb118-237"><a href="#cb118-237" aria-hidden="true" tabindex="-1"></a><span class="co"># names.covars0 &lt;- grep("z", names(dat0), value = TRUE)[c(1:3,5:8,20,14:19)] # age-0</span></span>
<span id="cb118-238"><a href="#cb118-238" aria-hidden="true" tabindex="-1"></a>names.covars0 <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"z"</span>, <span class="fu">names</span>(dat0), <span class="at">value =</span> <span class="cn">TRUE</span>)[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>,<span class="dv">15</span><span class="sc">:</span><span class="dv">20</span>)]<span class="co">#[c(2:3,5,7:9,15:20)] # age-0</span></span>
<span id="cb118-239"><a href="#cb118-239" aria-hidden="true" tabindex="-1"></a><span class="co"># names.covars2 &lt;- grep("z", names(dat1), value = TRUE)[c(1:3,5:8,11,14:19)] # age-1</span></span>
<span id="cb118-240"><a href="#cb118-240" aria-hidden="true" tabindex="-1"></a><span class="co"># names.covars1 &lt;- grep("z", names(dat0), value = TRUE)[c(1:3,5:8,14:15,20,16:19)] # age-1</span></span>
<span id="cb118-241"><a href="#cb118-241" aria-hidden="true" tabindex="-1"></a><span class="co"># names.covars1 &lt;- grep("z", names(dat0), value = TRUE)[c(1:3,5:8,20,14:19)] # age-1</span></span>
<span id="cb118-242"><a href="#cb118-242" aria-hidden="true" tabindex="-1"></a>names.covars1 <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"z"</span>, <span class="fu">names</span>(dat1), <span class="at">value =</span> <span class="cn">TRUE</span>)[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>,<span class="dv">15</span><span class="sc">:</span><span class="dv">20</span>)]<span class="co">#[c(2:3,5,7:9,15:20)] # age-1</span></span>
<span id="cb118-243"><a href="#cb118-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-244"><a href="#cb118-244" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(names.covars1)</span>
<span id="cb118-245"><a href="#cb118-245" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-246"><a href="#cb118-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-247"><a href="#cb118-247" aria-hidden="true" tabindex="-1"></a>Format covariate data into matrices for JAGS model</span>
<span id="cb118-250"><a href="#cb118-250" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-251"><a href="#cb118-251" aria-hidden="true" tabindex="-1"></a>n.covars <span class="ot">&lt;-</span> <span class="fu">length</span>(names.covars0)</span>
<span id="cb118-252"><a href="#cb118-252" aria-hidden="true" tabindex="-1"></a>covars0 <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">dim =</span> <span class="fu">c</span>(n.pops, <span class="fu">max</span>(n.years), n.covars))</span>
<span id="cb118-253"><a href="#cb118-253" aria-hidden="true" tabindex="-1"></a>covars1 <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">dim =</span> <span class="fu">c</span>(n.pops, <span class="fu">max</span>(n.years), n.covars))</span>
<span id="cb118-254"><a href="#cb118-254" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(p <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.pops) {</span>
<span id="cb118-255"><a href="#cb118-255" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(y <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.years[p]) {</span>
<span id="cb118-256"><a href="#cb118-256" aria-hidden="true" tabindex="-1"></a>    yr <span class="ot">&lt;-</span> years[p,y]</span>
<span id="cb118-257"><a href="#cb118-257" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(c <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.covars) {</span>
<span id="cb118-258"><a href="#cb118-258" aria-hidden="true" tabindex="-1"></a>      covars0[p,y,c] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dat0 <span class="sc">%&gt;%</span> <span class="fu">select</span>(stream, year, names.covars0[c]) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(stream <span class="sc">==</span> pops[p] <span class="sc">&amp;</span> year <span class="sc">==</span> yr) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">3</span>))</span>
<span id="cb118-259"><a href="#cb118-259" aria-hidden="true" tabindex="-1"></a>      covars1[p,y,c] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dat1 <span class="sc">%&gt;%</span> <span class="fu">select</span>(stream, year, names.covars1[c]) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(stream <span class="sc">==</span> pops[p] <span class="sc">&amp;</span> year <span class="sc">==</span> yr) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">3</span>))</span>
<span id="cb118-260"><a href="#cb118-260" aria-hidden="true" tabindex="-1"></a>    } <span class="co"># next c</span></span>
<span id="cb118-261"><a href="#cb118-261" aria-hidden="true" tabindex="-1"></a>  } <span class="co"># next y</span></span>
<span id="cb118-262"><a href="#cb118-262" aria-hidden="true" tabindex="-1"></a>  <span class="co">#print(p)</span></span>
<span id="cb118-263"><a href="#cb118-263" aria-hidden="true" tabindex="-1"></a>} <span class="co"># next p</span></span>
<span id="cb118-264"><a href="#cb118-264" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(covars0)</span>
<span id="cb118-265"><a href="#cb118-265" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(covars1)</span>
<span id="cb118-266"><a href="#cb118-266" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-267"><a href="#cb118-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-268"><a href="#cb118-268" aria-hidden="true" tabindex="-1"></a>Add interaction and/or squared terms, if applicable</span>
<span id="cb118-271"><a href="#cb118-271" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-272"><a href="#cb118-272" aria-hidden="true" tabindex="-1"></a><span class="co"># names.covars0 &lt;- c(names.covars0, "z_int_peaktime", "z_int_peakmag") # add names for additional terms</span></span>
<span id="cb118-273"><a href="#cb118-273" aria-hidden="true" tabindex="-1"></a><span class="co"># names.covars1 &lt;- c(names.covars1, "z_int_peaktime", "z_int_peakmag") # add names for additional terms</span></span>
<span id="cb118-274"><a href="#cb118-274" aria-hidden="true" tabindex="-1"></a><span class="co"># covars0 &lt;- abind::abind(covars0, covars0[,,6]*covars0[,,9], covars0[,,5]*covars0[,,8], along = 3)</span></span>
<span id="cb118-275"><a href="#cb118-275" aria-hidden="true" tabindex="-1"></a><span class="co"># covars1 &lt;- abind::abind(covars1, covars1[,,6]*covars1[,,9], covars1[,,5]*covars1[,,8], along = 3)</span></span>
<span id="cb118-276"><a href="#cb118-276" aria-hidden="true" tabindex="-1"></a><span class="co"># n.covars &lt;- length(names.covars0)</span></span>
<span id="cb118-277"><a href="#cb118-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-278"><a href="#cb118-278" aria-hidden="true" tabindex="-1"></a>names.covars0 <span class="ot">&lt;-</span> <span class="fu">c</span>(names.covars0, <span class="st">"z_int_peakmag"</span>, <span class="st">"z_int_peaktime"</span>) <span class="co"># add names for additional terms</span></span>
<span id="cb118-279"><a href="#cb118-279" aria-hidden="true" tabindex="-1"></a>names.covars1 <span class="ot">&lt;-</span> <span class="fu">c</span>(names.covars1, <span class="st">"z_int_peakmag"</span>, <span class="st">"z_int_peaktime"</span>) <span class="co"># add names for additional terms</span></span>
<span id="cb118-280"><a href="#cb118-280" aria-hidden="true" tabindex="-1"></a>covars0 <span class="ot">&lt;-</span> abind<span class="sc">::</span><span class="fu">abind</span>(covars0, covars0[,,<span class="dv">5</span>]<span class="sc">*</span>covars0[,,<span class="dv">7</span>], covars0[,,<span class="dv">6</span>]<span class="sc">*</span>covars0[,,<span class="dv">8</span>], <span class="at">along =</span> <span class="dv">3</span>)</span>
<span id="cb118-281"><a href="#cb118-281" aria-hidden="true" tabindex="-1"></a>covars1 <span class="ot">&lt;-</span> abind<span class="sc">::</span><span class="fu">abind</span>(covars1, covars1[,,<span class="dv">5</span>]<span class="sc">*</span>covars1[,,<span class="dv">7</span>], covars0[,,<span class="dv">6</span>]<span class="sc">*</span>covars0[,,<span class="dv">8</span>], <span class="at">along =</span> <span class="dv">3</span>)</span>
<span id="cb118-282"><a href="#cb118-282" aria-hidden="true" tabindex="-1"></a>n.covars <span class="ot">&lt;-</span> <span class="fu">length</span>(names.covars0)</span>
<span id="cb118-283"><a href="#cb118-283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-284"><a href="#cb118-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-285"><a href="#cb118-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-286"><a href="#cb118-286" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb118-287"><a href="#cb118-287" aria-hidden="true" tabindex="-1"></a><span class="in"># OLD - NOT USED</span></span>
<span id="cb118-288"><a href="#cb118-288" aria-hidden="true" tabindex="-1"></a><span class="in"># # set up covariate array</span></span>
<span id="cb118-289"><a href="#cb118-289" aria-hidden="true" tabindex="-1"></a><span class="in"># names.covars &lt;- grep("z", names(dat), value = TRUE)[c(1:8,11,14:19)] # for separated flow components</span></span>
<span id="cb118-290"><a href="#cb118-290" aria-hidden="true" tabindex="-1"></a><span class="in"># names.covars &lt;- grep("z", names(dat), value = TRUE)[c(1:5,7:12)] # for experienced flow</span></span>
<span id="cb118-291"><a href="#cb118-291" aria-hidden="true" tabindex="-1"></a><span class="in"># names.covars &lt;- grep("z", names(dat), value = TRUE)[c(1:3,5:8,11,14:19)]</span></span>
<span id="cb118-292"><a href="#cb118-292" aria-hidden="true" tabindex="-1"></a><span class="in"># names.covars &lt;- grep("z", names(dat), value = TRUE)[c(1:3,14:19)]</span></span>
<span id="cb118-293"><a href="#cb118-293" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb118-294"><a href="#cb118-294" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb118-295"><a href="#cb118-295" aria-hidden="true" tabindex="-1"></a><span class="in"># n.covars &lt;- length(names.covars)</span></span>
<span id="cb118-296"><a href="#cb118-296" aria-hidden="true" tabindex="-1"></a><span class="in"># covars &lt;- array(data = NA, dim = c(n.pops, max(n.years), n.covars))</span></span>
<span id="cb118-297"><a href="#cb118-297" aria-hidden="true" tabindex="-1"></a><span class="in"># for(p in 1:n.pops) {</span></span>
<span id="cb118-298"><a href="#cb118-298" aria-hidden="true" tabindex="-1"></a><span class="in">#   for(y in 1:n.years[p]) {</span></span>
<span id="cb118-299"><a href="#cb118-299" aria-hidden="true" tabindex="-1"></a><span class="in">#     yr &lt;- years[p,y]</span></span>
<span id="cb118-300"><a href="#cb118-300" aria-hidden="true" tabindex="-1"></a><span class="in">#     for(c in 1:n.covars) {</span></span>
<span id="cb118-301"><a href="#cb118-301" aria-hidden="true" tabindex="-1"></a><span class="in">#       covars[p,y,c] &lt;- as.numeric(dat %&gt;% select(stream, year, names.covars[c]) %&gt;% filter(stream == pops[p] &amp; year == yr) %&gt;% select(3))</span></span>
<span id="cb118-302"><a href="#cb118-302" aria-hidden="true" tabindex="-1"></a><span class="in">#     } # next c</span></span>
<span id="cb118-303"><a href="#cb118-303" aria-hidden="true" tabindex="-1"></a><span class="in">#   } # next y</span></span>
<span id="cb118-304"><a href="#cb118-304" aria-hidden="true" tabindex="-1"></a><span class="in">#   print(p)</span></span>
<span id="cb118-305"><a href="#cb118-305" aria-hidden="true" tabindex="-1"></a><span class="in"># } # next p</span></span>
<span id="cb118-306"><a href="#cb118-306" aria-hidden="true" tabindex="-1"></a><span class="in"># dim(covars)</span></span>
<span id="cb118-307"><a href="#cb118-307" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb118-308"><a href="#cb118-308" aria-hidden="true" tabindex="-1"></a><span class="in"># # (for separate flow components) Full interaction model: add array slices for squared terms, interaction terms</span></span>
<span id="cb118-309"><a href="#cb118-309" aria-hidden="true" tabindex="-1"></a><span class="in"># names.covars &lt;- c(names.covars, "z_int_peakmag", "z_int_peaktime", "z_int_winmeanflow", "z_int_jldwinmeanvar") # add names for additional terms</span></span>
<span id="cb118-310"><a href="#cb118-310" aria-hidden="true" tabindex="-1"></a><span class="in"># covars &lt;- abind::abind(covars, covars[,,7]*covars[,,10], covars[,,8]*covars[,,11], covars[,,4]*covars[,,9], covars[,,4]*covars[,,5], along = 3)</span></span>
<span id="cb118-311"><a href="#cb118-311" aria-hidden="true" tabindex="-1"></a><span class="in"># n.covars &lt;- length(names.covars)</span></span>
<span id="cb118-312"><a href="#cb118-312" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb118-313"><a href="#cb118-313" aria-hidden="true" tabindex="-1"></a><span class="in"># # (for experienced flow) Full interaction model: add array slices for squared terms, interaction terms</span></span>
<span id="cb118-314"><a href="#cb118-314" aria-hidden="true" tabindex="-1"></a><span class="in"># names.covars &lt;- c(names.covars, "z_int_winflowmeanvar", "z_int_peakmagtime") # add names for additional terms</span></span>
<span id="cb118-315"><a href="#cb118-315" aria-hidden="true" tabindex="-1"></a><span class="in"># covars &lt;- abind::abind(covars, covars[,,4]*covars[,,5], covars[,,6]*covars[,,7], along = 3)</span></span>
<span id="cb118-316"><a href="#cb118-316" aria-hidden="true" tabindex="-1"></a><span class="in"># n.covars &lt;- length(names.covars)</span></span>
<span id="cb118-317"><a href="#cb118-317" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb118-318"><a href="#cb118-318" aria-hidden="true" tabindex="-1"></a><span class="in"># names.covars &lt;- c(names.covars, "z_int_peakmag", "z_int_peaktime", "z_int_winmeanvar") # add names for additional terms</span></span>
<span id="cb118-319"><a href="#cb118-319" aria-hidden="true" tabindex="-1"></a><span class="in"># covars &lt;- abind::abind(covars, covars[,,5]*covars[,,7], covars[,,6]*covars[,,8], covars[,,13]*covars[,,14], along = 3)</span></span>
<span id="cb118-320"><a href="#cb118-320" aria-hidden="true" tabindex="-1"></a><span class="in"># n.covars &lt;- length(names.covars)</span></span>
<span id="cb118-321"><a href="#cb118-321" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb118-322"><a href="#cb118-322" aria-hidden="true" tabindex="-1"></a><span class="in"># # check dimensions</span></span>
<span id="cb118-323"><a href="#cb118-323" aria-hidden="true" tabindex="-1"></a><span class="in"># dim(covars)</span></span>
<span id="cb118-324"><a href="#cb118-324" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb118-325"><a href="#cb118-325" aria-hidden="true" tabindex="-1"></a><span class="in"># # create matrix for pre/post 1989</span></span>
<span id="cb118-326"><a href="#cb118-326" aria-hidden="true" tabindex="-1"></a><span class="in"># regime &lt;- matrix(data = NA, nrow = nrow(years), ncol = ncol(years))</span></span>
<span id="cb118-327"><a href="#cb118-327" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:nrow(regime)) { for (j in 1:ncol(regime)) { regime[i,j] &lt;- ifelse(years[i,j] &lt; 1989, 0, 1) }}</span></span>
<span id="cb118-328"><a href="#cb118-328" aria-hidden="true" tabindex="-1"></a><span class="in"># # names.covars &lt;- c(names.covars, "regime")</span></span>
<span id="cb118-329"><a href="#cb118-329" aria-hidden="true" tabindex="-1"></a><span class="in"># # covars &lt;- abind::abind(covars, regime, along = 3)</span></span>
<span id="cb118-330"><a href="#cb118-330" aria-hidden="true" tabindex="-1"></a><span class="in"># # n.covars &lt;- length(names.covars)</span></span>
<span id="cb118-331"><a href="#cb118-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-332"><a href="#cb118-332" aria-hidden="true" tabindex="-1"></a><span class="in"># plot(covars1[,,1] ~ covars2[,,1])</span></span>
<span id="cb118-333"><a href="#cb118-333" aria-hidden="true" tabindex="-1"></a><span class="in"># plot(covars1[,,2] ~ covars2[,,2])</span></span>
<span id="cb118-334"><a href="#cb118-334" aria-hidden="true" tabindex="-1"></a><span class="in"># plot(covars1[,,3] ~ covars2[,,3])</span></span>
<span id="cb118-335"><a href="#cb118-335" aria-hidden="true" tabindex="-1"></a><span class="in"># plot(covars1[,,4] ~ covars2[,,4])</span></span>
<span id="cb118-336"><a href="#cb118-336" aria-hidden="true" tabindex="-1"></a><span class="in"># plot(covars1[,,5] ~ covars2[,,5])</span></span>
<span id="cb118-337"><a href="#cb118-337" aria-hidden="true" tabindex="-1"></a><span class="in"># plot(covars1[,,6] ~ covars2[,,6])</span></span>
<span id="cb118-338"><a href="#cb118-338" aria-hidden="true" tabindex="-1"></a><span class="in"># plot(covars1[,,7] ~ covars2[,,7])</span></span>
<span id="cb118-339"><a href="#cb118-339" aria-hidden="true" tabindex="-1"></a><span class="in"># plot(covars1[,,8] ~ covars2[,,8])</span></span>
<span id="cb118-340"><a href="#cb118-340" aria-hidden="true" tabindex="-1"></a><span class="in"># plot(covars1[,,9] ~ covars2[,,9])</span></span>
<span id="cb118-341"><a href="#cb118-341" aria-hidden="true" tabindex="-1"></a><span class="in"># plot(covars1[,,10] ~ covars2[,,10])</span></span>
<span id="cb118-342"><a href="#cb118-342" aria-hidden="true" tabindex="-1"></a><span class="in"># plot(covars1[,,11] ~ covars2[,,11])</span></span>
<span id="cb118-343"><a href="#cb118-343" aria-hidden="true" tabindex="-1"></a><span class="in"># plot(covars1[,,12] ~ covars2[,,12])</span></span>
<span id="cb118-344"><a href="#cb118-344" aria-hidden="true" tabindex="-1"></a><span class="in"># plot(covars1[,,13] ~ covars2[,,13])</span></span>
<span id="cb118-345"><a href="#cb118-345" aria-hidden="true" tabindex="-1"></a><span class="in"># plot(covars1[,,14] ~ covars2[,,14])</span></span>
<span id="cb118-346"><a href="#cb118-346" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-347"><a href="#cb118-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-348"><a href="#cb118-348" aria-hidden="true" tabindex="-1"></a>Add empty columns for model initialization</span>
<span id="cb118-351"><a href="#cb118-351" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-352"><a href="#cb118-352" aria-hidden="true" tabindex="-1"></a><span class="co"># recruitment</span></span>
<span id="cb118-353"><a href="#cb118-353" aria-hidden="true" tabindex="-1"></a>rec_raw <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(rec_raw), <span class="at">ncol =</span> <span class="dv">4</span>), rec_raw)</span>
<span id="cb118-354"><a href="#cb118-354" aria-hidden="true" tabindex="-1"></a><span class="co"># rec_cor &lt;- cbind(matrix(NA, nrow = nrow(rec_cor), ncol = 4), rec_cor)</span></span>
<span id="cb118-355"><a href="#cb118-355" aria-hidden="true" tabindex="-1"></a><span class="co"># rec_cor_sd &lt;- cbind(matrix(NA, nrow = nrow(rec_cor_sd), ncol = 4), rec_cor_sd)</span></span>
<span id="cb118-356"><a href="#cb118-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-357"><a href="#cb118-357" aria-hidden="true" tabindex="-1"></a><span class="co"># covariates</span></span>
<span id="cb118-358"><a href="#cb118-358" aria-hidden="true" tabindex="-1"></a><span class="co"># rl &lt;- list()</span></span>
<span id="cb118-359"><a href="#cb118-359" aria-hidden="true" tabindex="-1"></a><span class="co"># for (i in 1:dim(covars)[3]) { rl[[i]] &lt;- cbind(matrix(NA, nrow = nrow(covars), ncol = 4), covars[,,i]) }</span></span>
<span id="cb118-360"><a href="#cb118-360" aria-hidden="true" tabindex="-1"></a><span class="co"># covars &lt;- abind::abind(rl, along = 3)</span></span>
<span id="cb118-361"><a href="#cb118-361" aria-hidden="true" tabindex="-1"></a>rl <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb118-362"><a href="#cb118-362" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(covars0)[<span class="dv">3</span>]) { rl[[i]] <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(covars0), <span class="at">ncol =</span> <span class="dv">4</span>), covars0[,,i]) }</span>
<span id="cb118-363"><a href="#cb118-363" aria-hidden="true" tabindex="-1"></a>covars0 <span class="ot">&lt;-</span> abind<span class="sc">::</span><span class="fu">abind</span>(rl, <span class="at">along =</span> <span class="dv">3</span>)</span>
<span id="cb118-364"><a href="#cb118-364" aria-hidden="true" tabindex="-1"></a>rl <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb118-365"><a href="#cb118-365" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(covars1)[<span class="dv">3</span>]) { rl[[i]] <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(covars1), <span class="at">ncol =</span> <span class="dv">4</span>), covars1[,,i]) }</span>
<span id="cb118-366"><a href="#cb118-366" aria-hidden="true" tabindex="-1"></a>covars1 <span class="ot">&lt;-</span> abind<span class="sc">::</span><span class="fu">abind</span>(rl, <span class="at">along =</span> <span class="dv">3</span>)</span>
<span id="cb118-367"><a href="#cb118-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-368"><a href="#cb118-368" aria-hidden="true" tabindex="-1"></a><span class="co"># years</span></span>
<span id="cb118-369"><a href="#cb118-369" aria-hidden="true" tabindex="-1"></a>n.years <span class="ot">&lt;-</span> n.years <span class="sc">+</span> <span class="dv">4</span></span>
<span id="cb118-370"><a href="#cb118-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-371"><a href="#cb118-371" aria-hidden="true" tabindex="-1"></a><span class="co"># regime</span></span>
<span id="cb118-372"><a href="#cb118-372" aria-hidden="true" tabindex="-1"></a><span class="co"># regime &lt;- cbind(matrix(NA, nrow = nrow(regime), ncol = 4), regime)</span></span>
<span id="cb118-373"><a href="#cb118-373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-374"><a href="#cb118-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-375"><a href="#cb118-375" aria-hidden="true" tabindex="-1"></a>Check dimensions</span>
<span id="cb118-378"><a href="#cb118-378" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-379"><a href="#cb118-379" aria-hidden="true" tabindex="-1"></a><span class="co"># check dimensions</span></span>
<span id="cb118-380"><a href="#cb118-380" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(rec_raw)</span>
<span id="cb118-381"><a href="#cb118-381" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(rec_cor)</span></span>
<span id="cb118-382"><a href="#cb118-382" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(rec_cor_sd)</span></span>
<span id="cb118-383"><a href="#cb118-383" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(covars)</span></span>
<span id="cb118-384"><a href="#cb118-384" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(covars0)</span>
<span id="cb118-385"><a href="#cb118-385" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(covars1)</span>
<span id="cb118-386"><a href="#cb118-386" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(n.years)</span>
<span id="cb118-387"><a href="#cb118-387" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-388"><a href="#cb118-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-389"><a href="#cb118-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-390"><a href="#cb118-390" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model in JAGS</span></span>
<span id="cb118-391"><a href="#cb118-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-392"><a href="#cb118-392" aria-hidden="true" tabindex="-1"></a><span class="fu">### Specify JAGS model</span></span>
<span id="cb118-393"><a href="#cb118-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-394"><a href="#cb118-394" aria-hidden="true" tabindex="-1"></a>State-space hierarchical Ricker stock-recruitment model with auto-correlated residuals, where observation error is an estimated parameter. Covariates can affect productivity at either age-0 or age-1, with a parameter that estimates the relative importance of effects at each age class. Observations are distributed log-normally around (latent, phases 1-2) redd densities. Log-log scale ensures positive values and allows sigma.oe to be estimated on a log-scale and directly compared to net error model estimates of redd count error from Baldock *et al.* (2023 CJFAS): 0.38 (mean and 95% CI = 0.34, 0.44)</span>
<span id="cb118-397"><a href="#cb118-397" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-398"><a href="#cb118-398" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"model {</span></span>
<span id="cb118-399"><a href="#cb118-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-400"><a href="#cb118-400" aria-hidden="true" tabindex="-1"></a><span class="st">##--- LIKELIHOOD ---------------------------------------------------##</span></span>
<span id="cb118-401"><a href="#cb118-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-402"><a href="#cb118-402" aria-hidden="true" tabindex="-1"></a><span class="st"># OBSERVATION PROCESS</span></span>
<span id="cb118-403"><a href="#cb118-403" aria-hidden="true" tabindex="-1"></a><span class="st">for (j in 1:numPops) {</span></span>
<span id="cb118-404"><a href="#cb118-404" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:numYears[j]) {</span></span>
<span id="cb118-405"><a href="#cb118-405" aria-hidden="true" tabindex="-1"></a><span class="st">        logY0[j,i] ~ dnorm(logY[j,i], pow(sigma.oe, -2)) </span></span>
<span id="cb118-406"><a href="#cb118-406" aria-hidden="true" tabindex="-1"></a><span class="st">        N[j,i] &lt;- exp(logY[j,i])</span></span>
<span id="cb118-407"><a href="#cb118-407" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb118-408"><a href="#cb118-408" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb118-409"><a href="#cb118-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-410"><a href="#cb118-410" aria-hidden="true" tabindex="-1"></a><span class="st"># STATE PROCESS</span></span>
<span id="cb118-411"><a href="#cb118-411" aria-hidden="true" tabindex="-1"></a><span class="st">for (j in 1:numPops) {</span></span>
<span id="cb118-412"><a href="#cb118-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-413"><a href="#cb118-413" aria-hidden="true" tabindex="-1"></a><span class="st">    # STARTING VALUES / INITIALIZATION</span></span>
<span id="cb118-414"><a href="#cb118-414" aria-hidden="true" tabindex="-1"></a><span class="st">    Y1[j] ~ dunif(1, maxY[j])</span></span>
<span id="cb118-415"><a href="#cb118-415" aria-hidden="true" tabindex="-1"></a><span class="st">    Y2[j] ~ dunif(1, maxY[j])</span></span>
<span id="cb118-416"><a href="#cb118-416" aria-hidden="true" tabindex="-1"></a><span class="st">    Y3[j] ~ dunif(1, maxY[j])</span></span>
<span id="cb118-417"><a href="#cb118-417" aria-hidden="true" tabindex="-1"></a><span class="st">    Y4[j] ~ dunif(1, maxY[j])</span></span>
<span id="cb118-418"><a href="#cb118-418" aria-hidden="true" tabindex="-1"></a><span class="st">    logY[j,1] &lt;- log(Y1[j])</span></span>
<span id="cb118-419"><a href="#cb118-419" aria-hidden="true" tabindex="-1"></a><span class="st">    logY[j,2] &lt;- log(Y2[j])</span></span>
<span id="cb118-420"><a href="#cb118-420" aria-hidden="true" tabindex="-1"></a><span class="st">    logY[j,3] &lt;- log(Y3[j])</span></span>
<span id="cb118-421"><a href="#cb118-421" aria-hidden="true" tabindex="-1"></a><span class="st">    logY[j,4] &lt;- log(Y4[j])</span></span>
<span id="cb118-422"><a href="#cb118-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-423"><a href="#cb118-423" aria-hidden="true" tabindex="-1"></a><span class="st">    logresid[j,4] &lt;- 0</span></span>
<span id="cb118-424"><a href="#cb118-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-425"><a href="#cb118-425" aria-hidden="true" tabindex="-1"></a><span class="st">    # ALL OTHER YEARS</span></span>
<span id="cb118-426"><a href="#cb118-426" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 5:numYears[j]) {</span></span>
<span id="cb118-427"><a href="#cb118-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-428"><a href="#cb118-428" aria-hidden="true" tabindex="-1"></a><span class="st">        # Derive population and year specific covariate effects </span></span>
<span id="cb118-429"><a href="#cb118-429" aria-hidden="true" tabindex="-1"></a><span class="st">        for (c in 1:numCovars) { </span></span>
<span id="cb118-430"><a href="#cb118-430" aria-hidden="true" tabindex="-1"></a><span class="st">            covars0[j,i,c] ~ dnorm(0, pow(1, -2))</span></span>
<span id="cb118-431"><a href="#cb118-431" aria-hidden="true" tabindex="-1"></a><span class="st">            covars1[j,i,c] ~ dnorm(0, pow(1, -2))</span></span>
<span id="cb118-432"><a href="#cb118-432" aria-hidden="true" tabindex="-1"></a><span class="st">            cov.eff[j,i,c] &lt;- coef[j,c] * (((1-p[c]) * covars0[j,i,c]) + (p[c] * covars1[j,i,c])) }</span></span>
<span id="cb118-433"><a href="#cb118-433" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb118-434"><a href="#cb118-434" aria-hidden="true" tabindex="-1"></a><span class="st">        # Likelihood and predictions</span></span>
<span id="cb118-435"><a href="#cb118-435" aria-hidden="true" tabindex="-1"></a><span class="st">        logY[j,i] ~ dnorm(logpred2[j,i], pow(sigma.pe[j], -2))</span></span>
<span id="cb118-436"><a href="#cb118-436" aria-hidden="true" tabindex="-1"></a><span class="st">        logpred[j,i] &lt;- logY[j,i-4] + A[j] - B[j] * exp(logY[j,i-4]) + sum(cov.eff[j,i,1:numCovars])</span></span>
<span id="cb118-437"><a href="#cb118-437" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb118-438"><a href="#cb118-438" aria-hidden="true" tabindex="-1"></a><span class="st">        # save observations and latent states in loop to exclude starting values from model object</span></span>
<span id="cb118-439"><a href="#cb118-439" aria-hidden="true" tabindex="-1"></a><span class="st">        loglatent[j,i] &lt;- logY[j,i]</span></span>
<span id="cb118-440"><a href="#cb118-440" aria-hidden="true" tabindex="-1"></a><span class="st">        logobserv[j,i] &lt;- logY0[j,i]</span></span>
<span id="cb118-441"><a href="#cb118-441" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb118-442"><a href="#cb118-442" aria-hidden="true" tabindex="-1"></a><span class="st">        # Auto-correlated residuals</span></span>
<span id="cb118-443"><a href="#cb118-443" aria-hidden="true" tabindex="-1"></a><span class="st">        logresid[j,i] &lt;- logY[j,i] - logpred[j,i]</span></span>
<span id="cb118-444"><a href="#cb118-444" aria-hidden="true" tabindex="-1"></a><span class="st">        logpred2[j,i] &lt;- logpred[j,i] + logresid[j,i-1] * phi[j]</span></span>
<span id="cb118-445"><a href="#cb118-445" aria-hidden="true" tabindex="-1"></a><span class="st">        logresid2[j,i] &lt;- logY[j,i] - logpred2[j,i]</span></span>
<span id="cb118-446"><a href="#cb118-446" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb118-447"><a href="#cb118-447" aria-hidden="true" tabindex="-1"></a><span class="st">        # Log-likelihood</span></span>
<span id="cb118-448"><a href="#cb118-448" aria-hidden="true" tabindex="-1"></a><span class="st">        loglik[j,i] &lt;- logdensity.norm(logY0[j,i], logY[j,i], pow(sigma.oe, -2))</span></span>
<span id="cb118-449"><a href="#cb118-449" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb118-450"><a href="#cb118-450" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb118-451"><a href="#cb118-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-452"><a href="#cb118-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-453"><a href="#cb118-453" aria-hidden="true" tabindex="-1"></a><span class="st">##--- PRIORS --------------------------------------------------------##</span></span>
<span id="cb118-454"><a href="#cb118-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-455"><a href="#cb118-455" aria-hidden="true" tabindex="-1"></a><span class="st"># Observation error is shared among populations, constrained prior...consider centering this on Baldock et al (2023) CJFAS estimate</span></span>
<span id="cb118-456"><a href="#cb118-456" aria-hidden="true" tabindex="-1"></a><span class="st">sigma.oe ~ dunif(0.001, 100) #dnorm(0, pow(0.5, -2)) T(0,)</span></span>
<span id="cb118-457"><a href="#cb118-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-458"><a href="#cb118-458" aria-hidden="true" tabindex="-1"></a><span class="st"># Population-specific parameters</span></span>
<span id="cb118-459"><a href="#cb118-459" aria-hidden="true" tabindex="-1"></a><span class="st">for (j in 1:numPops) {</span></span>
<span id="cb118-460"><a href="#cb118-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-461"><a href="#cb118-461" aria-hidden="true" tabindex="-1"></a><span class="st">    # Ricker A</span></span>
<span id="cb118-462"><a href="#cb118-462" aria-hidden="true" tabindex="-1"></a><span class="st">    #expA[j] ~ dunif(0, 20)</span></span>
<span id="cb118-463"><a href="#cb118-463" aria-hidden="true" tabindex="-1"></a><span class="st">    #A[j] &lt;- log(expA[j])</span></span>
<span id="cb118-464"><a href="#cb118-464" aria-hidden="true" tabindex="-1"></a><span class="st">    A[j] ~ dnorm(mu.A, pow(sigma.A, -2)) </span></span>
<span id="cb118-465"><a href="#cb118-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-466"><a href="#cb118-466" aria-hidden="true" tabindex="-1"></a><span class="st">    # Ricker B</span></span>
<span id="cb118-467"><a href="#cb118-467" aria-hidden="true" tabindex="-1"></a><span class="st">    B[j] ~ dnorm(0, pow(1, -2)) T(0,)</span></span>
<span id="cb118-468"><a href="#cb118-468" aria-hidden="true" tabindex="-1"></a><span class="st">    #B[j] ~ dnorm(mu.B, pow(sigma.B, -2))</span></span>
<span id="cb118-469"><a href="#cb118-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-470"><a href="#cb118-470" aria-hidden="true" tabindex="-1"></a><span class="st">    # Covariate effects</span></span>
<span id="cb118-471"><a href="#cb118-471" aria-hidden="true" tabindex="-1"></a><span class="st">    for (c in 1:numCovars) { coef[j,c] ~ dnorm(mu.coef[c], pow(sigma.coef[c], -2)) }</span></span>
<span id="cb118-472"><a href="#cb118-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-473"><a href="#cb118-473" aria-hidden="true" tabindex="-1"></a><span class="st">    # Process error</span></span>
<span id="cb118-474"><a href="#cb118-474" aria-hidden="true" tabindex="-1"></a><span class="st">    sigma.pe[j] ~ dunif(0.001, 100) #dnorm(0, pow(5, -2)) T(0,)</span></span>
<span id="cb118-475"><a href="#cb118-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-476"><a href="#cb118-476" aria-hidden="true" tabindex="-1"></a><span class="st">    # auto-correlated residuals</span></span>
<span id="cb118-477"><a href="#cb118-477" aria-hidden="true" tabindex="-1"></a><span class="st">    phi[j] ~ dunif(-0.99, 0.99)</span></span>
<span id="cb118-478"><a href="#cb118-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-479"><a href="#cb118-479" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb118-480"><a href="#cb118-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-481"><a href="#cb118-481" aria-hidden="true" tabindex="-1"></a><span class="st"># Global Ricker A and B</span></span>
<span id="cb118-482"><a href="#cb118-482" aria-hidden="true" tabindex="-1"></a><span class="st">mu.A &lt;- log(exp.mu.A) #dunif(0, 20)</span></span>
<span id="cb118-483"><a href="#cb118-483" aria-hidden="true" tabindex="-1"></a><span class="st">exp.mu.A ~ dunif(0, 20)</span></span>
<span id="cb118-484"><a href="#cb118-484" aria-hidden="true" tabindex="-1"></a><span class="st">sigma.A ~ dunif(0.001, 100)</span></span>
<span id="cb118-485"><a href="#cb118-485" aria-hidden="true" tabindex="-1"></a><span class="st">#mu.B ~ dnorm(0, pow(1, -2)) T(0,)</span></span>
<span id="cb118-486"><a href="#cb118-486" aria-hidden="true" tabindex="-1"></a><span class="st">#sigma.B ~ dunif(0.001, 100)</span></span>
<span id="cb118-487"><a href="#cb118-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-488"><a href="#cb118-488" aria-hidden="true" tabindex="-1"></a><span class="st"># Global covariate effects</span></span>
<span id="cb118-489"><a href="#cb118-489" aria-hidden="true" tabindex="-1"></a><span class="st">for (c in 1:numCovars) { </span></span>
<span id="cb118-490"><a href="#cb118-490" aria-hidden="true" tabindex="-1"></a><span class="st">    mu.coef[c] ~ dnorm(0, pow(25, -2)) </span></span>
<span id="cb118-491"><a href="#cb118-491" aria-hidden="true" tabindex="-1"></a><span class="st">    sigma.coef[c] ~ dunif(0.001, 100) #dnorm(0, pow(5, -2)) T(0.001,100)</span></span>
<span id="cb118-492"><a href="#cb118-492" aria-hidden="true" tabindex="-1"></a><span class="st">    p[c] ~ dunif(0, 1)</span></span>
<span id="cb118-493"><a href="#cb118-493" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb118-494"><a href="#cb118-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-495"><a href="#cb118-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-496"><a href="#cb118-496" aria-hidden="true" tabindex="-1"></a><span class="st">##--- DERIVED QUANTITIES ---------------------------------------------##</span></span>
<span id="cb118-497"><a href="#cb118-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-498"><a href="#cb118-498" aria-hidden="true" tabindex="-1"></a><span class="st"># Population specific carrying capacity</span></span>
<span id="cb118-499"><a href="#cb118-499" aria-hidden="true" tabindex="-1"></a><span class="st">for (j in 1:numPops) { K[j] &lt;- A[j] / B[j] }</span></span>
<span id="cb118-500"><a href="#cb118-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-501"><a href="#cb118-501" aria-hidden="true" tabindex="-1"></a><span class="st">}"</span>, <span class="at">file =</span> <span class="st">"JAGS Models/Ricker_Hierarchical_StateSpace_OEestimated_Covars_Proportional.txt"</span>)</span>
<span id="cb118-502"><a href="#cb118-502" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-503"><a href="#cb118-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-504"><a href="#cb118-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-505"><a href="#cb118-505" aria-hidden="true" tabindex="-1"></a>Same as above, but covariates only affect productivity at age-0</span>
<span id="cb118-508"><a href="#cb118-508" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-509"><a href="#cb118-509" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"model {</span></span>
<span id="cb118-510"><a href="#cb118-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-511"><a href="#cb118-511" aria-hidden="true" tabindex="-1"></a><span class="st">##--- LIKELIHOOD ---------------------------------------------------##</span></span>
<span id="cb118-512"><a href="#cb118-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-513"><a href="#cb118-513" aria-hidden="true" tabindex="-1"></a><span class="st"># OBSERVATION PROCESS</span></span>
<span id="cb118-514"><a href="#cb118-514" aria-hidden="true" tabindex="-1"></a><span class="st">for (j in 1:numPops) {</span></span>
<span id="cb118-515"><a href="#cb118-515" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:numYears[j]) {</span></span>
<span id="cb118-516"><a href="#cb118-516" aria-hidden="true" tabindex="-1"></a><span class="st">        logY0[j,i] ~ dnorm(logY[j,i], pow(sigma.oe, -2)) </span></span>
<span id="cb118-517"><a href="#cb118-517" aria-hidden="true" tabindex="-1"></a><span class="st">        N[j,i] &lt;- exp(logY[j,i])</span></span>
<span id="cb118-518"><a href="#cb118-518" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb118-519"><a href="#cb118-519" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb118-520"><a href="#cb118-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-521"><a href="#cb118-521" aria-hidden="true" tabindex="-1"></a><span class="st"># STATE PROCESS</span></span>
<span id="cb118-522"><a href="#cb118-522" aria-hidden="true" tabindex="-1"></a><span class="st">for (j in 1:numPops) {</span></span>
<span id="cb118-523"><a href="#cb118-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-524"><a href="#cb118-524" aria-hidden="true" tabindex="-1"></a><span class="st">    # STARTING VALUES / INITIALIZATION</span></span>
<span id="cb118-525"><a href="#cb118-525" aria-hidden="true" tabindex="-1"></a><span class="st">    Y1[j] ~ dunif(1, maxY[j])</span></span>
<span id="cb118-526"><a href="#cb118-526" aria-hidden="true" tabindex="-1"></a><span class="st">    Y2[j] ~ dunif(1, maxY[j])</span></span>
<span id="cb118-527"><a href="#cb118-527" aria-hidden="true" tabindex="-1"></a><span class="st">    Y3[j] ~ dunif(1, maxY[j])</span></span>
<span id="cb118-528"><a href="#cb118-528" aria-hidden="true" tabindex="-1"></a><span class="st">    Y4[j] ~ dunif(1, maxY[j])</span></span>
<span id="cb118-529"><a href="#cb118-529" aria-hidden="true" tabindex="-1"></a><span class="st">    logY[j,1] &lt;- log(Y1[j])</span></span>
<span id="cb118-530"><a href="#cb118-530" aria-hidden="true" tabindex="-1"></a><span class="st">    logY[j,2] &lt;- log(Y2[j])</span></span>
<span id="cb118-531"><a href="#cb118-531" aria-hidden="true" tabindex="-1"></a><span class="st">    logY[j,3] &lt;- log(Y3[j])</span></span>
<span id="cb118-532"><a href="#cb118-532" aria-hidden="true" tabindex="-1"></a><span class="st">    logY[j,4] &lt;- log(Y4[j])</span></span>
<span id="cb118-533"><a href="#cb118-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-534"><a href="#cb118-534" aria-hidden="true" tabindex="-1"></a><span class="st">    logresid[j,4] &lt;- 0</span></span>
<span id="cb118-535"><a href="#cb118-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-536"><a href="#cb118-536" aria-hidden="true" tabindex="-1"></a><span class="st">    # ALL OTHER YEARS</span></span>
<span id="cb118-537"><a href="#cb118-537" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 5:numYears[j]) {</span></span>
<span id="cb118-538"><a href="#cb118-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-539"><a href="#cb118-539" aria-hidden="true" tabindex="-1"></a><span class="st">        # Derive population and year specific covariate effects </span></span>
<span id="cb118-540"><a href="#cb118-540" aria-hidden="true" tabindex="-1"></a><span class="st">        for (c in 1:numCovars) { </span></span>
<span id="cb118-541"><a href="#cb118-541" aria-hidden="true" tabindex="-1"></a><span class="st">            covars[j,i,c] ~ dnorm(0, pow(1, -2))</span></span>
<span id="cb118-542"><a href="#cb118-542" aria-hidden="true" tabindex="-1"></a><span class="st">            cov.eff[j,i,c] &lt;- coef[j,c] * covars[j,i,c] }</span></span>
<span id="cb118-543"><a href="#cb118-543" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb118-544"><a href="#cb118-544" aria-hidden="true" tabindex="-1"></a><span class="st">        # Likelihood and predictions</span></span>
<span id="cb118-545"><a href="#cb118-545" aria-hidden="true" tabindex="-1"></a><span class="st">        logY[j,i] ~ dnorm(logpred2[j,i], pow(sigma.pe[j], -2))</span></span>
<span id="cb118-546"><a href="#cb118-546" aria-hidden="true" tabindex="-1"></a><span class="st">        logpred[j,i] &lt;- logY[j,i-4] + A[j] - B[j] * exp(logY[j,i-4]) + sum(cov.eff[j,i,1:numCovars])</span></span>
<span id="cb118-547"><a href="#cb118-547" aria-hidden="true" tabindex="-1"></a><span class="st">                </span></span>
<span id="cb118-548"><a href="#cb118-548" aria-hidden="true" tabindex="-1"></a><span class="st">        # save observations and latent states in loop to exclude starting values from model object</span></span>
<span id="cb118-549"><a href="#cb118-549" aria-hidden="true" tabindex="-1"></a><span class="st">        loglatent[j,i] &lt;- logY[j,i]</span></span>
<span id="cb118-550"><a href="#cb118-550" aria-hidden="true" tabindex="-1"></a><span class="st">        logobserv[j,i] &lt;- logY0[j,i]</span></span>
<span id="cb118-551"><a href="#cb118-551" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb118-552"><a href="#cb118-552" aria-hidden="true" tabindex="-1"></a><span class="st">        # Auto-correlated residuals</span></span>
<span id="cb118-553"><a href="#cb118-553" aria-hidden="true" tabindex="-1"></a><span class="st">        logresid[j,i] &lt;- logY[j,i] - logpred[j,i]</span></span>
<span id="cb118-554"><a href="#cb118-554" aria-hidden="true" tabindex="-1"></a><span class="st">        logpred2[j,i] &lt;- logpred[j,i] + logresid[j,i-1] * phi[j]</span></span>
<span id="cb118-555"><a href="#cb118-555" aria-hidden="true" tabindex="-1"></a><span class="st">        logresid2[j,i] &lt;- logY[j,i] - logpred2[j,i]</span></span>
<span id="cb118-556"><a href="#cb118-556" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb118-557"><a href="#cb118-557" aria-hidden="true" tabindex="-1"></a><span class="st">        # Log-likelihood</span></span>
<span id="cb118-558"><a href="#cb118-558" aria-hidden="true" tabindex="-1"></a><span class="st">        loglik[j,i] &lt;- logdensity.norm(logY0[j,i], logY[j,i], pow(sigma.oe, -2))</span></span>
<span id="cb118-559"><a href="#cb118-559" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb118-560"><a href="#cb118-560" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb118-561"><a href="#cb118-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-562"><a href="#cb118-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-563"><a href="#cb118-563" aria-hidden="true" tabindex="-1"></a><span class="st">##--- PRIORS --------------------------------------------------------##</span></span>
<span id="cb118-564"><a href="#cb118-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-565"><a href="#cb118-565" aria-hidden="true" tabindex="-1"></a><span class="st"># Observation error is shared among populations, constrained prior...consider centering this on Baldock et al (2023) CJFAS estimate</span></span>
<span id="cb118-566"><a href="#cb118-566" aria-hidden="true" tabindex="-1"></a><span class="st">sigma.oe ~ dunif(0.001, 100) #dnorm(0, pow(0.5, -2)) T(0,)</span></span>
<span id="cb118-567"><a href="#cb118-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-568"><a href="#cb118-568" aria-hidden="true" tabindex="-1"></a><span class="st"># Population-specific parameters</span></span>
<span id="cb118-569"><a href="#cb118-569" aria-hidden="true" tabindex="-1"></a><span class="st">for (j in 1:numPops) {</span></span>
<span id="cb118-570"><a href="#cb118-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-571"><a href="#cb118-571" aria-hidden="true" tabindex="-1"></a><span class="st">    # Ricker A</span></span>
<span id="cb118-572"><a href="#cb118-572" aria-hidden="true" tabindex="-1"></a><span class="st">    #expA[j] ~ dunif(0, 20)</span></span>
<span id="cb118-573"><a href="#cb118-573" aria-hidden="true" tabindex="-1"></a><span class="st">    #A[j] &lt;- log(expA[j])</span></span>
<span id="cb118-574"><a href="#cb118-574" aria-hidden="true" tabindex="-1"></a><span class="st">    A[j] ~ dnorm(mu.A, pow(sigma.A, -2)) </span></span>
<span id="cb118-575"><a href="#cb118-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-576"><a href="#cb118-576" aria-hidden="true" tabindex="-1"></a><span class="st">    # Ricker B</span></span>
<span id="cb118-577"><a href="#cb118-577" aria-hidden="true" tabindex="-1"></a><span class="st">    B[j] ~ dnorm(0, pow(1, -2)) T(0,)</span></span>
<span id="cb118-578"><a href="#cb118-578" aria-hidden="true" tabindex="-1"></a><span class="st">    #B[j] ~ dnorm(mu.B, pow(sigma.B, -2))</span></span>
<span id="cb118-579"><a href="#cb118-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-580"><a href="#cb118-580" aria-hidden="true" tabindex="-1"></a><span class="st">    # Covariate effects</span></span>
<span id="cb118-581"><a href="#cb118-581" aria-hidden="true" tabindex="-1"></a><span class="st">    for (c in 1:numCovars) { coef[j,c] ~ dnorm(mu.coef[c], pow(sigma.coef[c], -2)) }</span></span>
<span id="cb118-582"><a href="#cb118-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-583"><a href="#cb118-583" aria-hidden="true" tabindex="-1"></a><span class="st">    # Process error</span></span>
<span id="cb118-584"><a href="#cb118-584" aria-hidden="true" tabindex="-1"></a><span class="st">    sigma.pe[j] ~ dunif(0.001, 100) #dnorm(0, pow(5, -2)) T(0,)</span></span>
<span id="cb118-585"><a href="#cb118-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-586"><a href="#cb118-586" aria-hidden="true" tabindex="-1"></a><span class="st">    # auto-correlated residuals</span></span>
<span id="cb118-587"><a href="#cb118-587" aria-hidden="true" tabindex="-1"></a><span class="st">    phi[j] ~ dunif(-0.99, 0.99)</span></span>
<span id="cb118-588"><a href="#cb118-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-589"><a href="#cb118-589" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb118-590"><a href="#cb118-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-591"><a href="#cb118-591" aria-hidden="true" tabindex="-1"></a><span class="st"># Global Ricker A and B</span></span>
<span id="cb118-592"><a href="#cb118-592" aria-hidden="true" tabindex="-1"></a><span class="st">mu.A &lt;- log(exp.mu.A) #dunif(0, 20)</span></span>
<span id="cb118-593"><a href="#cb118-593" aria-hidden="true" tabindex="-1"></a><span class="st">exp.mu.A ~ dunif(0, 20)</span></span>
<span id="cb118-594"><a href="#cb118-594" aria-hidden="true" tabindex="-1"></a><span class="st">sigma.A ~ dunif(0.001, 100)</span></span>
<span id="cb118-595"><a href="#cb118-595" aria-hidden="true" tabindex="-1"></a><span class="st">#mu.B ~ dnorm(0, pow(1, -2)) T(0,)</span></span>
<span id="cb118-596"><a href="#cb118-596" aria-hidden="true" tabindex="-1"></a><span class="st">#sigma.B ~ dunif(0.001, 100)</span></span>
<span id="cb118-597"><a href="#cb118-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-598"><a href="#cb118-598" aria-hidden="true" tabindex="-1"></a><span class="st"># Global covariate effects</span></span>
<span id="cb118-599"><a href="#cb118-599" aria-hidden="true" tabindex="-1"></a><span class="st">for (c in 1:numCovars) { </span></span>
<span id="cb118-600"><a href="#cb118-600" aria-hidden="true" tabindex="-1"></a><span class="st">    mu.coef[c] ~ dnorm(0, pow(25, -2)) </span></span>
<span id="cb118-601"><a href="#cb118-601" aria-hidden="true" tabindex="-1"></a><span class="st">    sigma.coef[c] ~ dunif(0.001, 100) #dnorm(0, pow(5, -2)) T(0.001,100)</span></span>
<span id="cb118-602"><a href="#cb118-602" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb118-603"><a href="#cb118-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-604"><a href="#cb118-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-605"><a href="#cb118-605" aria-hidden="true" tabindex="-1"></a><span class="st">##--- DERIVED QUANTITIES ---------------------------------------------##</span></span>
<span id="cb118-606"><a href="#cb118-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-607"><a href="#cb118-607" aria-hidden="true" tabindex="-1"></a><span class="st"># Population specific carrying capacity</span></span>
<span id="cb118-608"><a href="#cb118-608" aria-hidden="true" tabindex="-1"></a><span class="st">for (j in 1:numPops) { K[j] &lt;- A[j] / B[j] }</span></span>
<span id="cb118-609"><a href="#cb118-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-610"><a href="#cb118-610" aria-hidden="true" tabindex="-1"></a><span class="st">}"</span>, <span class="at">file =</span> <span class="st">"JAGS Models/Ricker_Hierarchical_StateSpace_OEestimated_Covars.txt"</span>)</span>
<span id="cb118-611"><a href="#cb118-611" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-612"><a href="#cb118-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-613"><a href="#cb118-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-614"><a href="#cb118-614" aria-hidden="true" tabindex="-1"></a><span class="fu">### Age-0/1 Proportional</span></span>
<span id="cb118-615"><a href="#cb118-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-616"><a href="#cb118-616" aria-hidden="true" tabindex="-1"></a>Parameters to monitor</span>
<span id="cb118-619"><a href="#cb118-619" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-620"><a href="#cb118-620" aria-hidden="true" tabindex="-1"></a>jags.params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"K"</span>, <span class="st">"mu.A"</span>, <span class="st">"sigma.A"</span>, <span class="st">"sigma.oe"</span>, <span class="st">"sigma.pe"</span>,   <span class="co"># Ricker parameters</span></span>
<span id="cb118-621"><a href="#cb118-621" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"coef"</span>, <span class="st">"mu.coef"</span>, <span class="st">"sigma.coef"</span>, <span class="st">"cov.eff"</span>, <span class="st">"p"</span>,            <span class="co"># covariate effects</span></span>
<span id="cb118-622"><a href="#cb118-622" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"logpred"</span>, <span class="st">"logpred2"</span>,                                      <span class="co"># predictions</span></span>
<span id="cb118-623"><a href="#cb118-623" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"loglatent"</span>, <span class="st">"logobserv"</span>,                                   <span class="co"># latent states and observations</span></span>
<span id="cb118-624"><a href="#cb118-624" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"phi"</span>, <span class="st">"logresid"</span>, <span class="st">"logresid2"</span>, <span class="st">"loglik"</span>)                   <span class="co"># AR1 term, residuals, log-likelihood</span></span>
<span id="cb118-625"><a href="#cb118-625" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-626"><a href="#cb118-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-627"><a href="#cb118-627" aria-hidden="true" tabindex="-1"></a>Run model in JAGS</span>
<span id="cb118-628"><a href="#cb118-628" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb118-629"><a href="#cb118-629" aria-hidden="true" tabindex="-1"></a><span class="in">st &lt;- Sys.time()</span></span>
<span id="cb118-630"><a href="#cb118-630" aria-hidden="true" tabindex="-1"></a><span class="in">jags.data &lt;- list("logY0" = rec_raw, "numYears" = n.years, "numPops" = n.pops, "maxY" = maxY, "covars0" = covars0, "covars1" = covars1, "numCovars" = n.covars)</span></span>
<span id="cb118-631"><a href="#cb118-631" aria-hidden="true" tabindex="-1"></a><span class="in">mod_01pb &lt;- jags.parallel(data = jags.data, inits = NULL, parameters.to.save = jags.params, </span></span>
<span id="cb118-632"><a href="#cb118-632" aria-hidden="true" tabindex="-1"></a><span class="in">                          model.file = "JAGS Models/Ricker_Hierarchical_StateSpace_OEestimated_Covars_Proportional.txt", </span></span>
<span id="cb118-633"><a href="#cb118-633" aria-hidden="true" tabindex="-1"></a><span class="in">                          n.chains = 20, n.thin = 200, n.burnin = 10000, n.iter = 60000, DIC = TRUE)</span></span>
<span id="cb118-634"><a href="#cb118-634" aria-hidden="true" tabindex="-1"></a><span class="in">MCMCtrace(mod_01pb, ind = TRUE, params = c("A", "B", "mu.A", "sigma.A", "sigma.oe", "sigma.pe", "mu.coef", "sigma.coef", "p", "phi"),</span></span>
<span id="cb118-635"><a href="#cb118-635" aria-hidden="true" tabindex="-1"></a><span class="in">          filename = "Model output/MCMCtrace_ReddCountsRicker_Test_Age01p_winvar.pdf") # write out traceplots</span></span>
<span id="cb118-636"><a href="#cb118-636" aria-hidden="true" tabindex="-1"></a><span class="in">Sys.time() - st</span></span>
<span id="cb118-637"><a href="#cb118-637" aria-hidden="true" tabindex="-1"></a><span class="in">beep()</span></span>
<span id="cb118-638"><a href="#cb118-638" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-639"><a href="#cb118-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-640"><a href="#cb118-640" aria-hidden="true" tabindex="-1"></a>Save model output as RDS file</span>
<span id="cb118-641"><a href="#cb118-641" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb118-642"><a href="#cb118-642" aria-hidden="true" tabindex="-1"></a><span class="in">saveRDS(mod_01pb, "Model output/ReddCountsRicker_Phase1_Age01p_winvar.RDS")</span></span>
<span id="cb118-643"><a href="#cb118-643" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-644"><a href="#cb118-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-645"><a href="#cb118-645" aria-hidden="true" tabindex="-1"></a>Read in model RDS file</span>
<span id="cb118-646"><a href="#cb118-646" aria-hidden="true" tabindex="-1"></a><span class="in">```{r cache=FALSE}</span></span>
<span id="cb118-647"><a href="#cb118-647" aria-hidden="true" tabindex="-1"></a><span class="in">mod_01pb &lt;- readRDS("Model output/ReddCountsRicker_Phase1_Age01p_winvar.RDS")</span></span>
<span id="cb118-648"><a href="#cb118-648" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-649"><a href="#cb118-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-650"><a href="#cb118-650" aria-hidden="true" tabindex="-1"></a>Check R-hat values</span>
<span id="cb118-653"><a href="#cb118-653" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-654"><a href="#cb118-654" aria-hidden="true" tabindex="-1"></a>mod_01pb<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>][mod_01pb<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>] <span class="sc">&gt;</span> <span class="fl">1.05</span>]</span>
<span id="cb118-655"><a href="#cb118-655" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-656"><a href="#cb118-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-657"><a href="#cb118-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-658"><a href="#cb118-658" aria-hidden="true" tabindex="-1"></a><span class="fu">### Age-0 only</span></span>
<span id="cb118-659"><a href="#cb118-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-660"><a href="#cb118-660" aria-hidden="true" tabindex="-1"></a>*NOT CURRENTLY USED*</span>
<span id="cb118-661"><a href="#cb118-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-662"><a href="#cb118-662" aria-hidden="true" tabindex="-1"></a>Parameters to monitor</span>
<span id="cb118-663"><a href="#cb118-663" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb118-664"><a href="#cb118-664" aria-hidden="true" tabindex="-1"></a><span class="in">jags.params &lt;- c("A", "B", "K", "mu.A", "sigma.A", "sigma.oe", "sigma.pe",   # Ricker parameters</span></span>
<span id="cb118-665"><a href="#cb118-665" aria-hidden="true" tabindex="-1"></a><span class="in">                 "coef", "mu.coef", "sigma.coef", "cov.eff",            # covariate effects</span></span>
<span id="cb118-666"><a href="#cb118-666" aria-hidden="true" tabindex="-1"></a><span class="in">                 "logpred", "logpred2",                                      # predictions</span></span>
<span id="cb118-667"><a href="#cb118-667" aria-hidden="true" tabindex="-1"></a><span class="in">                 "loglatent", "logobserv",                                   # latent states and observations</span></span>
<span id="cb118-668"><a href="#cb118-668" aria-hidden="true" tabindex="-1"></a><span class="in">                 "phi", "logresid", "logresid2", "loglik")                   # AR1 term, residuals, log-likelihood</span></span>
<span id="cb118-669"><a href="#cb118-669" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-670"><a href="#cb118-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-671"><a href="#cb118-671" aria-hidden="true" tabindex="-1"></a>Run model in JAGS</span>
<span id="cb118-672"><a href="#cb118-672" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb118-673"><a href="#cb118-673" aria-hidden="true" tabindex="-1"></a><span class="in">st &lt;- Sys.time()</span></span>
<span id="cb118-674"><a href="#cb118-674" aria-hidden="true" tabindex="-1"></a><span class="in">jags.data &lt;- list("logY0" = rec_raw, "numYears" = n.years, "numPops" = n.pops, "maxY" = maxY, "covars" = covars0, "numCovars" = n.covars)</span></span>
<span id="cb118-675"><a href="#cb118-675" aria-hidden="true" tabindex="-1"></a><span class="in">mod_0 &lt;- jags.parallel(data = jags.data, inits = NULL, parameters.to.save = jags.params, </span></span>
<span id="cb118-676"><a href="#cb118-676" aria-hidden="true" tabindex="-1"></a><span class="in">                          model.file = "JAGS Models/Ricker_Hierarchical_StateSpace_OEestimated_Covars.txt", </span></span>
<span id="cb118-677"><a href="#cb118-677" aria-hidden="true" tabindex="-1"></a><span class="in">                          n.chains = 20, n.thin = 200, n.burnin = 10000, n.iter = 40000, DIC = TRUE)</span></span>
<span id="cb118-678"><a href="#cb118-678" aria-hidden="true" tabindex="-1"></a><span class="in">MCMCtrace(mod_0, ind = TRUE, params = c("A", "B", "mu.A", "sigma.A", "sigma.oe", "sigma.pe", "mu.coef", "sigma.coef", "p", "phi"),</span></span>
<span id="cb118-679"><a href="#cb118-679" aria-hidden="true" tabindex="-1"></a><span class="in">          filename = "Model output/MCMCtrace_ReddCountsRicker_Test_Age0.pdf") # write out traceplots</span></span>
<span id="cb118-680"><a href="#cb118-680" aria-hidden="true" tabindex="-1"></a><span class="in">Sys.time() - st</span></span>
<span id="cb118-681"><a href="#cb118-681" aria-hidden="true" tabindex="-1"></a><span class="in">beep()</span></span>
<span id="cb118-682"><a href="#cb118-682" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-683"><a href="#cb118-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-684"><a href="#cb118-684" aria-hidden="true" tabindex="-1"></a>Check R-hat values</span>
<span id="cb118-685"><a href="#cb118-685" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb118-686"><a href="#cb118-686" aria-hidden="true" tabindex="-1"></a><span class="in">mod_0$BUGSoutput$summary[,8][mod_0$BUGSoutput$summary[,8] &gt; 1.05]</span></span>
<span id="cb118-687"><a href="#cb118-687" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-688"><a href="#cb118-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-689"><a href="#cb118-689" aria-hidden="true" tabindex="-1"></a>Save model output as RDS file</span>
<span id="cb118-690"><a href="#cb118-690" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb118-691"><a href="#cb118-691" aria-hidden="true" tabindex="-1"></a><span class="in">saveRDS(mod_0, "Model output/ReddCountsRicker_Phase1_Age0.RDS")</span></span>
<span id="cb118-692"><a href="#cb118-692" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-693"><a href="#cb118-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-694"><a href="#cb118-694" aria-hidden="true" tabindex="-1"></a>Read in model RDS file</span>
<span id="cb118-695"><a href="#cb118-695" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb118-696"><a href="#cb118-696" aria-hidden="true" tabindex="-1"></a><span class="in">mod_0 &lt;- readRDS("Redd Counts Ricker/Model output/ReddCountsRicker_Phase1_Age0.RDS")</span></span>
<span id="cb118-697"><a href="#cb118-697" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-698"><a href="#cb118-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-699"><a href="#cb118-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-700"><a href="#cb118-700" aria-hidden="true" tabindex="-1"></a><span class="fu">### LOO-CV</span></span>
<span id="cb118-701"><a href="#cb118-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-702"><a href="#cb118-702" aria-hidden="true" tabindex="-1"></a><span class="in">```{r cache=FALSE}</span></span>
<span id="cb118-703"><a href="#cb118-703" aria-hidden="true" tabindex="-1"></a><span class="in">ll.arr &lt;- mod_01pb$BUGSoutput$sims.list$loglik # extract the log-likelihood estimates for each MCMC sample</span></span>
<span id="cb118-704"><a href="#cb118-704" aria-hidden="true" tabindex="-1"></a><span class="in">ll.mat &lt;- ll.arr[,,1]</span></span>
<span id="cb118-705"><a href="#cb118-705" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 2:dim(ll.arr)[3]) {</span></span>
<span id="cb118-706"><a href="#cb118-706" aria-hidden="true" tabindex="-1"></a><span class="in">  ll.mat &lt;- cbind(ll.mat, ll.arr[,,j])</span></span>
<span id="cb118-707"><a href="#cb118-707" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb118-708"><a href="#cb118-708" aria-hidden="true" tabindex="-1"></a><span class="in">rf &lt;- relative_eff(exp(ll.mat), chain_id = rep(1:20, each = 250))</span></span>
<span id="cb118-709"><a href="#cb118-709" aria-hidden="true" tabindex="-1"></a><span class="in">my_loo &lt;- loo(ll.mat, r_eff = rf)</span></span>
<span id="cb118-710"><a href="#cb118-710" aria-hidden="true" tabindex="-1"></a><span class="in">plot(my_loo)</span></span>
<span id="cb118-711"><a href="#cb118-711" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-712"><a href="#cb118-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-713"><a href="#cb118-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-714"><a href="#cb118-714" aria-hidden="true" tabindex="-1"></a><span class="fu">### Set top model</span></span>
<span id="cb118-715"><a href="#cb118-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-716"><a href="#cb118-716" aria-hidden="true" tabindex="-1"></a>Set top model and save MCMC samples and parameter summary</span>
<span id="cb118-717"><a href="#cb118-717" aria-hidden="true" tabindex="-1"></a><span class="in">```{r cache=FALSE}</span></span>
<span id="cb118-718"><a href="#cb118-718" aria-hidden="true" tabindex="-1"></a><span class="in">topmod &lt;- mod_01pb</span></span>
<span id="cb118-719"><a href="#cb118-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-720"><a href="#cb118-720" aria-hidden="true" tabindex="-1"></a><span class="in"># generate MCMC samples and store as an array</span></span>
<span id="cb118-721"><a href="#cb118-721" aria-hidden="true" tabindex="-1"></a><span class="in">modelout &lt;- topmod$BUGSoutput</span></span>
<span id="cb118-722"><a href="#cb118-722" aria-hidden="true" tabindex="-1"></a><span class="in">param.summary &lt;- modelout$summary</span></span>
<span id="cb118-723"><a href="#cb118-723" aria-hidden="true" tabindex="-1"></a><span class="in">McmcList &lt;- vector("list", length = dim(modelout$sims.array)[2])</span></span>
<span id="cb118-724"><a href="#cb118-724" aria-hidden="true" tabindex="-1"></a><span class="in">for(i in 1:length(McmcList)) {</span></span>
<span id="cb118-725"><a href="#cb118-725" aria-hidden="true" tabindex="-1"></a><span class="in">  McmcList[[i]] = as.mcmc(modelout$sims.array[,i,])</span></span>
<span id="cb118-726"><a href="#cb118-726" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb118-727"><a href="#cb118-727" aria-hidden="true" tabindex="-1"></a><span class="in"># rbind MCMC samples from 3 chains </span></span>
<span id="cb118-728"><a href="#cb118-728" aria-hidden="true" tabindex="-1"></a><span class="in">Mcmcdat &lt;- rbind(McmcList[[1]], McmcList[[2]], McmcList[[3]], McmcList[[4]], McmcList[[5]], </span></span>
<span id="cb118-729"><a href="#cb118-729" aria-hidden="true" tabindex="-1"></a><span class="in">                 McmcList[[6]], McmcList[[7]], McmcList[[8]], McmcList[[9]], McmcList[[10]], </span></span>
<span id="cb118-730"><a href="#cb118-730" aria-hidden="true" tabindex="-1"></a><span class="in">                 McmcList[[11]], McmcList[[12]], McmcList[[13]], McmcList[[14]], McmcList[[15]], </span></span>
<span id="cb118-731"><a href="#cb118-731" aria-hidden="true" tabindex="-1"></a><span class="in">                 McmcList[[16]], McmcList[[17]], McmcList[[18]], McmcList[[19]], McmcList[[20]])</span></span>
<span id="cb118-732"><a href="#cb118-732" aria-hidden="true" tabindex="-1"></a><span class="in">param.summary &lt;- as.data.frame(modelout$summary)</span></span>
<span id="cb118-733"><a href="#cb118-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-734"><a href="#cb118-734" aria-hidden="true" tabindex="-1"></a><span class="in"># save model output</span></span>
<span id="cb118-735"><a href="#cb118-735" aria-hidden="true" tabindex="-1"></a><span class="in">write_csv(as.data.frame(Mcmcdat), "Model output/ReddCountsRicker_Phase1_Age01p_mcmcsamps.csv")</span></span>
<span id="cb118-736"><a href="#cb118-736" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(as.data.frame(modelout$summary), "Model output/ReddCountsRicker_Phase1_Age01p_ParameterSummary.csv", row.names = T)</span></span>
<span id="cb118-737"><a href="#cb118-737" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-738"><a href="#cb118-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-739"><a href="#cb118-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-740"><a href="#cb118-740" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model Diagnostics</span></span>
<span id="cb118-741"><a href="#cb118-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-742"><a href="#cb118-742" aria-hidden="true" tabindex="-1"></a>Get expected and observed MCMC samples</span>
<span id="cb118-745"><a href="#cb118-745" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-746"><a href="#cb118-746" aria-hidden="true" tabindex="-1"></a>ppdat_exp <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Mcmcdat[,<span class="fu">startsWith</span>(<span class="fu">colnames</span>(Mcmcdat), <span class="st">"logpred2"</span>)])</span>
<span id="cb118-747"><a href="#cb118-747" aria-hidden="true" tabindex="-1"></a>ppdat_obs <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Mcmcdat[,<span class="fu">startsWith</span>(<span class="fu">colnames</span>(Mcmcdat), <span class="st">"loglatent"</span>)])</span>
<span id="cb118-748"><a href="#cb118-748" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-749"><a href="#cb118-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-750"><a href="#cb118-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-751"><a href="#cb118-751" aria-hidden="true" tabindex="-1"></a><span class="fu">### Residuals</span></span>
<span id="cb118-752"><a href="#cb118-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-753"><a href="#cb118-753" aria-hidden="true" tabindex="-1"></a>Histogram of residuals</span>
<span id="cb118-756"><a href="#cb118-756" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-757"><a href="#cb118-757" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">2.5</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb118-758"><a href="#cb118-758" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>((ppdat_obs <span class="sc">-</span> ppdat_exp), <span class="at">main =</span> <span class="st">""</span>, <span class="at">xlab =</span> <span class="st">"Observed - Expected"</span>)</span>
<span id="cb118-759"><a href="#cb118-759" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">legend =</span> <span class="fu">paste</span>(<span class="st">"Median Resid. = "</span>, <span class="fu">round</span>(<span class="fu">median</span>((ppdat_obs <span class="sc">-</span> ppdat_exp)), <span class="at">digits =</span> <span class="dv">4</span>), <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb118-760"><a href="#cb118-760" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">median</span>(<span class="fu">unlist</span>(ppdat_obs <span class="sc">-</span> ppdat_exp)), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb118-761"><a href="#cb118-761" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">bty =</span> <span class="st">"o"</span>)</span>
<span id="cb118-762"><a href="#cb118-762" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-763"><a href="#cb118-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-764"><a href="#cb118-764" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb118-765"><a href="#cb118-765" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Model Diagnostics/ReddCounts_Ricker_CovarModel_Age01_ResidHist.jpg", units = "in", width = 4.5, height = 4.5, res = 1500)</span></span>
<span id="cb118-766"><a href="#cb118-766" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,1,1), mgp = c(2.5,1,0))</span></span>
<span id="cb118-767"><a href="#cb118-767" aria-hidden="true" tabindex="-1"></a><span class="in">hist((ppdat_obs - ppdat_exp), main = "", xlab = "Observed - Expected")</span></span>
<span id="cb118-768"><a href="#cb118-768" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", bty = "n", legend = paste("Median Resid. = ", round(median((ppdat_obs - ppdat_exp)), digits = 4), sep = ""))</span></span>
<span id="cb118-769"><a href="#cb118-769" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = median(unlist(ppdat_obs - ppdat_exp)), col = "red", lwd = 2)</span></span>
<span id="cb118-770"><a href="#cb118-770" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o")</span></span>
<span id="cb118-771"><a href="#cb118-771" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-772"><a href="#cb118-772" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-773"><a href="#cb118-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-774"><a href="#cb118-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-775"><a href="#cb118-775" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Before autocorrelation</span></span>
<span id="cb118-778"><a href="#cb118-778" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-779"><a href="#cb118-779" aria-hidden="true" tabindex="-1"></a>logresid <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(rec_raw), <span class="at">ncol =</span> <span class="fu">ncol</span>(rec_raw)<span class="sc">+</span><span class="dv">4</span>)</span>
<span id="cb118-780"><a href="#cb118-780" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(rec_raw)) {</span>
<span id="cb118-781"><a href="#cb118-781" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(rec_raw)<span class="sc">+</span><span class="dv">4</span>) {</span>
<span id="cb118-782"><a href="#cb118-782" aria-hidden="true" tabindex="-1"></a>    <span class="fu">try</span>(logresid[j,i] <span class="ot">&lt;-</span> param.summary[<span class="fu">paste</span>(<span class="st">"logresid["</span>,j,<span class="st">","</span>,i,<span class="st">"]"</span>, <span class="at">sep =</span> <span class="st">""</span>),<span class="dv">1</span>])</span>
<span id="cb118-783"><a href="#cb118-783" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb118-784"><a href="#cb118-784" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb118-785"><a href="#cb118-785" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-786"><a href="#cb118-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-787"><a href="#cb118-787" aria-hidden="true" tabindex="-1"></a>Time series of residuals (AR1)</span>
<span id="cb118-788"><a href="#cb118-788" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=8, fig.height=8}</span></span>
<span id="cb118-789"><a href="#cb118-789" aria-hidden="true" tabindex="-1"></a><span class="in">par(mfrow = c(4,4), mgp = c(2,0.8,0), mar = c(2.5, 3, 1.5, 0.5))</span></span>
<span id="cb118-790"><a href="#cb118-790" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:n.pops) {</span></span>
<span id="cb118-791"><a href="#cb118-791" aria-hidden="true" tabindex="-1"></a><span class="in">  plot(logresid[i,c(5:55)] ~ years[i,c(1:51)], pch = 16, xlab = "", ylab = "log residuals", main = pops[i], xlim = c(1970, 2021), ylim = c(min(logresid, na.rm = T), max(logresid, na.rm = T)))</span></span>
<span id="cb118-792"><a href="#cb118-792" aria-hidden="true" tabindex="-1"></a><span class="in">  lines(logresid[i,c(5:55)] ~ years[i,c(1:51)])</span></span>
<span id="cb118-793"><a href="#cb118-793" aria-hidden="true" tabindex="-1"></a><span class="in">  abline(h = 0, lty = 2)</span></span>
<span id="cb118-794"><a href="#cb118-794" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb118-795"><a href="#cb118-795" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-796"><a href="#cb118-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-797"><a href="#cb118-797" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb118-798"><a href="#cb118-798" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Model Diagnostics/ReddCounts_Ricker_CovarModel_Age01_Residuals_NoAutocorr_commonscale.jpg", units = "in", width = 8, height = 8, res = 1000)</span></span>
<span id="cb118-799"><a href="#cb118-799" aria-hidden="true" tabindex="-1"></a><span class="in">par(mfrow = c(4,4), mgp = c(2,0.8,0), mar = c(2.5, 3, 1.5, 0.5))</span></span>
<span id="cb118-800"><a href="#cb118-800" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:n.pops) {</span></span>
<span id="cb118-801"><a href="#cb118-801" aria-hidden="true" tabindex="-1"></a><span class="in">  plot(logresid[i,c(5:55)] ~ years[i,c(1:51)], pch = 16, xlab = "", ylab = "log residuals", main = pops[i], xlim = c(1970, 2021), ylim = c(min(logresid, na.rm = T), max(logresid, na.rm = T)))</span></span>
<span id="cb118-802"><a href="#cb118-802" aria-hidden="true" tabindex="-1"></a><span class="in">  lines(logresid[i,c(5:55)] ~ years[i,c(1:51)])</span></span>
<span id="cb118-803"><a href="#cb118-803" aria-hidden="true" tabindex="-1"></a><span class="in">  abline(h = 0, lty = 2)</span></span>
<span id="cb118-804"><a href="#cb118-804" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb118-805"><a href="#cb118-805" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-806"><a href="#cb118-806" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-807"><a href="#cb118-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-808"><a href="#cb118-808" aria-hidden="true" tabindex="-1"></a>time series of residuals (AR1), unique y scale</span>
<span id="cb118-809"><a href="#cb118-809" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=8, fig.height=8}</span></span>
<span id="cb118-810"><a href="#cb118-810" aria-hidden="true" tabindex="-1"></a><span class="in">par(mfrow = c(4,4), mgp = c(2,0.8,0), mar = c(2.5, 3, 1.5, 0.5))</span></span>
<span id="cb118-811"><a href="#cb118-811" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:n.pops) {</span></span>
<span id="cb118-812"><a href="#cb118-812" aria-hidden="true" tabindex="-1"></a><span class="in">  plot(logresid[i,c(5:55)] ~ years[i,c(1:51)], pch = 16, xlab = "", ylab = "log residuals", main = pops[i], xlim = c(1970, 2021))</span></span>
<span id="cb118-813"><a href="#cb118-813" aria-hidden="true" tabindex="-1"></a><span class="in">  lines(logresid[i,c(5:55)] ~ years[i,c(1:51)])</span></span>
<span id="cb118-814"><a href="#cb118-814" aria-hidden="true" tabindex="-1"></a><span class="in">  abline(h = 0, lty = 2)</span></span>
<span id="cb118-815"><a href="#cb118-815" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb118-816"><a href="#cb118-816" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-817"><a href="#cb118-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-818"><a href="#cb118-818" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb118-819"><a href="#cb118-819" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Model Diagnostics/ReddCounts_Ricker_CovarModel_Age01_Residuals_NoAutocorr_uniquescale.jpg", units = "in", width = 8, height = 8, res = 1000)</span></span>
<span id="cb118-820"><a href="#cb118-820" aria-hidden="true" tabindex="-1"></a><span class="in">par(mfrow = c(4,4), mgp = c(2,0.8,0), mar = c(2.5, 3, 1.5, 0.5))</span></span>
<span id="cb118-821"><a href="#cb118-821" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:n.pops) {</span></span>
<span id="cb118-822"><a href="#cb118-822" aria-hidden="true" tabindex="-1"></a><span class="in">  plot(logresid[i,c(5:55)] ~ years[i,c(1:51)], pch = 16, xlab = "", ylab = "log residuals", main = pops[i], xlim = c(1970, 2021))</span></span>
<span id="cb118-823"><a href="#cb118-823" aria-hidden="true" tabindex="-1"></a><span class="in">  lines(logresid[i,c(5:55)] ~ years[i,c(1:51)])</span></span>
<span id="cb118-824"><a href="#cb118-824" aria-hidden="true" tabindex="-1"></a><span class="in">  abline(h = 0, lty = 2)</span></span>
<span id="cb118-825"><a href="#cb118-825" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb118-826"><a href="#cb118-826" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-827"><a href="#cb118-827" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-828"><a href="#cb118-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-829"><a href="#cb118-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-830"><a href="#cb118-830" aria-hidden="true" tabindex="-1"></a><span class="fu">#### After autocorrelation</span></span>
<span id="cb118-831"><a href="#cb118-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-832"><a href="#cb118-832" aria-hidden="true" tabindex="-1"></a>Residuals AFTER accounting for autocorrelation sensu Murdoch et al 2024 CJFAS</span>
<span id="cb118-835"><a href="#cb118-835" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-836"><a href="#cb118-836" aria-hidden="true" tabindex="-1"></a>logresid <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(rec_raw), <span class="at">ncol =</span> <span class="fu">ncol</span>(rec_raw)<span class="sc">+</span><span class="dv">4</span>)</span>
<span id="cb118-837"><a href="#cb118-837" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(rec_raw)) {</span>
<span id="cb118-838"><a href="#cb118-838" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(rec_raw)<span class="sc">+</span><span class="dv">4</span>) {</span>
<span id="cb118-839"><a href="#cb118-839" aria-hidden="true" tabindex="-1"></a>    <span class="fu">try</span>(logresid[j,i] <span class="ot">&lt;-</span> param.summary[<span class="fu">paste</span>(<span class="st">"logresid2["</span>,j,<span class="st">","</span>,i,<span class="st">"]"</span>, <span class="at">sep =</span> <span class="st">""</span>),<span class="dv">1</span>])</span>
<span id="cb118-840"><a href="#cb118-840" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb118-841"><a href="#cb118-841" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb118-842"><a href="#cb118-842" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-843"><a href="#cb118-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-844"><a href="#cb118-844" aria-hidden="true" tabindex="-1"></a>time series of residuals (AR1)</span>
<span id="cb118-845"><a href="#cb118-845" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=8, fig.height=8}</span></span>
<span id="cb118-846"><a href="#cb118-846" aria-hidden="true" tabindex="-1"></a><span class="in">par(mfrow = c(4,4), mgp = c(2,0.8,0), mar = c(2.5, 3, 1.5, 0.5))</span></span>
<span id="cb118-847"><a href="#cb118-847" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:n.pops) {</span></span>
<span id="cb118-848"><a href="#cb118-848" aria-hidden="true" tabindex="-1"></a><span class="in">  plot(logresid[i,c(5:55)] ~ years[i,c(1:51)], pch = 16, xlab = "", ylab = "log residuals", main = pops[i], xlim = c(1970, 2021), ylim = c(min(logresid, na.rm = T), max(logresid, na.rm = T)))</span></span>
<span id="cb118-849"><a href="#cb118-849" aria-hidden="true" tabindex="-1"></a><span class="in">  lines(logresid[i,c(5:55)] ~ years[i,c(1:51)])</span></span>
<span id="cb118-850"><a href="#cb118-850" aria-hidden="true" tabindex="-1"></a><span class="in">  abline(h = 0, lty = 2)</span></span>
<span id="cb118-851"><a href="#cb118-851" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb118-852"><a href="#cb118-852" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-853"><a href="#cb118-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-854"><a href="#cb118-854" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include = FALSE}</span></span>
<span id="cb118-855"><a href="#cb118-855" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Model Diagnostics/ReddCounts_Ricker_CovarModel_Age01_Residuals_wAutocorr_commonscale.jpg", units = "in", width = 8, height = 8, res = 1000)</span></span>
<span id="cb118-856"><a href="#cb118-856" aria-hidden="true" tabindex="-1"></a><span class="in">par(mfrow = c(4,4), mgp = c(2,0.8,0), mar = c(2.5, 3, 1.5, 0.5))</span></span>
<span id="cb118-857"><a href="#cb118-857" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:n.pops) {</span></span>
<span id="cb118-858"><a href="#cb118-858" aria-hidden="true" tabindex="-1"></a><span class="in">  plot(logresid[i,c(5:55)] ~ years[i,c(1:51)], pch = 16, xlab = "", ylab = "log residuals", main = pops[i], xlim = c(1970, 2021), ylim = c(min(logresid, na.rm = T), max(logresid, na.rm = T)))</span></span>
<span id="cb118-859"><a href="#cb118-859" aria-hidden="true" tabindex="-1"></a><span class="in">  lines(logresid[i,c(5:55)] ~ years[i,c(1:51)])</span></span>
<span id="cb118-860"><a href="#cb118-860" aria-hidden="true" tabindex="-1"></a><span class="in">  abline(h = 0, lty = 2)</span></span>
<span id="cb118-861"><a href="#cb118-861" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb118-862"><a href="#cb118-862" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-863"><a href="#cb118-863" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-864"><a href="#cb118-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-865"><a href="#cb118-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-866"><a href="#cb118-866" aria-hidden="true" tabindex="-1"></a>time series of residuals (AR1), unique y scale</span>
<span id="cb118-867"><a href="#cb118-867" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=8, fig.height=8}</span></span>
<span id="cb118-868"><a href="#cb118-868" aria-hidden="true" tabindex="-1"></a><span class="in">par(mfrow = c(4,4), mgp = c(2,0.8,0), mar = c(2.5, 3, 1.5, 0.5))</span></span>
<span id="cb118-869"><a href="#cb118-869" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:n.pops) {</span></span>
<span id="cb118-870"><a href="#cb118-870" aria-hidden="true" tabindex="-1"></a><span class="in">  plot(logresid[i,c(5:55)] ~ years[i,c(1:51)], pch = 16, xlab = "", ylab = "log residuals", main = pops[i], xlim = c(1970, 2021))</span></span>
<span id="cb118-871"><a href="#cb118-871" aria-hidden="true" tabindex="-1"></a><span class="in">  lines(logresid[i,c(5:55)] ~ years[i,c(1:51)])</span></span>
<span id="cb118-872"><a href="#cb118-872" aria-hidden="true" tabindex="-1"></a><span class="in">  abline(h = 0, lty = 2)</span></span>
<span id="cb118-873"><a href="#cb118-873" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb118-874"><a href="#cb118-874" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-875"><a href="#cb118-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-876"><a href="#cb118-876" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb118-877"><a href="#cb118-877" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Model Diagnostics/ReddCounts_Ricker_CovarModel_Age01_Residuals_wAutocorr_uniquescale.jpg", units = "in", width = 8, height = 8, res = 1000)</span></span>
<span id="cb118-878"><a href="#cb118-878" aria-hidden="true" tabindex="-1"></a><span class="in">par(mfrow = c(4,4), mgp = c(2,0.8,0), mar = c(2.5, 3, 1.5, 0.5))</span></span>
<span id="cb118-879"><a href="#cb118-879" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:n.pops) {</span></span>
<span id="cb118-880"><a href="#cb118-880" aria-hidden="true" tabindex="-1"></a><span class="in">  plot(logresid[i,c(5:55)] ~ years[i,c(1:51)], pch = 16, xlab = "", ylab = "log residuals", main = pops[i], xlim = c(1970, 2021))</span></span>
<span id="cb118-881"><a href="#cb118-881" aria-hidden="true" tabindex="-1"></a><span class="in">  lines(logresid[i,c(5:55)] ~ years[i,c(1:51)])</span></span>
<span id="cb118-882"><a href="#cb118-882" aria-hidden="true" tabindex="-1"></a><span class="in">  abline(h = 0, lty = 2)</span></span>
<span id="cb118-883"><a href="#cb118-883" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb118-884"><a href="#cb118-884" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-885"><a href="#cb118-885" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-886"><a href="#cb118-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-887"><a href="#cb118-887" aria-hidden="true" tabindex="-1"></a>Show residual autocorrelation plots by population</span>
<span id="cb118-888"><a href="#cb118-888" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=8, fig.height=8}</span></span>
<span id="cb118-889"><a href="#cb118-889" aria-hidden="true" tabindex="-1"></a><span class="in">par(mfrow = c(4,4), mgp = c(2,0.8,0), mar = c(3, 3, 0.5, 0.5))</span></span>
<span id="cb118-890"><a href="#cb118-890" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:n.pops) {</span></span>
<span id="cb118-891"><a href="#cb118-891" aria-hidden="true" tabindex="-1"></a><span class="in">  pacf(logresid[i,][complete.cases(logresid[i,])], main = pops[i])</span></span>
<span id="cb118-892"><a href="#cb118-892" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb118-893"><a href="#cb118-893" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-894"><a href="#cb118-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-895"><a href="#cb118-895" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bayesian p-value</span></span>
<span id="cb118-896"><a href="#cb118-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-899"><a href="#cb118-899" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-900"><a href="#cb118-900" aria-hidden="true" tabindex="-1"></a><span class="co"># Bayesian p-value</span></span>
<span id="cb118-901"><a href="#cb118-901" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(ppdat_exp <span class="sc">&gt;</span> ppdat_obs) <span class="sc">/</span> (<span class="fu">dim</span>(ppdat_obs)[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">dim</span>(ppdat_obs)[<span class="dv">2</span>])</span>
<span id="cb118-902"><a href="#cb118-902" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-903"><a href="#cb118-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-904"><a href="#cb118-904" aria-hidden="true" tabindex="-1"></a><span class="fu">### PP Check</span></span>
<span id="cb118-905"><a href="#cb118-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-906"><a href="#cb118-906" aria-hidden="true" tabindex="-1"></a>Note that this isn't a posterior predictive check in the true sense, but rather a comparison between the model-estimated latent states (log redd density) and the model predicted means. </span>
<span id="cb118-907"><a href="#cb118-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-910"><a href="#cb118-910" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-911"><a href="#cb118-911" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">2.5</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb118-912"><a href="#cb118-912" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">1.5</span>, <span class="at">to =</span> <span class="fl">6.5</span>, <span class="at">length.out =</span> <span class="dv">100</span>), <span class="at">y =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">1.5</span>, <span class="at">to =</span> <span class="fl">6.5</span>, <span class="at">length.out =</span> <span class="dv">100</span>), <span class="at">pch =</span> <span class="cn">NA</span>, <span class="at">xlab =</span> <span class="st">"Latent ln(recruitment)"</span>, <span class="at">ylab =</span> <span class="st">"Median posterior expected ln(recruitment)"</span>)</span>
<span id="cb118-913"><a href="#cb118-913" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">apply</span>(ppdat_exp, <span class="dv">2</span>, median, <span class="at">na.rm =</span> T) <span class="sc">~</span> <span class="fu">apply</span>(ppdat_obs, <span class="dv">2</span>, median, <span class="at">na.rm =</span> T))</span>
<span id="cb118-914"><a href="#cb118-914" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">legend =</span> <span class="fu">paste</span>(<span class="st">"Bayesian p-value = "</span>, <span class="fu">round</span>(<span class="fu">sum</span>(ppdat_exp <span class="sc">&gt;</span> ppdat_obs) <span class="sc">/</span> (<span class="fu">dim</span>(ppdat_obs)[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">dim</span>(ppdat_obs)[<span class="dv">2</span>]), <span class="at">digits =</span> <span class="dv">3</span>), <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb118-915"><a href="#cb118-915" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb118-916"><a href="#cb118-916" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-917"><a href="#cb118-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-918"><a href="#cb118-918" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb118-919"><a href="#cb118-919" aria-hidden="true" tabindex="-1"></a><span class="in"># Posterior Predictive Check: plot median posterior expected length ~ observed length with Bayesian p-value</span></span>
<span id="cb118-920"><a href="#cb118-920" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Model Diagnostics/ReddCounts_Ricker_CovarModel_Age01_PPCheck.jpg", units = "in", width = 4.5, height = 4.5, res = 1500)</span></span>
<span id="cb118-921"><a href="#cb118-921" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,1,1), mgp = c(2.5,1,0))</span></span>
<span id="cb118-922"><a href="#cb118-922" aria-hidden="true" tabindex="-1"></a><span class="in">plot(x = seq(from = 1.5, to = 6.5, length.out = 100), y = seq(from = 1.5, to = 6.5, length.out = 100), pch = NA, xlab = "Latent ln(recruitment)", ylab = "Median posterior expected ln(recruitment)")</span></span>
<span id="cb118-923"><a href="#cb118-923" aria-hidden="true" tabindex="-1"></a><span class="in">points(apply(ppdat_exp, 2, median, na.rm = T) ~ apply(ppdat_obs, 2, median, na.rm = T))</span></span>
<span id="cb118-924"><a href="#cb118-924" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topleft", bty = "n", legend = paste("Bayesian p-value = ", round(sum(ppdat_exp &gt; ppdat_obs) / (dim(ppdat_obs)[1]*dim(ppdat_obs)[2]), digits = 3), sep = ""))</span></span>
<span id="cb118-925"><a href="#cb118-925" aria-hidden="true" tabindex="-1"></a><span class="in">abline(a = 0, b = 1, col = "red", lwd = 2)</span></span>
<span id="cb118-926"><a href="#cb118-926" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-927"><a href="#cb118-927" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-928"><a href="#cb118-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-929"><a href="#cb118-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-930"><a href="#cb118-930" aria-hidden="true" tabindex="-1"></a><span class="fu">## Plot Model Output</span></span>
<span id="cb118-931"><a href="#cb118-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-932"><a href="#cb118-932" aria-hidden="true" tabindex="-1"></a><span class="fu">### Time series fits</span></span>
<span id="cb118-933"><a href="#cb118-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-934"><a href="#cb118-934" aria-hidden="true" tabindex="-1"></a>Pull latent and predicted abundance from model output</span>
<span id="cb118-935"><a href="#cb118-935" aria-hidden="true" tabindex="-1"></a><span class="in">```{r error=FALSE, message=FALSE, results='hide', warning=FALSE}</span></span>
<span id="cb118-936"><a href="#cb118-936" aria-hidden="true" tabindex="-1"></a><span class="in"># set up matrices: latent states</span></span>
<span id="cb118-937"><a href="#cb118-937" aria-hidden="true" tabindex="-1"></a><span class="in">N_med &lt;- matrix(data = NA, nrow = nrow(rec_raw), ncol = ncol(rec_raw)+4)</span></span>
<span id="cb118-938"><a href="#cb118-938" aria-hidden="true" tabindex="-1"></a><span class="in">N_low &lt;- matrix(data = NA, nrow = nrow(rec_raw), ncol = ncol(rec_raw)+4)</span></span>
<span id="cb118-939"><a href="#cb118-939" aria-hidden="true" tabindex="-1"></a><span class="in">N_upp &lt;- matrix(data = NA, nrow = nrow(rec_raw), ncol = ncol(rec_raw)+4)</span></span>
<span id="cb118-940"><a href="#cb118-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-941"><a href="#cb118-941" aria-hidden="true" tabindex="-1"></a><span class="in"># set up matrices: predictions</span></span>
<span id="cb118-942"><a href="#cb118-942" aria-hidden="true" tabindex="-1"></a><span class="in">P_med &lt;- matrix(data = NA, nrow = nrow(rec_raw), ncol = ncol(rec_raw)+4)</span></span>
<span id="cb118-943"><a href="#cb118-943" aria-hidden="true" tabindex="-1"></a><span class="in">P_low &lt;- matrix(data = NA, nrow = nrow(rec_raw), ncol = ncol(rec_raw)+4)</span></span>
<span id="cb118-944"><a href="#cb118-944" aria-hidden="true" tabindex="-1"></a><span class="in">P_upp &lt;- matrix(data = NA, nrow = nrow(rec_raw), ncol = ncol(rec_raw)+4)</span></span>
<span id="cb118-945"><a href="#cb118-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-946"><a href="#cb118-946" aria-hidden="true" tabindex="-1"></a><span class="in"># pull latent and predicted abundance from parameter summary</span></span>
<span id="cb118-947"><a href="#cb118-947" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(rec_raw)) {</span></span>
<span id="cb118-948"><a href="#cb118-948" aria-hidden="true" tabindex="-1"></a><span class="in">  for (i in 1:ncol(rec_raw)+4) {</span></span>
<span id="cb118-949"><a href="#cb118-949" aria-hidden="true" tabindex="-1"></a><span class="in">    # try(N_med[j,i] &lt;- exp(param.summary[paste("loglatent[",j,",",i,"]", sep = ""),5]))</span></span>
<span id="cb118-950"><a href="#cb118-950" aria-hidden="true" tabindex="-1"></a><span class="in">    # try(N_low[j,i] &lt;- exp(param.summary[paste("loglatent[",j,",",i,"]", sep = ""),3]))</span></span>
<span id="cb118-951"><a href="#cb118-951" aria-hidden="true" tabindex="-1"></a><span class="in">    # try(N_upp[j,i] &lt;- exp(param.summary[paste("loglatent[",j,",",i,"]", sep = ""),7]))</span></span>
<span id="cb118-952"><a href="#cb118-952" aria-hidden="true" tabindex="-1"></a><span class="in">    # </span></span>
<span id="cb118-953"><a href="#cb118-953" aria-hidden="true" tabindex="-1"></a><span class="in">    # try(P_med[j,i] &lt;- exp(param.summary[paste("logpred2[",j,",",i,"]", sep = ""),5]))</span></span>
<span id="cb118-954"><a href="#cb118-954" aria-hidden="true" tabindex="-1"></a><span class="in">    # try(P_low[j,i] &lt;- exp(param.summary[paste("logpred2[",j,",",i,"]", sep = ""),3]))</span></span>
<span id="cb118-955"><a href="#cb118-955" aria-hidden="true" tabindex="-1"></a><span class="in">    # try(P_upp[j,i] &lt;- exp(param.summary[paste("logpred2[",j,",",i,"]", sep = ""),7]))</span></span>
<span id="cb118-956"><a href="#cb118-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-957"><a href="#cb118-957" aria-hidden="true" tabindex="-1"></a><span class="in">    loglatent &lt;- NA</span></span>
<span id="cb118-958"><a href="#cb118-958" aria-hidden="true" tabindex="-1"></a><span class="in">    logpred2 &lt;- NA</span></span>
<span id="cb118-959"><a href="#cb118-959" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb118-960"><a href="#cb118-960" aria-hidden="true" tabindex="-1"></a><span class="in">    try(loglatent &lt;- Mcmcdat[,paste("loglatent[",j,",",i,"]", sep = "")])</span></span>
<span id="cb118-961"><a href="#cb118-961" aria-hidden="true" tabindex="-1"></a><span class="in">    try(logpred2 &lt;- Mcmcdat[,paste("logpred2[",j,",",i,"]", sep = "")])</span></span>
<span id="cb118-962"><a href="#cb118-962" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb118-963"><a href="#cb118-963" aria-hidden="true" tabindex="-1"></a><span class="in">    try(N_med[j,i] &lt;- quantile(exp(loglatent), prob = 0.50))</span></span>
<span id="cb118-964"><a href="#cb118-964" aria-hidden="true" tabindex="-1"></a><span class="in">    try(N_low[j,i] &lt;- quantile(exp(loglatent), prob = 0.05))</span></span>
<span id="cb118-965"><a href="#cb118-965" aria-hidden="true" tabindex="-1"></a><span class="in">    try(N_upp[j,i] &lt;- quantile(exp(loglatent), prob = 0.95))</span></span>
<span id="cb118-966"><a href="#cb118-966" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb118-967"><a href="#cb118-967" aria-hidden="true" tabindex="-1"></a><span class="in">    try(P_med[j,i] &lt;- quantile(exp(logpred2), prob = 0.50))</span></span>
<span id="cb118-968"><a href="#cb118-968" aria-hidden="true" tabindex="-1"></a><span class="in">    try(P_low[j,i] &lt;- quantile(exp(logpred2), prob = 0.05))</span></span>
<span id="cb118-969"><a href="#cb118-969" aria-hidden="true" tabindex="-1"></a><span class="in">    try(P_upp[j,i] &lt;- quantile(exp(logpred2), prob = 0.95))</span></span>
<span id="cb118-970"><a href="#cb118-970" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb118-971"><a href="#cb118-971" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb118-972"><a href="#cb118-972" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb118-973"><a href="#cb118-973" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-974"><a href="#cb118-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-975"><a href="#cb118-975" aria-hidden="true" tabindex="-1"></a>Set up and check color palette for color blindess accessibility</span>
<span id="cb118-978"><a href="#cb118-978" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-979"><a href="#cb118-979" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">&lt;-</span> rec_raw</span>
<span id="cb118-980"><a href="#cb118-980" aria-hidden="true" tabindex="-1"></a>popshort <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"THCH"</span>, <span class="st">"BLKT"</span>, <span class="st">"BLCR"</span>, <span class="st">"COCA"</span>, <span class="st">"FISH"</span>, <span class="st">"FLAT"</span>, <span class="st">"LTBC"</span>, <span class="st">"LOBC"</span>, <span class="st">"NOWL"</span>, <span class="st">"PRCE"</span>, <span class="st">"SRSC"</span>, <span class="st">"SPRG"</span>, <span class="st">"UPBC"</span>)</span>
<span id="cb118-981"><a href="#cb118-981" aria-hidden="true" tabindex="-1"></a>mycols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"orchid1"</span>, <span class="st">"forestgreen"</span>)<span class="co"># c("darkorange", "dodgerblue") # hcl.colors(2, "Red-Green")</span></span>
<span id="cb118-982"><a href="#cb118-982" aria-hidden="true" tabindex="-1"></a><span class="fu">palette_check</span>(<span class="fu">col2hcl</span>(mycols), <span class="at">plot =</span> <span class="cn">TRUE</span>)</span>
<span id="cb118-983"><a href="#cb118-983" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-984"><a href="#cb118-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-985"><a href="#cb118-985" aria-hidden="true" tabindex="-1"></a>Plot time series data with observations, latent states, and model fits.</span>
<span id="cb118-986"><a href="#cb118-986" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=8.5, fig.height=8.5}</span></span>
<span id="cb118-987"><a href="#cb118-987" aria-hidden="true" tabindex="-1"></a><span class="in">par(mfrow = c(4,4), mgp = c(2,0.6,0), mar = c(1.2, 1.2, 2, 1.2), oma = c(2.5,2.5,0,0))</span></span>
<span id="cb118-988"><a href="#cb118-988" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:n.pops) {</span></span>
<span id="cb118-989"><a href="#cb118-989" aria-hidden="true" tabindex="-1"></a><span class="in">  plot(exp(rec_raw[i,c(5:55)]) ~ years[i,c(1:51)], type = "n", xlab = "", ylab = "", xlim = c(1970, 2021), ylim = c(0, exp(max(rec_raw[i,], na.rm = T))))</span></span>
<span id="cb118-990"><a href="#cb118-990" aria-hidden="true" tabindex="-1"></a><span class="in">  title(popshort[i], line = 0.25)</span></span>
<span id="cb118-991"><a href="#cb118-991" aria-hidden="true" tabindex="-1"></a><span class="in">  # pop-specific years</span></span>
<span id="cb118-992"><a href="#cb118-992" aria-hidden="true" tabindex="-1"></a><span class="in">  yrpreds &lt;- as.numeric(na.omit(years[i,c(1:51)]))#[1:(length(as.numeric(na.omit(years[i,c(1:51)])))-4)]</span></span>
<span id="cb118-993"><a href="#cb118-993" aria-hidden="true" tabindex="-1"></a><span class="in">  # pop-specific latent states</span></span>
<span id="cb118-994"><a href="#cb118-994" aria-hidden="true" tabindex="-1"></a><span class="in">  nmedpreds &lt;- as.numeric(na.omit(N_med[i,c(5:55)]))</span></span>
<span id="cb118-995"><a href="#cb118-995" aria-hidden="true" tabindex="-1"></a><span class="in">  nlowpreds &lt;- as.numeric(na.omit(N_low[i,c(5:55)]))</span></span>
<span id="cb118-996"><a href="#cb118-996" aria-hidden="true" tabindex="-1"></a><span class="in">  nupppreds &lt;- as.numeric(na.omit(N_upp[i,c(5:55)]))</span></span>
<span id="cb118-997"><a href="#cb118-997" aria-hidden="true" tabindex="-1"></a><span class="in">  # pop-specific predictions</span></span>
<span id="cb118-998"><a href="#cb118-998" aria-hidden="true" tabindex="-1"></a><span class="in">  pmedpreds &lt;- as.numeric(na.omit(P_med[i,c(5:55)]))</span></span>
<span id="cb118-999"><a href="#cb118-999" aria-hidden="true" tabindex="-1"></a><span class="in">  plowpreds &lt;- as.numeric(na.omit(P_low[i,c(5:55)]))</span></span>
<span id="cb118-1000"><a href="#cb118-1000" aria-hidden="true" tabindex="-1"></a><span class="in">  pupppreds &lt;- as.numeric(na.omit(P_upp[i,c(5:55)]))</span></span>
<span id="cb118-1001"><a href="#cb118-1001" aria-hidden="true" tabindex="-1"></a><span class="in">  # carrying capacity</span></span>
<span id="cb118-1002"><a href="#cb118-1002" aria-hidden="true" tabindex="-1"></a><span class="in">  abline(h = param.summary[paste("K[",i,"]", sep = ""),5], lty = 3)</span></span>
<span id="cb118-1003"><a href="#cb118-1003" aria-hidden="true" tabindex="-1"></a><span class="in">  # plot latent states</span></span>
<span id="cb118-1004"><a href="#cb118-1004" aria-hidden="true" tabindex="-1"></a><span class="in">  lines(nmedpreds ~ yrpreds, lwd = 1.5, col = mycols[1])</span></span>
<span id="cb118-1005"><a href="#cb118-1005" aria-hidden="true" tabindex="-1"></a><span class="in">  polygon(x = c(yrpreds, rev(yrpreds)), y = c(c(nlowpreds), rev(nupppreds)), col = scales::alpha(mycols[1], 0.3), border = NA)</span></span>
<span id="cb118-1006"><a href="#cb118-1006" aria-hidden="true" tabindex="-1"></a><span class="in">  # plot predictions</span></span>
<span id="cb118-1007"><a href="#cb118-1007" aria-hidden="true" tabindex="-1"></a><span class="in">  lines(pmedpreds ~ yrpreds, lwd = 1.5, col = mycols[2])</span></span>
<span id="cb118-1008"><a href="#cb118-1008" aria-hidden="true" tabindex="-1"></a><span class="in">  polygon(x = c(yrpreds, rev(yrpreds)), y = c(c(plowpreds), rev(pupppreds)), col = scales::alpha(mycols[2], 0.3), border = NA)</span></span>
<span id="cb118-1009"><a href="#cb118-1009" aria-hidden="true" tabindex="-1"></a><span class="in">  # plot observations</span></span>
<span id="cb118-1010"><a href="#cb118-1010" aria-hidden="true" tabindex="-1"></a><span class="in">  points(exp(rec_raw[i,c(5:55)]) ~ years[i,c(1:51)], pch = 1)</span></span>
<span id="cb118-1011"><a href="#cb118-1011" aria-hidden="true" tabindex="-1"></a><span class="in">  # legend</span></span>
<span id="cb118-1012"><a href="#cb118-1012" aria-hidden="true" tabindex="-1"></a><span class="in">  #legend("topright", legend = pops[i], bty = "n", border = NA, col = NA, fill = NA, cex = 1.25)</span></span>
<span id="cb118-1013"><a href="#cb118-1013" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb118-1014"><a href="#cb118-1014" aria-hidden="true" tabindex="-1"></a><span class="in">mtext("Year", side = 1, line = 1, outer = T)</span></span>
<span id="cb118-1015"><a href="#cb118-1015" aria-hidden="true" tabindex="-1"></a><span class="in">mtext(expression("Redds km"^-1), side = 2, line = 1, outer = T)</span></span>
<span id="cb118-1016"><a href="#cb118-1016" aria-hidden="true" tabindex="-1"></a><span class="in">plot.new()</span></span>
<span id="cb118-1017"><a href="#cb118-1017" aria-hidden="true" tabindex="-1"></a><span class="in">legend("center", legend = c("Observations", "Latent states", "Predictions"), pch = c(1,NA,NA), lwd = c(NA,2,2), col = c("black", mycols[1], mycols[2]), bty = "n", cex = 1.5)</span></span>
<span id="cb118-1018"><a href="#cb118-1018" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1019"><a href="#cb118-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1020"><a href="#cb118-1020" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include = FALSE}</span></span>
<span id="cb118-1021"><a href="#cb118-1021" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Time Series/ReddCountsRicker_Covars_Age01p_TimeSeries_Proportional_90ci.jpg", units = "in", width = 8.5, height = 8.5, res = 1000)</span></span>
<span id="cb118-1022"><a href="#cb118-1022" aria-hidden="true" tabindex="-1"></a><span class="in">par(mfrow = c(4,4), mgp = c(2,0.6,0), mar = c(1.2, 1.2, 2, 1.2), oma = c(2.5,2.5,0,0))</span></span>
<span id="cb118-1023"><a href="#cb118-1023" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:n.pops) {</span></span>
<span id="cb118-1024"><a href="#cb118-1024" aria-hidden="true" tabindex="-1"></a><span class="in">  plot(exp(rec_raw[i,c(5:55)]) ~ years[i,c(1:51)], type = "n", xlab = "", ylab = "", xlim = c(1970, 2021), ylim = c(0, exp(max(rec_raw[i,], na.rm = T))))</span></span>
<span id="cb118-1025"><a href="#cb118-1025" aria-hidden="true" tabindex="-1"></a><span class="in">  title(popshort[i], line = 0.25)</span></span>
<span id="cb118-1026"><a href="#cb118-1026" aria-hidden="true" tabindex="-1"></a><span class="in">  # pop-specific years</span></span>
<span id="cb118-1027"><a href="#cb118-1027" aria-hidden="true" tabindex="-1"></a><span class="in">  yrpreds &lt;- as.numeric(na.omit(years[i,c(1:51)]))#[1:(length(as.numeric(na.omit(years[i,c(1:51)])))-4)]</span></span>
<span id="cb118-1028"><a href="#cb118-1028" aria-hidden="true" tabindex="-1"></a><span class="in">  # pop-specific latent states</span></span>
<span id="cb118-1029"><a href="#cb118-1029" aria-hidden="true" tabindex="-1"></a><span class="in">  nmedpreds &lt;- as.numeric(na.omit(N_med[i,c(5:55)]))</span></span>
<span id="cb118-1030"><a href="#cb118-1030" aria-hidden="true" tabindex="-1"></a><span class="in">  nlowpreds &lt;- as.numeric(na.omit(N_low[i,c(5:55)]))</span></span>
<span id="cb118-1031"><a href="#cb118-1031" aria-hidden="true" tabindex="-1"></a><span class="in">  nupppreds &lt;- as.numeric(na.omit(N_upp[i,c(5:55)]))</span></span>
<span id="cb118-1032"><a href="#cb118-1032" aria-hidden="true" tabindex="-1"></a><span class="in">  # pop-specific predictions</span></span>
<span id="cb118-1033"><a href="#cb118-1033" aria-hidden="true" tabindex="-1"></a><span class="in">  pmedpreds &lt;- as.numeric(na.omit(P_med[i,c(5:55)]))</span></span>
<span id="cb118-1034"><a href="#cb118-1034" aria-hidden="true" tabindex="-1"></a><span class="in">  plowpreds &lt;- as.numeric(na.omit(P_low[i,c(5:55)]))</span></span>
<span id="cb118-1035"><a href="#cb118-1035" aria-hidden="true" tabindex="-1"></a><span class="in">  pupppreds &lt;- as.numeric(na.omit(P_upp[i,c(5:55)]))</span></span>
<span id="cb118-1036"><a href="#cb118-1036" aria-hidden="true" tabindex="-1"></a><span class="in">  # carrying capacity</span></span>
<span id="cb118-1037"><a href="#cb118-1037" aria-hidden="true" tabindex="-1"></a><span class="in">  abline(h = param.summary[paste("K[",i,"]", sep = ""),5], lty = 3)</span></span>
<span id="cb118-1038"><a href="#cb118-1038" aria-hidden="true" tabindex="-1"></a><span class="in">  # plot latent states</span></span>
<span id="cb118-1039"><a href="#cb118-1039" aria-hidden="true" tabindex="-1"></a><span class="in">  lines(nmedpreds ~ yrpreds, lwd = 1.5, col = mycols[1])</span></span>
<span id="cb118-1040"><a href="#cb118-1040" aria-hidden="true" tabindex="-1"></a><span class="in">  polygon(x = c(yrpreds, rev(yrpreds)), y = c(c(nlowpreds), rev(nupppreds)), col = scales::alpha(mycols[1], 0.3), border = NA)</span></span>
<span id="cb118-1041"><a href="#cb118-1041" aria-hidden="true" tabindex="-1"></a><span class="in">  # plot predictions</span></span>
<span id="cb118-1042"><a href="#cb118-1042" aria-hidden="true" tabindex="-1"></a><span class="in">  lines(pmedpreds ~ yrpreds, lwd = 1.5, col = mycols[2])</span></span>
<span id="cb118-1043"><a href="#cb118-1043" aria-hidden="true" tabindex="-1"></a><span class="in">  polygon(x = c(yrpreds, rev(yrpreds)), y = c(c(plowpreds), rev(pupppreds)), col = scales::alpha(mycols[2], 0.3), border = NA)</span></span>
<span id="cb118-1044"><a href="#cb118-1044" aria-hidden="true" tabindex="-1"></a><span class="in">  # plot observations</span></span>
<span id="cb118-1045"><a href="#cb118-1045" aria-hidden="true" tabindex="-1"></a><span class="in">  points(exp(rec_raw[i,c(5:55)]) ~ years[i,c(1:51)], pch = 1)</span></span>
<span id="cb118-1046"><a href="#cb118-1046" aria-hidden="true" tabindex="-1"></a><span class="in">  # legend</span></span>
<span id="cb118-1047"><a href="#cb118-1047" aria-hidden="true" tabindex="-1"></a><span class="in">  #legend("topright", legend = pops[i], bty = "n", border = NA, col = NA, fill = NA, cex = 1.25)</span></span>
<span id="cb118-1048"><a href="#cb118-1048" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb118-1049"><a href="#cb118-1049" aria-hidden="true" tabindex="-1"></a><span class="in">mtext("Year", side = 1, line = 1, outer = T)</span></span>
<span id="cb118-1050"><a href="#cb118-1050" aria-hidden="true" tabindex="-1"></a><span class="in">mtext(expression("Redds km"^-1), side = 2, line = 1, outer = T)</span></span>
<span id="cb118-1051"><a href="#cb118-1051" aria-hidden="true" tabindex="-1"></a><span class="in">plot.new()</span></span>
<span id="cb118-1052"><a href="#cb118-1052" aria-hidden="true" tabindex="-1"></a><span class="in">legend("center", legend = c("Observations", "Latent states", "Predictions"), pch = c(1,NA,NA), lwd = c(NA,2,2), col = c("black", mycols[1], mycols[2]), bty = "n", cex = 1.5)</span></span>
<span id="cb118-1053"><a href="#cb118-1053" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-1054"><a href="#cb118-1054" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1055"><a href="#cb118-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1056"><a href="#cb118-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1057"><a href="#cb118-1057" aria-hidden="true" tabindex="-1"></a>Population summaries of latent states and carrying capacity, arranged from least to most variable (based on CV).</span>
<span id="cb118-1060"><a href="#cb118-1060" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-1061"><a href="#cb118-1061" aria-hidden="true" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="fu">apply</span>(N_med, <span class="dv">1</span>, mean, <span class="at">na.rm =</span> T)</span>
<span id="cb118-1062"><a href="#cb118-1062" aria-hidden="true" tabindex="-1"></a>sds <span class="ot">&lt;-</span> <span class="fu">apply</span>(N_med, <span class="dv">1</span>, sd, <span class="at">na.rm =</span> T)</span>
<span id="cb118-1063"><a href="#cb118-1063" aria-hidden="true" tabindex="-1"></a>cvs <span class="ot">&lt;-</span> sds<span class="sc">/</span>means</span>
<span id="cb118-1064"><a href="#cb118-1064" aria-hidden="true" tabindex="-1"></a>mins <span class="ot">&lt;-</span> <span class="fu">apply</span>(N_med, <span class="dv">1</span>, min, <span class="at">na.rm =</span> T)</span>
<span id="cb118-1065"><a href="#cb118-1065" aria-hidden="true" tabindex="-1"></a>maxs <span class="ot">&lt;-</span> <span class="fu">apply</span>(N_med, <span class="dv">1</span>, max, <span class="at">na.rm =</span> T)</span>
<span id="cb118-1066"><a href="#cb118-1066" aria-hidden="true" tabindex="-1"></a>relc <span class="ot">&lt;-</span> maxs<span class="sc">/</span>mins</span>
<span id="cb118-1067"><a href="#cb118-1067" aria-hidden="true" tabindex="-1"></a>ks <span class="ot">&lt;-</span> param.summary[<span class="fu">grep</span>(<span class="st">"K"</span>, <span class="fu">row.names</span>(param.summary), <span class="at">value =</span> <span class="cn">TRUE</span>),<span class="dv">5</span>]</span>
<span id="cb118-1068"><a href="#cb118-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1069"><a href="#cb118-1069" aria-hidden="true" tabindex="-1"></a>poptib <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">pop =</span> pops, <span class="at">mean =</span> <span class="fu">round</span>(means, <span class="at">digits =</span> <span class="dv">3</span>), <span class="at">sd =</span> <span class="fu">round</span>(sds, <span class="at">digits =</span> <span class="dv">3</span>), <span class="at">cv =</span> <span class="fu">round</span>(cvs, <span class="at">digits =</span> <span class="dv">3</span>), <span class="at">min =</span> <span class="fu">round</span>(mins, <span class="at">digits =</span> <span class="dv">3</span>), <span class="at">max =</span> <span class="fu">round</span>(maxs, <span class="at">digits =</span> <span class="dv">3</span>), <span class="at">K =</span> <span class="fu">round</span>(ks, <span class="at">digits =</span> <span class="dv">3</span>))</span>
<span id="cb118-1070"><a href="#cb118-1070" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(poptib <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(cv))</span>
<span id="cb118-1071"><a href="#cb118-1071" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1072"><a href="#cb118-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1073"><a href="#cb118-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1074"><a href="#cb118-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1075"><a href="#cb118-1075" aria-hidden="true" tabindex="-1"></a><span class="fu">### Parameter dot plots</span></span>
<span id="cb118-1076"><a href="#cb118-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1077"><a href="#cb118-1077" aria-hidden="true" tabindex="-1"></a>Coerce to ggs object</span>
<span id="cb118-1078"><a href="#cb118-1078" aria-hidden="true" tabindex="-1"></a><span class="in">```{r cache=FALSE}</span></span>
<span id="cb118-1079"><a href="#cb118-1079" aria-hidden="true" tabindex="-1"></a><span class="in">mod.gg &lt;- ggs(as.mcmc(topmod), keep_original_order = TRUE)</span></span>
<span id="cb118-1080"><a href="#cb118-1080" aria-hidden="true" tabindex="-1"></a><span class="in">popshort &lt;- c("THCH", "BLKT", "BLCR", "COCA", "FISH", "FLAT", "LTBC", "LOBC", "NOWL", "PRCE", "SRSC", "SPRG", "UPBC")</span></span>
<span id="cb118-1081"><a href="#cb118-1081" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1082"><a href="#cb118-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1083"><a href="#cb118-1083" aria-hidden="true" tabindex="-1"></a>Remind covariate names...</span>
<span id="cb118-1086"><a href="#cb118-1086" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-1087"><a href="#cb118-1087" aria-hidden="true" tabindex="-1"></a>names.covars0</span>
<span id="cb118-1088"><a href="#cb118-1088" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1089"><a href="#cb118-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1090"><a href="#cb118-1090" aria-hidden="true" tabindex="-1"></a>Covariate types and pretty covariate names</span>
<span id="cb118-1093"><a href="#cb118-1093" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-1094"><a href="#cb118-1094" aria-hidden="true" tabindex="-1"></a>CovType <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Managed flow"</span>, <span class="at">times =</span> <span class="dv">6</span>), </span>
<span id="cb118-1095"><a href="#cb118-1095" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">rep</span>(<span class="st">"Natural flow"</span>, <span class="at">times =</span> <span class="dv">2</span>), </span>
<span id="cb118-1096"><a href="#cb118-1096" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">rep</span>(<span class="st">"Temperature"</span>, <span class="at">times =</span> <span class="dv">4</span>), </span>
<span id="cb118-1097"><a href="#cb118-1097" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">rep</span>(<span class="st">"Interaction"</span>, <span class="at">times =</span> <span class="dv">2</span>)),</span>
<span id="cb118-1098"><a href="#cb118-1098" aria-hidden="true" tabindex="-1"></a>                  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Managed flow"</span>, <span class="st">"Natural flow"</span>, <span class="st">"Temperature"</span>, <span class="st">"Interaction"</span>))</span>
<span id="cb118-1099"><a href="#cb118-1099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1100"><a href="#cb118-1100" aria-hidden="true" tabindex="-1"></a><span class="co"># rename covariates</span></span>
<span id="cb118-1101"><a href="#cb118-1101" aria-hidden="true" tabindex="-1"></a>names.covars.new <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Duration of ramp down"</span>, <span class="st">"Timing of ramp down"</span>, </span>
<span id="cb118-1102"><a href="#cb118-1102" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Mgd. winter flow var."</span>, <span class="st">"Mgd. summer mean flow"</span>, <span class="st">"Mgd. peak flow mag."</span>, <span class="st">"Mgd. peak flow timing"</span>, </span>
<span id="cb118-1103"><a href="#cb118-1103" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Nat. peak flow mag."</span>, <span class="st">"Nat. peak flow timing"</span>,</span>
<span id="cb118-1104"><a href="#cb118-1104" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Autumn temperature"</span>, <span class="st">"Winter temperature"</span>, <span class="st">"Spring temperature"</span>, <span class="st">"Summer temperature"</span>,</span>
<span id="cb118-1105"><a href="#cb118-1105" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Mgd. x Nat. peak flow mag."</span>, <span class="st">"Mgd. x Nat. peak flow timing"</span>)</span>
<span id="cb118-1106"><a href="#cb118-1106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1107"><a href="#cb118-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1108"><a href="#cb118-1108" aria-hidden="true" tabindex="-1"></a>Set color palette</span>
<span id="cb118-1111"><a href="#cb118-1111" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-1112"><a href="#cb118-1112" aria-hidden="true" tabindex="-1"></a><span class="co"># bls &lt;- hcl.colors(5, "Blues3")</span></span>
<span id="cb118-1113"><a href="#cb118-1113" aria-hidden="true" tabindex="-1"></a><span class="co"># mycols &lt;- c("darkorange", bls[c(3,1)], "seagreen", "grey50")</span></span>
<span id="cb118-1114"><a href="#cb118-1114" aria-hidden="true" tabindex="-1"></a>mycols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#009E73"</span>, <span class="st">"#999999"</span>)</span>
<span id="cb118-1115"><a href="#cb118-1115" aria-hidden="true" tabindex="-1"></a><span class="co">#palette_check(col2hcl(mycols), plot = TRUE)</span></span>
<span id="cb118-1116"><a href="#cb118-1116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1117"><a href="#cb118-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1118"><a href="#cb118-1118" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Global covariate effects</span></span>
<span id="cb118-1119"><a href="#cb118-1119" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=5.5, fig.height=6}</span></span>
<span id="cb118-1120"><a href="#cb118-1120" aria-hidden="true" tabindex="-1"></a><span class="in">ggs_caterpillar(D = mod.gg, family = "mu.coef", thick_ci = c(0.125, 0.875), thin_ci = c(0.025, 0.975), sort = FALSE) + </span></span>
<span id="cb118-1121"><a href="#cb118-1121" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() + ylab("Environmental driver") + xlab("Global change in productivity, ln(R/S)") + aes(color = CovType) + scale_color_manual(values = mycols) +</span></span>
<span id="cb118-1122"><a href="#cb118-1122" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = 0, linetype = "dashed") + scale_y_discrete(labels = rev(names.covars.new), limits = rev) +</span></span>
<span id="cb118-1123"><a href="#cb118-1123" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "top", legend.title = element_blank(), axis.text = element_text(color = "black"),</span></span>
<span id="cb118-1124"><a href="#cb118-1124" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.key.spacing.y = unit(0, "cm"), legend.key.spacing.x = unit(1, "cm"), legend.margin = margin(0,0,0,0)) + </span></span>
<span id="cb118-1125"><a href="#cb118-1125" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(color = guide_legend(nrow = 2, byrow = TRUE))</span></span>
<span id="cb118-1126"><a href="#cb118-1126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1127"><a href="#cb118-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1128"><a href="#cb118-1128" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb118-1129"><a href="#cb118-1129" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Dot Plots/ReddCounts_Ricker_CovarModel_DotPlot_GlobalCovariates.jpg", units = "in", width = 5.5, height = 5, res = 1500)</span></span>
<span id="cb118-1130"><a href="#cb118-1130" aria-hidden="true" tabindex="-1"></a><span class="in">ggs_caterpillar(D = mod.gg, family = "mu.coef", thick_ci = c(0.125, 0.875), thin_ci = c(0.025, 0.975), sort = FALSE) + </span></span>
<span id="cb118-1131"><a href="#cb118-1131" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() + ylab("Environmental driver") + xlab("Global change in productivity, ln(R/S)") + aes(color = CovType) + scale_color_manual(values = mycols) +</span></span>
<span id="cb118-1132"><a href="#cb118-1132" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = 0, linetype = "dashed") + scale_y_discrete(labels = rev(names.covars.new), limits = rev) +</span></span>
<span id="cb118-1133"><a href="#cb118-1133" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "top", legend.title = element_blank(), axis.text = element_text(color = "black"), </span></span>
<span id="cb118-1134"><a href="#cb118-1134" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.key.spacing.y = unit(0, "cm"), legend.key.spacing.x = unit(1, "cm"), legend.margin = margin(0,0,0,0)) + </span></span>
<span id="cb118-1135"><a href="#cb118-1135" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(color = guide_legend(nrow = 2, byrow = TRUE))</span></span>
<span id="cb118-1136"><a href="#cb118-1136" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-1137"><a href="#cb118-1137" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1138"><a href="#cb118-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1139"><a href="#cb118-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1140"><a href="#cb118-1140" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Population covariate effects</span></span>
<span id="cb118-1141"><a href="#cb118-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1142"><a href="#cb118-1142" aria-hidden="true" tabindex="-1"></a>Define colors</span>
<span id="cb118-1145"><a href="#cb118-1145" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-1146"><a href="#cb118-1146" aria-hidden="true" tabindex="-1"></a>mycols2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(mycols[<span class="dv">1</span>], <span class="at">times =</span> <span class="dv">6</span>), <span class="fu">rep</span>(mycols[<span class="dv">2</span>], <span class="at">times =</span> <span class="dv">2</span>), </span>
<span id="cb118-1147"><a href="#cb118-1147" aria-hidden="true" tabindex="-1"></a>             <span class="fu">rep</span>(mycols[<span class="dv">3</span>], <span class="at">times =</span> <span class="dv">4</span>), <span class="fu">rep</span>(mycols[<span class="dv">4</span>], <span class="at">times =</span> <span class="dv">2</span>))</span>
<span id="cb118-1148"><a href="#cb118-1148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1149"><a href="#cb118-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1150"><a href="#cb118-1150" aria-hidden="true" tabindex="-1"></a>Generate plots in a for loop</span>
<span id="cb118-1153"><a href="#cb118-1153" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-1154"><a href="#cb118-1154" aria-hidden="true" tabindex="-1"></a><span class="co"># generate plots in a for loop</span></span>
<span id="cb118-1155"><a href="#cb118-1155" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(names.covars0)) {</span>
<span id="cb118-1156"><a href="#cb118-1156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">jpeg</span>(<span class="fu">paste</span>(<span class="st">"Figures/Dot Plots/Pop Level Covariate Effects/ReddCounts_Ricker_CovarModel_DotPlot_Covs"</span>, i, <span class="st">"_"</span>, names.covars0[i], <span class="st">".jpg"</span>, <span class="at">sep =</span> <span class="st">""</span>), <span class="at">units =</span> <span class="st">"in"</span>, <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">res =</span> <span class="dv">1500</span>)</span>
<span id="cb118-1157"><a href="#cb118-1157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">ggs_caterpillar</span>(<span class="at">D =</span> mod.gg <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">paste</span>(<span class="st">"coef["</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>, <span class="st">","</span>, i, <span class="st">"]"</span>, <span class="at">sep =</span> <span class="st">""</span>)), <span class="at">family =</span> <span class="st">"coef"</span>, <span class="at">thick_ci =</span> <span class="fu">c</span>(<span class="fl">0.125</span>, <span class="fl">0.875</span>), <span class="at">thin_ci =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb118-1158"><a href="#cb118-1158" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Effect"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(names.covars.new[i]) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(pops), <span class="at">limits =</span> rev) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb118-1159"><a href="#cb118-1159" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">color =</span> CovType[i]) <span class="sc">+</span> <span class="fu">scale_color_manual</span>(<span class="at">values =</span> mycols2[i]) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>), <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)))</span>
<span id="cb118-1160"><a href="#cb118-1160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dev.off</span>()</span>
<span id="cb118-1161"><a href="#cb118-1161" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb118-1162"><a href="#cb118-1162" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1163"><a href="#cb118-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1164"><a href="#cb118-1164" aria-hidden="true" tabindex="-1"></a>Combined plot</span>
<span id="cb118-1165"><a href="#cb118-1165" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=11, fig.height=11}</span></span>
<span id="cb118-1166"><a href="#cb118-1166" aria-hidden="true" tabindex="-1"></a><span class="in">covplots &lt;- list()</span></span>
<span id="cb118-1167"><a href="#cb118-1167" aria-hidden="true" tabindex="-1"></a><span class="in">popshort &lt;- c("THCH", "BLKT", "BLCR", "COCA", "FISH", "FLAT", "LTBC", "LOBC", "NOWL", "PRCE", "SRSC", "SPRG", "UPBC")</span></span>
<span id="cb118-1168"><a href="#cb118-1168" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:length(names.covars0)) {</span></span>
<span id="cb118-1169"><a href="#cb118-1169" aria-hidden="true" tabindex="-1"></a><span class="in">  p1 &lt;- eval(substitute(ggs_caterpillar(D = mod.gg %&gt;% filter(Parameter %in% paste("coef[", 1:16, ",", i, "]", sep = "")), family = "coef", thick_ci = c(0.125, 0.875), thin_ci = c(0.025, 0.975), sort = FALSE) + </span></span>
<span id="cb118-1170"><a href="#cb118-1170" aria-hidden="true" tabindex="-1"></a><span class="in">                          theme_bw() + ylab("") + xlab("") + xlim(-0.55, 0.49) + ggtitle(names.covars.new[i]) + geom_vline(xintercept = 0, linetype = "dashed") + </span></span>
<span id="cb118-1171"><a href="#cb118-1171" aria-hidden="true" tabindex="-1"></a><span class="in">                          scale_y_discrete(labels = rev(popshort), limits = rev) + aes(color = CovType[i]) + scale_color_manual(values = mycols2[i]) + </span></span>
<span id="cb118-1172"><a href="#cb118-1172" aria-hidden="true" tabindex="-1"></a><span class="in">                          theme(legend.position = "none", plot.margin = unit(c(0.1,0.1,-0.7,-0.5), 'lines'), plot.title = element_text(vjust = -0.5, hjust = 0.5), axis.text = element_text(color = "black")), list(i = i)))</span></span>
<span id="cb118-1173"><a href="#cb118-1173" aria-hidden="true" tabindex="-1"></a><span class="in">  covplots[[i]] &lt;- p1</span></span>
<span id="cb118-1174"><a href="#cb118-1174" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb118-1175"><a href="#cb118-1175" aria-hidden="true" tabindex="-1"></a><span class="in">myfig &lt;- ggarrange(plotlist = covplots, ncol = 4, nrow = 4)</span></span>
<span id="cb118-1176"><a href="#cb118-1176" aria-hidden="true" tabindex="-1"></a><span class="in">myfig</span></span>
<span id="cb118-1177"><a href="#cb118-1177" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1178"><a href="#cb118-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1179"><a href="#cb118-1179" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb118-1180"><a href="#cb118-1180" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Dot Plots/Pop Level Covariate Effects/ReddCounts_Ricker_CovarModel_DotPlot_PopLevelCovEffects_combined.jpeg", height = 11.4, width = 11.4, units = "in", res = 1000)</span></span>
<span id="cb118-1181"><a href="#cb118-1181" aria-hidden="true" tabindex="-1"></a><span class="in"># ggarrange(plotlist = covplots, ncol = 4, nrow = 4)</span></span>
<span id="cb118-1182"><a href="#cb118-1182" aria-hidden="true" tabindex="-1"></a><span class="in">annotate_figure(myfig, left = text_grob("Population", rot = 90, size = 15), bottom = text_grob("Population-specific change in productivity, ln(R/S)", size = 15))</span></span>
<span id="cb118-1183"><a href="#cb118-1183" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-1184"><a href="#cb118-1184" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1185"><a href="#cb118-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1186"><a href="#cb118-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1187"><a href="#cb118-1187" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Population variation in covariate effects</span></span>
<span id="cb118-1188"><a href="#cb118-1188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1189"><a href="#cb118-1189" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=5.5, fig.height=6}</span></span>
<span id="cb118-1190"><a href="#cb118-1190" aria-hidden="true" tabindex="-1"></a><span class="in">ggs_caterpillar(D = mod.gg, family = "sigma.coef", thick_ci = c(0.125, 0.875), thin_ci = c(0.025, 0.975), sort = FALSE) + </span></span>
<span id="cb118-1191"><a href="#cb118-1191" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() + ylab("Environmental driver") + xlab("Population-level variation in covariate effect") + aes(color = CovType) + scale_color_manual(values = mycols) +</span></span>
<span id="cb118-1192"><a href="#cb118-1192" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = 0, linetype = "dashed") + scale_y_discrete(labels = rev(names.covars.new), limits = rev) +</span></span>
<span id="cb118-1193"><a href="#cb118-1193" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "top") + theme(legend.title = element_blank(), axis.text = element_text(color = "black"), </span></span>
<span id="cb118-1194"><a href="#cb118-1194" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.key.spacing.y = unit(0, "cm"), legend.key.spacing.x = unit(1, "cm"), legend.margin = margin(0,0,0,0))  + </span></span>
<span id="cb118-1195"><a href="#cb118-1195" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(color = guide_legend(nrow = 2, byrow = TRUE))</span></span>
<span id="cb118-1196"><a href="#cb118-1196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1197"><a href="#cb118-1197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1198"><a href="#cb118-1198" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb118-1199"><a href="#cb118-1199" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Dot Plots/ReddCounts_Ricker_CovarModel_DotPlot_GlobalCovariatesSigma.jpg", units = "in", width = 5.5, height = 6, res = 1500)</span></span>
<span id="cb118-1200"><a href="#cb118-1200" aria-hidden="true" tabindex="-1"></a><span class="in">ggs_caterpillar(D = mod.gg, family = "sigma.coef", thick_ci = c(0.125, 0.875), thin_ci = c(0.025, 0.975), sort = FALSE) + </span></span>
<span id="cb118-1201"><a href="#cb118-1201" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() + ylab("Environmental driver") + xlab("Population-level variation in covariate effect") + aes(color = CovType) + scale_color_manual(values = mycols) +</span></span>
<span id="cb118-1202"><a href="#cb118-1202" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = 0, linetype = "dashed") + scale_y_discrete(labels = rev(names.covars.new), limits = rev) +</span></span>
<span id="cb118-1203"><a href="#cb118-1203" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "top") + theme(legend.title = element_blank(), axis.text = element_text(color = "black"), </span></span>
<span id="cb118-1204"><a href="#cb118-1204" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.key.spacing.y = unit(0, "cm"), legend.key.spacing.x = unit(1, "cm"), legend.margin = margin(0,0,0,0))  + </span></span>
<span id="cb118-1205"><a href="#cb118-1205" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(color = guide_legend(nrow = 2, byrow = TRUE))</span></span>
<span id="cb118-1206"><a href="#cb118-1206" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-1207"><a href="#cb118-1207" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1208"><a href="#cb118-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1209"><a href="#cb118-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1210"><a href="#cb118-1210" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Age proportional effects</span></span>
<span id="cb118-1211"><a href="#cb118-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1212"><a href="#cb118-1212" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=5, fig.height=7}</span></span>
<span id="cb118-1213"><a href="#cb118-1213" aria-hidden="true" tabindex="-1"></a><span class="in">as_tibble(Mcmcdat[, c("p[1]", "p[2]", "p[3]", "p[4]", "p[5]", "p[6]", "p[7]", "p[8]", "p[9]", </span></span>
<span id="cb118-1214"><a href="#cb118-1214" aria-hidden="true" tabindex="-1"></a><span class="in">                      "p[10]", "p[11]", "p[12]", "p[13]", "p[14]")]) %&gt;%</span></span>
<span id="cb118-1215"><a href="#cb118-1215" aria-hidden="true" tabindex="-1"></a><span class="in">  gather(key = "param", value = "value") %&gt;% mutate(param = fct_rev(as_factor(param))) %&gt;% </span></span>
<span id="cb118-1216"><a href="#cb118-1216" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = value, y = param, height = stat(density), fill = param)) + </span></span>
<span id="cb118-1217"><a href="#cb118-1217" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_density_ridges(scale = 1.3, stat = "density", alpha = 0.8) +</span></span>
<span id="cb118-1218"><a href="#cb118-1218" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = rev(mycols2)) + scale_y_discrete(labels = rev(names.covars.new), expand = expand_scale(mult = c(0.01, .07))) +</span></span>
<span id="cb118-1219"><a href="#cb118-1219" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Environmental driver") + xlab(expression(paste("Proportional effect at age-0 vs. age-1 (", rho, ")"))) +</span></span>
<span id="cb118-1220"><a href="#cb118-1220" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() + theme(legend.position = "none", axis.text = element_text(color = "black"), </span></span>
<span id="cb118-1221"><a href="#cb118-1221" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.key.spacing.y = unit(0, "cm"), legend.key.spacing.x = unit(1, "cm"), legend.margin = margin(0,0,0,0), panel.grid = element_blank())  + </span></span>
<span id="cb118-1222"><a href="#cb118-1222" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(color = guide_legend(nrow = 2, byrow = TRUE))</span></span>
<span id="cb118-1223"><a href="#cb118-1223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1224"><a href="#cb118-1224" aria-hidden="true" tabindex="-1"></a><span class="in"># same but plot as density/ridgelines</span></span>
<span id="cb118-1225"><a href="#cb118-1225" aria-hidden="true" tabindex="-1"></a><span class="in">mycols2 &lt;- c(mycols[1], mycols[1], mycols[1], mycols[1], mycols[1], mycols[1], mycols[2], mycols[2], mycols[3], mycols[3], mycols[3], mycols[3], mycols[4], mycols[4])</span></span>
<span id="cb118-1226"><a href="#cb118-1226" aria-hidden="true" tabindex="-1"></a><span class="in"># mycols2 &lt;- c("darkorange", "darkorange", bls[3], bls[3], bls[3], bls[3], bls[1], bls[1], "seagreen", "seagreen", "seagreen", "seagreen", "grey50", "grey50")</span></span>
<span id="cb118-1227"><a href="#cb118-1227" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Dot Plots/ReddCounts_Ricker_CovarModel_DensityPlot_ProportionalCov.jpg", units = "in", width = 5, height = 7, res = 1500)</span></span>
<span id="cb118-1228"><a href="#cb118-1228" aria-hidden="true" tabindex="-1"></a><span class="in">as_tibble(Mcmcdat[, c("p[1]", "p[2]", "p[3]", "p[4]", "p[5]", "p[6]", "p[7]", "p[8]", "p[9]", </span></span>
<span id="cb118-1229"><a href="#cb118-1229" aria-hidden="true" tabindex="-1"></a><span class="in">                      "p[10]", "p[11]", "p[12]", "p[13]", "p[14]")]) %&gt;%</span></span>
<span id="cb118-1230"><a href="#cb118-1230" aria-hidden="true" tabindex="-1"></a><span class="in">  gather(key = "param", value = "value") %&gt;% mutate(param = fct_rev(as_factor(param))) %&gt;% </span></span>
<span id="cb118-1231"><a href="#cb118-1231" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = value, y = param, height = stat(density), fill = param)) + </span></span>
<span id="cb118-1232"><a href="#cb118-1232" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_density_ridges(scale = 1.3, stat = "density", alpha = 0.8) +</span></span>
<span id="cb118-1233"><a href="#cb118-1233" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = rev(mycols2)) + scale_y_discrete(labels = rev(names.covars.new), expand = expand_scale(mult = c(0.01, .07))) +</span></span>
<span id="cb118-1234"><a href="#cb118-1234" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Environmental driver") + xlab(expression(paste("Proportional effect at age-0 vs. age-1 (", rho, ")"))) +</span></span>
<span id="cb118-1235"><a href="#cb118-1235" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() + theme(legend.position = "none", axis.text = element_text(color = "black"), </span></span>
<span id="cb118-1236"><a href="#cb118-1236" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.key.spacing.y = unit(0, "cm"), legend.key.spacing.x = unit(1, "cm"), legend.margin = margin(0,0,0,0), panel.grid = element_blank())  + </span></span>
<span id="cb118-1237"><a href="#cb118-1237" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(color = guide_legend(nrow = 2, byrow = TRUE))</span></span>
<span id="cb118-1238"><a href="#cb118-1238" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-1239"><a href="#cb118-1239" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1240"><a href="#cb118-1240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1241"><a href="#cb118-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1242"><a href="#cb118-1242" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Ricker a</span></span>
<span id="cb118-1243"><a href="#cb118-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1244"><a href="#cb118-1244" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=5, fig.height=5}</span></span>
<span id="cb118-1245"><a href="#cb118-1245" aria-hidden="true" tabindex="-1"></a><span class="in">ggs_caterpillar(D = mod.gg %&gt;% filter(Parameter %in% paste("A[", 1:13, "]", sep = "")), family = "A", thick_ci = c(0.125, 0.875), thin_ci = c(0.025, 0.975), sort = FALSE) + theme_bw() + theme(axis.text = element_text(color = "black")) + ylab("Population") + xlab("Ricker a") + scale_y_discrete(labels = rev(popshort), limits = rev)</span></span>
<span id="cb118-1246"><a href="#cb118-1246" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1247"><a href="#cb118-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1248"><a href="#cb118-1248" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb118-1249"><a href="#cb118-1249" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Dot Plots/ReddCounts_Ricker_CovarModel_DotPlot_RickerA.jpg", units = "in", width = 5, height = 5, res = 1500)</span></span>
<span id="cb118-1250"><a href="#cb118-1250" aria-hidden="true" tabindex="-1"></a><span class="in">ggs_caterpillar(D = mod.gg %&gt;% filter(Parameter %in% paste("A[", 1:13, "]", sep = "")), family = "A", thick_ci = c(0.125, 0.875), thin_ci = c(0.025, 0.975), sort = FALSE) + theme_bw() + theme(axis.text = element_text(color = "black")) + ylab("Population") + xlab("Ricker a") + scale_y_discrete(labels = rev(popshort), limits = rev)</span></span>
<span id="cb118-1251"><a href="#cb118-1251" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-1252"><a href="#cb118-1252" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1253"><a href="#cb118-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1254"><a href="#cb118-1254" aria-hidden="true" tabindex="-1"></a><span class="fu">#### River b</span></span>
<span id="cb118-1255"><a href="#cb118-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1256"><a href="#cb118-1256" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=4, fig.height=5}</span></span>
<span id="cb118-1257"><a href="#cb118-1257" aria-hidden="true" tabindex="-1"></a><span class="in">ggs_caterpillar(D = mod.gg %&gt;% filter(Parameter %in% paste("B[", 1:13, "]", sep = "")), family = "B", thick_ci = c(0.125, 0.875), thin_ci = c(0.025, 0.975), sort = FALSE) + theme_bw() + theme(axis.text = element_text(color = "black")) + ylab("Population") + xlab("Ricker b") + scale_y_discrete(labels = rev(popshort), limits = rev)</span></span>
<span id="cb118-1258"><a href="#cb118-1258" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1259"><a href="#cb118-1259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1260"><a href="#cb118-1260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1261"><a href="#cb118-1261" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb118-1262"><a href="#cb118-1262" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Dot Plots/ReddCounts_Ricker_CovarModel_DotPlot_RickerB.jpg", units = "in", width = 4, height = 5, res = 1500)</span></span>
<span id="cb118-1263"><a href="#cb118-1263" aria-hidden="true" tabindex="-1"></a><span class="in">ggs_caterpillar(D = mod.gg %&gt;% filter(Parameter %in% paste("B[", 1:13, "]", sep = "")), family = "B", thick_ci = c(0.125, 0.875), thin_ci = c(0.025, 0.975), sort = FALSE) + theme_bw() + theme(axis.text = element_text(color = "black")) + ylab("Population") + xlab("Ricker b") + scale_y_discrete(labels = rev(popshort), limits = rev)</span></span>
<span id="cb118-1264"><a href="#cb118-1264" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-1265"><a href="#cb118-1265" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1266"><a href="#cb118-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1267"><a href="#cb118-1267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1268"><a href="#cb118-1268" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Observation error</span></span>
<span id="cb118-1269"><a href="#cb118-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1270"><a href="#cb118-1270" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=5, fig.height=3}</span></span>
<span id="cb118-1271"><a href="#cb118-1271" aria-hidden="true" tabindex="-1"></a><span class="in">ggs_caterpillar(D = mod.gg, family = "sigma.oe", thick_ci = c(0.125, 0.875), thin_ci = c(0.025, 0.975), sort = FALSE) + </span></span>
<span id="cb118-1272"><a href="#cb118-1272" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() + theme(axis.text = element_text(color = "black")) + ylab("") + xlab("Observation error") + scale_y_discrete(labels = "Global")</span></span>
<span id="cb118-1273"><a href="#cb118-1273" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1274"><a href="#cb118-1274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1275"><a href="#cb118-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1276"><a href="#cb118-1276" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb118-1277"><a href="#cb118-1277" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Dot Plots/ReddCounts_Ricker_CovarModel_DotPlot_ObservationError.jpg", units = "in", width = 5, height = 3, res = 1500)</span></span>
<span id="cb118-1278"><a href="#cb118-1278" aria-hidden="true" tabindex="-1"></a><span class="in">ggs_caterpillar(D = mod.gg, family = "sigma.oe", thick_ci = c(0.125, 0.875), thin_ci = c(0.025, 0.975), sort = FALSE) + </span></span>
<span id="cb118-1279"><a href="#cb118-1279" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() + theme(axis.text = element_text(color = "black")) + ylab("") + xlab("Observation error") + scale_y_discrete(labels = "Global")</span></span>
<span id="cb118-1280"><a href="#cb118-1280" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-1281"><a href="#cb118-1281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1282"><a href="#cb118-1282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1283"><a href="#cb118-1283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1284"><a href="#cb118-1284" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Process error</span></span>
<span id="cb118-1285"><a href="#cb118-1285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1286"><a href="#cb118-1286" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=4, fig.height=5}</span></span>
<span id="cb118-1287"><a href="#cb118-1287" aria-hidden="true" tabindex="-1"></a><span class="in">ggs_caterpillar(D = mod.gg, family = "sigma.pe", thick_ci = c(0.125, 0.875), thin_ci = c(0.025, 0.975), sort = FALSE) + </span></span>
<span id="cb118-1288"><a href="#cb118-1288" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() + theme(axis.text = element_text(color = "black")) + ylab("Population") + xlab("Process error") + scale_y_discrete(labels = rev(popshort), limits = rev)</span></span>
<span id="cb118-1289"><a href="#cb118-1289" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1290"><a href="#cb118-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1291"><a href="#cb118-1291" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb118-1292"><a href="#cb118-1292" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Dot Plots/ReddCounts_Ricker_CovarModel_DotPlot_ProcessError.jpg", units = "in", width = 4, height = 5, res = 1500)</span></span>
<span id="cb118-1293"><a href="#cb118-1293" aria-hidden="true" tabindex="-1"></a><span class="in">ggs_caterpillar(D = mod.gg, family = "sigma.pe", thick_ci = c(0.125, 0.875), thin_ci = c(0.025, 0.975), sort = FALSE) + </span></span>
<span id="cb118-1294"><a href="#cb118-1294" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() + theme(axis.text = element_text(color = "black")) + ylab("Population") + xlab("Process error") + scale_y_discrete(labels = rev(popshort), limits = rev)</span></span>
<span id="cb118-1295"><a href="#cb118-1295" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-1296"><a href="#cb118-1296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1297"><a href="#cb118-1297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1298"><a href="#cb118-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1299"><a href="#cb118-1299" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Carrying capacity</span></span>
<span id="cb118-1300"><a href="#cb118-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1301"><a href="#cb118-1301" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=4, fig.height=5}</span></span>
<span id="cb118-1302"><a href="#cb118-1302" aria-hidden="true" tabindex="-1"></a><span class="in">ggs_caterpillar(D = mod.gg, family = "K", thick_ci = c(0.125, 0.875), thin_ci = c(0.025, 0.975), sort = FALSE) + </span></span>
<span id="cb118-1303"><a href="#cb118-1303" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() + theme(axis.text = element_text(color = "black")) + ylab("Population") + xlab("Carrying capacity (redds / km)") + scale_y_discrete(labels = rev(popshort), limits = rev)</span></span>
<span id="cb118-1304"><a href="#cb118-1304" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1305"><a href="#cb118-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1306"><a href="#cb118-1306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1307"><a href="#cb118-1307" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb118-1308"><a href="#cb118-1308" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Dot Plots/ReddCounts_Ricker_CovarModel_DotPlot_CarryingCapacity.jpg", units = "in", width = 5, height = 5, res = 1500)</span></span>
<span id="cb118-1309"><a href="#cb118-1309" aria-hidden="true" tabindex="-1"></a><span class="in">ggs_caterpillar(D = mod.gg, family = "K", thick_ci = c(0.125, 0.875), thin_ci = c(0.025, 0.975), sort = FALSE) + </span></span>
<span id="cb118-1310"><a href="#cb118-1310" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() + theme(axis.text = element_text(color = "black")) + ylab("Population") + xlab("Carrying capacity (redds / km)") + scale_y_discrete(labels = rev(popshort), limits = rev)</span></span>
<span id="cb118-1311"><a href="#cb118-1311" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-1312"><a href="#cb118-1312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1313"><a href="#cb118-1313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1314"><a href="#cb118-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1315"><a href="#cb118-1315" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Phi - autocorrelated residuls</span></span>
<span id="cb118-1316"><a href="#cb118-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1317"><a href="#cb118-1317" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=4, fig.height=5}</span></span>
<span id="cb118-1318"><a href="#cb118-1318" aria-hidden="true" tabindex="-1"></a><span class="in">ggs_caterpillar(D = mod.gg, family = "phi", thick_ci = c(0.125, 0.875), thin_ci = c(0.025, 0.975), sort = FALSE) + </span></span>
<span id="cb118-1319"><a href="#cb118-1319" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() + theme(axis.text = element_text(color = "black")) + ylab("Population") + xlab("AR1") + scale_y_discrete(labels = rev(popshort), limits = rev) + geom_vline(xintercept = 0, linetype = "dashed") </span></span>
<span id="cb118-1320"><a href="#cb118-1320" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1321"><a href="#cb118-1321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1322"><a href="#cb118-1322" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include = FALSE}</span></span>
<span id="cb118-1323"><a href="#cb118-1323" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Dot Plots/ReddCounts_Ricker_CovarModel_DotPlot_AutoCorrResid.jpg", units = "in", width = 4, height = 5, res = 1500)</span></span>
<span id="cb118-1324"><a href="#cb118-1324" aria-hidden="true" tabindex="-1"></a><span class="in">ggs_caterpillar(D = mod.gg, family = "phi", thick_ci = c(0.125, 0.875), thin_ci = c(0.025, 0.975), sort = FALSE) + </span></span>
<span id="cb118-1325"><a href="#cb118-1325" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() + theme(axis.text = element_text(color = "black")) + ylab("Population") + xlab("AR1") + scale_y_discrete(labels = rev(popshort), limits = rev) + geom_vline(xintercept = 0, linetype = "dashed") </span></span>
<span id="cb118-1326"><a href="#cb118-1326" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-1327"><a href="#cb118-1327" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1328"><a href="#cb118-1328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1329"><a href="#cb118-1329" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Sigma a</span></span>
<span id="cb118-1330"><a href="#cb118-1330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1333"><a href="#cb118-1333" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-1334"><a href="#cb118-1334" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(<span class="at">D =</span> mod.gg, <span class="at">family =</span> <span class="st">"sigma.A"</span>, <span class="at">thick_ci =</span> <span class="fu">c</span>(<span class="fl">0.125</span>, <span class="fl">0.875</span>), <span class="at">thin_ci =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb118-1335"><a href="#cb118-1335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) </span>
<span id="cb118-1336"><a href="#cb118-1336" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1337"><a href="#cb118-1337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1338"><a href="#cb118-1338" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb118-1339"><a href="#cb118-1339" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Dot Plots/ReddCounts_Ricker_CovarModel_DotPlot_SigmaA.jpg", units = "in", width = 5, height = 5, res = 1500)</span></span>
<span id="cb118-1340"><a href="#cb118-1340" aria-hidden="true" tabindex="-1"></a><span class="in">ggs_caterpillar(D = mod.gg, family = "sigma.A", thick_ci = c(0.125, 0.875), thin_ci = c(0.025, 0.975), sort = FALSE) + </span></span>
<span id="cb118-1341"><a href="#cb118-1341" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw() + theme(axis.text = element_text(color = "black")) + ylab("") + xlab("") + geom_vline(xintercept = 0, linetype = "dashed") </span></span>
<span id="cb118-1342"><a href="#cb118-1342" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-1343"><a href="#cb118-1343" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1344"><a href="#cb118-1344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1345"><a href="#cb118-1345" aria-hidden="true" tabindex="-1"></a><span class="fu">### Marginal effects</span></span>
<span id="cb118-1346"><a href="#cb118-1346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1347"><a href="#cb118-1347" aria-hidden="true" tabindex="-1"></a>Load in covariate mean/SD summaries, to transform axes to real scale</span>
<span id="cb118-1350"><a href="#cb118-1350" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-1351"><a href="#cb118-1351" aria-hidden="true" tabindex="-1"></a>covsrc_jldq_summary <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Derived/ManagedFlow_SummaryMeanSD_1967-2022.csv"</span>)</span>
<span id="cb118-1352"><a href="#cb118-1352" aria-hidden="true" tabindex="-1"></a>covsrc_natq_summary <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Derived/NaturalFlow_SummaryMeanSD_1975-2022.csv"</span>)</span>
<span id="cb118-1353"><a href="#cb118-1353" aria-hidden="true" tabindex="-1"></a>covsrc_expq_summary <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Derived/ExperiencedFlow_SummaryMeanSD_1975-2022.csv"</span>)</span>
<span id="cb118-1354"><a href="#cb118-1354" aria-hidden="true" tabindex="-1"></a>covsrc_temp_summary <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Derived/Temperature_SummaryMeanSD_1967-2022.csv"</span>)</span>
<span id="cb118-1355"><a href="#cb118-1355" aria-hidden="true" tabindex="-1"></a>covsummary <span class="ot">&lt;-</span> <span class="fu">rbind</span>(covsrc_jldq_summary[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">6</span><span class="sc">:</span><span class="dv">9</span>),], covsrc_natq_summary[<span class="fu">c</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>),], covsrc_temp_summary)</span>
<span id="cb118-1356"><a href="#cb118-1356" aria-hidden="true" tabindex="-1"></a>covsummary</span>
<span id="cb118-1357"><a href="#cb118-1357" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1358"><a href="#cb118-1358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1359"><a href="#cb118-1359" aria-hidden="true" tabindex="-1"></a>Values for prediction and color palettes</span>
<span id="cb118-1362"><a href="#cb118-1362" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-1363"><a href="#cb118-1363" aria-hidden="true" tabindex="-1"></a>nvalues <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb118-1364"><a href="#cb118-1364" aria-hidden="true" tabindex="-1"></a>colPal <span class="ot">&lt;-</span> <span class="fu">hcl.colors</span>(<span class="fu">length</span>(pops), <span class="st">"Spectral"</span>)</span>
<span id="cb118-1365"><a href="#cb118-1365" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1366"><a href="#cb118-1366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1367"><a href="#cb118-1367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1368"><a href="#cb118-1368" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb118-1369"><a href="#cb118-1369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1370"><a href="#cb118-1370" aria-hidden="true" tabindex="-1"></a><span class="fu">#### JLD ramp duration</span></span>
<span id="cb118-1371"><a href="#cb118-1371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1372"><a href="#cb118-1372" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=4.25, fig.height=4.4}</span></span>
<span id="cb118-1373"><a href="#cb118-1373" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,2.5,0.5), mgp = c(2.25,0.8,0))</span></span>
<span id="cb118-1374"><a href="#cb118-1374" aria-hidden="true" tabindex="-1"></a><span class="in"># set up plot</span></span>
<span id="cb118-1375"><a href="#cb118-1375" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- seq(from = min(dat$z_jld_rampdur), to = max(dat$z_jld_rampdur), length.out = nvalues)</span></span>
<span id="cb118-1376"><a href="#cb118-1376" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0.3, to = 2, length.out = nvalues) ~ x1, pch = NA, bty = "l", xlab = "Duration of ramp down (days)", ylab = "Productivity, ln(R/S)", axes = F)</span></span>
<span id="cb118-1377"><a href="#cb118-1377" aria-hidden="true" tabindex="-1"></a><span class="in"># axes and box</span></span>
<span id="cb118-1378"><a href="#cb118-1378" aria-hidden="true" tabindex="-1"></a><span class="in"># range(dat$jld_rampdur)</span></span>
<span id="cb118-1379"><a href="#cb118-1379" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis &lt;- seq(from = 5, to = 30, by = 5)</span></span>
<span id="cb118-1380"><a href="#cb118-1380" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis.scaled &lt;- (x.axis - covsummary$mean[1]) / covsummary$sd[1]</span></span>
<span id="cb118-1381"><a href="#cb118-1381" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, at = x.axis.scaled, labels = x.axis)</span></span>
<span id="cb118-1382"><a href="#cb118-1382" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2)</span></span>
<span id="cb118-1383"><a href="#cb118-1383" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions</span></span>
<span id="cb118-1384"><a href="#cb118-1384" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-1385"><a href="#cb118-1385" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[1]"]*x1 }</span></span>
<span id="cb118-1386"><a href="#cb118-1386" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-1387"><a href="#cb118-1387" aria-hidden="true" tabindex="-1"></a><span class="in">pred_025 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.025)</span></span>
<span id="cb118-1388"><a href="#cb118-1388" aria-hidden="true" tabindex="-1"></a><span class="in">pred_125 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.125)</span></span>
<span id="cb118-1389"><a href="#cb118-1389" aria-hidden="true" tabindex="-1"></a><span class="in">pred_875 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.875)</span></span>
<span id="cb118-1390"><a href="#cb118-1390" aria-hidden="true" tabindex="-1"></a><span class="in">pred_975 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.975)</span></span>
<span id="cb118-1391"><a href="#cb118-1391" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_975, rev(pred_025)), col = "grey85", lty=0)</span></span>
<span id="cb118-1392"><a href="#cb118-1392" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_875, rev(pred_125)), col = "grey70", lty=0)</span></span>
<span id="cb118-1393"><a href="#cb118-1393" aria-hidden="true" tabindex="-1"></a><span class="in"># add population-specific fits</span></span>
<span id="cb118-1394"><a href="#cb118-1394" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",1]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb118-1395"><a href="#cb118-1395" aria-hidden="true" tabindex="-1"></a><span class="in"># add global fit</span></span>
<span id="cb118-1396"><a href="#cb118-1396" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, col = "black", lwd = 3, type = "l")</span></span>
<span id="cb118-1397"><a href="#cb118-1397" aria-hidden="true" tabindex="-1"></a><span class="in"># median productivity</span></span>
<span id="cb118-1398"><a href="#cb118-1398" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = param.summary["mu.A",5], lty = 3, col = "grey40")</span></span>
<span id="cb118-1399"><a href="#cb118-1399" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 0, lty = 3, col = "grey40")</span></span>
<span id="cb118-1400"><a href="#cb118-1400" aria-hidden="true" tabindex="-1"></a><span class="in">text(x = 0, y = 0.3, labels = "10", pos = 4, col = "grey40")</span></span>
<span id="cb118-1401"><a href="#cb118-1401" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb118-1402"><a href="#cb118-1402" aria-hidden="true" tabindex="-1"></a><span class="in"># legend</span></span>
<span id="cb118-1403"><a href="#cb118-1403" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE, usr = c(0,1,0,1))</span></span>
<span id="cb118-1404"><a href="#cb118-1404" aria-hidden="true" tabindex="-1"></a><span class="in"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb118-1405"><a href="#cb118-1405" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o", lwd = 3, col = mycols2[1])</span></span>
<span id="cb118-1406"><a href="#cb118-1406" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1407"><a href="#cb118-1407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1408"><a href="#cb118-1408" aria-hidden="true" tabindex="-1"></a><span class="fu">#### JLD ramp timing</span></span>
<span id="cb118-1409"><a href="#cb118-1409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1410"><a href="#cb118-1410" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=4.25, fig.height=4.4}</span></span>
<span id="cb118-1411"><a href="#cb118-1411" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,2.5,0.5), mgp = c(2.25,0.8,0))</span></span>
<span id="cb118-1412"><a href="#cb118-1412" aria-hidden="true" tabindex="-1"></a><span class="in"># set up plot</span></span>
<span id="cb118-1413"><a href="#cb118-1413" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- seq(from = min(dat$z_jld_rampratemindoy), to = max(dat$z_jld_rampratemindoy), length.out = nvalues)</span></span>
<span id="cb118-1414"><a href="#cb118-1414" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0.3, to = 2, length.out = nvalues) ~ x1, pch = NA, bty = "l", xlab = "Timing of ramp down", ylab = "Productivity, ln(R/S)", axes = F)</span></span>
<span id="cb118-1415"><a href="#cb118-1415" aria-hidden="true" tabindex="-1"></a><span class="in"># axes and box</span></span>
<span id="cb118-1416"><a href="#cb118-1416" aria-hidden="true" tabindex="-1"></a><span class="in"># range(dat$jld_rampratemindoy)</span></span>
<span id="cb118-1417"><a href="#cb118-1417" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis &lt;- c(254,264,274)</span></span>
<span id="cb118-1418"><a href="#cb118-1418" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis.scaled &lt;- (x.axis - covsummary$mean[2]) / covsummary$sd[2]</span></span>
<span id="cb118-1419"><a href="#cb118-1419" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, at = x.axis.scaled, labels = c("10 Sept", "20 Sept", "30 Sept"))</span></span>
<span id="cb118-1420"><a href="#cb118-1420" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2)</span></span>
<span id="cb118-1421"><a href="#cb118-1421" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions</span></span>
<span id="cb118-1422"><a href="#cb118-1422" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-1423"><a href="#cb118-1423" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[2]"]*x1 }</span></span>
<span id="cb118-1424"><a href="#cb118-1424" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-1425"><a href="#cb118-1425" aria-hidden="true" tabindex="-1"></a><span class="in">pred_025 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.025)</span></span>
<span id="cb118-1426"><a href="#cb118-1426" aria-hidden="true" tabindex="-1"></a><span class="in">pred_125 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.125)</span></span>
<span id="cb118-1427"><a href="#cb118-1427" aria-hidden="true" tabindex="-1"></a><span class="in">pred_875 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.875)</span></span>
<span id="cb118-1428"><a href="#cb118-1428" aria-hidden="true" tabindex="-1"></a><span class="in">pred_975 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.975)</span></span>
<span id="cb118-1429"><a href="#cb118-1429" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_975, rev(pred_025)), col = "grey85", lty=0)</span></span>
<span id="cb118-1430"><a href="#cb118-1430" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_875, rev(pred_125)), col = "grey70", lty=0)</span></span>
<span id="cb118-1431"><a href="#cb118-1431" aria-hidden="true" tabindex="-1"></a><span class="in"># add population-specific fits</span></span>
<span id="cb118-1432"><a href="#cb118-1432" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",2]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb118-1433"><a href="#cb118-1433" aria-hidden="true" tabindex="-1"></a><span class="in"># add global fit</span></span>
<span id="cb118-1434"><a href="#cb118-1434" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, col = "black", lwd = 3, type = "l")</span></span>
<span id="cb118-1435"><a href="#cb118-1435" aria-hidden="true" tabindex="-1"></a><span class="in"># median productivity</span></span>
<span id="cb118-1436"><a href="#cb118-1436" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = param.summary["mu.A",5], lty = 3, col = "grey40")</span></span>
<span id="cb118-1437"><a href="#cb118-1437" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 0, lty = 3, col = "grey40")</span></span>
<span id="cb118-1438"><a href="#cb118-1438" aria-hidden="true" tabindex="-1"></a><span class="in">text(x = 0, y = 0.3, labels = "26 Sept", pos = 4, col = "grey40")</span></span>
<span id="cb118-1439"><a href="#cb118-1439" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb118-1440"><a href="#cb118-1440" aria-hidden="true" tabindex="-1"></a><span class="in"># legend</span></span>
<span id="cb118-1441"><a href="#cb118-1441" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE, usr = c(0,1,0,1))</span></span>
<span id="cb118-1442"><a href="#cb118-1442" aria-hidden="true" tabindex="-1"></a><span class="in"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb118-1443"><a href="#cb118-1443" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o", lwd = 3, col = mycols2[2])</span></span>
<span id="cb118-1444"><a href="#cb118-1444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1445"><a href="#cb118-1445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1446"><a href="#cb118-1446" aria-hidden="true" tabindex="-1"></a><span class="fu">#### JLD winter variation</span></span>
<span id="cb118-1447"><a href="#cb118-1447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1448"><a href="#cb118-1448" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=4.25, fig.height=4.4}</span></span>
<span id="cb118-1449"><a href="#cb118-1449" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,2.5,0.5), mgp = c(2.25,0.8,0))</span></span>
<span id="cb118-1450"><a href="#cb118-1450" aria-hidden="true" tabindex="-1"></a><span class="in"># set up plot</span></span>
<span id="cb118-1451"><a href="#cb118-1451" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- seq(from = min(dat$z_jld_winvar, na.rm = TRUE), to = max(dat$z_jld_winvar, na.rm = TRUE), length.out = nvalues)</span></span>
<span id="cb118-1452"><a href="#cb118-1452" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0.3, to = 2, length.out = nvalues) ~ x1, pch = NA, bty = "l", xlab = "Mgd. winter flow variation", ylab = "Productivity, ln(R/S)", axes = F)</span></span>
<span id="cb118-1453"><a href="#cb118-1453" aria-hidden="true" tabindex="-1"></a><span class="in"># axes and box</span></span>
<span id="cb118-1454"><a href="#cb118-1454" aria-hidden="true" tabindex="-1"></a><span class="in"># range(dat$jld_winvar, na.rm = T)</span></span>
<span id="cb118-1455"><a href="#cb118-1455" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis &lt;- seq(from = 0, to = 0.3, by = 0.05)</span></span>
<span id="cb118-1456"><a href="#cb118-1456" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis.scaled &lt;- (x.axis - covsummary$mean[3]) / covsummary$sd[3]</span></span>
<span id="cb118-1457"><a href="#cb118-1457" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, at = x.axis.scaled, labels = c("0.00", "0.05", "0.10", "0.15", "0.20", "0.25", "0.30"))</span></span>
<span id="cb118-1458"><a href="#cb118-1458" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2)</span></span>
<span id="cb118-1459"><a href="#cb118-1459" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions</span></span>
<span id="cb118-1460"><a href="#cb118-1460" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-1461"><a href="#cb118-1461" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[3]"]*x1 }</span></span>
<span id="cb118-1462"><a href="#cb118-1462" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-1463"><a href="#cb118-1463" aria-hidden="true" tabindex="-1"></a><span class="in">pred_025 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.025)</span></span>
<span id="cb118-1464"><a href="#cb118-1464" aria-hidden="true" tabindex="-1"></a><span class="in">pred_125 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.225)</span></span>
<span id="cb118-1465"><a href="#cb118-1465" aria-hidden="true" tabindex="-1"></a><span class="in">pred_875 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.875)</span></span>
<span id="cb118-1466"><a href="#cb118-1466" aria-hidden="true" tabindex="-1"></a><span class="in">pred_975 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.975)</span></span>
<span id="cb118-1467"><a href="#cb118-1467" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_975, rev(pred_025)), col = "grey85", lty=0)</span></span>
<span id="cb118-1468"><a href="#cb118-1468" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_875, rev(pred_125)), col = "grey70", lty=0)</span></span>
<span id="cb118-1469"><a href="#cb118-1469" aria-hidden="true" tabindex="-1"></a><span class="in"># add population-specific fits</span></span>
<span id="cb118-1470"><a href="#cb118-1470" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",3]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb118-1471"><a href="#cb118-1471" aria-hidden="true" tabindex="-1"></a><span class="in"># add global fit</span></span>
<span id="cb118-1472"><a href="#cb118-1472" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, col = "black", lwd = 3, type = "l")</span></span>
<span id="cb118-1473"><a href="#cb118-1473" aria-hidden="true" tabindex="-1"></a><span class="in"># median productivity</span></span>
<span id="cb118-1474"><a href="#cb118-1474" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = param.summary["mu.A",5], lty = 3, col = "grey40")</span></span>
<span id="cb118-1475"><a href="#cb118-1475" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 0, lty = 3, col = "grey40")</span></span>
<span id="cb118-1476"><a href="#cb118-1476" aria-hidden="true" tabindex="-1"></a><span class="in">text(x = 0, y = 0.3, labels = "0.043", pos = 4, col = "grey40")</span></span>
<span id="cb118-1477"><a href="#cb118-1477" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb118-1478"><a href="#cb118-1478" aria-hidden="true" tabindex="-1"></a><span class="in"># legend</span></span>
<span id="cb118-1479"><a href="#cb118-1479" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE, usr = c(0,1,0,1))</span></span>
<span id="cb118-1480"><a href="#cb118-1480" aria-hidden="true" tabindex="-1"></a><span class="in"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb118-1481"><a href="#cb118-1481" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o", lwd = 3, col = mycols2[3])</span></span>
<span id="cb118-1482"><a href="#cb118-1482" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1483"><a href="#cb118-1483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1484"><a href="#cb118-1484" aria-hidden="true" tabindex="-1"></a><span class="fu">#### JLD summer flow</span></span>
<span id="cb118-1485"><a href="#cb118-1485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1486"><a href="#cb118-1486" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=4.25, fig.height=4.4}</span></span>
<span id="cb118-1487"><a href="#cb118-1487" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,2.5,0.5), mgp = c(2.25,0.8,0))</span></span>
<span id="cb118-1488"><a href="#cb118-1488" aria-hidden="true" tabindex="-1"></a><span class="in"># set up plot</span></span>
<span id="cb118-1489"><a href="#cb118-1489" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- seq(from = min(dat$z_jld_summean, na.rm = TRUE), to = max(dat$z_jld_summean, na.rm = TRUE), length.out = nvalues)</span></span>
<span id="cb118-1490"><a href="#cb118-1490" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0.3, to = 2, length.out = nvalues) ~ x1, pch = NA, bty = "l", xlab = "Mgd. summer mean flow (cfs)", ylab = "Productivity, ln(R/S)", axes = F)</span></span>
<span id="cb118-1491"><a href="#cb118-1491" aria-hidden="true" tabindex="-1"></a><span class="in"># axes and box</span></span>
<span id="cb118-1492"><a href="#cb118-1492" aria-hidden="true" tabindex="-1"></a><span class="in"># range(dat$jld_summean, na.rm = T)</span></span>
<span id="cb118-1493"><a href="#cb118-1493" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis &lt;- seq(from = 1500, to = 4500, by = 1000)</span></span>
<span id="cb118-1494"><a href="#cb118-1494" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis.scaled &lt;- (x.axis - covsummary$mean[4]) / covsummary$sd[4]</span></span>
<span id="cb118-1495"><a href="#cb118-1495" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, at = x.axis.scaled, labels = x.axis)</span></span>
<span id="cb118-1496"><a href="#cb118-1496" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2)</span></span>
<span id="cb118-1497"><a href="#cb118-1497" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions</span></span>
<span id="cb118-1498"><a href="#cb118-1498" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-1499"><a href="#cb118-1499" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[4]"]*x1 }</span></span>
<span id="cb118-1500"><a href="#cb118-1500" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-1501"><a href="#cb118-1501" aria-hidden="true" tabindex="-1"></a><span class="in">pred_025 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.025)</span></span>
<span id="cb118-1502"><a href="#cb118-1502" aria-hidden="true" tabindex="-1"></a><span class="in">pred_125 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.125)</span></span>
<span id="cb118-1503"><a href="#cb118-1503" aria-hidden="true" tabindex="-1"></a><span class="in">pred_875 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.875)</span></span>
<span id="cb118-1504"><a href="#cb118-1504" aria-hidden="true" tabindex="-1"></a><span class="in">pred_975 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.975)</span></span>
<span id="cb118-1505"><a href="#cb118-1505" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_975, rev(pred_025)), col = "grey85", lty=0)</span></span>
<span id="cb118-1506"><a href="#cb118-1506" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_875, rev(pred_125)), col = "grey70", lty=0)</span></span>
<span id="cb118-1507"><a href="#cb118-1507" aria-hidden="true" tabindex="-1"></a><span class="in"># add population-specific fits</span></span>
<span id="cb118-1508"><a href="#cb118-1508" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",4]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb118-1509"><a href="#cb118-1509" aria-hidden="true" tabindex="-1"></a><span class="in"># add global fit</span></span>
<span id="cb118-1510"><a href="#cb118-1510" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, col = "black", lwd = 3, type = "l")</span></span>
<span id="cb118-1511"><a href="#cb118-1511" aria-hidden="true" tabindex="-1"></a><span class="in"># median productivity</span></span>
<span id="cb118-1512"><a href="#cb118-1512" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = param.summary["mu.A",5], lty = 3, col = "grey40")</span></span>
<span id="cb118-1513"><a href="#cb118-1513" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 0, lty = 3, col = "grey40")</span></span>
<span id="cb118-1514"><a href="#cb118-1514" aria-hidden="true" tabindex="-1"></a><span class="in">text(x = 0, y = 0.3, labels = "2700", pos = 4, col = "grey40")</span></span>
<span id="cb118-1515"><a href="#cb118-1515" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb118-1516"><a href="#cb118-1516" aria-hidden="true" tabindex="-1"></a><span class="in"># legend</span></span>
<span id="cb118-1517"><a href="#cb118-1517" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE, usr = c(0,1,0,1))</span></span>
<span id="cb118-1518"><a href="#cb118-1518" aria-hidden="true" tabindex="-1"></a><span class="in"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb118-1519"><a href="#cb118-1519" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o", lwd = 3, col = mycols2[4])</span></span>
<span id="cb118-1520"><a href="#cb118-1520" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1521"><a href="#cb118-1521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1522"><a href="#cb118-1522" aria-hidden="true" tabindex="-1"></a><span class="fu">#### JLD peak flow mag.</span></span>
<span id="cb118-1523"><a href="#cb118-1523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1524"><a href="#cb118-1524" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=4.25, fig.height=4.4}</span></span>
<span id="cb118-1525"><a href="#cb118-1525" aria-hidden="true" tabindex="-1"></a><span class="in"># JLD Peak flow magnitude</span></span>
<span id="cb118-1526"><a href="#cb118-1526" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,2.5,0.5), mgp = c(2.25,0.8,0))</span></span>
<span id="cb118-1527"><a href="#cb118-1527" aria-hidden="true" tabindex="-1"></a><span class="in"># set up plot</span></span>
<span id="cb118-1528"><a href="#cb118-1528" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- seq(from = min(dat$z_jld_peakmag, na.rm = TRUE), to = max(dat$z_jld_peakmag, na.rm = TRUE), length.out = nvalues)</span></span>
<span id="cb118-1529"><a href="#cb118-1529" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0.3, to = 2, length.out = nvalues) ~ x1, pch = NA, bty = "l", xlab = "Mgd. peak flow magnitude (cfs)", ylab = "Productivity, ln(R/S)", axes = F)</span></span>
<span id="cb118-1530"><a href="#cb118-1530" aria-hidden="true" tabindex="-1"></a><span class="in"># axes and box</span></span>
<span id="cb118-1531"><a href="#cb118-1531" aria-hidden="true" tabindex="-1"></a><span class="in"># range(dat$jld_peakmag, na.rm = T)</span></span>
<span id="cb118-1532"><a href="#cb118-1532" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis &lt;- seq(from = 4000, to = 12000, by = 2000)</span></span>
<span id="cb118-1533"><a href="#cb118-1533" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis.scaled &lt;- (x.axis - covsummary$mean[5]) / covsummary$sd[5]</span></span>
<span id="cb118-1534"><a href="#cb118-1534" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, at = x.axis.scaled, labels = round((x.axis), digits = 0))</span></span>
<span id="cb118-1535"><a href="#cb118-1535" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2)</span></span>
<span id="cb118-1536"><a href="#cb118-1536" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions</span></span>
<span id="cb118-1537"><a href="#cb118-1537" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-1538"><a href="#cb118-1538" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[5]"]*x1 }</span></span>
<span id="cb118-1539"><a href="#cb118-1539" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-1540"><a href="#cb118-1540" aria-hidden="true" tabindex="-1"></a><span class="in">pred_025 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.025)</span></span>
<span id="cb118-1541"><a href="#cb118-1541" aria-hidden="true" tabindex="-1"></a><span class="in">pred_125 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.125)</span></span>
<span id="cb118-1542"><a href="#cb118-1542" aria-hidden="true" tabindex="-1"></a><span class="in">pred_875 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.875)</span></span>
<span id="cb118-1543"><a href="#cb118-1543" aria-hidden="true" tabindex="-1"></a><span class="in">pred_975 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.975)</span></span>
<span id="cb118-1544"><a href="#cb118-1544" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_975, rev(pred_025)), col = "grey85", lty=0)</span></span>
<span id="cb118-1545"><a href="#cb118-1545" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_875, rev(pred_125)), col = "grey70", lty=0)</span></span>
<span id="cb118-1546"><a href="#cb118-1546" aria-hidden="true" tabindex="-1"></a><span class="in"># add population-specific fits</span></span>
<span id="cb118-1547"><a href="#cb118-1547" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",5]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb118-1548"><a href="#cb118-1548" aria-hidden="true" tabindex="-1"></a><span class="in"># add global fit</span></span>
<span id="cb118-1549"><a href="#cb118-1549" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, col = "black", lwd = 3, type = "l")</span></span>
<span id="cb118-1550"><a href="#cb118-1550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1551"><a href="#cb118-1551" aria-hidden="true" tabindex="-1"></a><span class="in"># interaction with natural peak magnitude</span></span>
<span id="cb118-1552"><a href="#cb118-1552" aria-hidden="true" tabindex="-1"></a><span class="in">## minimum</span></span>
<span id="cb118-1553"><a href="#cb118-1553" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-1554"><a href="#cb118-1554" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[5]"]*x1 + Mcmcdat[j,"mu.coef[7]"]*min(dat$z_natq_peakmag, na.rm = T) + Mcmcdat[j,"mu.coef[13]"]*x1*min(dat$z_natq_peakmag, na.rm = T) }</span></span>
<span id="cb118-1555"><a href="#cb118-1555" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-1556"><a href="#cb118-1556" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, lty = 3, lwd = 2, type = "l")</span></span>
<span id="cb118-1557"><a href="#cb118-1557" aria-hidden="true" tabindex="-1"></a><span class="in">## maximum</span></span>
<span id="cb118-1558"><a href="#cb118-1558" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-1559"><a href="#cb118-1559" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[5]"]*x1 + Mcmcdat[j,"mu.coef[7]"]*max(dat$z_natq_peakmag, na.rm = T) + Mcmcdat[j,"mu.coef[13]"]*x1*max(dat$z_natq_peakmag, na.rm = T) }</span></span>
<span id="cb118-1560"><a href="#cb118-1560" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-1561"><a href="#cb118-1561" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, lty = 2, lwd = 2, type = "l")</span></span>
<span id="cb118-1562"><a href="#cb118-1562" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", legend = c("Min. nat. peak flow", "Max. nat. peak flow"), lwd = 2, lty = c(3,2), bty = "n", cex = 0.75)</span></span>
<span id="cb118-1563"><a href="#cb118-1563" aria-hidden="true" tabindex="-1"></a><span class="in"># median productivity</span></span>
<span id="cb118-1564"><a href="#cb118-1564" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = param.summary["mu.A",5], lty = 3, col = "grey40")</span></span>
<span id="cb118-1565"><a href="#cb118-1565" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 0, lty = 3, col = "grey40")</span></span>
<span id="cb118-1566"><a href="#cb118-1566" aria-hidden="true" tabindex="-1"></a><span class="in">text(x = 0, y = 0.3, labels = "5884", pos = 4, col = "grey40")</span></span>
<span id="cb118-1567"><a href="#cb118-1567" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb118-1568"><a href="#cb118-1568" aria-hidden="true" tabindex="-1"></a><span class="in"># legend</span></span>
<span id="cb118-1569"><a href="#cb118-1569" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE, usr = c(0,1,0,1))</span></span>
<span id="cb118-1570"><a href="#cb118-1570" aria-hidden="true" tabindex="-1"></a><span class="in"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb118-1571"><a href="#cb118-1571" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o", lwd = 3, col = mycols2[5])</span></span>
<span id="cb118-1572"><a href="#cb118-1572" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1573"><a href="#cb118-1573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1574"><a href="#cb118-1574" aria-hidden="true" tabindex="-1"></a><span class="fu">#### JLD peak flow timing</span></span>
<span id="cb118-1575"><a href="#cb118-1575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1576"><a href="#cb118-1576" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=4.25, fig.height=4.4}</span></span>
<span id="cb118-1577"><a href="#cb118-1577" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,2.5,0.5), mgp = c(2.25,0.8,0))</span></span>
<span id="cb118-1578"><a href="#cb118-1578" aria-hidden="true" tabindex="-1"></a><span class="in"># set up plot</span></span>
<span id="cb118-1579"><a href="#cb118-1579" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- seq(from = min(dat$z_jld_peaktime, na.rm = TRUE), to = max(dat$z_jld_peaktime, na.rm = TRUE), length.out = nvalues)</span></span>
<span id="cb118-1580"><a href="#cb118-1580" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0.3, to = 2, length.out = nvalues) ~ x1, pch = NA, bty = "l", xlab = "Mgd. peak flow timing", ylab = "Productivity, ln(R/S)", axes = F)</span></span>
<span id="cb118-1581"><a href="#cb118-1581" aria-hidden="true" tabindex="-1"></a><span class="in"># axes and box</span></span>
<span id="cb118-1582"><a href="#cb118-1582" aria-hidden="true" tabindex="-1"></a><span class="in"># range(dat$jld_peaktime, na.rm = T)</span></span>
<span id="cb118-1583"><a href="#cb118-1583" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis &lt;- c(242, 273, 303)</span></span>
<span id="cb118-1584"><a href="#cb118-1584" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis.scaled &lt;- (x.axis - covsummary$mean[6]) / covsummary$sd[6]</span></span>
<span id="cb118-1585"><a href="#cb118-1585" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, at = x.axis.scaled, labels = c("1 May", "1 June", "1 July"))</span></span>
<span id="cb118-1586"><a href="#cb118-1586" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2)</span></span>
<span id="cb118-1587"><a href="#cb118-1587" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions</span></span>
<span id="cb118-1588"><a href="#cb118-1588" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-1589"><a href="#cb118-1589" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[6]"]*x1 }</span></span>
<span id="cb118-1590"><a href="#cb118-1590" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-1591"><a href="#cb118-1591" aria-hidden="true" tabindex="-1"></a><span class="in">pred_025 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.025)</span></span>
<span id="cb118-1592"><a href="#cb118-1592" aria-hidden="true" tabindex="-1"></a><span class="in">pred_125 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.125)</span></span>
<span id="cb118-1593"><a href="#cb118-1593" aria-hidden="true" tabindex="-1"></a><span class="in">pred_875 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.875)</span></span>
<span id="cb118-1594"><a href="#cb118-1594" aria-hidden="true" tabindex="-1"></a><span class="in">pred_975 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.975)</span></span>
<span id="cb118-1595"><a href="#cb118-1595" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_975, rev(pred_025)), col = "grey85", lty=0)</span></span>
<span id="cb118-1596"><a href="#cb118-1596" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_875, rev(pred_125)), col = "grey70", lty=0)</span></span>
<span id="cb118-1597"><a href="#cb118-1597" aria-hidden="true" tabindex="-1"></a><span class="in"># add population-specific fits</span></span>
<span id="cb118-1598"><a href="#cb118-1598" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",6]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb118-1599"><a href="#cb118-1599" aria-hidden="true" tabindex="-1"></a><span class="in"># add global fit</span></span>
<span id="cb118-1600"><a href="#cb118-1600" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, col = "black", lwd = 3, type = "l")</span></span>
<span id="cb118-1601"><a href="#cb118-1601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1602"><a href="#cb118-1602" aria-hidden="true" tabindex="-1"></a><span class="in"># interaction with natural peak magnitude</span></span>
<span id="cb118-1603"><a href="#cb118-1603" aria-hidden="true" tabindex="-1"></a><span class="in">## minimum</span></span>
<span id="cb118-1604"><a href="#cb118-1604" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-1605"><a href="#cb118-1605" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[6]"]*x1 + Mcmcdat[j,"mu.coef[8]"]*min(dat$z_natq_peaktime, na.rm = T) + Mcmcdat[j,"mu.coef[14]"]*x1*min(dat$z_natq_peaktime, na.rm = T) }</span></span>
<span id="cb118-1606"><a href="#cb118-1606" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-1607"><a href="#cb118-1607" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, lty = 3, lwd = 2, type = "l")</span></span>
<span id="cb118-1608"><a href="#cb118-1608" aria-hidden="true" tabindex="-1"></a><span class="in">## maximum</span></span>
<span id="cb118-1609"><a href="#cb118-1609" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-1610"><a href="#cb118-1610" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[6]"]*x1 + Mcmcdat[j,"mu.coef[8]"]*max(dat$z_natq_peaktime, na.rm = T) + Mcmcdat[j,"mu.coef[14]"]*x1*max(dat$z_natq_peaktime, na.rm = T) }</span></span>
<span id="cb118-1611"><a href="#cb118-1611" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-1612"><a href="#cb118-1612" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, lty = 2, lwd = 2, type = "l")</span></span>
<span id="cb118-1613"><a href="#cb118-1613" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topleft", legend = c("Min. nat. peak time", "Max. nat. peak time"), lwd = 2, lty = c(3,2), bty = "n", cex = 0.75)</span></span>
<span id="cb118-1614"><a href="#cb118-1614" aria-hidden="true" tabindex="-1"></a><span class="in"># median productivity</span></span>
<span id="cb118-1615"><a href="#cb118-1615" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = param.summary["mu.A",5], lty = 3, col = "grey40")</span></span>
<span id="cb118-1616"><a href="#cb118-1616" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 0, lty = 3, col = "grey40")</span></span>
<span id="cb118-1617"><a href="#cb118-1617" aria-hidden="true" tabindex="-1"></a><span class="in">text(x = 0, y = 0.3, labels = "14 June", pos = 4, col = "grey40")</span></span>
<span id="cb118-1618"><a href="#cb118-1618" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb118-1619"><a href="#cb118-1619" aria-hidden="true" tabindex="-1"></a><span class="in"># legend</span></span>
<span id="cb118-1620"><a href="#cb118-1620" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE, usr = c(0,1,0,1))</span></span>
<span id="cb118-1621"><a href="#cb118-1621" aria-hidden="true" tabindex="-1"></a><span class="in"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb118-1622"><a href="#cb118-1622" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o", lwd = 3, col = mycols2[6])</span></span>
<span id="cb118-1623"><a href="#cb118-1623" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1624"><a href="#cb118-1624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1625"><a href="#cb118-1625" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Nat peak flow mag.</span></span>
<span id="cb118-1626"><a href="#cb118-1626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1627"><a href="#cb118-1627" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=4.25, fig.height=4.4}</span></span>
<span id="cb118-1628"><a href="#cb118-1628" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,2.5,0.5), mgp = c(2.25,0.8,0))</span></span>
<span id="cb118-1629"><a href="#cb118-1629" aria-hidden="true" tabindex="-1"></a><span class="in"># set up plot</span></span>
<span id="cb118-1630"><a href="#cb118-1630" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- seq(from = min(dat$z_natq_peakmag, na.rm = TRUE), to = max(dat$z_natq_peakmag, na.rm = TRUE), length.out = nvalues)</span></span>
<span id="cb118-1631"><a href="#cb118-1631" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0.3, to = 2, length.out = nvalues) ~ x1, pch = NA, bty = "l", xlab = "Natural peak flow magnitude (cfs)", ylab = "Productivity, ln(R/S)", axes = F)</span></span>
<span id="cb118-1632"><a href="#cb118-1632" aria-hidden="true" tabindex="-1"></a><span class="in"># axes and box</span></span>
<span id="cb118-1633"><a href="#cb118-1633" aria-hidden="true" tabindex="-1"></a><span class="in"># range(dat$natq_peakmag, na.rm = T)</span></span>
<span id="cb118-1634"><a href="#cb118-1634" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis &lt;- seq(from = 5000, to = 20000, by = 5000)</span></span>
<span id="cb118-1635"><a href="#cb118-1635" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis.scaled &lt;- (x.axis - covsummary$mean[7]) / covsummary$sd[7]</span></span>
<span id="cb118-1636"><a href="#cb118-1636" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, at = x.axis.scaled, labels = round((x.axis), digits = 0))</span></span>
<span id="cb118-1637"><a href="#cb118-1637" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2)</span></span>
<span id="cb118-1638"><a href="#cb118-1638" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions</span></span>
<span id="cb118-1639"><a href="#cb118-1639" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-1640"><a href="#cb118-1640" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[7]"]*x1 }</span></span>
<span id="cb118-1641"><a href="#cb118-1641" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-1642"><a href="#cb118-1642" aria-hidden="true" tabindex="-1"></a><span class="in">pred_025 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.025)</span></span>
<span id="cb118-1643"><a href="#cb118-1643" aria-hidden="true" tabindex="-1"></a><span class="in">pred_125 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.125)</span></span>
<span id="cb118-1644"><a href="#cb118-1644" aria-hidden="true" tabindex="-1"></a><span class="in">pred_875 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.875)</span></span>
<span id="cb118-1645"><a href="#cb118-1645" aria-hidden="true" tabindex="-1"></a><span class="in">pred_975 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.975)</span></span>
<span id="cb118-1646"><a href="#cb118-1646" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_975, rev(pred_025)), col = "grey85", lty=0)</span></span>
<span id="cb118-1647"><a href="#cb118-1647" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_875, rev(pred_125)), col = "grey70", lty=0)</span></span>
<span id="cb118-1648"><a href="#cb118-1648" aria-hidden="true" tabindex="-1"></a><span class="in"># add population-specific fits</span></span>
<span id="cb118-1649"><a href="#cb118-1649" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",7]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb118-1650"><a href="#cb118-1650" aria-hidden="true" tabindex="-1"></a><span class="in"># add global fit</span></span>
<span id="cb118-1651"><a href="#cb118-1651" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, col = "black", lwd = 3, type = "l")</span></span>
<span id="cb118-1652"><a href="#cb118-1652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1653"><a href="#cb118-1653" aria-hidden="true" tabindex="-1"></a><span class="in"># interaction with natural peak magnitude</span></span>
<span id="cb118-1654"><a href="#cb118-1654" aria-hidden="true" tabindex="-1"></a><span class="in">## minimum</span></span>
<span id="cb118-1655"><a href="#cb118-1655" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-1656"><a href="#cb118-1656" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[7]"]*x1 + Mcmcdat[j,"mu.coef[5]"]*min(dat$z_jld_peakmag, na.rm = T) + Mcmcdat[j,"mu.coef[13]"]*x1*min(dat$z_jld_peakmag, na.rm = T) }</span></span>
<span id="cb118-1657"><a href="#cb118-1657" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-1658"><a href="#cb118-1658" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, lty = 3, lwd = 2, type = "l")</span></span>
<span id="cb118-1659"><a href="#cb118-1659" aria-hidden="true" tabindex="-1"></a><span class="in">## maximum</span></span>
<span id="cb118-1660"><a href="#cb118-1660" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-1661"><a href="#cb118-1661" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[7]"]*x1 + Mcmcdat[j,"mu.coef[5]"]*max(dat$z_jld_peakmag, na.rm = T) + Mcmcdat[j,"mu.coef[13]"]*x1*max(dat$z_jld_peakmag, na.rm = T) }</span></span>
<span id="cb118-1662"><a href="#cb118-1662" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-1663"><a href="#cb118-1663" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, lty = 2, lwd = 2, type = "l")</span></span>
<span id="cb118-1664"><a href="#cb118-1664" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", legend = c("Min. JLD peak flow", "Max. JLD peak flow"), lwd = 2, lty = c(3,2), bty = "n", cex = 0.75)</span></span>
<span id="cb118-1665"><a href="#cb118-1665" aria-hidden="true" tabindex="-1"></a><span class="in"># median productivity</span></span>
<span id="cb118-1666"><a href="#cb118-1666" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = param.summary["mu.A",5], lty = 3, col = "grey40")</span></span>
<span id="cb118-1667"><a href="#cb118-1667" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 0, lty = 3, col = "grey40")</span></span>
<span id="cb118-1668"><a href="#cb118-1668" aria-hidden="true" tabindex="-1"></a><span class="in">text(x = 0, y = 0.3, labels = "10948", pos = 4, col = "grey40")</span></span>
<span id="cb118-1669"><a href="#cb118-1669" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb118-1670"><a href="#cb118-1670" aria-hidden="true" tabindex="-1"></a><span class="in"># legend</span></span>
<span id="cb118-1671"><a href="#cb118-1671" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE, usr = c(0,1,0,1))</span></span>
<span id="cb118-1672"><a href="#cb118-1672" aria-hidden="true" tabindex="-1"></a><span class="in"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb118-1673"><a href="#cb118-1673" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o", lwd = 3, col = mycols2[7])</span></span>
<span id="cb118-1674"><a href="#cb118-1674" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1675"><a href="#cb118-1675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1676"><a href="#cb118-1676" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Nat peak flow timing</span></span>
<span id="cb118-1677"><a href="#cb118-1677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1678"><a href="#cb118-1678" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=4.25, fig.height=4.4}</span></span>
<span id="cb118-1679"><a href="#cb118-1679" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,2.5,0.5), mgp = c(2.25,0.8,0))</span></span>
<span id="cb118-1680"><a href="#cb118-1680" aria-hidden="true" tabindex="-1"></a><span class="in"># set up plot</span></span>
<span id="cb118-1681"><a href="#cb118-1681" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- seq(from = min(dat$z_natq_peaktime, na.rm = TRUE), to = max(dat$z_natq_peaktime, na.rm = TRUE), length.out = nvalues)</span></span>
<span id="cb118-1682"><a href="#cb118-1682" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0.3, to = 2, length.out = nvalues) ~ x1, pch = NA, bty = "l", xlab = "Natural peak flow timing", ylab = "Productivity, ln(R/S)", axes = F)</span></span>
<span id="cb118-1683"><a href="#cb118-1683" aria-hidden="true" tabindex="-1"></a><span class="in"># axes and box</span></span>
<span id="cb118-1684"><a href="#cb118-1684" aria-hidden="true" tabindex="-1"></a><span class="in"># range(dat$natq_peaktime, na.rm = T)</span></span>
<span id="cb118-1685"><a href="#cb118-1685" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis &lt;- c(256, 273, 287, 303)</span></span>
<span id="cb118-1686"><a href="#cb118-1686" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis.scaled &lt;- (x.axis - covsummary$mean[8]) / covsummary$sd[8]</span></span>
<span id="cb118-1687"><a href="#cb118-1687" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, at = x.axis.scaled, labels = c("15 May", "1 June", "15 June", "1 July"))</span></span>
<span id="cb118-1688"><a href="#cb118-1688" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2)</span></span>
<span id="cb118-1689"><a href="#cb118-1689" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions</span></span>
<span id="cb118-1690"><a href="#cb118-1690" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-1691"><a href="#cb118-1691" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[8]"]*x1 }</span></span>
<span id="cb118-1692"><a href="#cb118-1692" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-1693"><a href="#cb118-1693" aria-hidden="true" tabindex="-1"></a><span class="in">pred_025 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.025)</span></span>
<span id="cb118-1694"><a href="#cb118-1694" aria-hidden="true" tabindex="-1"></a><span class="in">pred_125 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.125)</span></span>
<span id="cb118-1695"><a href="#cb118-1695" aria-hidden="true" tabindex="-1"></a><span class="in">pred_875 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.875)</span></span>
<span id="cb118-1696"><a href="#cb118-1696" aria-hidden="true" tabindex="-1"></a><span class="in">pred_975 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.975)</span></span>
<span id="cb118-1697"><a href="#cb118-1697" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_975, rev(pred_025)), col = "grey85", lty=0)</span></span>
<span id="cb118-1698"><a href="#cb118-1698" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_875, rev(pred_125)), col = "grey70", lty=0)</span></span>
<span id="cb118-1699"><a href="#cb118-1699" aria-hidden="true" tabindex="-1"></a><span class="in"># add population-specific fits</span></span>
<span id="cb118-1700"><a href="#cb118-1700" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",8]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb118-1701"><a href="#cb118-1701" aria-hidden="true" tabindex="-1"></a><span class="in"># add global fit</span></span>
<span id="cb118-1702"><a href="#cb118-1702" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, col = "black", lwd = 3, type = "l")</span></span>
<span id="cb118-1703"><a href="#cb118-1703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1704"><a href="#cb118-1704" aria-hidden="true" tabindex="-1"></a><span class="in"># interaction with natural peak timing</span></span>
<span id="cb118-1705"><a href="#cb118-1705" aria-hidden="true" tabindex="-1"></a><span class="in">## minimum</span></span>
<span id="cb118-1706"><a href="#cb118-1706" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-1707"><a href="#cb118-1707" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[8]"]*x1 + Mcmcdat[j,"mu.coef[6]"]*min(dat$z_jld_peaktime, na.rm = T) + Mcmcdat[j,"mu.coef[14]"]*x1*min(dat$z_jld_peaktime, na.rm = T) }</span></span>
<span id="cb118-1708"><a href="#cb118-1708" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-1709"><a href="#cb118-1709" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, lty = 3, lwd = 2, type = "l")</span></span>
<span id="cb118-1710"><a href="#cb118-1710" aria-hidden="true" tabindex="-1"></a><span class="in">## maximum</span></span>
<span id="cb118-1711"><a href="#cb118-1711" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-1712"><a href="#cb118-1712" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[8]"]*x1 + Mcmcdat[j,"mu.coef[6]"]*max(dat$z_jld_peaktime, na.rm = T) + Mcmcdat[j,"mu.coef[14]"]*x1*max(dat$z_jld_peaktime, na.rm = T) }</span></span>
<span id="cb118-1713"><a href="#cb118-1713" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-1714"><a href="#cb118-1714" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, lty = 2, lwd = 2, type = "l")</span></span>
<span id="cb118-1715"><a href="#cb118-1715" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", legend = c("Min. JLD peak time", "Max. JLD peak time"), lwd = 2, lty = c(3,2), bty = "n", cex = 0.75)</span></span>
<span id="cb118-1716"><a href="#cb118-1716" aria-hidden="true" tabindex="-1"></a><span class="in"># median productivity</span></span>
<span id="cb118-1717"><a href="#cb118-1717" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = param.summary["mu.A",5], lty = 3, col = "grey40")</span></span>
<span id="cb118-1718"><a href="#cb118-1718" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 0, lty = 3, col = "grey40")</span></span>
<span id="cb118-1719"><a href="#cb118-1719" aria-hidden="true" tabindex="-1"></a><span class="in">text(x = 0, y = 0.3, labels = "5 June", pos = 4, col = "grey40")</span></span>
<span id="cb118-1720"><a href="#cb118-1720" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb118-1721"><a href="#cb118-1721" aria-hidden="true" tabindex="-1"></a><span class="in"># legend</span></span>
<span id="cb118-1722"><a href="#cb118-1722" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE, usr = c(0,1,0,1))</span></span>
<span id="cb118-1723"><a href="#cb118-1723" aria-hidden="true" tabindex="-1"></a><span class="in"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb118-1724"><a href="#cb118-1724" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o", lwd = 3, col = mycols2[8])</span></span>
<span id="cb118-1725"><a href="#cb118-1725" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1726"><a href="#cb118-1726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1727"><a href="#cb118-1727" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Autumn temperature</span></span>
<span id="cb118-1728"><a href="#cb118-1728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1729"><a href="#cb118-1729" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=4.25, fig.height=4.4}</span></span>
<span id="cb118-1730"><a href="#cb118-1730" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,2.5,0.5), mgp = c(2.25,0.8,0))</span></span>
<span id="cb118-1731"><a href="#cb118-1731" aria-hidden="true" tabindex="-1"></a><span class="in"># set up plot</span></span>
<span id="cb118-1732"><a href="#cb118-1732" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- seq(from = min(dat$z_temp_falmean, na.rm = TRUE), to = max(dat$z_temp_falmean, na.rm = TRUE), length.out = nvalues)</span></span>
<span id="cb118-1733"><a href="#cb118-1733" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0.3, to = 2, length.out = nvalues) ~ x1, pch = NA, bty = "l", xlab = expression(paste("Autumn temperature ("^"o", "C)", sep = "")), ylab = "Productivity, ln(R/S)", axes = F)</span></span>
<span id="cb118-1734"><a href="#cb118-1734" aria-hidden="true" tabindex="-1"></a><span class="in"># axes and box</span></span>
<span id="cb118-1735"><a href="#cb118-1735" aria-hidden="true" tabindex="-1"></a><span class="in"># range(dat$temp_falmean, na.rm = T)</span></span>
<span id="cb118-1736"><a href="#cb118-1736" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis &lt;- seq(from = 2, to = 6, by = 1)</span></span>
<span id="cb118-1737"><a href="#cb118-1737" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis.scaled &lt;- (x.axis - covsummary$mean[9]) / covsummary$sd[9]</span></span>
<span id="cb118-1738"><a href="#cb118-1738" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, at = x.axis.scaled, labels = x.axis)</span></span>
<span id="cb118-1739"><a href="#cb118-1739" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2)</span></span>
<span id="cb118-1740"><a href="#cb118-1740" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions</span></span>
<span id="cb118-1741"><a href="#cb118-1741" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-1742"><a href="#cb118-1742" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[9]"]*x1 }</span></span>
<span id="cb118-1743"><a href="#cb118-1743" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-1744"><a href="#cb118-1744" aria-hidden="true" tabindex="-1"></a><span class="in">pred_025 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.05)</span></span>
<span id="cb118-1745"><a href="#cb118-1745" aria-hidden="true" tabindex="-1"></a><span class="in">pred_125 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.125)</span></span>
<span id="cb118-1746"><a href="#cb118-1746" aria-hidden="true" tabindex="-1"></a><span class="in">pred_875 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.875)</span></span>
<span id="cb118-1747"><a href="#cb118-1747" aria-hidden="true" tabindex="-1"></a><span class="in">pred_975 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.975)</span></span>
<span id="cb118-1748"><a href="#cb118-1748" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_975, rev(pred_025)), col = "grey85", lty=0)</span></span>
<span id="cb118-1749"><a href="#cb118-1749" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_875, rev(pred_125)), col = "grey70", lty=0)</span></span>
<span id="cb118-1750"><a href="#cb118-1750" aria-hidden="true" tabindex="-1"></a><span class="in"># add population-specific fits</span></span>
<span id="cb118-1751"><a href="#cb118-1751" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",9]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb118-1752"><a href="#cb118-1752" aria-hidden="true" tabindex="-1"></a><span class="in"># add global fit</span></span>
<span id="cb118-1753"><a href="#cb118-1753" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, col = "black", lwd = 3, type = "l")</span></span>
<span id="cb118-1754"><a href="#cb118-1754" aria-hidden="true" tabindex="-1"></a><span class="in"># median productivity</span></span>
<span id="cb118-1755"><a href="#cb118-1755" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = param.summary["mu.A",5], lty = 3, col = "grey40")</span></span>
<span id="cb118-1756"><a href="#cb118-1756" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 0, lty = 3, col = "grey40")</span></span>
<span id="cb118-1757"><a href="#cb118-1757" aria-hidden="true" tabindex="-1"></a><span class="in">text(x = 0, y = 0.3, labels = "4.05", pos = 4, col = "grey40")</span></span>
<span id="cb118-1758"><a href="#cb118-1758" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb118-1759"><a href="#cb118-1759" aria-hidden="true" tabindex="-1"></a><span class="in"># legend</span></span>
<span id="cb118-1760"><a href="#cb118-1760" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE, usr = c(0,1,0,1))</span></span>
<span id="cb118-1761"><a href="#cb118-1761" aria-hidden="true" tabindex="-1"></a><span class="in"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb118-1762"><a href="#cb118-1762" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o", lwd = 3, col = mycols2[9])</span></span>
<span id="cb118-1763"><a href="#cb118-1763" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1764"><a href="#cb118-1764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1765"><a href="#cb118-1765" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Winter temperature</span></span>
<span id="cb118-1766"><a href="#cb118-1766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1767"><a href="#cb118-1767" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=4.25, fig.height=4.4}</span></span>
<span id="cb118-1768"><a href="#cb118-1768" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,2.5,0.5), mgp = c(2.25,0.8,0))</span></span>
<span id="cb118-1769"><a href="#cb118-1769" aria-hidden="true" tabindex="-1"></a><span class="in"># set up plot</span></span>
<span id="cb118-1770"><a href="#cb118-1770" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- seq(from = min(dat$z_temp_winmean, na.rm = TRUE), to = max(dat$z_temp_winmean, na.rm = TRUE), length.out = nvalues)</span></span>
<span id="cb118-1771"><a href="#cb118-1771" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0.3, to = 2, length.out = nvalues) ~ x1, pch = NA, bty = "l", xlab = expression(paste("Winter temperature ("^"o", "C)", sep = "")), ylab = "Productivity, ln(R/S)", axes = F)</span></span>
<span id="cb118-1772"><a href="#cb118-1772" aria-hidden="true" tabindex="-1"></a><span class="in"># axes and box</span></span>
<span id="cb118-1773"><a href="#cb118-1773" aria-hidden="true" tabindex="-1"></a><span class="in"># range(dat$temp_winmean, na.rm = T)</span></span>
<span id="cb118-1774"><a href="#cb118-1774" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis &lt;- seq(from = -13, to = 5, by = 2)</span></span>
<span id="cb118-1775"><a href="#cb118-1775" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis.scaled &lt;- (x.axis - covsummary$mean[10]) / covsummary$sd[10]</span></span>
<span id="cb118-1776"><a href="#cb118-1776" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, at = x.axis.scaled, labels = x.axis)</span></span>
<span id="cb118-1777"><a href="#cb118-1777" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2)</span></span>
<span id="cb118-1778"><a href="#cb118-1778" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions</span></span>
<span id="cb118-1779"><a href="#cb118-1779" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-1780"><a href="#cb118-1780" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[10]"]*x1 }</span></span>
<span id="cb118-1781"><a href="#cb118-1781" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-1782"><a href="#cb118-1782" aria-hidden="true" tabindex="-1"></a><span class="in">pred_025 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.025)</span></span>
<span id="cb118-1783"><a href="#cb118-1783" aria-hidden="true" tabindex="-1"></a><span class="in">pred_125 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.125)</span></span>
<span id="cb118-1784"><a href="#cb118-1784" aria-hidden="true" tabindex="-1"></a><span class="in">pred_875 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.875)</span></span>
<span id="cb118-1785"><a href="#cb118-1785" aria-hidden="true" tabindex="-1"></a><span class="in">pred_975 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.925)</span></span>
<span id="cb118-1786"><a href="#cb118-1786" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_975, rev(pred_025)), col = "grey85", lty=0)</span></span>
<span id="cb118-1787"><a href="#cb118-1787" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_875, rev(pred_125)), col = "grey70", lty=0)</span></span>
<span id="cb118-1788"><a href="#cb118-1788" aria-hidden="true" tabindex="-1"></a><span class="in"># add population-specific fits</span></span>
<span id="cb118-1789"><a href="#cb118-1789" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",10]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb118-1790"><a href="#cb118-1790" aria-hidden="true" tabindex="-1"></a><span class="in"># add global fit</span></span>
<span id="cb118-1791"><a href="#cb118-1791" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, col = "black", lwd = 3, type = "l")</span></span>
<span id="cb118-1792"><a href="#cb118-1792" aria-hidden="true" tabindex="-1"></a><span class="in"># median productivity</span></span>
<span id="cb118-1793"><a href="#cb118-1793" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = param.summary["mu.A",5], lty = 3, col = "grey40")</span></span>
<span id="cb118-1794"><a href="#cb118-1794" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 0, lty = 3, col = "grey40")</span></span>
<span id="cb118-1795"><a href="#cb118-1795" aria-hidden="true" tabindex="-1"></a><span class="in">text(x = 0, y = 0.3, labels = "-9.29", pos = 4, col = "grey40")</span></span>
<span id="cb118-1796"><a href="#cb118-1796" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb118-1797"><a href="#cb118-1797" aria-hidden="true" tabindex="-1"></a><span class="in"># legend</span></span>
<span id="cb118-1798"><a href="#cb118-1798" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE, usr = c(0,1,0,1))</span></span>
<span id="cb118-1799"><a href="#cb118-1799" aria-hidden="true" tabindex="-1"></a><span class="in"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb118-1800"><a href="#cb118-1800" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o", lwd = 3, col = mycols2[10])</span></span>
<span id="cb118-1801"><a href="#cb118-1801" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1802"><a href="#cb118-1802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1803"><a href="#cb118-1803" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Spring temperature</span></span>
<span id="cb118-1804"><a href="#cb118-1804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1805"><a href="#cb118-1805" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=4.25, fig.height=4.4}</span></span>
<span id="cb118-1806"><a href="#cb118-1806" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,2.5,0.5), mgp = c(2.25,0.8,0))</span></span>
<span id="cb118-1807"><a href="#cb118-1807" aria-hidden="true" tabindex="-1"></a><span class="in"># set up plot</span></span>
<span id="cb118-1808"><a href="#cb118-1808" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- seq(from = min(dat$z_temp_sprmean, na.rm = TRUE), to = max(dat$z_temp_sprmean, na.rm = TRUE), length.out = nvalues)</span></span>
<span id="cb118-1809"><a href="#cb118-1809" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0.3, to = 2, length.out = nvalues) ~ x1, pch = NA, bty = "l", xlab = expression(paste("Spring temperature ("^"o", "C)", sep = "")), ylab = "Productivity, ln(R/S)", axes = F)</span></span>
<span id="cb118-1810"><a href="#cb118-1810" aria-hidden="true" tabindex="-1"></a><span class="in"># axes and box</span></span>
<span id="cb118-1811"><a href="#cb118-1811" aria-hidden="true" tabindex="-1"></a><span class="in"># range(dat$temp_sprmean, na.rm = T)</span></span>
<span id="cb118-1812"><a href="#cb118-1812" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis &lt;- seq(from = 0, to = 5, by = 1)</span></span>
<span id="cb118-1813"><a href="#cb118-1813" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis.scaled &lt;- (x.axis - covsummary$mean[11]) / covsummary$sd[11]</span></span>
<span id="cb118-1814"><a href="#cb118-1814" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, at = x.axis.scaled, labels = x.axis)</span></span>
<span id="cb118-1815"><a href="#cb118-1815" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2)</span></span>
<span id="cb118-1816"><a href="#cb118-1816" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions</span></span>
<span id="cb118-1817"><a href="#cb118-1817" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-1818"><a href="#cb118-1818" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[11]"]*x1 }</span></span>
<span id="cb118-1819"><a href="#cb118-1819" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-1820"><a href="#cb118-1820" aria-hidden="true" tabindex="-1"></a><span class="in">pred_025 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.025)</span></span>
<span id="cb118-1821"><a href="#cb118-1821" aria-hidden="true" tabindex="-1"></a><span class="in">pred_125 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.125)</span></span>
<span id="cb118-1822"><a href="#cb118-1822" aria-hidden="true" tabindex="-1"></a><span class="in">pred_875 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.875)</span></span>
<span id="cb118-1823"><a href="#cb118-1823" aria-hidden="true" tabindex="-1"></a><span class="in">pred_975 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.975)</span></span>
<span id="cb118-1824"><a href="#cb118-1824" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_975, rev(pred_025)), col = "grey85", lty=0)</span></span>
<span id="cb118-1825"><a href="#cb118-1825" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_875, rev(pred_125)), col = "grey70", lty=0)</span></span>
<span id="cb118-1826"><a href="#cb118-1826" aria-hidden="true" tabindex="-1"></a><span class="in"># add population-specific fits</span></span>
<span id="cb118-1827"><a href="#cb118-1827" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",11]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb118-1828"><a href="#cb118-1828" aria-hidden="true" tabindex="-1"></a><span class="in"># add global fit</span></span>
<span id="cb118-1829"><a href="#cb118-1829" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, col = "black", lwd = 3, type = "l")</span></span>
<span id="cb118-1830"><a href="#cb118-1830" aria-hidden="true" tabindex="-1"></a><span class="in"># median productivity</span></span>
<span id="cb118-1831"><a href="#cb118-1831" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = param.summary["mu.A",5], lty = 3, col = "grey40")</span></span>
<span id="cb118-1832"><a href="#cb118-1832" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 0, lty = 3, col = "grey40")</span></span>
<span id="cb118-1833"><a href="#cb118-1833" aria-hidden="true" tabindex="-1"></a><span class="in">text(x = 0, y = 0.3, labels = "2.38", pos = 4, col = "grey40")</span></span>
<span id="cb118-1834"><a href="#cb118-1834" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb118-1835"><a href="#cb118-1835" aria-hidden="true" tabindex="-1"></a><span class="in"># legend</span></span>
<span id="cb118-1836"><a href="#cb118-1836" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE, usr = c(0,1,0,1))</span></span>
<span id="cb118-1837"><a href="#cb118-1837" aria-hidden="true" tabindex="-1"></a><span class="in"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb118-1838"><a href="#cb118-1838" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o", lwd = 3, col = mycols2[11])</span></span>
<span id="cb118-1839"><a href="#cb118-1839" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1840"><a href="#cb118-1840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1841"><a href="#cb118-1841" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Summer temperature</span></span>
<span id="cb118-1842"><a href="#cb118-1842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1843"><a href="#cb118-1843" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=4.25, fig.height=4.4}</span></span>
<span id="cb118-1844"><a href="#cb118-1844" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,2.5,0.5), mgp = c(2.25,0.8,0))</span></span>
<span id="cb118-1845"><a href="#cb118-1845" aria-hidden="true" tabindex="-1"></a><span class="in"># set up plot</span></span>
<span id="cb118-1846"><a href="#cb118-1846" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- seq(from = min(dat$z_temp_summean, na.rm = TRUE), to = max(dat$z_temp_summean, na.rm = TRUE), length.out = nvalues)</span></span>
<span id="cb118-1847"><a href="#cb118-1847" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0.3, to = 2, length.out = nvalues) ~ x1, pch = NA, bty = "l", xlab = expression(paste("Summer temperature ("^"o", "C)", sep = "")), ylab = "Productivity, ln(R/S)", axes = F)</span></span>
<span id="cb118-1848"><a href="#cb118-1848" aria-hidden="true" tabindex="-1"></a><span class="in"># axes and box</span></span>
<span id="cb118-1849"><a href="#cb118-1849" aria-hidden="true" tabindex="-1"></a><span class="in"># range(dat$temp_summean, na.rm = T)</span></span>
<span id="cb118-1850"><a href="#cb118-1850" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis &lt;- seq(from = 12, to = 17, by = 1)</span></span>
<span id="cb118-1851"><a href="#cb118-1851" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis.scaled &lt;- (x.axis - covsummary$mean[12]) / covsummary$sd[12]</span></span>
<span id="cb118-1852"><a href="#cb118-1852" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, at = x.axis.scaled, labels = x.axis)</span></span>
<span id="cb118-1853"><a href="#cb118-1853" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2)</span></span>
<span id="cb118-1854"><a href="#cb118-1854" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions</span></span>
<span id="cb118-1855"><a href="#cb118-1855" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-1856"><a href="#cb118-1856" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[12]"]*x1 }</span></span>
<span id="cb118-1857"><a href="#cb118-1857" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-1858"><a href="#cb118-1858" aria-hidden="true" tabindex="-1"></a><span class="in">pred_025 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.025)</span></span>
<span id="cb118-1859"><a href="#cb118-1859" aria-hidden="true" tabindex="-1"></a><span class="in">pred_125 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.125)</span></span>
<span id="cb118-1860"><a href="#cb118-1860" aria-hidden="true" tabindex="-1"></a><span class="in">pred_875 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.875)</span></span>
<span id="cb118-1861"><a href="#cb118-1861" aria-hidden="true" tabindex="-1"></a><span class="in">pred_975 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.975)</span></span>
<span id="cb118-1862"><a href="#cb118-1862" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_975, rev(pred_025)), col = "grey85", lty=0)</span></span>
<span id="cb118-1863"><a href="#cb118-1863" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_875, rev(pred_125)), col = "grey70", lty=0)</span></span>
<span id="cb118-1864"><a href="#cb118-1864" aria-hidden="true" tabindex="-1"></a><span class="in"># add population-specific fits</span></span>
<span id="cb118-1865"><a href="#cb118-1865" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",12]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb118-1866"><a href="#cb118-1866" aria-hidden="true" tabindex="-1"></a><span class="in"># add global fit</span></span>
<span id="cb118-1867"><a href="#cb118-1867" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, col = "black", lwd = 3, type = "l")</span></span>
<span id="cb118-1868"><a href="#cb118-1868" aria-hidden="true" tabindex="-1"></a><span class="in"># median productivity</span></span>
<span id="cb118-1869"><a href="#cb118-1869" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = param.summary["mu.A",5], lty = 3, col = "grey40")</span></span>
<span id="cb118-1870"><a href="#cb118-1870" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 0, lty = 3, col = "grey40")</span></span>
<span id="cb118-1871"><a href="#cb118-1871" aria-hidden="true" tabindex="-1"></a><span class="in">text(x = 0, y = 0.3, labels = "14.81", pos = 4, col = "grey40")</span></span>
<span id="cb118-1872"><a href="#cb118-1872" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb118-1873"><a href="#cb118-1873" aria-hidden="true" tabindex="-1"></a><span class="in"># legend</span></span>
<span id="cb118-1874"><a href="#cb118-1874" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE, usr = c(0,1,0,1))</span></span>
<span id="cb118-1875"><a href="#cb118-1875" aria-hidden="true" tabindex="-1"></a><span class="in"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb118-1876"><a href="#cb118-1876" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o", lwd = 3, col = mycols2[12])</span></span>
<span id="cb118-1877"><a href="#cb118-1877" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1878"><a href="#cb118-1878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1879"><a href="#cb118-1879" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb118-1880"><a href="#cb118-1880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1881"><a href="#cb118-1881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1882"><a href="#cb118-1882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1883"><a href="#cb118-1883" aria-hidden="true" tabindex="-1"></a>Write plots to file...</span>
<span id="cb118-1884"><a href="#cb118-1884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1885"><a href="#cb118-1885" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb118-1886"><a href="#cb118-1886" aria-hidden="true" tabindex="-1"></a><span class="in"># JLD Ramp Duration</span></span>
<span id="cb118-1887"><a href="#cb118-1887" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Marginal Effects/ReddCounts_Ricker_CovarModel_MarginalEffects_1_z_jld_rampdur.jpg", units = "in", width = 4.25, height = 4.4, res = 1500)</span></span>
<span id="cb118-1888"><a href="#cb118-1888" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,2.5,0.5), mgp = c(2.25,0.8,0))</span></span>
<span id="cb118-1889"><a href="#cb118-1889" aria-hidden="true" tabindex="-1"></a><span class="in"># set up plot</span></span>
<span id="cb118-1890"><a href="#cb118-1890" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- seq(from = min(dat$z_jld_rampdur), to = max(dat$z_jld_rampdur), length.out = nvalues)</span></span>
<span id="cb118-1891"><a href="#cb118-1891" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0.3, to = 2, length.out = nvalues) ~ x1, pch = NA, bty = "l", xlab = "Duration of ramp down (days)", ylab = "Productivity, ln(R/S)", axes = F)</span></span>
<span id="cb118-1892"><a href="#cb118-1892" aria-hidden="true" tabindex="-1"></a><span class="in"># axes and box</span></span>
<span id="cb118-1893"><a href="#cb118-1893" aria-hidden="true" tabindex="-1"></a><span class="in"># range(dat$jld_rampdur)</span></span>
<span id="cb118-1894"><a href="#cb118-1894" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis &lt;- seq(from = 5, to = 30, by = 5)</span></span>
<span id="cb118-1895"><a href="#cb118-1895" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis.scaled &lt;- (x.axis - covsummary$mean[1]) / covsummary$sd[1]</span></span>
<span id="cb118-1896"><a href="#cb118-1896" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, at = x.axis.scaled, labels = x.axis)</span></span>
<span id="cb118-1897"><a href="#cb118-1897" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2)</span></span>
<span id="cb118-1898"><a href="#cb118-1898" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions</span></span>
<span id="cb118-1899"><a href="#cb118-1899" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-1900"><a href="#cb118-1900" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[1]"]*x1 }</span></span>
<span id="cb118-1901"><a href="#cb118-1901" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-1902"><a href="#cb118-1902" aria-hidden="true" tabindex="-1"></a><span class="in">pred_025 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.025)</span></span>
<span id="cb118-1903"><a href="#cb118-1903" aria-hidden="true" tabindex="-1"></a><span class="in">pred_125 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.125)</span></span>
<span id="cb118-1904"><a href="#cb118-1904" aria-hidden="true" tabindex="-1"></a><span class="in">pred_875 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.875)</span></span>
<span id="cb118-1905"><a href="#cb118-1905" aria-hidden="true" tabindex="-1"></a><span class="in">pred_975 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.975)</span></span>
<span id="cb118-1906"><a href="#cb118-1906" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_975, rev(pred_025)), col = "grey85", lty=0)</span></span>
<span id="cb118-1907"><a href="#cb118-1907" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_875, rev(pred_125)), col = "grey70", lty=0)</span></span>
<span id="cb118-1908"><a href="#cb118-1908" aria-hidden="true" tabindex="-1"></a><span class="in"># add population-specific fits</span></span>
<span id="cb118-1909"><a href="#cb118-1909" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",1]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb118-1910"><a href="#cb118-1910" aria-hidden="true" tabindex="-1"></a><span class="in"># add global fit</span></span>
<span id="cb118-1911"><a href="#cb118-1911" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, col = "black", lwd = 3, type = "l")</span></span>
<span id="cb118-1912"><a href="#cb118-1912" aria-hidden="true" tabindex="-1"></a><span class="in"># median productivity</span></span>
<span id="cb118-1913"><a href="#cb118-1913" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = param.summary["mu.A",5], lty = 3, col = "grey40")</span></span>
<span id="cb118-1914"><a href="#cb118-1914" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 0, lty = 3, col = "grey40")</span></span>
<span id="cb118-1915"><a href="#cb118-1915" aria-hidden="true" tabindex="-1"></a><span class="in">text(x = 0, y = 0.3, labels = "10", pos = 4, col = "grey40")</span></span>
<span id="cb118-1916"><a href="#cb118-1916" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb118-1917"><a href="#cb118-1917" aria-hidden="true" tabindex="-1"></a><span class="in"># legend</span></span>
<span id="cb118-1918"><a href="#cb118-1918" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE, usr = c(0,1,0,1))</span></span>
<span id="cb118-1919"><a href="#cb118-1919" aria-hidden="true" tabindex="-1"></a><span class="in"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb118-1920"><a href="#cb118-1920" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o", lwd = 3, col = mycols2[1])</span></span>
<span id="cb118-1921"><a href="#cb118-1921" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-1922"><a href="#cb118-1922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1923"><a href="#cb118-1923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1924"><a href="#cb118-1924" aria-hidden="true" tabindex="-1"></a><span class="in"># JLD Ramp Rate Min DOY</span></span>
<span id="cb118-1925"><a href="#cb118-1925" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Marginal Effects/ReddCounts_Ricker_CovarModel_MarginalEffects_2_z_jld_rampratemindoy.jpg", units = "in", width = 4.25, height = 4.4, res = 1500)</span></span>
<span id="cb118-1926"><a href="#cb118-1926" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,2.5,0.5), mgp = c(2.25,0.8,0))</span></span>
<span id="cb118-1927"><a href="#cb118-1927" aria-hidden="true" tabindex="-1"></a><span class="in"># set up plot</span></span>
<span id="cb118-1928"><a href="#cb118-1928" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- seq(from = min(dat$z_jld_rampratemindoy), to = max(dat$z_jld_rampratemindoy), length.out = nvalues)</span></span>
<span id="cb118-1929"><a href="#cb118-1929" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0.3, to = 2, length.out = nvalues) ~ x1, pch = NA, bty = "l", xlab = "Timing of ramp down", ylab = "Productivity, ln(R/S)", axes = F)</span></span>
<span id="cb118-1930"><a href="#cb118-1930" aria-hidden="true" tabindex="-1"></a><span class="in"># axes and box</span></span>
<span id="cb118-1931"><a href="#cb118-1931" aria-hidden="true" tabindex="-1"></a><span class="in"># range(dat$jld_rampratemindoy)</span></span>
<span id="cb118-1932"><a href="#cb118-1932" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis &lt;- c(254,264,274)</span></span>
<span id="cb118-1933"><a href="#cb118-1933" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis.scaled &lt;- (x.axis - covsummary$mean[2]) / covsummary$sd[2]</span></span>
<span id="cb118-1934"><a href="#cb118-1934" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, at = x.axis.scaled, labels = c("10 Sept", "20 Sept", "30 Sept"))</span></span>
<span id="cb118-1935"><a href="#cb118-1935" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2)</span></span>
<span id="cb118-1936"><a href="#cb118-1936" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions</span></span>
<span id="cb118-1937"><a href="#cb118-1937" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-1938"><a href="#cb118-1938" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[2]"]*x1 }</span></span>
<span id="cb118-1939"><a href="#cb118-1939" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-1940"><a href="#cb118-1940" aria-hidden="true" tabindex="-1"></a><span class="in">pred_025 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.025)</span></span>
<span id="cb118-1941"><a href="#cb118-1941" aria-hidden="true" tabindex="-1"></a><span class="in">pred_125 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.125)</span></span>
<span id="cb118-1942"><a href="#cb118-1942" aria-hidden="true" tabindex="-1"></a><span class="in">pred_875 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.875)</span></span>
<span id="cb118-1943"><a href="#cb118-1943" aria-hidden="true" tabindex="-1"></a><span class="in">pred_975 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.975)</span></span>
<span id="cb118-1944"><a href="#cb118-1944" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_975, rev(pred_025)), col = "grey85", lty=0)</span></span>
<span id="cb118-1945"><a href="#cb118-1945" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_875, rev(pred_125)), col = "grey70", lty=0)</span></span>
<span id="cb118-1946"><a href="#cb118-1946" aria-hidden="true" tabindex="-1"></a><span class="in"># add population-specific fits</span></span>
<span id="cb118-1947"><a href="#cb118-1947" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",2]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb118-1948"><a href="#cb118-1948" aria-hidden="true" tabindex="-1"></a><span class="in"># add global fit</span></span>
<span id="cb118-1949"><a href="#cb118-1949" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, col = "black", lwd = 3, type = "l")</span></span>
<span id="cb118-1950"><a href="#cb118-1950" aria-hidden="true" tabindex="-1"></a><span class="in"># median productivity</span></span>
<span id="cb118-1951"><a href="#cb118-1951" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = param.summary["mu.A",5], lty = 3, col = "grey40")</span></span>
<span id="cb118-1952"><a href="#cb118-1952" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 0, lty = 3, col = "grey40")</span></span>
<span id="cb118-1953"><a href="#cb118-1953" aria-hidden="true" tabindex="-1"></a><span class="in">text(x = 0, y = 0.3, labels = "26 Sept", pos = 4, col = "grey40")</span></span>
<span id="cb118-1954"><a href="#cb118-1954" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb118-1955"><a href="#cb118-1955" aria-hidden="true" tabindex="-1"></a><span class="in"># legend</span></span>
<span id="cb118-1956"><a href="#cb118-1956" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE, usr = c(0,1,0,1))</span></span>
<span id="cb118-1957"><a href="#cb118-1957" aria-hidden="true" tabindex="-1"></a><span class="in"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb118-1958"><a href="#cb118-1958" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o", lwd = 3, col = mycols2[2])</span></span>
<span id="cb118-1959"><a href="#cb118-1959" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-1960"><a href="#cb118-1960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1961"><a href="#cb118-1961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1962"><a href="#cb118-1962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1963"><a href="#cb118-1963" aria-hidden="true" tabindex="-1"></a><span class="in"># JLD winter variation</span></span>
<span id="cb118-1964"><a href="#cb118-1964" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Marginal Effects/ReddCounts_Ricker_CovarModel_MarginalEffects_3_z_jld_winvar.jpg", units = "in", width = 4.25, height = 4.4, res = 1500)</span></span>
<span id="cb118-1965"><a href="#cb118-1965" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,2.5,0.5), mgp = c(2.25,0.8,0))</span></span>
<span id="cb118-1966"><a href="#cb118-1966" aria-hidden="true" tabindex="-1"></a><span class="in"># set up plot</span></span>
<span id="cb118-1967"><a href="#cb118-1967" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- seq(from = min(dat$z_jld_winvar, na.rm = TRUE), to = max(dat$z_jld_winvar, na.rm = TRUE), length.out = nvalues)</span></span>
<span id="cb118-1968"><a href="#cb118-1968" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0.3, to = 2, length.out = nvalues) ~ x1, pch = NA, bty = "l", xlab = "Mgd. winter flow variation", ylab = "Productivity, ln(R/S)", axes = F)</span></span>
<span id="cb118-1969"><a href="#cb118-1969" aria-hidden="true" tabindex="-1"></a><span class="in"># axes and box</span></span>
<span id="cb118-1970"><a href="#cb118-1970" aria-hidden="true" tabindex="-1"></a><span class="in"># range(dat$jld_winvar, na.rm = T)</span></span>
<span id="cb118-1971"><a href="#cb118-1971" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis &lt;- seq(from = 0, to = 0.3, by = 0.05)</span></span>
<span id="cb118-1972"><a href="#cb118-1972" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis.scaled &lt;- (x.axis - covsummary$mean[3]) / covsummary$sd[3]</span></span>
<span id="cb118-1973"><a href="#cb118-1973" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, at = x.axis.scaled, labels = c("0.00", "0.05", "0.10", "0.15", "0.20", "0.25", "0.30"))</span></span>
<span id="cb118-1974"><a href="#cb118-1974" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2)</span></span>
<span id="cb118-1975"><a href="#cb118-1975" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions</span></span>
<span id="cb118-1976"><a href="#cb118-1976" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-1977"><a href="#cb118-1977" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[3]"]*x1 }</span></span>
<span id="cb118-1978"><a href="#cb118-1978" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-1979"><a href="#cb118-1979" aria-hidden="true" tabindex="-1"></a><span class="in">pred_025 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.025)</span></span>
<span id="cb118-1980"><a href="#cb118-1980" aria-hidden="true" tabindex="-1"></a><span class="in">pred_125 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.225)</span></span>
<span id="cb118-1981"><a href="#cb118-1981" aria-hidden="true" tabindex="-1"></a><span class="in">pred_875 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.875)</span></span>
<span id="cb118-1982"><a href="#cb118-1982" aria-hidden="true" tabindex="-1"></a><span class="in">pred_975 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.975)</span></span>
<span id="cb118-1983"><a href="#cb118-1983" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_975, rev(pred_025)), col = "grey85", lty=0)</span></span>
<span id="cb118-1984"><a href="#cb118-1984" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_875, rev(pred_125)), col = "grey70", lty=0)</span></span>
<span id="cb118-1985"><a href="#cb118-1985" aria-hidden="true" tabindex="-1"></a><span class="in"># add population-specific fits</span></span>
<span id="cb118-1986"><a href="#cb118-1986" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",3]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb118-1987"><a href="#cb118-1987" aria-hidden="true" tabindex="-1"></a><span class="in"># add global fit</span></span>
<span id="cb118-1988"><a href="#cb118-1988" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, col = "black", lwd = 3, type = "l")</span></span>
<span id="cb118-1989"><a href="#cb118-1989" aria-hidden="true" tabindex="-1"></a><span class="in"># median productivity</span></span>
<span id="cb118-1990"><a href="#cb118-1990" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = param.summary["mu.A",5], lty = 3, col = "grey40")</span></span>
<span id="cb118-1991"><a href="#cb118-1991" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 0, lty = 3, col = "grey40")</span></span>
<span id="cb118-1992"><a href="#cb118-1992" aria-hidden="true" tabindex="-1"></a><span class="in">text(x = 0, y = 0.3, labels = "0.043", pos = 4, col = "grey40")</span></span>
<span id="cb118-1993"><a href="#cb118-1993" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb118-1994"><a href="#cb118-1994" aria-hidden="true" tabindex="-1"></a><span class="in"># legend</span></span>
<span id="cb118-1995"><a href="#cb118-1995" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE, usr = c(0,1,0,1))</span></span>
<span id="cb118-1996"><a href="#cb118-1996" aria-hidden="true" tabindex="-1"></a><span class="in"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb118-1997"><a href="#cb118-1997" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o", lwd = 3, col = mycols2[3])</span></span>
<span id="cb118-1998"><a href="#cb118-1998" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-1999"><a href="#cb118-1999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2000"><a href="#cb118-2000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2001"><a href="#cb118-2001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2002"><a href="#cb118-2002" aria-hidden="true" tabindex="-1"></a><span class="in"># JLD Summer Mean Flow</span></span>
<span id="cb118-2003"><a href="#cb118-2003" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Marginal Effects/ReddCounts_Ricker_CovarModel_MarginalEffects_4_z_jld_summean.jpg", units = "in", width = 4.25, height = 4.4, res = 1500)</span></span>
<span id="cb118-2004"><a href="#cb118-2004" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,2.5,0.5), mgp = c(2.25,0.8,0))</span></span>
<span id="cb118-2005"><a href="#cb118-2005" aria-hidden="true" tabindex="-1"></a><span class="in"># set up plot</span></span>
<span id="cb118-2006"><a href="#cb118-2006" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- seq(from = min(dat$z_jld_summean, na.rm = TRUE), to = max(dat$z_jld_summean, na.rm = TRUE), length.out = nvalues)</span></span>
<span id="cb118-2007"><a href="#cb118-2007" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0.3, to = 2, length.out = nvalues) ~ x1, pch = NA, bty = "l", xlab = "Mgd. summer mean flow (cfs)", ylab = "Productivity, ln(R/S)", axes = F)</span></span>
<span id="cb118-2008"><a href="#cb118-2008" aria-hidden="true" tabindex="-1"></a><span class="in"># axes and box</span></span>
<span id="cb118-2009"><a href="#cb118-2009" aria-hidden="true" tabindex="-1"></a><span class="in"># range(dat$jld_summean, na.rm = T)</span></span>
<span id="cb118-2010"><a href="#cb118-2010" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis &lt;- seq(from = 1500, to = 4500, by = 1000)</span></span>
<span id="cb118-2011"><a href="#cb118-2011" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis.scaled &lt;- (x.axis - covsummary$mean[4]) / covsummary$sd[4]</span></span>
<span id="cb118-2012"><a href="#cb118-2012" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, at = x.axis.scaled, labels = x.axis)</span></span>
<span id="cb118-2013"><a href="#cb118-2013" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2)</span></span>
<span id="cb118-2014"><a href="#cb118-2014" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions</span></span>
<span id="cb118-2015"><a href="#cb118-2015" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-2016"><a href="#cb118-2016" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[4]"]*x1 }</span></span>
<span id="cb118-2017"><a href="#cb118-2017" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-2018"><a href="#cb118-2018" aria-hidden="true" tabindex="-1"></a><span class="in">pred_025 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.025)</span></span>
<span id="cb118-2019"><a href="#cb118-2019" aria-hidden="true" tabindex="-1"></a><span class="in">pred_125 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.125)</span></span>
<span id="cb118-2020"><a href="#cb118-2020" aria-hidden="true" tabindex="-1"></a><span class="in">pred_875 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.875)</span></span>
<span id="cb118-2021"><a href="#cb118-2021" aria-hidden="true" tabindex="-1"></a><span class="in">pred_975 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.975)</span></span>
<span id="cb118-2022"><a href="#cb118-2022" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_975, rev(pred_025)), col = "grey85", lty=0)</span></span>
<span id="cb118-2023"><a href="#cb118-2023" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_875, rev(pred_125)), col = "grey70", lty=0)</span></span>
<span id="cb118-2024"><a href="#cb118-2024" aria-hidden="true" tabindex="-1"></a><span class="in"># add population-specific fits</span></span>
<span id="cb118-2025"><a href="#cb118-2025" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",4]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb118-2026"><a href="#cb118-2026" aria-hidden="true" tabindex="-1"></a><span class="in"># add global fit</span></span>
<span id="cb118-2027"><a href="#cb118-2027" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, col = "black", lwd = 3, type = "l")</span></span>
<span id="cb118-2028"><a href="#cb118-2028" aria-hidden="true" tabindex="-1"></a><span class="in"># median productivity</span></span>
<span id="cb118-2029"><a href="#cb118-2029" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = param.summary["mu.A",5], lty = 3, col = "grey40")</span></span>
<span id="cb118-2030"><a href="#cb118-2030" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 0, lty = 3, col = "grey40")</span></span>
<span id="cb118-2031"><a href="#cb118-2031" aria-hidden="true" tabindex="-1"></a><span class="in">text(x = 0, y = 0.3, labels = "2700", pos = 4, col = "grey40")</span></span>
<span id="cb118-2032"><a href="#cb118-2032" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb118-2033"><a href="#cb118-2033" aria-hidden="true" tabindex="-1"></a><span class="in"># legend</span></span>
<span id="cb118-2034"><a href="#cb118-2034" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE, usr = c(0,1,0,1))</span></span>
<span id="cb118-2035"><a href="#cb118-2035" aria-hidden="true" tabindex="-1"></a><span class="in"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb118-2036"><a href="#cb118-2036" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o", lwd = 3, col = mycols2[4])</span></span>
<span id="cb118-2037"><a href="#cb118-2037" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-2038"><a href="#cb118-2038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2039"><a href="#cb118-2039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2040"><a href="#cb118-2040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2041"><a href="#cb118-2041" aria-hidden="true" tabindex="-1"></a><span class="in"># JLD Peak flow magnitude</span></span>
<span id="cb118-2042"><a href="#cb118-2042" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Marginal Effects/ReddCounts_Ricker_CovarModel_MarginalEffects_5_z_jld_peakmag.jpg", units = "in", width = 4.25, height = 4.4, res = 1500)</span></span>
<span id="cb118-2043"><a href="#cb118-2043" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,2.5,0.5), mgp = c(2.25,0.8,0))</span></span>
<span id="cb118-2044"><a href="#cb118-2044" aria-hidden="true" tabindex="-1"></a><span class="in"># set up plot</span></span>
<span id="cb118-2045"><a href="#cb118-2045" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- seq(from = min(dat$z_jld_peakmag, na.rm = TRUE), to = max(dat$z_jld_peakmag, na.rm = TRUE), length.out = nvalues)</span></span>
<span id="cb118-2046"><a href="#cb118-2046" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0.3, to = 2, length.out = nvalues) ~ x1, pch = NA, bty = "l", xlab = "Mgd. peak flow magnitude (cfs)", ylab = "Productivity, ln(R/S)", axes = F)</span></span>
<span id="cb118-2047"><a href="#cb118-2047" aria-hidden="true" tabindex="-1"></a><span class="in"># axes and box</span></span>
<span id="cb118-2048"><a href="#cb118-2048" aria-hidden="true" tabindex="-1"></a><span class="in"># range(dat$jld_peakmag, na.rm = T)</span></span>
<span id="cb118-2049"><a href="#cb118-2049" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis &lt;- seq(from = 4000, to = 12000, by = 2000)</span></span>
<span id="cb118-2050"><a href="#cb118-2050" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis.scaled &lt;- (x.axis - covsummary$mean[5]) / covsummary$sd[5]</span></span>
<span id="cb118-2051"><a href="#cb118-2051" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, at = x.axis.scaled, labels = round((x.axis), digits = 0))</span></span>
<span id="cb118-2052"><a href="#cb118-2052" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2)</span></span>
<span id="cb118-2053"><a href="#cb118-2053" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions</span></span>
<span id="cb118-2054"><a href="#cb118-2054" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-2055"><a href="#cb118-2055" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[5]"]*x1 }</span></span>
<span id="cb118-2056"><a href="#cb118-2056" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-2057"><a href="#cb118-2057" aria-hidden="true" tabindex="-1"></a><span class="in">pred_025 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.025)</span></span>
<span id="cb118-2058"><a href="#cb118-2058" aria-hidden="true" tabindex="-1"></a><span class="in">pred_125 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.125)</span></span>
<span id="cb118-2059"><a href="#cb118-2059" aria-hidden="true" tabindex="-1"></a><span class="in">pred_875 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.875)</span></span>
<span id="cb118-2060"><a href="#cb118-2060" aria-hidden="true" tabindex="-1"></a><span class="in">pred_975 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.975)</span></span>
<span id="cb118-2061"><a href="#cb118-2061" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_975, rev(pred_025)), col = "grey85", lty=0)</span></span>
<span id="cb118-2062"><a href="#cb118-2062" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_875, rev(pred_125)), col = "grey70", lty=0)</span></span>
<span id="cb118-2063"><a href="#cb118-2063" aria-hidden="true" tabindex="-1"></a><span class="in"># add population-specific fits</span></span>
<span id="cb118-2064"><a href="#cb118-2064" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",5]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb118-2065"><a href="#cb118-2065" aria-hidden="true" tabindex="-1"></a><span class="in"># add global fit</span></span>
<span id="cb118-2066"><a href="#cb118-2066" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, col = "black", lwd = 3, type = "l")</span></span>
<span id="cb118-2067"><a href="#cb118-2067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2068"><a href="#cb118-2068" aria-hidden="true" tabindex="-1"></a><span class="in"># interaction with natural peak magnitude</span></span>
<span id="cb118-2069"><a href="#cb118-2069" aria-hidden="true" tabindex="-1"></a><span class="in">## minimum</span></span>
<span id="cb118-2070"><a href="#cb118-2070" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-2071"><a href="#cb118-2071" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[5]"]*x1 + Mcmcdat[j,"mu.coef[7]"]*min(dat$z_natq_peakmag, na.rm = T) + Mcmcdat[j,"mu.coef[13]"]*x1*min(dat$z_natq_peakmag, na.rm = T) }</span></span>
<span id="cb118-2072"><a href="#cb118-2072" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-2073"><a href="#cb118-2073" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, lty = 3, lwd = 2, type = "l")</span></span>
<span id="cb118-2074"><a href="#cb118-2074" aria-hidden="true" tabindex="-1"></a><span class="in">## maximum</span></span>
<span id="cb118-2075"><a href="#cb118-2075" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-2076"><a href="#cb118-2076" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[5]"]*x1 + Mcmcdat[j,"mu.coef[7]"]*max(dat$z_natq_peakmag, na.rm = T) + Mcmcdat[j,"mu.coef[13]"]*x1*max(dat$z_natq_peakmag, na.rm = T) }</span></span>
<span id="cb118-2077"><a href="#cb118-2077" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-2078"><a href="#cb118-2078" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, lty = 2, lwd = 2, type = "l")</span></span>
<span id="cb118-2079"><a href="#cb118-2079" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", legend = c("Min. nat. peak flow", "Max. nat. peak flow"), lwd = 2, lty = c(3,2), bty = "n", cex = 0.75)</span></span>
<span id="cb118-2080"><a href="#cb118-2080" aria-hidden="true" tabindex="-1"></a><span class="in"># median productivity</span></span>
<span id="cb118-2081"><a href="#cb118-2081" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = param.summary["mu.A",5], lty = 3, col = "grey40")</span></span>
<span id="cb118-2082"><a href="#cb118-2082" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 0, lty = 3, col = "grey40")</span></span>
<span id="cb118-2083"><a href="#cb118-2083" aria-hidden="true" tabindex="-1"></a><span class="in">text(x = 0, y = 0.3, labels = "5884", pos = 4, col = "grey40")</span></span>
<span id="cb118-2084"><a href="#cb118-2084" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb118-2085"><a href="#cb118-2085" aria-hidden="true" tabindex="-1"></a><span class="in"># legend</span></span>
<span id="cb118-2086"><a href="#cb118-2086" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE, usr = c(0,1,0,1))</span></span>
<span id="cb118-2087"><a href="#cb118-2087" aria-hidden="true" tabindex="-1"></a><span class="in"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb118-2088"><a href="#cb118-2088" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o", lwd = 3, col = mycols2[5])</span></span>
<span id="cb118-2089"><a href="#cb118-2089" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-2090"><a href="#cb118-2090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2091"><a href="#cb118-2091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2092"><a href="#cb118-2092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2093"><a href="#cb118-2093" aria-hidden="true" tabindex="-1"></a><span class="in"># JLD peak flow timing</span></span>
<span id="cb118-2094"><a href="#cb118-2094" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Marginal Effects/ReddCounts_Ricker_CovarModel_MarginalEffects_6_z_jld_peaktime.jpg", units = "in", width = 4.25, height = 4.4, res = 1500)</span></span>
<span id="cb118-2095"><a href="#cb118-2095" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,2.5,0.5), mgp = c(2.25,0.8,0))</span></span>
<span id="cb118-2096"><a href="#cb118-2096" aria-hidden="true" tabindex="-1"></a><span class="in"># set up plot</span></span>
<span id="cb118-2097"><a href="#cb118-2097" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- seq(from = min(dat$z_jld_peaktime, na.rm = TRUE), to = max(dat$z_jld_peaktime, na.rm = TRUE), length.out = nvalues)</span></span>
<span id="cb118-2098"><a href="#cb118-2098" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0.3, to = 2, length.out = nvalues) ~ x1, pch = NA, bty = "l", xlab = "Mgd. peak flow timing", ylab = "Productivity, ln(R/S)", axes = F)</span></span>
<span id="cb118-2099"><a href="#cb118-2099" aria-hidden="true" tabindex="-1"></a><span class="in"># axes and box</span></span>
<span id="cb118-2100"><a href="#cb118-2100" aria-hidden="true" tabindex="-1"></a><span class="in">range(dat$jld_peaktime, na.rm = T)</span></span>
<span id="cb118-2101"><a href="#cb118-2101" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis &lt;- c(242, 273, 303)</span></span>
<span id="cb118-2102"><a href="#cb118-2102" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis.scaled &lt;- (x.axis - covsummary$mean[6]) / covsummary$sd[6]</span></span>
<span id="cb118-2103"><a href="#cb118-2103" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, at = x.axis.scaled, labels = c("1 May", "1 June", "1 July"))</span></span>
<span id="cb118-2104"><a href="#cb118-2104" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2)</span></span>
<span id="cb118-2105"><a href="#cb118-2105" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions</span></span>
<span id="cb118-2106"><a href="#cb118-2106" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-2107"><a href="#cb118-2107" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[6]"]*x1 }</span></span>
<span id="cb118-2108"><a href="#cb118-2108" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-2109"><a href="#cb118-2109" aria-hidden="true" tabindex="-1"></a><span class="in">pred_025 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.025)</span></span>
<span id="cb118-2110"><a href="#cb118-2110" aria-hidden="true" tabindex="-1"></a><span class="in">pred_125 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.125)</span></span>
<span id="cb118-2111"><a href="#cb118-2111" aria-hidden="true" tabindex="-1"></a><span class="in">pred_875 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.875)</span></span>
<span id="cb118-2112"><a href="#cb118-2112" aria-hidden="true" tabindex="-1"></a><span class="in">pred_975 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.975)</span></span>
<span id="cb118-2113"><a href="#cb118-2113" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_975, rev(pred_025)), col = "grey85", lty=0)</span></span>
<span id="cb118-2114"><a href="#cb118-2114" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_875, rev(pred_125)), col = "grey70", lty=0)</span></span>
<span id="cb118-2115"><a href="#cb118-2115" aria-hidden="true" tabindex="-1"></a><span class="in"># add population-specific fits</span></span>
<span id="cb118-2116"><a href="#cb118-2116" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",6]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb118-2117"><a href="#cb118-2117" aria-hidden="true" tabindex="-1"></a><span class="in"># add global fit</span></span>
<span id="cb118-2118"><a href="#cb118-2118" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, col = "black", lwd = 3, type = "l")</span></span>
<span id="cb118-2119"><a href="#cb118-2119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2120"><a href="#cb118-2120" aria-hidden="true" tabindex="-1"></a><span class="in"># interaction with natural peak magnitude</span></span>
<span id="cb118-2121"><a href="#cb118-2121" aria-hidden="true" tabindex="-1"></a><span class="in">## minimum</span></span>
<span id="cb118-2122"><a href="#cb118-2122" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-2123"><a href="#cb118-2123" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[6]"]*x1 + Mcmcdat[j,"mu.coef[8]"]*min(dat$z_natq_peaktime, na.rm = T) + Mcmcdat[j,"mu.coef[14]"]*x1*min(dat$z_natq_peaktime, na.rm = T) }</span></span>
<span id="cb118-2124"><a href="#cb118-2124" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-2125"><a href="#cb118-2125" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, lty = 3, lwd = 2, type = "l")</span></span>
<span id="cb118-2126"><a href="#cb118-2126" aria-hidden="true" tabindex="-1"></a><span class="in">## maximum</span></span>
<span id="cb118-2127"><a href="#cb118-2127" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-2128"><a href="#cb118-2128" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[6]"]*x1 + Mcmcdat[j,"mu.coef[8]"]*max(dat$z_natq_peaktime, na.rm = T) + Mcmcdat[j,"mu.coef[14]"]*x1*max(dat$z_natq_peaktime, na.rm = T) }</span></span>
<span id="cb118-2129"><a href="#cb118-2129" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-2130"><a href="#cb118-2130" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, lty = 2, lwd = 2, type = "l")</span></span>
<span id="cb118-2131"><a href="#cb118-2131" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topleft", legend = c("Min. nat. peak time", "Max. nat. peak time"), lwd = 2, lty = c(3,2), bty = "n", cex = 0.75)</span></span>
<span id="cb118-2132"><a href="#cb118-2132" aria-hidden="true" tabindex="-1"></a><span class="in"># median productivity</span></span>
<span id="cb118-2133"><a href="#cb118-2133" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = param.summary["mu.A",5], lty = 3, col = "grey40")</span></span>
<span id="cb118-2134"><a href="#cb118-2134" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 0, lty = 3, col = "grey40")</span></span>
<span id="cb118-2135"><a href="#cb118-2135" aria-hidden="true" tabindex="-1"></a><span class="in">text(x = 0, y = 0.3, labels = "14 June", pos = 4, col = "grey40")</span></span>
<span id="cb118-2136"><a href="#cb118-2136" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb118-2137"><a href="#cb118-2137" aria-hidden="true" tabindex="-1"></a><span class="in"># legend</span></span>
<span id="cb118-2138"><a href="#cb118-2138" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE, usr = c(0,1,0,1))</span></span>
<span id="cb118-2139"><a href="#cb118-2139" aria-hidden="true" tabindex="-1"></a><span class="in"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb118-2140"><a href="#cb118-2140" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o", lwd = 3, col = mycols2[6])</span></span>
<span id="cb118-2141"><a href="#cb118-2141" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-2142"><a href="#cb118-2142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2143"><a href="#cb118-2143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2144"><a href="#cb118-2144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2145"><a href="#cb118-2145" aria-hidden="true" tabindex="-1"></a><span class="in"># Natural Peak flow magnitude</span></span>
<span id="cb118-2146"><a href="#cb118-2146" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Marginal Effects/ReddCounts_Ricker_CovarModel_MarginalEffects_7_z_natq_peakmag.jpg", units = "in", width = 4.25, height = 4.4, res = 1500)</span></span>
<span id="cb118-2147"><a href="#cb118-2147" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,2.5,0.5), mgp = c(2.25,0.8,0))</span></span>
<span id="cb118-2148"><a href="#cb118-2148" aria-hidden="true" tabindex="-1"></a><span class="in"># set up plot</span></span>
<span id="cb118-2149"><a href="#cb118-2149" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- seq(from = min(dat$z_natq_peakmag, na.rm = TRUE), to = max(dat$z_natq_peakmag, na.rm = TRUE), length.out = nvalues)</span></span>
<span id="cb118-2150"><a href="#cb118-2150" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0.3, to = 2, length.out = nvalues) ~ x1, pch = NA, bty = "l", xlab = "Natural peak flow magnitude (cfs)", ylab = "Productivity, ln(R/S)", axes = F)</span></span>
<span id="cb118-2151"><a href="#cb118-2151" aria-hidden="true" tabindex="-1"></a><span class="in"># axes and box</span></span>
<span id="cb118-2152"><a href="#cb118-2152" aria-hidden="true" tabindex="-1"></a><span class="in"># range(dat$natq_peakmag, na.rm = T)</span></span>
<span id="cb118-2153"><a href="#cb118-2153" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis &lt;- seq(from = 5000, to = 20000, by = 5000)</span></span>
<span id="cb118-2154"><a href="#cb118-2154" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis.scaled &lt;- (x.axis - covsummary$mean[7]) / covsummary$sd[7]</span></span>
<span id="cb118-2155"><a href="#cb118-2155" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, at = x.axis.scaled, labels = round((x.axis), digits = 0))</span></span>
<span id="cb118-2156"><a href="#cb118-2156" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2)</span></span>
<span id="cb118-2157"><a href="#cb118-2157" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions</span></span>
<span id="cb118-2158"><a href="#cb118-2158" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-2159"><a href="#cb118-2159" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[7]"]*x1 }</span></span>
<span id="cb118-2160"><a href="#cb118-2160" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-2161"><a href="#cb118-2161" aria-hidden="true" tabindex="-1"></a><span class="in">pred_025 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.025)</span></span>
<span id="cb118-2162"><a href="#cb118-2162" aria-hidden="true" tabindex="-1"></a><span class="in">pred_125 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.125)</span></span>
<span id="cb118-2163"><a href="#cb118-2163" aria-hidden="true" tabindex="-1"></a><span class="in">pred_875 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.875)</span></span>
<span id="cb118-2164"><a href="#cb118-2164" aria-hidden="true" tabindex="-1"></a><span class="in">pred_975 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.975)</span></span>
<span id="cb118-2165"><a href="#cb118-2165" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_975, rev(pred_025)), col = "grey85", lty=0)</span></span>
<span id="cb118-2166"><a href="#cb118-2166" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_875, rev(pred_125)), col = "grey70", lty=0)</span></span>
<span id="cb118-2167"><a href="#cb118-2167" aria-hidden="true" tabindex="-1"></a><span class="in"># add population-specific fits</span></span>
<span id="cb118-2168"><a href="#cb118-2168" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",7]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb118-2169"><a href="#cb118-2169" aria-hidden="true" tabindex="-1"></a><span class="in"># add global fit</span></span>
<span id="cb118-2170"><a href="#cb118-2170" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, col = "black", lwd = 3, type = "l")</span></span>
<span id="cb118-2171"><a href="#cb118-2171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2172"><a href="#cb118-2172" aria-hidden="true" tabindex="-1"></a><span class="in"># interaction with natural peak magnitude</span></span>
<span id="cb118-2173"><a href="#cb118-2173" aria-hidden="true" tabindex="-1"></a><span class="in">## minimum</span></span>
<span id="cb118-2174"><a href="#cb118-2174" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-2175"><a href="#cb118-2175" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[7]"]*x1 + Mcmcdat[j,"mu.coef[5]"]*min(dat$z_jld_peakmag, na.rm = T) + Mcmcdat[j,"mu.coef[13]"]*x1*min(dat$z_jld_peakmag, na.rm = T) }</span></span>
<span id="cb118-2176"><a href="#cb118-2176" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-2177"><a href="#cb118-2177" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, lty = 3, lwd = 2, type = "l")</span></span>
<span id="cb118-2178"><a href="#cb118-2178" aria-hidden="true" tabindex="-1"></a><span class="in">## maximum</span></span>
<span id="cb118-2179"><a href="#cb118-2179" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-2180"><a href="#cb118-2180" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[7]"]*x1 + Mcmcdat[j,"mu.coef[5]"]*max(dat$z_jld_peakmag, na.rm = T) + Mcmcdat[j,"mu.coef[13]"]*x1*max(dat$z_jld_peakmag, na.rm = T) }</span></span>
<span id="cb118-2181"><a href="#cb118-2181" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-2182"><a href="#cb118-2182" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, lty = 2, lwd = 2, type = "l")</span></span>
<span id="cb118-2183"><a href="#cb118-2183" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", legend = c("Min. JLD peak flow", "Max. JLD peak flow"), lwd = 2, lty = c(3,2), bty = "n", cex = 0.75)</span></span>
<span id="cb118-2184"><a href="#cb118-2184" aria-hidden="true" tabindex="-1"></a><span class="in"># median productivity</span></span>
<span id="cb118-2185"><a href="#cb118-2185" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = param.summary["mu.A",5], lty = 3, col = "grey40")</span></span>
<span id="cb118-2186"><a href="#cb118-2186" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 0, lty = 3, col = "grey40")</span></span>
<span id="cb118-2187"><a href="#cb118-2187" aria-hidden="true" tabindex="-1"></a><span class="in">text(x = 0, y = 0.3, labels = "10948", pos = 4, col = "grey40")</span></span>
<span id="cb118-2188"><a href="#cb118-2188" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb118-2189"><a href="#cb118-2189" aria-hidden="true" tabindex="-1"></a><span class="in"># legend</span></span>
<span id="cb118-2190"><a href="#cb118-2190" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE, usr = c(0,1,0,1))</span></span>
<span id="cb118-2191"><a href="#cb118-2191" aria-hidden="true" tabindex="-1"></a><span class="in"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb118-2192"><a href="#cb118-2192" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o", lwd = 3, col = mycols2[7])</span></span>
<span id="cb118-2193"><a href="#cb118-2193" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-2194"><a href="#cb118-2194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2195"><a href="#cb118-2195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2196"><a href="#cb118-2196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2197"><a href="#cb118-2197" aria-hidden="true" tabindex="-1"></a><span class="in"># Natural peak flow timing</span></span>
<span id="cb118-2198"><a href="#cb118-2198" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Marginal Effects/ReddCounts_Ricker_CovarModel_MarginalEffects_8_z_natq_peaktime.jpg", units = "in", width = 4.25, height = 4.4, res = 1500)</span></span>
<span id="cb118-2199"><a href="#cb118-2199" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,2.5,0.5), mgp = c(2.25,0.8,0))</span></span>
<span id="cb118-2200"><a href="#cb118-2200" aria-hidden="true" tabindex="-1"></a><span class="in"># set up plot</span></span>
<span id="cb118-2201"><a href="#cb118-2201" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- seq(from = min(dat$z_natq_peaktime, na.rm = TRUE), to = max(dat$z_natq_peaktime, na.rm = TRUE), length.out = nvalues)</span></span>
<span id="cb118-2202"><a href="#cb118-2202" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0.3, to = 2, length.out = nvalues) ~ x1, pch = NA, bty = "l", xlab = "Natural peak flow timing", ylab = "Productivity, ln(R/S)", axes = F)</span></span>
<span id="cb118-2203"><a href="#cb118-2203" aria-hidden="true" tabindex="-1"></a><span class="in"># axes and box</span></span>
<span id="cb118-2204"><a href="#cb118-2204" aria-hidden="true" tabindex="-1"></a><span class="in"># range(dat$natq_peaktime, na.rm = T)</span></span>
<span id="cb118-2205"><a href="#cb118-2205" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis &lt;- c(256, 273, 287, 303)</span></span>
<span id="cb118-2206"><a href="#cb118-2206" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis.scaled &lt;- (x.axis - covsummary$mean[8]) / covsummary$sd[8]</span></span>
<span id="cb118-2207"><a href="#cb118-2207" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, at = x.axis.scaled, labels = c("15 May", "1 June", "15 June", "1 July"))</span></span>
<span id="cb118-2208"><a href="#cb118-2208" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2)</span></span>
<span id="cb118-2209"><a href="#cb118-2209" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions</span></span>
<span id="cb118-2210"><a href="#cb118-2210" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-2211"><a href="#cb118-2211" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[8]"]*x1 }</span></span>
<span id="cb118-2212"><a href="#cb118-2212" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-2213"><a href="#cb118-2213" aria-hidden="true" tabindex="-1"></a><span class="in">pred_025 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.025)</span></span>
<span id="cb118-2214"><a href="#cb118-2214" aria-hidden="true" tabindex="-1"></a><span class="in">pred_125 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.125)</span></span>
<span id="cb118-2215"><a href="#cb118-2215" aria-hidden="true" tabindex="-1"></a><span class="in">pred_875 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.875)</span></span>
<span id="cb118-2216"><a href="#cb118-2216" aria-hidden="true" tabindex="-1"></a><span class="in">pred_975 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.975)</span></span>
<span id="cb118-2217"><a href="#cb118-2217" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_975, rev(pred_025)), col = "grey85", lty=0)</span></span>
<span id="cb118-2218"><a href="#cb118-2218" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_875, rev(pred_125)), col = "grey70", lty=0)</span></span>
<span id="cb118-2219"><a href="#cb118-2219" aria-hidden="true" tabindex="-1"></a><span class="in"># add population-specific fits</span></span>
<span id="cb118-2220"><a href="#cb118-2220" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",8]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb118-2221"><a href="#cb118-2221" aria-hidden="true" tabindex="-1"></a><span class="in"># add global fit</span></span>
<span id="cb118-2222"><a href="#cb118-2222" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, col = "black", lwd = 3, type = "l")</span></span>
<span id="cb118-2223"><a href="#cb118-2223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2224"><a href="#cb118-2224" aria-hidden="true" tabindex="-1"></a><span class="in"># interaction with natural peak timing</span></span>
<span id="cb118-2225"><a href="#cb118-2225" aria-hidden="true" tabindex="-1"></a><span class="in">## minimum</span></span>
<span id="cb118-2226"><a href="#cb118-2226" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-2227"><a href="#cb118-2227" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[8]"]*x1 + Mcmcdat[j,"mu.coef[6]"]*min(dat$z_jld_peaktime, na.rm = T) + Mcmcdat[j,"mu.coef[14]"]*x1*min(dat$z_jld_peaktime, na.rm = T) }</span></span>
<span id="cb118-2228"><a href="#cb118-2228" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-2229"><a href="#cb118-2229" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, lty = 3, lwd = 2, type = "l")</span></span>
<span id="cb118-2230"><a href="#cb118-2230" aria-hidden="true" tabindex="-1"></a><span class="in">## maximum</span></span>
<span id="cb118-2231"><a href="#cb118-2231" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-2232"><a href="#cb118-2232" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[8]"]*x1 + Mcmcdat[j,"mu.coef[6]"]*max(dat$z_jld_peaktime, na.rm = T) + Mcmcdat[j,"mu.coef[14]"]*x1*max(dat$z_jld_peaktime, na.rm = T) }</span></span>
<span id="cb118-2233"><a href="#cb118-2233" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-2234"><a href="#cb118-2234" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, lty = 2, lwd = 2, type = "l")</span></span>
<span id="cb118-2235"><a href="#cb118-2235" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", legend = c("Min. JLD peak time", "Max. JLD peak time"), lwd = 2, lty = c(3,2), bty = "n", cex = 0.75)</span></span>
<span id="cb118-2236"><a href="#cb118-2236" aria-hidden="true" tabindex="-1"></a><span class="in"># median productivity</span></span>
<span id="cb118-2237"><a href="#cb118-2237" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = param.summary["mu.A",5], lty = 3, col = "grey40")</span></span>
<span id="cb118-2238"><a href="#cb118-2238" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 0, lty = 3, col = "grey40")</span></span>
<span id="cb118-2239"><a href="#cb118-2239" aria-hidden="true" tabindex="-1"></a><span class="in">text(x = 0, y = 0.3, labels = "5 June", pos = 4, col = "grey40")</span></span>
<span id="cb118-2240"><a href="#cb118-2240" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb118-2241"><a href="#cb118-2241" aria-hidden="true" tabindex="-1"></a><span class="in"># legend</span></span>
<span id="cb118-2242"><a href="#cb118-2242" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE, usr = c(0,1,0,1))</span></span>
<span id="cb118-2243"><a href="#cb118-2243" aria-hidden="true" tabindex="-1"></a><span class="in"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb118-2244"><a href="#cb118-2244" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o", lwd = 3, col = mycols2[8])</span></span>
<span id="cb118-2245"><a href="#cb118-2245" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-2246"><a href="#cb118-2246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2247"><a href="#cb118-2247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2248"><a href="#cb118-2248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2249"><a href="#cb118-2249" aria-hidden="true" tabindex="-1"></a><span class="in"># Fall Temperature</span></span>
<span id="cb118-2250"><a href="#cb118-2250" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Marginal Effects/ReddCounts_Ricker_CovarModel_MarginalEffects_9_z_temp_falmean.jpg", units = "in", width = 4.25, height = 4.4, res = 1500)</span></span>
<span id="cb118-2251"><a href="#cb118-2251" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,2.5,0.5), mgp = c(2.25,0.8,0))</span></span>
<span id="cb118-2252"><a href="#cb118-2252" aria-hidden="true" tabindex="-1"></a><span class="in"># set up plot</span></span>
<span id="cb118-2253"><a href="#cb118-2253" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- seq(from = min(dat$z_temp_falmean, na.rm = TRUE), to = max(dat$z_temp_falmean, na.rm = TRUE), length.out = nvalues)</span></span>
<span id="cb118-2254"><a href="#cb118-2254" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0.3, to = 2, length.out = nvalues) ~ x1, pch = NA, bty = "l", xlab = expression(paste("Autumn temperature ("^"o", "C)", sep = "")), ylab = "Productivity, ln(R/S)", axes = F)</span></span>
<span id="cb118-2255"><a href="#cb118-2255" aria-hidden="true" tabindex="-1"></a><span class="in"># axes and box</span></span>
<span id="cb118-2256"><a href="#cb118-2256" aria-hidden="true" tabindex="-1"></a><span class="in">range(dat$temp_falmean, na.rm = T)</span></span>
<span id="cb118-2257"><a href="#cb118-2257" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis &lt;- seq(from = 2, to = 6, by = 1)</span></span>
<span id="cb118-2258"><a href="#cb118-2258" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis.scaled &lt;- (x.axis - covsummary$mean[9]) / covsummary$sd[9]</span></span>
<span id="cb118-2259"><a href="#cb118-2259" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, at = x.axis.scaled, labels = x.axis)</span></span>
<span id="cb118-2260"><a href="#cb118-2260" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2)</span></span>
<span id="cb118-2261"><a href="#cb118-2261" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions</span></span>
<span id="cb118-2262"><a href="#cb118-2262" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-2263"><a href="#cb118-2263" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[9]"]*x1 }</span></span>
<span id="cb118-2264"><a href="#cb118-2264" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-2265"><a href="#cb118-2265" aria-hidden="true" tabindex="-1"></a><span class="in">pred_025 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.05)</span></span>
<span id="cb118-2266"><a href="#cb118-2266" aria-hidden="true" tabindex="-1"></a><span class="in">pred_125 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.125)</span></span>
<span id="cb118-2267"><a href="#cb118-2267" aria-hidden="true" tabindex="-1"></a><span class="in">pred_875 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.875)</span></span>
<span id="cb118-2268"><a href="#cb118-2268" aria-hidden="true" tabindex="-1"></a><span class="in">pred_975 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.975)</span></span>
<span id="cb118-2269"><a href="#cb118-2269" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_975, rev(pred_025)), col = "grey85", lty=0)</span></span>
<span id="cb118-2270"><a href="#cb118-2270" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_875, rev(pred_125)), col = "grey70", lty=0)</span></span>
<span id="cb118-2271"><a href="#cb118-2271" aria-hidden="true" tabindex="-1"></a><span class="in"># add population-specific fits</span></span>
<span id="cb118-2272"><a href="#cb118-2272" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",9]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb118-2273"><a href="#cb118-2273" aria-hidden="true" tabindex="-1"></a><span class="in"># add global fit</span></span>
<span id="cb118-2274"><a href="#cb118-2274" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, col = "black", lwd = 3, type = "l")</span></span>
<span id="cb118-2275"><a href="#cb118-2275" aria-hidden="true" tabindex="-1"></a><span class="in"># median productivity</span></span>
<span id="cb118-2276"><a href="#cb118-2276" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = param.summary["mu.A",5], lty = 3, col = "grey40")</span></span>
<span id="cb118-2277"><a href="#cb118-2277" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 0, lty = 3, col = "grey40")</span></span>
<span id="cb118-2278"><a href="#cb118-2278" aria-hidden="true" tabindex="-1"></a><span class="in">text(x = 0, y = 0.3, labels = "4.05", pos = 4, col = "grey40")</span></span>
<span id="cb118-2279"><a href="#cb118-2279" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb118-2280"><a href="#cb118-2280" aria-hidden="true" tabindex="-1"></a><span class="in"># legend</span></span>
<span id="cb118-2281"><a href="#cb118-2281" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE, usr = c(0,1,0,1))</span></span>
<span id="cb118-2282"><a href="#cb118-2282" aria-hidden="true" tabindex="-1"></a><span class="in"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb118-2283"><a href="#cb118-2283" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o", lwd = 3, col = mycols2[9])</span></span>
<span id="cb118-2284"><a href="#cb118-2284" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-2285"><a href="#cb118-2285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2286"><a href="#cb118-2286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2287"><a href="#cb118-2287" aria-hidden="true" tabindex="-1"></a><span class="in"># Winter Temperature</span></span>
<span id="cb118-2288"><a href="#cb118-2288" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Marginal Effects/ReddCounts_Ricker_CovarModel_MarginalEffects_10_z_temp_winmean.jpg", units = "in", width = 4.25, height = 4.4, res = 1500)</span></span>
<span id="cb118-2289"><a href="#cb118-2289" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,2.5,0.5), mgp = c(2.25,0.8,0))</span></span>
<span id="cb118-2290"><a href="#cb118-2290" aria-hidden="true" tabindex="-1"></a><span class="in"># set up plot</span></span>
<span id="cb118-2291"><a href="#cb118-2291" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- seq(from = min(dat$z_temp_winmean, na.rm = TRUE), to = max(dat$z_temp_winmean, na.rm = TRUE), length.out = nvalues)</span></span>
<span id="cb118-2292"><a href="#cb118-2292" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0.3, to = 2, length.out = nvalues) ~ x1, pch = NA, bty = "l", xlab = expression(paste("Winter temperature ("^"o", "C)", sep = "")), ylab = "Productivity, ln(R/S)", axes = F)</span></span>
<span id="cb118-2293"><a href="#cb118-2293" aria-hidden="true" tabindex="-1"></a><span class="in"># axes and box</span></span>
<span id="cb118-2294"><a href="#cb118-2294" aria-hidden="true" tabindex="-1"></a><span class="in">range(dat$temp_winmean, na.rm = T)</span></span>
<span id="cb118-2295"><a href="#cb118-2295" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis &lt;- seq(from = -13, to = 5, by = 2)</span></span>
<span id="cb118-2296"><a href="#cb118-2296" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis.scaled &lt;- (x.axis - covsummary$mean[10]) / covsummary$sd[10]</span></span>
<span id="cb118-2297"><a href="#cb118-2297" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, at = x.axis.scaled, labels = x.axis)</span></span>
<span id="cb118-2298"><a href="#cb118-2298" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2)</span></span>
<span id="cb118-2299"><a href="#cb118-2299" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions</span></span>
<span id="cb118-2300"><a href="#cb118-2300" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-2301"><a href="#cb118-2301" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[10]"]*x1 }</span></span>
<span id="cb118-2302"><a href="#cb118-2302" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-2303"><a href="#cb118-2303" aria-hidden="true" tabindex="-1"></a><span class="in">pred_025 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.025)</span></span>
<span id="cb118-2304"><a href="#cb118-2304" aria-hidden="true" tabindex="-1"></a><span class="in">pred_125 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.125)</span></span>
<span id="cb118-2305"><a href="#cb118-2305" aria-hidden="true" tabindex="-1"></a><span class="in">pred_875 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.875)</span></span>
<span id="cb118-2306"><a href="#cb118-2306" aria-hidden="true" tabindex="-1"></a><span class="in">pred_975 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.925)</span></span>
<span id="cb118-2307"><a href="#cb118-2307" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_975, rev(pred_025)), col = "grey85", lty=0)</span></span>
<span id="cb118-2308"><a href="#cb118-2308" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_875, rev(pred_125)), col = "grey70", lty=0)</span></span>
<span id="cb118-2309"><a href="#cb118-2309" aria-hidden="true" tabindex="-1"></a><span class="in"># add population-specific fits</span></span>
<span id="cb118-2310"><a href="#cb118-2310" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",10]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb118-2311"><a href="#cb118-2311" aria-hidden="true" tabindex="-1"></a><span class="in"># add global fit</span></span>
<span id="cb118-2312"><a href="#cb118-2312" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, col = "black", lwd = 3, type = "l")</span></span>
<span id="cb118-2313"><a href="#cb118-2313" aria-hidden="true" tabindex="-1"></a><span class="in"># median productivity</span></span>
<span id="cb118-2314"><a href="#cb118-2314" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = param.summary["mu.A",5], lty = 3, col = "grey40")</span></span>
<span id="cb118-2315"><a href="#cb118-2315" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 0, lty = 3, col = "grey40")</span></span>
<span id="cb118-2316"><a href="#cb118-2316" aria-hidden="true" tabindex="-1"></a><span class="in">text(x = 0, y = 0.3, labels = "-9.29", pos = 4, col = "grey40")</span></span>
<span id="cb118-2317"><a href="#cb118-2317" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb118-2318"><a href="#cb118-2318" aria-hidden="true" tabindex="-1"></a><span class="in"># legend</span></span>
<span id="cb118-2319"><a href="#cb118-2319" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE, usr = c(0,1,0,1))</span></span>
<span id="cb118-2320"><a href="#cb118-2320" aria-hidden="true" tabindex="-1"></a><span class="in"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb118-2321"><a href="#cb118-2321" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o", lwd = 3, col = mycols2[10])</span></span>
<span id="cb118-2322"><a href="#cb118-2322" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-2323"><a href="#cb118-2323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2324"><a href="#cb118-2324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2325"><a href="#cb118-2325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2326"><a href="#cb118-2326" aria-hidden="true" tabindex="-1"></a><span class="in"># Spring Temperature</span></span>
<span id="cb118-2327"><a href="#cb118-2327" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Marginal Effects/ReddCounts_Ricker_CovarModel_MarginalEffects_11_z_temp_sprmean.jpg", units = "in", width = 4.25, height = 4.4, res = 1500)</span></span>
<span id="cb118-2328"><a href="#cb118-2328" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,2.5,0.5), mgp = c(2.25,0.8,0))</span></span>
<span id="cb118-2329"><a href="#cb118-2329" aria-hidden="true" tabindex="-1"></a><span class="in"># set up plot</span></span>
<span id="cb118-2330"><a href="#cb118-2330" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- seq(from = min(dat$z_temp_sprmean, na.rm = TRUE), to = max(dat$z_temp_sprmean, na.rm = TRUE), length.out = nvalues)</span></span>
<span id="cb118-2331"><a href="#cb118-2331" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0.3, to = 2, length.out = nvalues) ~ x1, pch = NA, bty = "l", xlab = expression(paste("Spring temperature ("^"o", "C)", sep = "")), ylab = "Productivity, ln(R/S)", axes = F)</span></span>
<span id="cb118-2332"><a href="#cb118-2332" aria-hidden="true" tabindex="-1"></a><span class="in"># axes and box</span></span>
<span id="cb118-2333"><a href="#cb118-2333" aria-hidden="true" tabindex="-1"></a><span class="in"># range(dat$temp_sprmean, na.rm = T)</span></span>
<span id="cb118-2334"><a href="#cb118-2334" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis &lt;- seq(from = 0, to = 5, by = 1)</span></span>
<span id="cb118-2335"><a href="#cb118-2335" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis.scaled &lt;- (x.axis - covsummary$mean[11]) / covsummary$sd[11]</span></span>
<span id="cb118-2336"><a href="#cb118-2336" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, at = x.axis.scaled, labels = x.axis)</span></span>
<span id="cb118-2337"><a href="#cb118-2337" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2)</span></span>
<span id="cb118-2338"><a href="#cb118-2338" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions</span></span>
<span id="cb118-2339"><a href="#cb118-2339" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-2340"><a href="#cb118-2340" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[11]"]*x1 }</span></span>
<span id="cb118-2341"><a href="#cb118-2341" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-2342"><a href="#cb118-2342" aria-hidden="true" tabindex="-1"></a><span class="in">pred_025 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.025)</span></span>
<span id="cb118-2343"><a href="#cb118-2343" aria-hidden="true" tabindex="-1"></a><span class="in">pred_125 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.125)</span></span>
<span id="cb118-2344"><a href="#cb118-2344" aria-hidden="true" tabindex="-1"></a><span class="in">pred_875 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.875)</span></span>
<span id="cb118-2345"><a href="#cb118-2345" aria-hidden="true" tabindex="-1"></a><span class="in">pred_975 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.975)</span></span>
<span id="cb118-2346"><a href="#cb118-2346" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_975, rev(pred_025)), col = "grey85", lty=0)</span></span>
<span id="cb118-2347"><a href="#cb118-2347" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_875, rev(pred_125)), col = "grey70", lty=0)</span></span>
<span id="cb118-2348"><a href="#cb118-2348" aria-hidden="true" tabindex="-1"></a><span class="in"># add population-specific fits</span></span>
<span id="cb118-2349"><a href="#cb118-2349" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",11]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb118-2350"><a href="#cb118-2350" aria-hidden="true" tabindex="-1"></a><span class="in"># add global fit</span></span>
<span id="cb118-2351"><a href="#cb118-2351" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, col = "black", lwd = 3, type = "l")</span></span>
<span id="cb118-2352"><a href="#cb118-2352" aria-hidden="true" tabindex="-1"></a><span class="in"># median productivity</span></span>
<span id="cb118-2353"><a href="#cb118-2353" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = param.summary["mu.A",5], lty = 3, col = "grey40")</span></span>
<span id="cb118-2354"><a href="#cb118-2354" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 0, lty = 3, col = "grey40")</span></span>
<span id="cb118-2355"><a href="#cb118-2355" aria-hidden="true" tabindex="-1"></a><span class="in">text(x = 0, y = 0.3, labels = "2.38", pos = 4, col = "grey40")</span></span>
<span id="cb118-2356"><a href="#cb118-2356" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb118-2357"><a href="#cb118-2357" aria-hidden="true" tabindex="-1"></a><span class="in"># legend</span></span>
<span id="cb118-2358"><a href="#cb118-2358" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE, usr = c(0,1,0,1))</span></span>
<span id="cb118-2359"><a href="#cb118-2359" aria-hidden="true" tabindex="-1"></a><span class="in"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb118-2360"><a href="#cb118-2360" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o", lwd = 3, col = mycols2[11])</span></span>
<span id="cb118-2361"><a href="#cb118-2361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2362"><a href="#cb118-2362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2363"><a href="#cb118-2363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2364"><a href="#cb118-2364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2365"><a href="#cb118-2365" aria-hidden="true" tabindex="-1"></a><span class="in"># Summer Temperature</span></span>
<span id="cb118-2366"><a href="#cb118-2366" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Marginal Effects/ReddCounts_Ricker_CovarModel_MarginalEffects_12_z_temp_summean.jpg", units = "in", width = 4.25, height = 4.4, res = 1500)</span></span>
<span id="cb118-2367"><a href="#cb118-2367" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,2.5,0.5), mgp = c(2.25,0.8,0))</span></span>
<span id="cb118-2368"><a href="#cb118-2368" aria-hidden="true" tabindex="-1"></a><span class="in"># set up plot</span></span>
<span id="cb118-2369"><a href="#cb118-2369" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- seq(from = min(dat$z_temp_summean, na.rm = TRUE), to = max(dat$z_temp_summean, na.rm = TRUE), length.out = nvalues)</span></span>
<span id="cb118-2370"><a href="#cb118-2370" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0.3, to = 2, length.out = nvalues) ~ x1, pch = NA, bty = "l", xlab = expression(paste("Summer temperature ("^"o", "C)", sep = "")), ylab = "Productivity, ln(R/S)", axes = F)</span></span>
<span id="cb118-2371"><a href="#cb118-2371" aria-hidden="true" tabindex="-1"></a><span class="in"># axes and box</span></span>
<span id="cb118-2372"><a href="#cb118-2372" aria-hidden="true" tabindex="-1"></a><span class="in"># range(dat$temp_summean, na.rm = T)</span></span>
<span id="cb118-2373"><a href="#cb118-2373" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis &lt;- seq(from = 12, to = 17, by = 1)</span></span>
<span id="cb118-2374"><a href="#cb118-2374" aria-hidden="true" tabindex="-1"></a><span class="in">x.axis.scaled &lt;- (x.axis - covsummary$mean[12]) / covsummary$sd[12]</span></span>
<span id="cb118-2375"><a href="#cb118-2375" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, at = x.axis.scaled, labels = x.axis)</span></span>
<span id="cb118-2376"><a href="#cb118-2376" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2)</span></span>
<span id="cb118-2377"><a href="#cb118-2377" aria-hidden="true" tabindex="-1"></a><span class="in"># predictions</span></span>
<span id="cb118-2378"><a href="#cb118-2378" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- matrix(NA, nrow = nrow(Mcmcdat), ncol = nvalues)</span></span>
<span id="cb118-2379"><a href="#cb118-2379" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nrow(pred)) { pred[j,] &lt;- Mcmcdat[j,"mu.A"] + Mcmcdat[j,"mu.coef[12]"]*x1 }</span></span>
<span id="cb118-2380"><a href="#cb118-2380" aria-hidden="true" tabindex="-1"></a><span class="in">pred_median &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.50) </span></span>
<span id="cb118-2381"><a href="#cb118-2381" aria-hidden="true" tabindex="-1"></a><span class="in">pred_025 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.025)</span></span>
<span id="cb118-2382"><a href="#cb118-2382" aria-hidden="true" tabindex="-1"></a><span class="in">pred_125 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.125)</span></span>
<span id="cb118-2383"><a href="#cb118-2383" aria-hidden="true" tabindex="-1"></a><span class="in">pred_875 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.875)</span></span>
<span id="cb118-2384"><a href="#cb118-2384" aria-hidden="true" tabindex="-1"></a><span class="in">pred_975 &lt;- apply(pred, MARGIN = 2, quantile, prob = 0.975)</span></span>
<span id="cb118-2385"><a href="#cb118-2385" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_975, rev(pred_025)), col = "grey85", lty=0)</span></span>
<span id="cb118-2386"><a href="#cb118-2386" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(c(x1, rev(x1)), c(pred_875, rev(pred_125)), col = "grey70", lty=0)</span></span>
<span id="cb118-2387"><a href="#cb118-2387" aria-hidden="true" tabindex="-1"></a><span class="in"># add population-specific fits</span></span>
<span id="cb118-2388"><a href="#cb118-2388" aria-hidden="true" tabindex="-1"></a><span class="in"># for (i in 1:n.pops) { lines(param.summary[paste("A[", i, "]", sep = ""),5] + param.summary[paste("coef[", i, ",12]", sep = ""),5]*x1 ~ x1, col = colPal[i], lwd = 1) }</span></span>
<span id="cb118-2389"><a href="#cb118-2389" aria-hidden="true" tabindex="-1"></a><span class="in"># add global fit</span></span>
<span id="cb118-2390"><a href="#cb118-2390" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_median ~ x1, col = "black", lwd = 3, type = "l")</span></span>
<span id="cb118-2391"><a href="#cb118-2391" aria-hidden="true" tabindex="-1"></a><span class="in"># median productivity</span></span>
<span id="cb118-2392"><a href="#cb118-2392" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = param.summary["mu.A",5], lty = 3, col = "grey40")</span></span>
<span id="cb118-2393"><a href="#cb118-2393" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 0, lty = 3, col = "grey40")</span></span>
<span id="cb118-2394"><a href="#cb118-2394" aria-hidden="true" tabindex="-1"></a><span class="in">text(x = 0, y = 0.3, labels = "14.81", pos = 4, col = "grey40")</span></span>
<span id="cb118-2395"><a href="#cb118-2395" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(density((median(Mcmcdat[,"mu.A"]) - Mcmcdat[,"mu.A"]) / Mcmcdat[,"mu.coef[1]"]))</span></span>
<span id="cb118-2396"><a href="#cb118-2396" aria-hidden="true" tabindex="-1"></a><span class="in"># legend</span></span>
<span id="cb118-2397"><a href="#cb118-2397" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE, usr = c(0,1,0,1))</span></span>
<span id="cb118-2398"><a href="#cb118-2398" aria-hidden="true" tabindex="-1"></a><span class="in"># legend(0.085, 1.15, legend = popshort, lwd = 1, col = colPal, ncol = 5, cex = 0.5, bg = "grey85")</span></span>
<span id="cb118-2399"><a href="#cb118-2399" aria-hidden="true" tabindex="-1"></a><span class="in">box(bty = "o", lwd = 3, col = mycols2[12])</span></span>
<span id="cb118-2400"><a href="#cb118-2400" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-2401"><a href="#cb118-2401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2402"><a href="#cb118-2402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-2403"><a href="#cb118-2403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2404"><a href="#cb118-2404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2405"><a href="#cb118-2405" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interactions</span></span>
<span id="cb118-2406"><a href="#cb118-2406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2407"><a href="#cb118-2407" aria-hidden="true" tabindex="-1"></a>Get raw covariate data for plotting</span>
<span id="cb118-2410"><a href="#cb118-2410" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-2411"><a href="#cb118-2411" aria-hidden="true" tabindex="-1"></a>mgdcovs <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Derived/JLD_ManagedFlow_Covariates_BroodYear_1960-2022.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb118-2412"><a href="#cb118-2412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(broodyr, jld_peakmag, jld_peaktime) <span class="sc">%&gt;%</span></span>
<span id="cb118-2413"><a href="#cb118-2413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">z_jld_peakmag =</span> (jld_peakmag <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">5</span>])<span class="sc">/</span>covsummary<span class="sc">$</span>sd[<span class="dv">5</span>],</span>
<span id="cb118-2414"><a href="#cb118-2414" aria-hidden="true" tabindex="-1"></a>         <span class="at">z_jld_peaktime =</span> (jld_peaktime <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">6</span>])<span class="sc">/</span>covsummary<span class="sc">$</span>sd[<span class="dv">6</span>])</span>
<span id="cb118-2415"><a href="#cb118-2415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2416"><a href="#cb118-2416" aria-hidden="true" tabindex="-1"></a>natcovs <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Derived/SnakeTribs_NaturalFlow_Covariates_BroodYear_1960-2022.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb118-2417"><a href="#cb118-2417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(site <span class="sc">==</span> <span class="st">"SnakeNat"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb118-2418"><a href="#cb118-2418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(broodyr, natq_peakmag, natq_peaktime) <span class="sc">%&gt;%</span></span>
<span id="cb118-2419"><a href="#cb118-2419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">z_natq_peakmag =</span> (natq_peakmag <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">7</span>])<span class="sc">/</span>covsummary<span class="sc">$</span>sd[<span class="dv">7</span>],</span>
<span id="cb118-2420"><a href="#cb118-2420" aria-hidden="true" tabindex="-1"></a>         <span class="at">z_natq_peaktime =</span> (natq_peaktime <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">8</span>])<span class="sc">/</span>covsummary<span class="sc">$</span>sd[<span class="dv">8</span>])</span>
<span id="cb118-2421"><a href="#cb118-2421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2422"><a href="#cb118-2422" aria-hidden="true" tabindex="-1"></a>mycovdat <span class="ot">&lt;-</span> mgdcovs <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(natcovs)</span>
<span id="cb118-2423"><a href="#cb118-2423" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-2424"><a href="#cb118-2424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2425"><a href="#cb118-2425" aria-hidden="true" tabindex="-1"></a>Number of values for calculation</span>
<span id="cb118-2428"><a href="#cb118-2428" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-2429"><a href="#cb118-2429" aria-hidden="true" tabindex="-1"></a>nvalues <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb118-2430"><a href="#cb118-2430" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-2431"><a href="#cb118-2431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2432"><a href="#cb118-2432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2433"><a href="#cb118-2433" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Peak flow magnitude</span></span>
<span id="cb118-2434"><a href="#cb118-2434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2435"><a href="#cb118-2435" aria-hidden="true" tabindex="-1"></a>Generate sequences of predictor data and transform to original scale</span>
<span id="cb118-2438"><a href="#cb118-2438" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-2439"><a href="#cb118-2439" aria-hidden="true" tabindex="-1"></a>xjld <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_jld_peakmag, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_jld_peakmag, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">length.out =</span> nvalues)</span>
<span id="cb118-2440"><a href="#cb118-2440" aria-hidden="true" tabindex="-1"></a>xnat <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_natq_peakmag, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_natq_peakmag, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">length.out =</span> nvalues)</span>
<span id="cb118-2441"><a href="#cb118-2441" aria-hidden="true" tabindex="-1"></a>xjld.real <span class="ot">&lt;-</span> (xjld <span class="sc">*</span> covsummary<span class="sc">$</span>sd[<span class="dv">5</span>]) <span class="sc">+</span> covsummary<span class="sc">$</span>mean[<span class="dv">5</span>]</span>
<span id="cb118-2442"><a href="#cb118-2442" aria-hidden="true" tabindex="-1"></a>xnat.real <span class="ot">&lt;-</span> (xnat <span class="sc">*</span> covsummary<span class="sc">$</span>sd[<span class="dv">7</span>]) <span class="sc">+</span> covsummary<span class="sc">$</span>mean[<span class="dv">7</span>]</span>
<span id="cb118-2443"><a href="#cb118-2443" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-2444"><a href="#cb118-2444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2445"><a href="#cb118-2445" aria-hidden="true" tabindex="-1"></a>Set up axes</span>
<span id="cb118-2448"><a href="#cb118-2448" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-2449"><a href="#cb118-2449" aria-hidden="true" tabindex="-1"></a>xjld.axis <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">4000</span>, <span class="at">to =</span> <span class="dv">12000</span>, <span class="at">by =</span> <span class="dv">2000</span>)</span>
<span id="cb118-2450"><a href="#cb118-2450" aria-hidden="true" tabindex="-1"></a>xjld.axis.scaled <span class="ot">&lt;-</span> (xjld.axis <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">5</span>]) <span class="sc">/</span> covsummary<span class="sc">$</span>sd[<span class="dv">5</span>]</span>
<span id="cb118-2451"><a href="#cb118-2451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2452"><a href="#cb118-2452" aria-hidden="true" tabindex="-1"></a>xnat.axis <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">5000</span>, <span class="at">to =</span> <span class="dv">20000</span>, <span class="at">by =</span> <span class="dv">5000</span>)</span>
<span id="cb118-2453"><a href="#cb118-2453" aria-hidden="true" tabindex="-1"></a>xnat.axis.scaled <span class="ot">&lt;-</span> (xnat.axis <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">7</span>]) <span class="sc">/</span> covsummary<span class="sc">$</span>sd[<span class="dv">7</span>]</span>
<span id="cb118-2454"><a href="#cb118-2454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-2455"><a href="#cb118-2455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2456"><a href="#cb118-2456" aria-hidden="true" tabindex="-1"></a>Predict productivity from model</span>
<span id="cb118-2459"><a href="#cb118-2459" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-2460"><a href="#cb118-2460" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> nvalues, <span class="at">ncol =</span> nvalues) <span class="co"># matrix of predictions</span></span>
<span id="cb118-2461"><a href="#cb118-2461" aria-hidden="true" tabindex="-1"></a>com <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> nvalues, <span class="at">ncol =</span> nvalues) <span class="co"># matrix of combined flow</span></span>
<span id="cb118-2462"><a href="#cb118-2462" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nvalues) {</span>
<span id="cb118-2463"><a href="#cb118-2463" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nvalues) {</span>
<span id="cb118-2464"><a href="#cb118-2464" aria-hidden="true" tabindex="-1"></a>    z[i,j] <span class="ot">&lt;-</span> param.summary[<span class="st">"mu.coef[5]"</span>,<span class="dv">5</span>]<span class="sc">*</span>xjld[i] <span class="sc">+</span> param.summary[<span class="st">"mu.coef[7]"</span>,<span class="dv">5</span>]<span class="sc">*</span>xnat[j] <span class="sc">+</span> param.summary[<span class="st">"mu.coef[13]"</span>,<span class="dv">5</span>]<span class="sc">*</span>xjld[i]<span class="sc">*</span>xnat[j]</span>
<span id="cb118-2465"><a href="#cb118-2465" aria-hidden="true" tabindex="-1"></a>    com[i,j] <span class="ot">&lt;-</span> (xjld.real[i]) <span class="sc">+</span> (xnat.real[j])</span>
<span id="cb118-2466"><a href="#cb118-2466" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb118-2467"><a href="#cb118-2467" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb118-2468"><a href="#cb118-2468" aria-hidden="true" tabindex="-1"></a>z.cont <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(z <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, z) <span class="co"># trick for plotting single contour</span></span>
<span id="cb118-2469"><a href="#cb118-2469" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(z)</span>
<span id="cb118-2470"><a href="#cb118-2470" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-2471"><a href="#cb118-2471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2472"><a href="#cb118-2472" aria-hidden="true" tabindex="-1"></a>Plot set up</span>
<span id="cb118-2475"><a href="#cb118-2475" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-2476"><a href="#cb118-2476" aria-hidden="true" tabindex="-1"></a>mylevels <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>) <span class="co"># specify location and number of breaks for plotting</span></span>
<span id="cb118-2477"><a href="#cb118-2477" aria-hidden="true" tabindex="-1"></a>mycols <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">hcl.colors</span>(<span class="fu">length</span>(mylevels)<span class="sc">-</span><span class="dv">1</span>, <span class="st">"Blue-Red 3"</span>))</span>
<span id="cb118-2478"><a href="#cb118-2478" aria-hidden="true" tabindex="-1"></a>myddd <span class="ot">&lt;-</span> mycovdat <span class="sc">%&gt;%</span> <span class="fu">select</span>(z_natq_peakmag, z_jld_peakmag) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(z_natq_peakmag))</span>
<span id="cb118-2479"><a href="#cb118-2479" aria-hidden="true" tabindex="-1"></a>myhull <span class="ot">&lt;-</span> <span class="fu">chull</span>(myddd)</span>
<span id="cb118-2480"><a href="#cb118-2480" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-2481"><a href="#cb118-2481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2482"><a href="#cb118-2482" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=6, fig.height=4.5}</span></span>
<span id="cb118-2483"><a href="#cb118-2483" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(5,5,1,1), mgp = c(3.5,1,0))</span></span>
<span id="cb118-2484"><a href="#cb118-2484" aria-hidden="true" tabindex="-1"></a><span class="in">filled.contour(x = xnat, y = xjld, z = t(z),</span></span>
<span id="cb118-2485"><a href="#cb118-2485" aria-hidden="true" tabindex="-1"></a><span class="in">               plot.title = {</span></span>
<span id="cb118-2486"><a href="#cb118-2486" aria-hidden="true" tabindex="-1"></a><span class="in">                 title(xlab = "Natural peak flow magnitude (cfs)")</span></span>
<span id="cb118-2487"><a href="#cb118-2487" aria-hidden="true" tabindex="-1"></a><span class="in">                 title(ylab = "Managed peak flow magnitude (cfs)")</span></span>
<span id="cb118-2488"><a href="#cb118-2488" aria-hidden="true" tabindex="-1"></a><span class="in">               },</span></span>
<span id="cb118-2489"><a href="#cb118-2489" aria-hidden="true" tabindex="-1"></a><span class="in">               levels = mylevels,</span></span>
<span id="cb118-2490"><a href="#cb118-2490" aria-hidden="true" tabindex="-1"></a><span class="in">               col = mycols,</span></span>
<span id="cb118-2491"><a href="#cb118-2491" aria-hidden="true" tabindex="-1"></a><span class="in">               plot.axes = {</span></span>
<span id="cb118-2492"><a href="#cb118-2492" aria-hidden="true" tabindex="-1"></a><span class="in">                 contour(x = xnat, y = xjld, z = t(z), levels = 0, lty = 3, lwd = 1, col = "grey40",</span></span>
<span id="cb118-2493"><a href="#cb118-2493" aria-hidden="true" tabindex="-1"></a><span class="in">                         drawlabels = F, axes = F, frame.plot = F, add = T);</span></span>
<span id="cb118-2494"><a href="#cb118-2494" aria-hidden="true" tabindex="-1"></a><span class="in">                 segments(myddd$z_natq_peakmag[myhull], myddd$z_jld_peakmag[myhull],</span></span>
<span id="cb118-2495"><a href="#cb118-2495" aria-hidden="true" tabindex="-1"></a><span class="in">                          myddd$z_natq_peakmag[c(myhull[length(myhull)], myhull[-length(myhull)])],</span></span>
<span id="cb118-2496"><a href="#cb118-2496" aria-hidden="true" tabindex="-1"></a><span class="in">                          myddd$z_jld_peakmag[c(myhull[length(myhull)], myhull[-length(myhull)])],</span></span>
<span id="cb118-2497"><a href="#cb118-2497" aria-hidden="true" tabindex="-1"></a><span class="in">                          col = "grey40", lwd = 2) # Draw convex hull lines</span></span>
<span id="cb118-2498"><a href="#cb118-2498" aria-hidden="true" tabindex="-1"></a><span class="in">                 axis(1, at = xnat.axis.scaled, labels = xnat.axis); </span></span>
<span id="cb118-2499"><a href="#cb118-2499" aria-hidden="true" tabindex="-1"></a><span class="in">                 axis(2, at = xjld.axis.scaled, labels = xjld.axis)</span></span>
<span id="cb118-2500"><a href="#cb118-2500" aria-hidden="true" tabindex="-1"></a><span class="in">               })</span></span>
<span id="cb118-2501"><a href="#cb118-2501" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-2502"><a href="#cb118-2502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2503"><a href="#cb118-2503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2504"><a href="#cb118-2504" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb118-2505"><a href="#cb118-2505" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Marginal Effects/ReddCounts_Ricker_CovarModel_MarginalEffects_13_PeakMagnitude_Interaction.jpg", units = "in", width = 6, height = 4.5, res = 1500)</span></span>
<span id="cb118-2506"><a href="#cb118-2506" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(5,5,1,1), mgp = c(3.5,1,0))</span></span>
<span id="cb118-2507"><a href="#cb118-2507" aria-hidden="true" tabindex="-1"></a><span class="in">filled.contour(x = xnat, y = xjld, z = t(z),</span></span>
<span id="cb118-2508"><a href="#cb118-2508" aria-hidden="true" tabindex="-1"></a><span class="in">               plot.title = {</span></span>
<span id="cb118-2509"><a href="#cb118-2509" aria-hidden="true" tabindex="-1"></a><span class="in">                 title(xlab = "Natural peak flow magnitude (cfs)")</span></span>
<span id="cb118-2510"><a href="#cb118-2510" aria-hidden="true" tabindex="-1"></a><span class="in">                 title(ylab = "Managed peak flow magnitude (cfs)")</span></span>
<span id="cb118-2511"><a href="#cb118-2511" aria-hidden="true" tabindex="-1"></a><span class="in">               },</span></span>
<span id="cb118-2512"><a href="#cb118-2512" aria-hidden="true" tabindex="-1"></a><span class="in">               levels = mylevels,</span></span>
<span id="cb118-2513"><a href="#cb118-2513" aria-hidden="true" tabindex="-1"></a><span class="in">               col = mycols,</span></span>
<span id="cb118-2514"><a href="#cb118-2514" aria-hidden="true" tabindex="-1"></a><span class="in">               plot.axes = {</span></span>
<span id="cb118-2515"><a href="#cb118-2515" aria-hidden="true" tabindex="-1"></a><span class="in">                 contour(x = xnat, y = xjld, z = t(z), levels = 0, lty = 3, lwd = 1, col = "grey40",</span></span>
<span id="cb118-2516"><a href="#cb118-2516" aria-hidden="true" tabindex="-1"></a><span class="in">                         drawlabels = F, axes = F, frame.plot = F, add = T);</span></span>
<span id="cb118-2517"><a href="#cb118-2517" aria-hidden="true" tabindex="-1"></a><span class="in">                 segments(myddd$z_natq_peakmag[myhull], myddd$z_jld_peakmag[myhull],</span></span>
<span id="cb118-2518"><a href="#cb118-2518" aria-hidden="true" tabindex="-1"></a><span class="in">                          myddd$z_natq_peakmag[c(myhull[length(myhull)], myhull[-length(myhull)])],</span></span>
<span id="cb118-2519"><a href="#cb118-2519" aria-hidden="true" tabindex="-1"></a><span class="in">                          myddd$z_jld_peakmag[c(myhull[length(myhull)], myhull[-length(myhull)])],</span></span>
<span id="cb118-2520"><a href="#cb118-2520" aria-hidden="true" tabindex="-1"></a><span class="in">                          col = "grey40", lwd = 2) # Draw convex hull lines</span></span>
<span id="cb118-2521"><a href="#cb118-2521" aria-hidden="true" tabindex="-1"></a><span class="in">                 axis(1, at = xnat.axis.scaled, labels = xnat.axis); </span></span>
<span id="cb118-2522"><a href="#cb118-2522" aria-hidden="true" tabindex="-1"></a><span class="in">                 axis(2, at = xjld.axis.scaled, labels = xjld.axis)</span></span>
<span id="cb118-2523"><a href="#cb118-2523" aria-hidden="true" tabindex="-1"></a><span class="in">               })</span></span>
<span id="cb118-2524"><a href="#cb118-2524" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-2525"><a href="#cb118-2525" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-2526"><a href="#cb118-2526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2527"><a href="#cb118-2527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2528"><a href="#cb118-2528" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Peak flow timing</span></span>
<span id="cb118-2529"><a href="#cb118-2529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2530"><a href="#cb118-2530" aria-hidden="true" tabindex="-1"></a>Generate sequences of predictor data and transform to original scale</span>
<span id="cb118-2533"><a href="#cb118-2533" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-2534"><a href="#cb118-2534" aria-hidden="true" tabindex="-1"></a>xjld <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_jld_peaktime, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_jld_peaktime, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">length.out =</span> nvalues)</span>
<span id="cb118-2535"><a href="#cb118-2535" aria-hidden="true" tabindex="-1"></a>xnat <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_natq_peaktime, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_natq_peaktime, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">length.out =</span> nvalues)</span>
<span id="cb118-2536"><a href="#cb118-2536" aria-hidden="true" tabindex="-1"></a>xjld.real <span class="ot">&lt;-</span> (xjld <span class="sc">*</span> covsummary<span class="sc">$</span>sd[<span class="dv">6</span>]) <span class="sc">+</span> covsummary<span class="sc">$</span>mean[<span class="dv">6</span>]</span>
<span id="cb118-2537"><a href="#cb118-2537" aria-hidden="true" tabindex="-1"></a>xnat.real <span class="ot">&lt;-</span> (xnat <span class="sc">*</span> covsummary<span class="sc">$</span>sd[<span class="dv">8</span>]) <span class="sc">+</span> covsummary<span class="sc">$</span>mean[<span class="dv">8</span>]</span>
<span id="cb118-2538"><a href="#cb118-2538" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-2539"><a href="#cb118-2539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2540"><a href="#cb118-2540" aria-hidden="true" tabindex="-1"></a>Set up axes</span>
<span id="cb118-2543"><a href="#cb118-2543" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-2544"><a href="#cb118-2544" aria-hidden="true" tabindex="-1"></a>xjld.axis <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">242</span>, <span class="dv">273</span>, <span class="dv">303</span>)</span>
<span id="cb118-2545"><a href="#cb118-2545" aria-hidden="true" tabindex="-1"></a>xjld.axis.scaled <span class="ot">&lt;-</span> (xjld.axis <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">6</span>]) <span class="sc">/</span> covsummary<span class="sc">$</span>sd[<span class="dv">6</span>]</span>
<span id="cb118-2546"><a href="#cb118-2546" aria-hidden="true" tabindex="-1"></a>xjld.axis.labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1 May"</span>, <span class="st">"1 June"</span>, <span class="st">"1 July"</span>)</span>
<span id="cb118-2547"><a href="#cb118-2547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2548"><a href="#cb118-2548" aria-hidden="true" tabindex="-1"></a>xnat.axis <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">256</span>, <span class="dv">273</span>, <span class="dv">287</span>, <span class="dv">303</span>)</span>
<span id="cb118-2549"><a href="#cb118-2549" aria-hidden="true" tabindex="-1"></a>xnat.axis.scaled <span class="ot">&lt;-</span> (xnat.axis <span class="sc">-</span> covsummary<span class="sc">$</span>mean[<span class="dv">8</span>]) <span class="sc">/</span> covsummary<span class="sc">$</span>sd[<span class="dv">8</span>]</span>
<span id="cb118-2550"><a href="#cb118-2550" aria-hidden="true" tabindex="-1"></a>xnat.axis.labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"15 May"</span>, <span class="st">"1 June"</span>, <span class="st">"15 June"</span>, <span class="st">"1 July"</span>)</span>
<span id="cb118-2551"><a href="#cb118-2551" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-2552"><a href="#cb118-2552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2553"><a href="#cb118-2553" aria-hidden="true" tabindex="-1"></a>Predict productivity from model</span>
<span id="cb118-2556"><a href="#cb118-2556" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-2557"><a href="#cb118-2557" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> nvalues, <span class="at">ncol =</span> nvalues) <span class="co"># matrix of predictions</span></span>
<span id="cb118-2558"><a href="#cb118-2558" aria-hidden="true" tabindex="-1"></a>com <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> nvalues, <span class="at">ncol =</span> nvalues) <span class="co"># matrix of combined flow</span></span>
<span id="cb118-2559"><a href="#cb118-2559" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nvalues) {</span>
<span id="cb118-2560"><a href="#cb118-2560" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nvalues) {</span>
<span id="cb118-2561"><a href="#cb118-2561" aria-hidden="true" tabindex="-1"></a>    z[i,j] <span class="ot">&lt;-</span> param.summary[<span class="st">"mu.coef[6]"</span>,<span class="dv">5</span>]<span class="sc">*</span>xjld[i] <span class="sc">+</span> param.summary[<span class="st">"mu.coef[8]"</span>,<span class="dv">5</span>]<span class="sc">*</span>xnat[j] <span class="sc">+</span> param.summary[<span class="st">"mu.coef[14]"</span>,<span class="dv">5</span>]<span class="sc">*</span>xjld[i]<span class="sc">*</span>xnat[j]</span>
<span id="cb118-2562"><a href="#cb118-2562" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb118-2563"><a href="#cb118-2563" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb118-2564"><a href="#cb118-2564" aria-hidden="true" tabindex="-1"></a>z.cont <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(z <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, z) <span class="co"># trick for plotting single contour</span></span>
<span id="cb118-2565"><a href="#cb118-2565" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(z)</span>
<span id="cb118-2566"><a href="#cb118-2566" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-2567"><a href="#cb118-2567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2568"><a href="#cb118-2568" aria-hidden="true" tabindex="-1"></a>Plot set up</span>
<span id="cb118-2571"><a href="#cb118-2571" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb118-2572"><a href="#cb118-2572" aria-hidden="true" tabindex="-1"></a>mylevels <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>) <span class="co"># specify location and number of breaks for plotting</span></span>
<span id="cb118-2573"><a href="#cb118-2573" aria-hidden="true" tabindex="-1"></a>mycols <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">hcl.colors</span>(<span class="fu">length</span>(mylevels)<span class="sc">-</span><span class="dv">1</span>, <span class="st">"Blue-Red 3"</span>))</span>
<span id="cb118-2574"><a href="#cb118-2574" aria-hidden="true" tabindex="-1"></a>myddd <span class="ot">&lt;-</span> mycovdat <span class="sc">%&gt;%</span> <span class="fu">select</span>(z_natq_peaktime, z_jld_peaktime) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(z_natq_peaktime), <span class="sc">!</span><span class="fu">is.na</span>(z_jld_peaktime))</span>
<span id="cb118-2575"><a href="#cb118-2575" aria-hidden="true" tabindex="-1"></a>myhull <span class="ot">&lt;-</span> <span class="fu">chull</span>(myddd)</span>
<span id="cb118-2576"><a href="#cb118-2576" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-2577"><a href="#cb118-2577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2578"><a href="#cb118-2578" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=6, fig.height=4.5}</span></span>
<span id="cb118-2579"><a href="#cb118-2579" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(5,5,1,1), mgp = c(3.5,1,0))</span></span>
<span id="cb118-2580"><a href="#cb118-2580" aria-hidden="true" tabindex="-1"></a><span class="in">filled.contour(x = xnat, y = xjld, z = t(z),</span></span>
<span id="cb118-2581"><a href="#cb118-2581" aria-hidden="true" tabindex="-1"></a><span class="in">               plot.title = {</span></span>
<span id="cb118-2582"><a href="#cb118-2582" aria-hidden="true" tabindex="-1"></a><span class="in">                 title(xlab = "Natural peak flow timing")</span></span>
<span id="cb118-2583"><a href="#cb118-2583" aria-hidden="true" tabindex="-1"></a><span class="in">                 title(ylab = "Managed peak flow timing")</span></span>
<span id="cb118-2584"><a href="#cb118-2584" aria-hidden="true" tabindex="-1"></a><span class="in">               },</span></span>
<span id="cb118-2585"><a href="#cb118-2585" aria-hidden="true" tabindex="-1"></a><span class="in">               levels = mylevels,</span></span>
<span id="cb118-2586"><a href="#cb118-2586" aria-hidden="true" tabindex="-1"></a><span class="in">               col = mycols,</span></span>
<span id="cb118-2587"><a href="#cb118-2587" aria-hidden="true" tabindex="-1"></a><span class="in">               plot.axes = {</span></span>
<span id="cb118-2588"><a href="#cb118-2588" aria-hidden="true" tabindex="-1"></a><span class="in">                 contour(x = xnat, y = xjld, z = t(z), levels = 0, lty = 3, lwd = 1, col = "grey40",</span></span>
<span id="cb118-2589"><a href="#cb118-2589" aria-hidden="true" tabindex="-1"></a><span class="in">                         drawlabels = F, axes = F, frame.plot = F, add = T);</span></span>
<span id="cb118-2590"><a href="#cb118-2590" aria-hidden="true" tabindex="-1"></a><span class="in">                 segments(myddd$z_natq_peaktime[myhull], myddd$z_jld_peaktime[myhull],</span></span>
<span id="cb118-2591"><a href="#cb118-2591" aria-hidden="true" tabindex="-1"></a><span class="in">                          myddd$z_natq_peaktime[c(myhull[length(myhull)], myhull[-length(myhull)])],</span></span>
<span id="cb118-2592"><a href="#cb118-2592" aria-hidden="true" tabindex="-1"></a><span class="in">                          myddd$z_jld_peaktime[c(myhull[length(myhull)], myhull[-length(myhull)])],</span></span>
<span id="cb118-2593"><a href="#cb118-2593" aria-hidden="true" tabindex="-1"></a><span class="in">                          col = "grey40", lwd = 2) # Draw convex hull lines</span></span>
<span id="cb118-2594"><a href="#cb118-2594" aria-hidden="true" tabindex="-1"></a><span class="in">                 axis(1, at = xnat.axis.scaled, labels = xnat.axis.labels);</span></span>
<span id="cb118-2595"><a href="#cb118-2595" aria-hidden="true" tabindex="-1"></a><span class="in">                 axis(2, at = xjld.axis.scaled, labels = xjld.axis.labels)</span></span>
<span id="cb118-2596"><a href="#cb118-2596" aria-hidden="true" tabindex="-1"></a><span class="in">               })</span></span>
<span id="cb118-2597"><a href="#cb118-2597" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-2598"><a href="#cb118-2598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2599"><a href="#cb118-2599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2600"><a href="#cb118-2600" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb118-2601"><a href="#cb118-2601" aria-hidden="true" tabindex="-1"></a><span class="in">jpeg("Figures/Marginal Effects/ReddCounts_Ricker_CovarModel_MarginalEffects_14_PeakTiming_Interaction.jpg", units = "in", width = 6, height = 4.5, res = 1500)</span></span>
<span id="cb118-2602"><a href="#cb118-2602" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(5,5,1,1), mgp = c(3.5,1,0))</span></span>
<span id="cb118-2603"><a href="#cb118-2603" aria-hidden="true" tabindex="-1"></a><span class="in">filled.contour(x = xnat, y = xjld, z = t(z),</span></span>
<span id="cb118-2604"><a href="#cb118-2604" aria-hidden="true" tabindex="-1"></a><span class="in">               plot.title = {</span></span>
<span id="cb118-2605"><a href="#cb118-2605" aria-hidden="true" tabindex="-1"></a><span class="in">                 title(xlab = "Natural peak flow timing")</span></span>
<span id="cb118-2606"><a href="#cb118-2606" aria-hidden="true" tabindex="-1"></a><span class="in">                 title(ylab = "Managed peak flow timing")</span></span>
<span id="cb118-2607"><a href="#cb118-2607" aria-hidden="true" tabindex="-1"></a><span class="in">               },</span></span>
<span id="cb118-2608"><a href="#cb118-2608" aria-hidden="true" tabindex="-1"></a><span class="in">               levels = mylevels,</span></span>
<span id="cb118-2609"><a href="#cb118-2609" aria-hidden="true" tabindex="-1"></a><span class="in">               col = mycols,</span></span>
<span id="cb118-2610"><a href="#cb118-2610" aria-hidden="true" tabindex="-1"></a><span class="in">               plot.axes = {</span></span>
<span id="cb118-2611"><a href="#cb118-2611" aria-hidden="true" tabindex="-1"></a><span class="in">                 contour(x = xnat, y = xjld, z = t(z), levels = 0, lty = 3, lwd = 1, col = "grey40",</span></span>
<span id="cb118-2612"><a href="#cb118-2612" aria-hidden="true" tabindex="-1"></a><span class="in">                         drawlabels = F, axes = F, frame.plot = F, add = T);</span></span>
<span id="cb118-2613"><a href="#cb118-2613" aria-hidden="true" tabindex="-1"></a><span class="in">                 segments(myddd$z_natq_peaktime[myhull], myddd$z_jld_peaktime[myhull],</span></span>
<span id="cb118-2614"><a href="#cb118-2614" aria-hidden="true" tabindex="-1"></a><span class="in">                          myddd$z_natq_peaktime[c(myhull[length(myhull)], myhull[-length(myhull)])],</span></span>
<span id="cb118-2615"><a href="#cb118-2615" aria-hidden="true" tabindex="-1"></a><span class="in">                          myddd$z_jld_peaktime[c(myhull[length(myhull)], myhull[-length(myhull)])],</span></span>
<span id="cb118-2616"><a href="#cb118-2616" aria-hidden="true" tabindex="-1"></a><span class="in">                          col = "grey40", lwd = 2) # Draw convex hull lines</span></span>
<span id="cb118-2617"><a href="#cb118-2617" aria-hidden="true" tabindex="-1"></a><span class="in">                 axis(1, at = xnat.axis.scaled, labels = xnat.axis.labels);</span></span>
<span id="cb118-2618"><a href="#cb118-2618" aria-hidden="true" tabindex="-1"></a><span class="in">                 axis(2, at = xjld.axis.scaled, labels = xjld.axis.labels)</span></span>
<span id="cb118-2619"><a href="#cb118-2619" aria-hidden="true" tabindex="-1"></a><span class="in">               })</span></span>
<span id="cb118-2620"><a href="#cb118-2620" aria-hidden="true" tabindex="-1"></a><span class="in">dev.off()</span></span>
<span id="cb118-2621"><a href="#cb118-2621" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-2622"><a href="#cb118-2622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2623"><a href="#cb118-2623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2624"><a href="#cb118-2624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2625"><a href="#cb118-2625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2626"><a href="#cb118-2626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2627"><a href="#cb118-2627" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>