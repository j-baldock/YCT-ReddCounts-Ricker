{
  "hash": "a0f21f68a73ae66bea1a536d59e513ba",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"GCM Data Summary\"\n---\n\n\n\n\n\n\n\nPurpose: Generate future seasonal mean air temperature projections from GCM data (Rahimi *et al.* 2024, Geoscientific Model Development)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## Generate seasonal projections\n\nSome misc. objects\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npatt <- c(\"t2min_atStation_corrected\", \"t2max_atStation_corrected\", \"t2min_atStation_original\", \"t2max_atStation_original\")\nsumm <- c(\"min\", \"max\", \"min\", \"max\")\ntype <- c(\"corrected\", \"corrected\", \"original\", \"original\")\nmylist <- list()\n```\n:::\n\n\n\n\n\n\nPull in climate projection data\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfor(i in 1:length(patt)) {\n  myfiles <- list.files(\"Data/GCM Archive\", pattern = patt[i], full.names = TRUE)\n  dat <- read_csv(myfiles, id = \"file_name\")[,c(1,2,5)] %>% mutate(summ = summ[i], type = type[i], gcm = str_match(file_name, \"Archive/\\\\s*(.*?)\\\\s*_t2\")[,2])\n  dat <- dat %>% select(6,4,5,2,3) %>% rename(date = 4, temp = 5)\n  mylist[[i]] <- dat\n  #print(i)\n}\ndat <- do.call(rbind, mylist)\nsummary(dat)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     gcm                summ               type                date           \n Length:2604648     Length:2604648     Length:2604648     Min.   :1980-10-01  \n Class :character   Class :character   Class :character   1st Qu.:2010-07-01  \n Mode  :character   Mode  :character   Mode  :character   Median :2040-04-01  \n                                                          Mean   :2040-03-31  \n                                                          3rd Qu.:2069-12-31  \n                                                          Max.   :2099-09-30  \n                                                          NA's   :836         \n      temp      \n Min.   :217.5  \n 1st Qu.:269.5  \n Median :276.6  \n Mean   :277.9  \n 3rd Qu.:286.6  \n Max.   :315.6  \n                \n```\n\n\n:::\n\n```{.r .cell-code}\nhead(dat)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 5\n  gcm                 summ  type      date        temp\n  <chr>               <chr> <chr>     <date>     <dbl>\n1 access-cm2_r5i1p1f1 min   corrected 1980-10-01  268.\n2 access-cm2_r5i1p1f1 min   corrected 1980-10-02  257.\n3 access-cm2_r5i1p1f1 min   corrected 1980-10-03  253.\n4 access-cm2_r5i1p1f1 min   corrected 1980-10-04  260.\n5 access-cm2_r5i1p1f1 min   corrected 1980-10-05  267.\n6 access-cm2_r5i1p1f1 min   corrected 1980-10-06  271.\n```\n\n\n:::\n:::\n\n\n\n\n\n\nNotes:\n\n* Some GCMs do not predict for Feb 29 (leap years)\n* ukesm1-0-ll_r2i1p1f2 predicts for 30 days per month, even in Feb (but does not actually have dates for Feb 29/30)\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nview(dat %>% group_by(gcm, summ, type) %>% summarise(mind = min(date, na.rm = T), maxd = max(date, na.rm = T), n = n()))\n```\n:::\n\n\n\n\n\n\nSome GCMs do not predict for Feb 29 (leap years)...drop NAs\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- dat %>% filter(!is.na(date))\n```\n:::\n\n\n\n\n\n\nFind daily mean temp for each climate model\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat2 <- dat %>% group_by(gcm, type, date) %>% summarize(temp_mean = mean(temp)-273.15) %>% ungroup()\ndat2 %>% group_by(gcm) %>% summarise(mind = min(date), maxd = max(date), n = n())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 15 × 4\n   gcm                    mind       maxd           n\n   <chr>                  <date>     <date>     <int>\n 1 access-cm2_r5i1p1f1    1980-10-01 2099-09-30 86928\n 2 canesm5_r1i1p2f1       1980-10-01 2099-09-30 86870\n 3 cesm2_r11i1p1f1        1980-10-01 2099-09-30 86870\n 4 cnrm-esm2-1_r1i1p1f2   1980-10-01 2099-09-30 86928\n 5 ec-earth3-veg_r1i1p1f1 1980-10-01 2099-09-30 86928\n 6 ec-earth3_r1i1p1f1     1980-10-01 2099-09-30 86928\n 7 fgoals-g3_r1i1p1f1     1980-10-01 2099-09-30 86870\n 8 giss-e2-1-g_r1i1p1f2   1980-10-01 2099-09-30 86870\n 9 miroc6_r1i1p1f1        1980-10-01 2099-09-30 86928\n10 mpi-esm1-2-hr_r3i1p1f1 1980-10-01 2099-09-30 86928\n11 mpi-esm1-2-hr_r7i1p1f1 1980-10-01 2099-09-30 86928\n12 mpi-esm1-2-lr_r7i1p1f1 1980-10-01 2099-09-30 86928\n13 noresm2-mm_r1i1p1f1    1980-10-01 2099-09-30 86870\n14 taiesm1_r1i1p1f1       1980-10-01 2099-09-30 86870\n15 ukesm1-0-ll_r2i1p1f2   1980-10-01 2099-09-30 85262\n```\n\n\n:::\n\n```{.r .cell-code}\n#sum(is.na(dat2$temp_mean))\n```\n:::\n\n\n\n\n\n\n### Vizualize raw GCM data\n\nGroup by year, plot time series of annual means.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat2 %>% mutate(year = year(date)) %>% group_by(gcm, year) %>% summarize(ann_temp = mean(temp_mean)) %>% ggplot() + geom_line(aes(x = year, y = ann_temp, group = gcm, colour = gcm))\n```\n\n::: {.cell-output-display}\n![](ClimateProjectionData_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\nView corrected daily (mean) air temp for a single year (1981)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat2 %>% filter(date >= \"1981-01-01\" & date <= \"1981-12-31\", type == \"corrected\") %>% ggplot() + geom_line(aes(x = date, y = temp_mean, group = gcm, colour = gcm))\n```\n\n::: {.cell-output-display}\n![](ClimateProjectionData_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n\n### Summarize across seasons\n\nSummarize GCM data across four seasons\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat2 <- dat2 %>% mutate(season = ifelse(month(date) %in% c(9,10,11), \"fal\",\n                                        ifelse(month(date) %in% c(12,1,2), \"win\",\n                                               ifelse(month(date) %in% c(3,4,5), \"spr\", \"sum\"))))\ndat3 <- dat2 %>% group_by(gcm, type, season, year(date)) %>% summarize(temp_mean = mean(temp_mean)) %>% rename(year = 4)\n```\n:::\n\n\n\n\n\n\nPlot time series of seasonal mean air temperature:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat3 %>% ggplot() + geom_line(aes(x = year, y = temp_mean, group = gcm, colour = gcm)) + facet_wrap(~season)\n```\n\n::: {.cell-output-display}\n![](ClimateProjectionData_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n\n### Summarize across GCMs\n\nSummarize seasonal mean air temperature across 15 GCMs\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat_summ <- dat3 %>% group_by(type, season, year) %>% summarize(count = n(), temp_avg = mean(temp_mean, na.rm = T), temp_sd = sd(temp_mean, na.rm = T), temp_min = min(temp_mean, na.rm = T), temp_max = max(temp_mean, na.rm = T)) %>% ungroup()\n```\n:::\n\n\n\n\n\n\nPlot raw and corrected output: mean min and max\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat_summ %>% ggplot() + geom_line(aes(x = year, y = temp_avg)) + geom_line(aes(x = year, y = temp_min), color = 4) + geom_line(aes(x = year, y = temp_max), color = 2) + facet_wrap(~season + type)\n```\n\n::: {.cell-output-display}\n![](ClimateProjectionData_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\nView winter corrected only:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat_summ %>% filter(season == \"win\", type == \"corrected\") %>% ggplot() + geom_line(aes(x = year, y = temp_avg)) + geom_line(aes(x = year, y = temp_min), linetype = 2) + geom_line(aes(x = year, y = temp_max), linetype = 2) \n```\n\n::: {.cell-output-display}\n![](ClimateProjectionData_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n\n### Write out data files\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(dat3, \"Data/Derived/SeasonalMeanAirTemp_byGCM_1980-2099.csv\")\nwrite_csv(dat_summ, \"Data/Derived/SeasonalMeanAirTemp_Summarized_1980-2099.csv\")\n```\n:::\n\n\n\n\n\n\n\n### Read derived data\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat3 <- read_csv(\"Data/Derived/SeasonalMeanAirTemp_byGCM_1980-2099.csv\")\ndat_summ <- read_csv(\"Data/Derived/SeasonalMeanAirTemp_Summarized_1980-2099.csv\")\n```\n:::\n\n\n\n\n\n\n\n## Compare to observed data\n\nLoad NWS air temperature data from Moose, WY\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nairsum <- read_csv(\"Data/Derived/AirTemperature_Covariates_BroodYear_1960-2022.csv\")\n```\n:::\n\n\n\n\n\n\n\nCompare observed data with projections from individual GCMs\n\n::: panel-tabset\n\n#### Autumn\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + \n  geom_line(data = dat3 %>% filter(season == \"fal\"), aes(x = year, y = temp_mean, group = gcm, colour = gcm)) +\n  geom_line(data = airsum %>% filter(site == \"moose\"), aes(x = broodyr, y = temp_falmean), size = 1.2) + xlim(1960,2100) +\n  facet_wrap(~ type, ncol = 2) + theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](ClimateProjectionData_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n#### Winter\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + \n  geom_line(data = dat3 %>% filter(season == \"win\"), aes(x = year, y = temp_mean, group = gcm, colour = gcm)) +\n  geom_line(data = airsum %>% filter(site == \"moose\"), aes(x = broodyr, y = temp_winmean), size = 1.2) + xlim(1960,2100) +\n  facet_wrap(~ type, ncol = 2) + theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](ClimateProjectionData_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n#### Spring\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + \n  geom_line(data = dat3 %>% filter(season == \"spr\"), aes(x = year, y = temp_mean, group = gcm, colour = gcm)) +\n  geom_line(data = airsum %>% filter(site == \"moose\"), aes(x = broodyr, y = temp_sprmean), size = 1.2) + xlim(1960,2100) +\n  facet_wrap(~ type, ncol = 2) + theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](ClimateProjectionData_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n#### Summer\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + \n  geom_line(data = dat3 %>% filter(season == \"sum\"), aes(x = year, y = temp_mean, group = gcm, colour = gcm)) +\n  geom_line(data = airsum %>% filter(site == \"moose\"), aes(x = broodyr, y = temp_summean), size = 1.2) + xlim(1960,2100) +\n  facet_wrap(~ type, ncol = 2) + theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](ClimateProjectionData_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n::: \n\n\nCompare observed data with projections summarized across all GCMs\n\n::: panel-tabset\n\n#### Autumn\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + \n  geom_line(data = dat_summ %>% filter(season == \"fal\"), aes(x = year, y = temp_avg)) + \n  geom_line(data = dat_summ %>% filter(season == \"fal\"), aes(x = year, y = temp_min), color = 4) + \n  geom_line(data = dat_summ %>% filter(season == \"fal\"), aes(x = year, y = temp_max), color = 2) +\n  geom_line(data = airsum %>% filter(site == \"moose\"), aes(x = broodyr, y = temp_falmean), size = 1.2) + xlim(1960,2100) +\n  facet_wrap(~ type, ncol = 2) + theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](ClimateProjectionData_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n#### Winter\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + \n  geom_line(data = dat_summ %>% filter(season == \"win\"), aes(x = year, y = temp_avg)) + \n  geom_line(data = dat_summ %>% filter(season == \"win\"), aes(x = year, y = temp_min), color = 4) + \n  geom_line(data = dat_summ %>% filter(season == \"win\"), aes(x = year, y = temp_max), color = 2) +\n  geom_line(data = airsum %>% filter(site == \"moose\"), aes(x = broodyr, y = temp_winmean), size = 1.2) + xlim(1960,2100) +\n  facet_wrap(~ type, ncol = 2) + theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](ClimateProjectionData_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n#### Spring\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + \n  geom_line(data = dat_summ %>% filter(season == \"spr\"), aes(x = year, y = temp_avg)) + \n  geom_line(data = dat_summ %>% filter(season == \"spr\"), aes(x = year, y = temp_min), color = 4) + \n  geom_line(data = dat_summ %>% filter(season == \"spr\"), aes(x = year, y = temp_max), color = 2) +\n  geom_line(data = airsum %>% filter(site == \"moose\"), aes(x = broodyr, y = temp_sprmean), size = 1.2) + xlim(1960,2100) +\n  facet_wrap(~ type, ncol = 2) + theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](ClimateProjectionData_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n#### Summer\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + \n  geom_line(data = dat_summ %>% filter(season == \"sum\"), aes(x = year, y = temp_avg)) + \n  geom_line(data = dat_summ %>% filter(season == \"sum\"), aes(x = year, y = temp_min), color = 4) + \n  geom_line(data = dat_summ %>% filter(season == \"sum\"), aes(x = year, y = temp_max), color = 2) +\n  geom_line(data = airsum %>% filter(site == \"moose\"), aes(x = broodyr, y = temp_summean), size = 1.2) + xlim(1960,2100) +\n  facet_wrap(~ type, ncol = 2) + theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](ClimateProjectionData_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n:::\n\n\nCombined plot for supplementary file\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## Exceedance timeline\n\nWhen will projected seasonal means consistently exceed observed data (w/in the time frame of redd count monitoring)?\n\n* Autumn: 2045-2050\n* Winter: 2083\n* Spring: 2065\n* Summer: 2050-2055\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmaxobs <- airsum %>% filter(site == \"moose\", broodyr %in% c(1980:2015)) %>% group_by(site) %>% summarise(maxfal = max(temp_falmean, na.rm = T), maxwin = max(temp_winmean, na.rm = T), maxspr = max(temp_sprmean, na.rm = T), maxsum = max(temp_summean, na.rm = T))\n\ndat_summ %>% filter(type == \"corrected\", season == \"fal\", temp_avg >= c(maxobs[1,2])) # 2045-2050\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 56 × 8\n   type      season  year count temp_avg temp_sd temp_min temp_max\n   <chr>     <chr>  <dbl> <dbl>    <dbl>   <dbl>    <dbl>    <dbl>\n 1 corrected fal     2036    15     6.18   0.994     4.82     7.75\n 2 corrected fal     2042    15     6.21   1.11      4.34     7.88\n 3 corrected fal     2043    15     6.62   1.23      4.51     8.71\n 4 corrected fal     2046    15     6.29   1.62      3.64    10.1 \n 5 corrected fal     2047    15     6.63   1.24      5.16    10.0 \n 6 corrected fal     2049    15     6.71   1.54      3.29     9.42\n 7 corrected fal     2050    15     6.34   1.31      4.42     9.01\n 8 corrected fal     2051    15     6.25   1.85      2.83     9.07\n 9 corrected fal     2052    15     6.50   1.81      1.99    10.1 \n10 corrected fal     2053    15     6.88   1.32      4.98    10.2 \n# ℹ 46 more rows\n```\n\n\n:::\n\n```{.r .cell-code}\ndat_summ %>% filter(type == \"corrected\", season == \"win\", temp_avg >= c(maxobs[1,3])) # 2083\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 16 × 8\n   type      season  year count temp_avg temp_sd temp_min temp_max\n   <chr>     <chr>  <dbl> <dbl>    <dbl>   <dbl>    <dbl>    <dbl>\n 1 corrected win     2083    15    -5.10    1.62    -7.54   -1.86 \n 2 corrected win     2084    15    -5.52    1.92    -8.86   -2.59 \n 3 corrected win     2085    15    -5.63    1.84    -9.09   -2.57 \n 4 corrected win     2086    15    -5.58    2.06    -7.68   -0.963\n 5 corrected win     2088    15    -5.00    1.71    -7.36   -1.47 \n 6 corrected win     2089    15    -5.68    1.77    -8.32   -2.08 \n 7 corrected win     2090    15    -5.73    2.53   -11.2    -1.29 \n 8 corrected win     2091    15    -5.20    2.25    -9.76   -1.64 \n 9 corrected win     2092    15    -5.54    2.28   -10.7    -0.699\n10 corrected win     2093    15    -4.81    2.05    -7.88   -0.445\n11 corrected win     2094    15    -5.70    1.47    -7.95   -2.92 \n12 corrected win     2095    15    -5.34    1.99    -8.69   -2.11 \n13 corrected win     2096    15    -4.91    2.21    -8.06    0.928\n14 corrected win     2097    15    -5.34    1.38    -7.22   -3.64 \n15 corrected win     2098    15    -4.97    2.30    -8.54   -1.71 \n16 corrected win     2099    15    -5.05    2.97   -12.3     0.517\n```\n\n\n:::\n\n```{.r .cell-code}\ndat_summ %>% filter(type == \"corrected\", season == \"spr\", temp_avg >= c(maxobs[1,4])) # 2065\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 37 × 8\n   type      season  year count temp_avg temp_sd temp_min temp_max\n   <chr>     <chr>  <dbl> <dbl>    <dbl>   <dbl>    <dbl>    <dbl>\n 1 corrected spr     2060    15     5.45    2.16     1.08     9.80\n 2 corrected spr     2061    15     5.55    1.28     1.89     7.24\n 3 corrected spr     2065    15     5.54    1.47     3.15     8.73\n 4 corrected spr     2066    15     5.76    2.03     1.27     8.69\n 5 corrected spr     2067    15     5.66    1.67     2.06     8.41\n 6 corrected spr     2068    15     5.47    1.46     3.52     8.27\n 7 corrected spr     2069    15     5.52    1.90     2.03     8.60\n 8 corrected spr     2070    15     5.76    1.93     1.93     9.33\n 9 corrected spr     2071    15     6.12    1.84     2.84     8.98\n10 corrected spr     2072    15     6.40    2.12     2.76    11.3 \n# ℹ 27 more rows\n```\n\n\n:::\n\n```{.r .cell-code}\ndat_summ %>% filter(type == \"corrected\", season == \"sum\", temp_avg >= c(maxobs[1,5])) # 2050-2055\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 48 × 8\n   type      season  year count temp_avg temp_sd temp_min temp_max\n   <chr>     <chr>  <dbl> <dbl>    <dbl>   <dbl>    <dbl>    <dbl>\n 1 corrected sum     2050    15     17.4   0.891     16.1     19.4\n 2 corrected sum     2051    15     17.5   1.48      15.3     20.5\n 3 corrected sum     2053    15     17.6   0.926     16.0     19.3\n 4 corrected sum     2055    15     17.6   1.37      15.7     20.7\n 5 corrected sum     2056    15     17.7   1.17      15.5     19.7\n 6 corrected sum     2057    15     17.6   1.06      15.7     19.3\n 7 corrected sum     2058    15     17.5   1.27      16.4     20.4\n 8 corrected sum     2059    15     18.0   1.23      15.1     20.3\n 9 corrected sum     2060    15     17.8   1.33      16.0     20.4\n10 corrected sum     2061    15     18.1   1.13      16.2     20.3\n# ℹ 38 more rows\n```\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}